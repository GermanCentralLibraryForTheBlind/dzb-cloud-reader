/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*!
 * jQuery JavaScript Library v1.11.0
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-01-23T21:02Z
 */

/*!
 * Sizzle CSS Selector Engine v1.10.16
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-01-13
 */

/*!
 * Bootstrap v3.0.3 (http://getbootstrap.com)
 * Copyright 2013 Twitter, Inc.
 * Licensed under http://www.apache.org/licenses/LICENSE-2.0
 */

//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.
//  
//  Redistribution and use in source and binary forms, with or without modification, 
//  are permitted provided that the following conditions are met:
//  1. Redistributions of source code must retain the above copyright notice, this 
//  list of conditions and the following disclaimer.
//  2. Redistributions in binary form must reproduce the above copyright notice, 
//  this list of conditions and the following disclaimer in the documentation and/or 
//  other materials provided with the distribution.
//  3. Neither the name of the organization nor the names of its contributors may be 
//  used to endorse or promote products derived from this software without specific 
//  prior written permission.

/**
 * @license RequireJS text 2.0.6 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*!
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

/**@license
 * RequireJS Hogan Plugin | v0.2.1 (2013/02/08)
 * Author: Miller Medeiros | MIT License
 */

//     keymaster.js
//     (c) 2011-2013 Thomas Fuchs
//     keymaster.js may be freely distributed under the MIT license.

/*
colpick Color Picker
Copyright 2013 Jose Vargas. Licensed under GPL license. Based on Stefan Petre's Color Picker www.eyecon.ro, dual licensed under the MIT and GPL licenses

For usage and examples: colpick.com/plugin
 */

//     Underscore.js 1.4.4
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore may be freely distributed under the MIT license.

//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/*
 Copyright (c) 2013 Gildas Lormeau. All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

 1. Redistributions of source code must retain the above copyright notice,
 this list of conditions and the following disclaimer.

 2. Redistributions in binary form must reproduce the above copyright
 notice, this list of conditions and the following disclaimer in
 the documentation and/or other materials provided with the distribution.

 3. The names of the authors may not be used to endorse or promote products
 derived from this software without specific prior written permission.

 THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED WARRANTIES,
 INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL JCRAFT,
 INC. OR ANY CONTRIBUTORS TO THIS SOFTWARE BE LIABLE FOR ANY DIRECT, INDIRECT,
 INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
 OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 Copyright (c) 2013 Gildas Lormeau. All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

 1. Redistributions of source code must retain the above copyright notice,
 this list of conditions and the following disclaimer.

 2. Redistributions in binary form must reproduce the above copyright 
 notice, this list of conditions and the following disclaimer in 
 the documentation and/or other materials provided with the distribution.

 3. The names of the authors may not be used to endorse or promote products
 derived from this software without specific prior written permission.

 THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED WARRANTIES,
 INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL JCRAFT,
 INC. OR ANY CONTRIBUTORS TO THIS SOFTWARE BE LIABLE FOR ANY DIRECT, INDIRECT,
 INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
 OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * Crypto-JS v2.5.3
 * http://code.google.com/p/crypto-js/
 * (c) 2009-2012 by Jeff Mott. All rights reserved.
 * http://code.google.com/p/crypto-js/wiki/License
 */

/*! http://mths.be/punycode by @mathias */

/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.10.0
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.com/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0
 *
 */

/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.10.0
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.com/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0
 *
 */

/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.11.2
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.com/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0 
 *
 */

//  LauncherOSX
//
//  Created by Boris Schneiderman.
//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.
//  
//  Redistribution and use in source and binary forms, with or without modification, 
//  are permitted provided that the following conditions are met:
//  1. Redistributions of source code must retain the above copyright notice, this 
//  list of conditions and the following disclaimer.
//  2. Redistributions in binary form must reproduce the above copyright notice, 
//  this list of conditions and the following disclaimer in the documentation and/or 
//  other materials provided with the distribution.
//  3. Neither the name of the organization nor the names of its contributors may be 
//  used to endorse or promote products derived from this software without specific 
//  prior written permission.
//  
//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND 
//  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
//  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. 
//  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, 
//  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, 
//  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
//  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF 
//  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE 
//  OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
//  OF THE POSSIBILITY OF SUCH DAMAGE.

/**
 * @preserve JSizes - JQuery plugin v0.33
 *
 * Licensed under the revised BSD License.
 * Copyright 2008-2010 Bram Stein
 * All rights reserved.
 */

//  Created by Boris Schneiderman.
//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.
//  
//  Redistribution and use in source and binary forms, with or without modification, 
//  are permitted provided that the following conditions are met:
//  1. Redistributions of source code must retain the above copyright notice, this 
//  list of conditions and the following disclaimer.
//  2. Redistributions in binary form must reproduce the above copyright notice, 
//  this list of conditions and the following disclaimer in the documentation and/or 
//  other materials provided with the distribution.
//  3. Neither the name of the organization nor the names of its contributors may be 
//  used to endorse or promote products derived from this software without specific 
//  prior written permission.
//  
//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND 
//  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
//  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. 
//  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, 
//  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, 
//  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
//  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF 
//  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE 
//  OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
//  OF THE POSSIBILITY OF SUCH DAMAGE.

//  LauncherOSX
//
//  Created by Boris Schneiderman.
// Modified by Daniel Weck
//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.
//  
//  Redistribution and use in source and binary forms, with or without modification, 
//  are permitted provided that the following conditions are met:
//  1. Redistributions of source code must retain the above copyright notice, this 
//  list of conditions and the following disclaimer.
//  2. Redistributions in binary form must reproduce the above copyright notice, 
//  this list of conditions and the following disclaimer in the documentation and/or 
//  other materials provided with the distribution.
//  3. Neither the name of the organization nor the names of its contributors may be 
//  used to endorse or promote products derived from this software without specific 
//  prior written permission.
//  
//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND 
//  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
//  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. 
//  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, 
//  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, 
//  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
//  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF 
//  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE 
//  OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
//  OF THE POSSIBILITY OF SUCH DAMAGE.

//  LauncherOSX
//
//  Created by Boris Schneiderman.
// Modified by Daniel Weck, Andrey Kavarma
//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.
//  
//  Redistribution and use in source and binary forms, with or without modification, 
//  are permitted provided that the following conditions are met:
//  1. Redistributions of source code must retain the above copyright notice, this 
//  list of conditions and the following disclaimer.
//  2. Redistributions in binary form must reproduce the above copyright notice, 
//  this list of conditions and the following disclaimer in the documentation and/or 
//  other materials provided with the distribution.
//  3. Neither the name of the organization nor the names of its contributors may be 
//  used to endorse or promote products derived from this software without specific 
//  prior written permission.
//  
//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND 
//  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
//  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. 
//  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, 
//  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, 
//  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
//  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF 
//  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE 
//  OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
//  OF THE POSSIBILITY OF SUCH DAMAGE.

/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

/**
 * Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Copyright 2013, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3alpha.804
 * Build date: 8 December 2013
 */

/**
 * Highlighter module for Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Depends on Rangy core, TextRange and CssClassApplier modules.
 *
 * Copyright 2013, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3alpha.804
 * Build date: 8 December 2013
 */

/**
 * Class Applier module for Rangy.
 * Adds, removes and toggles classes on Ranges and Selections
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Depends on Rangy core.
 *
 * Copyright 2013, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3alpha.804
 * Build date: 8 December 2013
 */

/**
 * Text range module for Rangy.
 * Text-based manipulation and searching of ranges and selections.
 *
 * Features
 *
 * - Ability to move range boundaries by character or word offsets
 * - Customizable word tokenizer
 * - Ignores text nodes inside <script> or <style> elements or those hidden by CSS display and visibility properties
 * - Range findText method to search for text or regex within the page or within a range. Flags for whole words and case
 *   sensitivity
 * - Selection and range save/restore as text offsets within a node
 * - Methods to return visible text within a range or selection
 * - innerText method for elements
 *
 * References
 *
 * https://www.w3.org/Bugs/Public/show_bug.cgi?id=13145
 * http://aryeh.name/spec/innertext/innertext.html
 * http://dvcs.w3.org/hg/editing/raw-file/tip/editing.html
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Depends on Rangy core.
 *
 * Copyright 2013, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3alpha.804
 * Build date: 8 December 2013
 */

/**
 * Position module for Rangy.
 * Extensions to Range and Selection objects to provide access to pixel positions relative to the viewport or document.
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Depends on Rangy core.
 *
 * Copyright %%build:year%%, Tim Down
 * Licensed under the MIT license.
 * Version: %%build:version%%
 * Build date: %%build:date%%
 */

//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.
// 
//  Redistribution and use in source and binary forms, with or without modification, 
//  are permitted provided that the following conditions are met:
//  1. Redistributions of source code must retain the above copyright notice, this 
//  list of conditions and the following disclaimer.
//  2. Redistributions in binary form must reproduce the above copyright notice, 
//  this list of conditions and the following disclaimer in the documentation and/or 
//  other materials provided with the distribution.
//  3. Neither the name of the organization nor the names of its contributors may be 
//  used to endorse or promote products derived from this software without specific 
//  prior written permission.
//  
//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND 
//  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
//  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. 
//  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, 
//  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, 
//  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
//  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF 
//  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE 
//  OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
//  OF THE POSSIBILITY OF SUCH DAMAGE.

//  Created by Dmitry Markushevich (dmitrym@evidentpoint.com)
// 
//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.
//  
//  Redistribution and use in source and binary forms, with or without modification, 
//  are permitted provided that the following conditions are met:
//  1. Redistributions of source code must retain the above copyright notice, this 
//  list of conditions and the following disclaimer.
//  2. Redistributions in binary form must reproduce the above copyright notice, 
//  this list of conditions and the following disclaimer in the documentation and/or 
//  other materials provided with the distribution.
//  3. Neither the name of the organization nor the names of its contributors may be 
//  used to endorse or promote products derived from this software without specific 
//  prior written permission.
//  
//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND 
//  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
//  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. 
//  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, 
//  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, 
//  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
//  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF 
//  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE 
//  OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
//  OF THE POSSIBILITY OF SUCH DAMAGE.

//  Created by Boris Schneiderman.
// Modified by Daniel Weck
//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.
//  
//  Redistribution and use in source and binary forms, with or without modification, 
//  are permitted provided that the following conditions are met:
//  1. Redistributions of source code must retain the above copyright notice, this 
//  list of conditions and the following disclaimer.
//  2. Redistributions in binary form must reproduce the above copyright notice, 
//  this list of conditions and the following disclaimer in the documentation and/or 
//  other materials provided with the distribution.
//  3. Neither the name of the organization nor the names of its contributors may be 
//  used to endorse or promote products derived from this software without specific 
//  prior written permission.
//  
//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND 
//  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
//  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. 
//  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, 
//  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, 
//  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
//  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF 
//  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE 
//  OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
//  OF THE POSSIBILITY OF SUCH DAMAGE.

/*!
* screenfull
* v1.2.0 - 2014-04-29
* (c) Sindre Sorhus; MIT License
*/

/*! Hammer.JS - v1.0.6 - 2014-01-02
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */

/*! jQuery plugin for Hammer.JS - v1.0.0 - 2014-01-02
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */

var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("thirdparty/almond",function(){}),function(e,t){typeof module=="object"&&typeof module.exports=="object"?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}(typeof window!="undefined"?window:this,function(e,t){function y(e){var t=e.length,n=p.type(e);return n==="function"||p.isWindow(e)?!1:e.nodeType===1&&t?!0:n==="array"||t===0||typeof t=="number"&&t>0&&t-1 in e}function x(e,t,n){if(p.isFunction(t))return p.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return p.grep(e,function(e){return e===t!==n});if(typeof t=="string"){if(S.test(t))return p.filter(t,e,n);t=p.filter(t,e)}return p.grep(e,function(e){return p.inArray(e,t)>=0!==n})}function O(e,t){do e=e[t];while(e&&e.nodeType!==1);return e}function D(e){var t=_[e]={};return p.each(e.match(M)||[],function(e,n){t[n]=!0}),t}function H(){N.addEventListener?(N.removeEventListener("DOMContentLoaded",B,!1),e.removeEventListener("load",B,!1)):(N.detachEvent("onreadystatechange",B),e.detachEvent("onload",B))}function B(){if(N.addEventListener||event.type==="load"||N.readyState==="complete")H(),p.ready()}function R(e,t,n){if(n===undefined&&e.nodeType===1){var r="data-"+t.replace(q,"-$1").toLowerCase();n=e.getAttribute(r);if(typeof n=="string"){try{n=n==="true"?!0:n==="false"?!1:n==="null"?null:+n+""===n?+n:I.test(n)?p.parseJSON(n):n}catch(i){}p.data(e,t,n)}else n=undefined}return n}function U(e){var t;for(t in e){if(t==="data"&&p.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function z(e,t,r,i){if(!p.acceptData(e))return;var s,o,u=p.expando,a=e.nodeType,f=a?p.cache:e,l=a?e[u]:e[u]&&u;if((!l||!f[l]||!i&&!f[l].data)&&r===undefined&&typeof t=="string")return;l||(a?l=e[u]=n.pop()||p.guid++:l=u),f[l]||(f[l]=a?{}:{toJSON:p.noop});if(typeof t=="object"||typeof t=="function")i?f[l]=p.extend(f[l],t):f[l].data=p.extend(f[l].data,t);return o=f[l],i||(o.data||(o.data={}),o=o.data),r!==undefined&&(o[p.camelCase(t)]=r),typeof t=="string"?(s=o[t],s==null&&(s=o[p.camelCase(t)])):s=o,s}function W(e,t,n){if(!p.acceptData(e))return;var r,i,s=e.nodeType,o=s?p.cache:e,u=s?e[p.expando]:p.expando;if(!o[u])return;if(t){r=n?o[u]:o[u].data;if(r){p.isArray(t)?t=t.concat(p.map(t,p.camelCase)):t in r?t=[t]:(t=p.camelCase(t),t in r?t=[t]:t=t.split(" ")),i=t.length;while(i--)delete r[t[i]];if(n?!U(r):!p.isEmptyObject(r))return}}if(!n){delete o[u].data;if(!U(o[u]))return}s?p.cleanData([e],!0):c.deleteExpando||o!=o.window?delete o[u]:o[u]=null}function tt(){return!0}function nt(){return!1}function rt(){try{return N.activeElement}catch(e){}}function it(e){var t=st.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Et(e,t){var n,r,i=0,s=typeof e.getElementsByTagName!==j?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==j?e.querySelectorAll(t||"*"):undefined;if(!s)for(s=[],n=e.childNodes||e;(r=n[i])!=null;i++)!t||p.nodeName(r,t)?s.push(r):p.merge(s,Et(r,t));return t===undefined||t&&p.nodeName(e,t)?p.merge([e],s):s}function St(e){K.test(e.type)&&(e.defaultChecked=e.checked)}function xt(e,t){return p.nodeName(e,"table")&&p.nodeName(t.nodeType!==11?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function Tt(e){return e.type=(p.find.attr(e,"type")!==null)+"/"+e.type,e}function Nt(e){var t=mt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Ct(e,t){var n,r=0;for(;(n=e[r])!=null;r++)p._data(n,"globalEval",!t||p._data(t[r],"globalEval"))}function kt(e,t){if(t.nodeType!==1||!p.hasData(e))return;var n,r,i,s=p._data(e),o=p._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)p.event.add(t,n,u[n][r])}o.data&&(o.data=p.extend({},o.data))}function Lt(e,t){var n,r,i;if(t.nodeType!==1)return;n=t.nodeName.toLowerCase();if(!c.noCloneEvent&&t[p.expando]){i=p._data(t);for(r in i.events)p.removeEvent(t,r,i.handle);t.removeAttribute(p.expando)}if(n==="script"&&t.text!==e.text)Tt(t).text=e.text,Nt(t);else if(n==="object")t.parentNode&&(t.outerHTML=e.outerHTML),c.html5Clone&&e.innerHTML&&!p.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML);else if(n==="input"&&K.test(e.type))t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value);else if(n==="option")t.defaultSelected=t.selected=e.defaultSelected;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}function Mt(t,n){var r=p(n.createElement(t)).appendTo(n.body),i=e.getDefaultComputedStyle?e.getDefaultComputedStyle(r[0]).display:p.css(r[0],"display");return r.detach(),i}function _t(e){var t=N,n=Ot[e];if(!n){n=Mt(e,t);if(n==="none"||!n)At=(At||p("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=(At[0].contentWindow||At[0].contentDocument).document,t.write(),t.close(),n=Mt(e,t),At.detach();Ot[e]=n}return n}function Ft(e,t){return{get:function(){var n=e();if(n==null)return;if(n){delete this.get;return}return(this.get=t).apply(this,arguments)}}}function $t(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Vt.length;while(i--){t=Vt[i]+n;if(t in e)return t}return r}function Jt(e,t){var n,r,i,s=[],o=0,u=e.length;for(;o<u;o++){r=e[o];if(!r.style)continue;s[o]=p._data(r,"olddisplay"),n=r.style.display,t?(!s[o]&&n==="none"&&(r.style.display=""),r.style.display===""&&$(r)&&(s[o]=p._data(r,"olddisplay",_t(r.nodeName)))):s[o]||(i=$(r),(n&&n!=="none"||!i)&&p._data(r,"olddisplay",i?n:p.css(r,"display")))}for(o=0;o<u;o++){r=e[o];if(!r.style)continue;if(!t||r.style.display==="none"||r.style.display==="")r.style.display=t?s[o]||"":"none"}return e}function Kt(e,t,n){var r=Ut.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function Qt(e,t,n,r,i){var s=n===(r?"border":"content")?4:t==="width"?1:0,o=0;for(;s<4;s+=2)n==="margin"&&(o+=p.css(e,n+V[s],!0,i)),r?(n==="content"&&(o-=p.css(e,"padding"+V[s],!0,i)),n!=="margin"&&(o-=p.css(e,"border"+V[s]+"Width",!0,i))):(o+=p.css(e,"padding"+V[s],!0,i),n!=="padding"&&(o+=p.css(e,"border"+V[s]+"Width",!0,i)));return o}function Gt(e,t,n){var r=!0,i=t==="width"?e.offsetWidth:e.offsetHeight,s=Ht(e),o=c.boxSizing()&&p.css(e,"boxSizing",!1,s)==="border-box";if(i<=0||i==null){i=Bt(e,t,s);if(i<0||i==null)i=e.style[t];if(Pt.test(i))return i;r=o&&(c.boxSizingReliable()||i===e.style[t]),i=parseFloat(i)||0}return i+Qt(e,t,n||(o?"border":"content"),r,s)+"px"}function Yt(e,t,n,r,i){return new Yt.prototype.init(e,t,n,r,i)}function un(){return setTimeout(function(){Zt=undefined}),Zt=p.now()}function an(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=V[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function fn(e,t,n){var r,i=(on[t]||[]).concat(on["*"]),s=0,o=i.length;for(;s<o;s++)if(r=i[s].call(n,t,e))return r}function ln(e,t,n){var r,i,s,o,u,a,f,l,h=this,d={},v=e.style,m=e.nodeType&&$(e),g=p._data(e,"fxshow");n.queue||(u=p._queueHooks(e,"fx"),u.unqueued==null&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,h.always(function(){h.always(function(){u.unqueued--,p.queue(e,"fx").length||u.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[v.overflow,v.overflowX,v.overflowY],f=p.css(e,"display"),l=_t(e.nodeName),f==="none"&&(f=l),f==="inline"&&p.css(e,"float")==="none"&&(!c.inlineBlockNeedsLayout||l==="inline"?v.display="inline-block":v.zoom=1)),n.overflow&&(v.overflow="hidden",c.shrinkWrapBlocks()||h.always(function(){v.overflow=n.overflow[0],v.overflowX=n.overflow[1],v.overflowY=n.overflow[2]}));for(r in t){i=t[r];if(tn.exec(i)){delete t[r],s=s||i==="toggle";if(i===(m?"hide":"show")){if(i!=="show"||!g||g[r]===undefined)continue;m=!0}d[r]=g&&g[r]||p.style(e,r)}}if(!p.isEmptyObject(d)){g?"hidden"in g&&(m=g.hidden):g=p._data(e,"fxshow",{}),s&&(g.hidden=!m),m?p(e).show():h.done(function(){p(e).hide()}),h.done(function(){var t;p._removeData(e,"fxshow");for(t in d)p.style(e,t,d[t])});for(r in d)o=fn(m?g[r]:0,r,h),r in g||(g[r]=o.start,m&&(o.end=o.start,o.start=r==="width"||r==="height"?1:0))}}function cn(e,t){var n,r,i,s,o;for(n in e){r=p.camelCase(n),i=t[r],s=e[n],p.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=p.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function hn(e,t,n){var r,i,s=0,o=sn.length,u=p.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=Zt||un(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;o<a;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),s<1&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:p.extend({},t),opts:p.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Zt||un(),duration:n.duration,tweens:[],createTween:function(t,n){var r=p.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;i=!0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;cn(l,f.opts.specialEasing);for(;s<o;s++){r=sn[s].call(f,e,l,f.opts);if(r)return r}return p.map(l,fn,f),p.isFunction(f.opts.start)&&f.opts.start.call(e,f),p.fx.timer(p.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function In(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(M)||[];if(p.isFunction(n))while(r=s[i++])r.charAt(0)==="+"?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qn(e,t,n,r){function o(u){var a;return i[u]=!0,p.each(e[u]||[],function(e,u){var f=u(t,n,r);if(typeof f=="string"&&!s&&!i[f])return t.dataTypes.unshift(f),o(f),!1;if(s)return!(a=f)}),a}var i={},s=e===Bn;return o(t.dataTypes[0])||!i["*"]&&o("*")}function Rn(e,t){var n,r,i=p.ajaxSettings.flatOptions||{};for(r in t)t[r]!==undefined&&((i[r]?e:n||(n={}))[r]=t[r]);return n&&p.extend(!0,e,n),e}function Un(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while(a[0]==="*")a.shift(),i===undefined&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(o in u)if(u[o]&&u[o].test(i)){a.unshift(o);break}if(a[0]in n)s=a[0];else{for(o in n){if(!a[0]||e.converters[o+" "+a[0]]){s=o;break}r||(r=o)}s=s||r}if(s)return s!==a[0]&&a.unshift(s),n[s]}function zn(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s){e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift();if(s)if(s==="*")s=a;else if(a!=="*"&&a!==s){o=f[a+" "+s]||f["* "+s];if(!o)for(i in f){u=i.split(" ");if(u[1]===s){o=f[a+" "+u[0]]||f["* "+u[0]];if(o){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}}}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}}return{state:"success",data:t}}function Kn(e,t,n,r){var i;if(p.isArray(t))p.each(t,function(t,i){n||Xn.test(e)?r(e,i):Kn(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&p.type(t)==="object")for(i in t)Kn(e+"["+i+"]",t[i],n,r);else r(e,t)}function Zn(){try{return new e.XMLHttpRequest}catch(t){}}function er(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function sr(e){return p.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n=[],r=n.slice,i=n.concat,s=n.push,o=n.indexOf,u={},a=u.toString,f=u.hasOwnProperty,l="".trim,c={},h="1.11.0",p=function(e,t){return new p.fn.init(e,t)},d=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,v=/^-ms-/,m=/-([\da-z])/gi,g=function(e,t){return t.toUpperCase()};p.fn=p.prototype={jquery:h,constructor:p,selector:"",length:0,toArray:function(){return r.call(this)},get:function(e){return e!=null?e<0?this[e+this.length]:this[e]:r.call(this)},pushStack:function(e){var t=p.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return p.each(this,e,t)},map:function(e){return this.pushStack(p.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:s,sort:n.sort,splice:n.splice},p.extend=p.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[u]||{},u++),typeof o!="object"&&!p.isFunction(o)&&(o={}),u===a&&(o=this,u--);for(;u<a;u++)if((i=arguments[u])!=null)for(r in i){e=o[r],n=i[r];if(o===n)continue;f&&n&&(p.isPlainObject(n)||(t=p.isArray(n)))?(t?(t=!1,s=e&&p.isArray(e)?e:[]):s=e&&p.isPlainObject(e)?e:{},o[r]=p.extend(f,s,n)):n!==undefined&&(o[r]=n)}return o},p.extend({expando:"jQuery"+(h+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return p.type(e)==="function"},isArray:Array.isArray||function(e){return p.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return e-parseFloat(e)>=0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isPlainObject:function(e){var t;if(!e||p.type(e)!=="object"||e.nodeType||p.isWindow(e))return!1;try{if(e.constructor&&!f.call(e,"constructor")&&!f.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(c.ownLast)for(t in e)return f.call(e,t);for(t in e);return t===undefined||f.call(e,t)},type:function(e){return e==null?e+"":typeof e=="object"||typeof e=="function"?u[a.call(e)]||"object":typeof e},globalEval:function(t){t&&p.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(v,"ms-").replace(m,g)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=y(e);if(n)if(o)for(;i<s;i++){r=t.apply(e[i],n);if(r===!1)break}else for(i in e){r=t.apply(e[i],n);if(r===!1)break}else if(o)for(;i<s;i++){r=t.call(e[i],i,e[i]);if(r===!1)break}else for(i in e){r=t.call(e[i],i,e[i]);if(r===!1)break}return e},trim:l&&!l.call("﻿ ")?function(e){return e==null?"":l.call(e)}:function(e){return e==null?"":(e+"").replace(d,"")},makeArray:function(e,t){var n=t||[];return e!=null&&(y(Object(e))?p.merge(n,typeof e=="string"?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(o)return o.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,t){var n=+t.length,r=0,i=e.length;while(r<n)e[i++]=t[r++];if(n!==n)while(t[r]!==undefined)e[i++]=t[r++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length,u=!n;for(;s<o;s++)r=!t(e[s],s),r!==u&&i.push(e[s]);return i},map:function(e,t,n){var r,s=0,o=e.length,u=y(e),a=[];if(u)for(;s<o;s++)r=t(e[s],s,n),r!=null&&a.push(r);else for(s in e)r=t(e[s],s,n),r!=null&&a.push(r);return i.apply([],a)},guid:1,proxy:function(e,t){var n,i,s;return typeof t=="string"&&(s=e[t],t=e,e=s),p.isFunction(e)?(n=r.call(arguments,2),i=function(){return e.apply(t||this,n.concat(r.call(arguments)))},i.guid=e.guid=e.guid||p.guid++,i):undefined},now:function(){return+(new Date)},support:c}),p.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){u["[object "+t+"]"]=t.toLowerCase()});var b=function(e){function rt(e,t,r,i){var s,o,u,a,f,h,v,m,w,E;(t?t.ownerDocument||t:b)!==c&&l(t),t=t||c,r=r||[];if(!e||typeof e!="string")return r;if((a=t.nodeType)!==1&&a!==9)return[];if(p&&!i){if(s=G.exec(e))if(u=s[1]){if(a===9){o=t.getElementById(u);if(!o||!o.parentNode)return r;if(o.id===u)return r.push(o),r}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(u))&&g(t,o)&&o.id===u)return r.push(o),r}else{if(s[2])return _.apply(r,t.getElementsByTagName(e)),r;if((u=s[3])&&n.getElementsByClassName&&t.getElementsByClassName)return _.apply(r,t.getElementsByClassName(u)),r}if(n.qsa&&(!d||!d.test(e))){m=v=y,w=t,E=a===9&&e;if(a===1&&t.nodeName.toLowerCase()!=="object"){h=dt(e),(v=t.getAttribute("id"))?m=v.replace(Z,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",f=h.length;while(f--)h[f]=m+vt(h[f]);w=Y.test(e)&&ht(t.parentNode)||t,E=h.join(",")}if(E)try{return _.apply(r,w.querySelectorAll(E)),r}catch(S){}finally{v||t.removeAttribute("id")}}}return xt(e.replace(R,"$1"),t,r,i)}function it(){function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}var e=[];return t}function st(e){return e[y]=!0,e}function ot(e){var t=c.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ut(e,t){var n=e.split("|"),i=e.length;while(i--)r.attrHandle[n[i]]=t}function at(e,t){var n=t&&e,r=n&&e.nodeType===1&&t.nodeType===1&&(~t.sourceIndex||k)-(~e.sourceIndex||k);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function ct(e){return st(function(t){return t=+t,st(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ht(e){return e&&typeof e.getElementsByTagName!==C&&e}function pt(){}function dt(e,t){var n,i,s,o,u,a,f,l=x[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=r.preFilter;while(u){if(!n||(i=U.exec(u)))i&&(u=u.slice(i[0].length)||u),a.push(s=[]);n=!1;if(i=z.exec(u))n=i.shift(),s.push({value:n,type:i[0].replace(R," ")}),u=u.slice(n.length);for(o in r.filter)(i=$[o].exec(u))&&(!f[o]||(i=f[o](i)))&&(n=i.shift(),s.push({value:n,type:o,matches:i}),u=u.slice(n.length));if(!n)break}return t?u.length:u?rt.error(e):x(e,a).slice(0)}function vt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function mt(e,t,n){var r=t.dir,i=n&&r==="parentNode",s=E++;return t.first?function(t,n,s){while(t=t[r])if(t.nodeType===1||i)return e(t,n,s)}:function(t,n,o){var u,a,f=[w,s];if(o){while(t=t[r])if(t.nodeType===1||i)if(e(t,n,o))return!0}else while(t=t[r])if(t.nodeType===1||i){a=t[y]||(t[y]={});if((u=a[r])&&u[0]===w&&u[1]===s)return f[2]=u[2];a[r]=f;if(f[2]=e(t,n,o))return!0}}}function gt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function yt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function bt(e,t,n,r,i,s){return r&&!r[y]&&(r=bt(r)),i&&!i[y]&&(i=bt(i,s)),st(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||St(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?yt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=yt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?P.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=yt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):_.apply(o,g)})}function wt(e){var t,n,i,s=e.length,o=r.relative[e[0].type],a=o||r.relative[" "],f=o?1:0,l=mt(function(e){return e===t},a,!0),c=mt(function(e){return P.call(t,e)>-1},a,!0),h=[function(e,n,r){return!o&&(r||n!==u)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;f<s;f++)if(n=r.relative[e[f].type])h=[mt(gt(h),n)];else{n=r.filter[e[f].type].apply(null,e[f].matches);if(n[y]){i=++f;for(;i<s;i++)if(r.relative[e[i].type])break;return bt(f>1&&gt(h),f>1&&vt(e.slice(0,f-1).concat({value:e[f-2].type===" "?"*":""})).replace(R,"$1"),n,f<i&&wt(e.slice(f,i)),i<s&&wt(e=e.slice(i)),i<s&&vt(e))}h.push(n)}return gt(h)}function Et(e,t){var n=t.length>0,i=e.length>0,s=function(s,o,a,f,l){var h,p,d,v=0,m="0",g=s&&[],y=[],b=u,E=s||i&&r.find.TAG("*",l),S=w+=b==null?1:Math.random()||.1,x=E.length;l&&(u=o!==c&&o);for(;m!==x&&(h=E[m])!=null;m++){if(i&&h){p=0;while(d=e[p++])if(d(h,o,a)){f.push(h);break}l&&(w=S)}n&&((h=!d&&h)&&v--,s&&g.push(h))}v+=m;if(n&&m!==v){p=0;while(d=t[p++])d(g,y,o,a);if(s){if(v>0)while(m--)!g[m]&&!y[m]&&(y[m]=O.call(f));y=yt(y)}_.apply(f,y),l&&!s&&y.length>0&&v+t.length>1&&rt.uniqueSort(f)}return l&&(w=S,u=b),g};return n?st(s):s}function St(e,t,n){var r=0,i=t.length;for(;r<i;r++)rt(e,t[r],n);return n}function xt(e,t,i,s){var u,a,f,l,c,h=dt(e);if(!s&&h.length===1){a=h[0]=h[0].slice(0);if(a.length>2&&(f=a[0]).type==="ID"&&n.getById&&t.nodeType===9&&p&&r.relative[a[1].type]){t=(r.find.ID(f.matches[0].replace(et,tt),t)||[])[0];if(!t)return i;e=e.slice(a.shift().value.length)}u=$.needsContext.test(e)?0:a.length;while(u--){f=a[u];if(r.relative[l=f.type])break;if(c=r.find[l])if(s=c(f.matches[0].replace(et,tt),Y.test(a[0].type)&&ht(t.parentNode)||t)){a.splice(u,1),e=s.length&&vt(a);if(!e)return _.apply(i,s),i;break}}}return o(e,h)(s,t,!p,i,Y.test(e)&&ht(t.parentNode)||t),i}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y="sizzle"+ -(new Date),b=e.document,w=0,E=0,S=it(),x=it(),T=it(),N=function(e,t){return e===t&&(f=!0),0},C=typeof undefined,k=1<<31,L={}.hasOwnProperty,A=[],O=A.pop,M=A.push,_=A.push,D=A.slice,P=A.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},H="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",B="[\\x20\\t\\r\\n\\f]",j="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",F=j.replace("w","w#"),I="\\["+B+"*("+j+")"+B+"*(?:([*^$|!~]?=)"+B+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+F+")|)|)"+B+"*\\]",q=":("+j+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+I.replace(3,8)+")*)|.*)\\)|)",R=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g"),U=new RegExp("^"+B+"*,"+B+"*"),z=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),W=new RegExp("="+B+"*([^\\]'\"]*?)"+B+"*\\]","g"),X=new RegExp(q),V=new RegExp("^"+F+"$"),$={ID:new RegExp("^#("+j+")"),CLASS:new RegExp("^\\.("+j+")"),TAG:new RegExp("^("+j.replace("w","w*")+")"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+H+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},J=/^(?:input|select|textarea|button)$/i,K=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,G=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Y=/[+~]/,Z=/'|\\/g,et=new RegExp("\\\\([\\da-f]{1,6}"+B+"?|("+B+")|.)","ig"),tt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,r&1023|56320)};try{_.apply(A=D.call(b.childNodes),b.childNodes),A[b.childNodes.length].nodeType}catch(nt){_={apply:A.length?function(e,t){M.apply(e,D.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}n=rt.support={},s=rt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},l=rt.setDocument=function(e){var t,i=e?e.ownerDocument||e:b,o=i.defaultView;if(i===c||i.nodeType!==9||!i.documentElement)return c;c=i,h=i.documentElement,p=!s(i),o&&o!==o.top&&(o.addEventListener?o.addEventListener("unload",function(){l()},!1):o.attachEvent&&o.attachEvent("onunload",function(){l()})),n.attributes=ot(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ot(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Q.test(i.getElementsByClassName)&&ot(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",e.getElementsByClassName("i").length===2}),n.getById=ot(function(e){return h.appendChild(e).id=y,!i.getElementsByName||!i.getElementsByName(y).length}),n.getById?(r.find.ID=function(e,t){if(typeof t.getElementById!==C&&p){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},r.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==C&&e.getAttributeNode("id");return n&&n.value===t}}),r.find.TAG=n.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==C)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++])n.nodeType===1&&r.push(n);return r}return s},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==C&&p)return t.getElementsByClassName(e)},v=[],d=[];if(n.qsa=Q.test(i.querySelectorAll))ot(function(e){e.innerHTML="<select t=''><option selected=''></option></select>",e.querySelectorAll("[t^='']").length&&d.push("[*^$]="+B+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||d.push("\\["+B+"*(?:value|"+H+")"),e.querySelectorAll(":checked").length||d.push(":checked")}),ot(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&d.push("name"+B+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")});return(n.matchesSelector=Q.test(m=h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ot(function(e){n.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),v.push("!=",q)}),d=d.length&&new RegExp(d.join("|")),v=v.length&&new RegExp(v.join("|")),t=Q.test(h.compareDocumentPosition),g=t||Q.test(h.contains)?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},N=t?function(e,t){if(e===t)return f=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,r&1||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===i||e.ownerDocument===b&&g(b,e)?-1:t===i||t.ownerDocument===b&&g(b,t)?1:a?P.call(a,e)-P.call(a,t):0:r&4?-1:1)}:function(e,t){if(e===t)return f=!0,0;var n,r=0,s=e.parentNode,o=t.parentNode,u=[e],l=[t];if(!s||!o)return e===i?-1:t===i?1:s?-1:o?1:a?P.call(a,e)-P.call(a,t):0;if(s===o)return at(e,t);n=e;while(n=n.parentNode)u.unshift(n);n=t;while(n=n.parentNode)l.unshift(n);while(u[r]===l[r])r++;return r?at(u[r],l[r]):u[r]===b?-1:l[r]===b?1:0},i},rt.matches=function(e,t){return rt(e,null,null,t)},rt.matchesSelector=function(e,t){(e.ownerDocument||e)!==c&&l(e),t=t.replace(W,"='$1']");if(n.matchesSelector&&p&&(!v||!v.test(t))&&(!d||!d.test(t)))try{var r=m.call(e,t);if(r||n.disconnectedMatch||e.document&&e.document.nodeType!==11)return r}catch(i){}return rt(t,c,null,[e]).length>0},rt.contains=function(e,t){return(e.ownerDocument||e)!==c&&l(e),g(e,t)},rt.attr=function(e,t){(e.ownerDocument||e)!==c&&l(e);var i=r.attrHandle[t.toLowerCase()],s=i&&L.call(r.attrHandle,t.toLowerCase())?i(e,t,!p):undefined;return s!==undefined?s:n.attributes||!p?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},rt.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},rt.uniqueSort=function(e){var t,r=[],i=0,s=0;f=!n.detectDuplicates,a=!n.sortStable&&e.slice(0),e.sort(N);if(f){while(t=e[s++])t===e[s]&&(i=r.push(s));while(i--)e.splice(r[i],1)}return a=null,e},i=rt.getText=function(e){var t,n="",r=0,s=e.nodeType;if(!s)while(t=e[r++])n+=i(t);else if(s===1||s===9||s===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(s===3||s===4)return e.nodeValue;return n},r=rt.selectors={cacheLength:50,createPseudo:st,match:$,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||rt.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&rt.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return $.CHILD.test(e[0])?null:(e[3]&&e[4]!==undefined?e[2]=e[4]:n&&X.test(n)&&(t=dt(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(et,tt).toLowerCase();return e==="*"?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=S[e+" "];return t||(t=new RegExp("(^|"+B+")"+e+"("+B+"|$)"))&&S(e,function(e){return t.test(typeof e.className=="string"&&e.className||typeof e.getAttribute!==C&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=rt.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),b=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&b){l=m[y]||(m[y]={}),f=l[e]||[],p=f[0]===w&&f[1],h=f[0]===w&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[w,p,h];break}}else if(b&&(f=(t[y]||(t[y]={}))[e])&&f[0]===w)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){b&&((c[y]||(c[y]={}))[e]=[w,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||rt.error("unsupported pseudo: "+e);return i[y]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?st(function(e,n){var r,s=i(e,t),o=s.length;while(o--)r=P.call(e,s[o]),e[r]=!(n[r]=s[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:st(function(e){var t=[],n=[],r=o(e.replace(R,"$1"));return r[y]?st(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:st(function(e){return function(t){return rt(e,t).length>0}}),contains:st(function(e){return function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:st(function(e){return V.test(e||"")||rt.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=p?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===c.activeElement&&(!c.hasFocus||c.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return K.test(e.nodeName)},input:function(e){return J.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()==="text")},first:ct(function(){return[0]}),last:ct(function(e,t){return[t-1]}),eq:ct(function(e,t,n){return[n<0?n+t:n]}),even:ct(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:ct(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:ct(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:ct(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}},r.pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ft(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=lt(t);return pt.prototype=r.filters=r.pseudos,r.setFilters=new pt,o=rt.compile=function(e,t){var n,r=[],i=[],s=T[e+" "];if(!s){t||(t=dt(e)),n=t.length;while(n--)s=wt(t[n]),s[y]?r.push(s):i.push(s);s=T(e,Et(i,r))}return s},n.sortStable=y.split("").sort(N).join("")===y,n.detectDuplicates=!!f,l(),n.sortDetached=ot(function(e){return e.compareDocumentPosition(c.createElement("div"))&1}),ot(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild.getAttribute("href")==="#"})||ut("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,t.toLowerCase()==="type"?1:2)}),(!n.attributes||!ot(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),e.firstChild.getAttribute("value")===""}))&&ut("value",function(e,t,n){if(!n&&e.nodeName.toLowerCase()==="input")return e.defaultValue}),ot(function(e){return e.getAttribute("disabled")==null})||ut(H,function(e,t,n){var r;if(!n)return e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),rt}(e);p.find=b,p.expr=b.selectors,p.expr[":"]=p.expr.pseudos,p.unique=b.uniqueSort,p.text=b.getText,p.isXMLDoc=b.isXML,p.contains=b.contains;var w=p.expr.match.needsContext,E=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,S=/^.[^:#\[\.,]*$/;p.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),t.length===1&&r.nodeType===1?p.find.matchesSelector(r,e)?[r]:[]:p.find.matches(e,p.grep(t,function(e){return e.nodeType===1}))},p.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if(typeof e!="string")return this.pushStack(p(e).filter(function(){for(t=0;t<i;t++)if(p.contains(r[t],this))return!0}));for(t=0;t<i;t++)p.find(e,r[t],n);return n=this.pushStack(i>1?p.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(x(this,e||[],!1))},not:function(e){return this.pushStack(x(this,e||[],!0))},is:function(e){return!!x(this,typeof e=="string"&&w.test(e)?p(e):e||[],!1).length}});var T,N=e.document,C=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,k=p.fn.init=function(e,t){var n,r;if(!e)return this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?n=[null,e,null]:n=C.exec(e);if(n&&(n[1]||!t)){if(n[1]){t=t instanceof p?t[0]:t,p.merge(this,p.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:N,!0));if(E.test(n[1])&&p.isPlainObject(t))for(n in t)p.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}r=N.getElementById(n[2]);if(r&&r.parentNode){if(r.id!==n[2])return T.find(e);this.length=1,this[0]=r}return this.context=N,this.selector=e,this}return!t||t.jquery?(t||T).find(e):this.constructor(t).find(e)}return e.nodeType?(this.context=this[0]=e,this.length=1,this):p.isFunction(e)?typeof T.ready!="undefined"?T.ready(e):e(p):(e.selector!==undefined&&(this.selector=e.selector,this.context=e.context),p.makeArray(e,this))};k.prototype=p.fn,T=p(N);var L=/^(?:parents|prev(?:Until|All))/,A={children:!0,contents:!0,next:!0,prev:!0};p.extend({dir:function(e,t,n){var r=[],i=e[t];while(i&&i.nodeType!==9&&(n===undefined||i.nodeType!==1||!p(i).is(n)))i.nodeType===1&&r.push(i),i=i[t];return r},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}}),p.fn.extend({has:function(e){var t,n=p(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(p.contains(this,n[t]))return!0})},closest:function(e,t){var n,r=0,i=this.length,s=[],o=w.test(e)||typeof e!="string"?p(e,t||this.context):0;for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:n.nodeType===1&&p.find.matchesSelector(n,e))){s.push(n);break}return this.pushStack(s.length>1?p.unique(s):s)},index:function(e){return e?typeof e=="string"?p.inArray(this[0],p(e)):p.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(p.unique(p.merge(this.get(),p(e,t))))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),p.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return p.dir(e,"parentNode")},parentsUntil:function(e,t,n){return p.dir(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return p.dir(e,"nextSibling")},prevAll:function(e){return p.dir(e,"previousSibling")},nextUntil:function(e,t,n){return p.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return p.dir(e,"previousSibling",n)},siblings:function(e){return p.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return p.sibling(e.firstChild)},contents:function(e){return p.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:p.merge([],e.childNodes)}},function(e,t){p.fn[e]=function(n,r){var i=p.map(this,t,n);return e.slice(-5)!=="Until"&&(r=n),r&&typeof r=="string"&&(i=p.filter(r,i)),this.length>1&&(A[e]||(i=p.unique(i)),L.test(e)&&(i=i.reverse())),this.pushStack(i)}});var M=/\S+/g,_={};p.Callbacks=function(e){e=typeof e=="string"?_[e]||D(e):p.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){n=e.memory&&c,r=!0,s=o||0,o=0,i=u.length,t=!0;for(;u&&s<i;s++)if(u[s].apply(c[0],c[1])===!1&&e.stopOnFalse){n=!1;break}t=!1,u&&(a?a.length&&f(a.shift()):n?u=[]:l.disable())},l={add:function(){if(u){var r=u.length;(function s(t){p.each(t,function(t,n){var r=p.type(n);r==="function"?(!e.unique||!l.has(n))&&u.push(n):n&&n.length&&r!=="string"&&s(n)})})(arguments),t?i=u.length:n&&(o=r,f(n))}return this},remove:function(){return u&&p.each(arguments,function(e,n){var r;while((r=p.inArray(n,u,r))>-1)u.splice(r,1),t&&(r<=i&&i--,r<=s&&s--)}),this},has:function(e){return e?p.inArray(e,u)>-1:!!u&&!!u.length},empty:function(){return u=[],i=0,this},disable:function(){return u=a=n=undefined,this},disabled:function(){return!u},lock:function(){return a=undefined,n||l.disable(),this},locked:function(){return!a},fireWith:function(e,n){return u&&(!r||a)&&(n=n||[],n=[e,n.slice?n.slice():n],t?a.push(n):f(n)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},p.extend({Deferred:function(e){var t=[["resolve","done",p.Callbacks("once memory"),"resolved"],["reject","fail",p.Callbacks("once memory"),"rejected"],["notify","progress",p.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return p.Deferred(function(n){p.each(t,function(t,s){var o=p.isFunction(e[t])&&e[t];i[s[1]](function(){var e=o&&o.apply(this,arguments);e&&p.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s[0]+"With"](this===r?n.promise():this,o?[e]:arguments)})}),e=null}).promise()},promise:function(e){return e!=null?p.extend(e,r):r}},i={};return r.pipe=r.then,p.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=r.call(arguments),i=n.length,s=i!==1||e&&p.isFunction(e.promise)?i:0,o=s===1?e:p.Deferred(),u=function(e,t,n){return function(i){t[e]=this,n[e]=arguments.length>1?r.call(arguments):i,n===a?o.notifyWith(t,n):--s||o.resolveWith(t,n)}},a,f,l;if(i>1){a=new Array(i),f=new Array(i),l=new Array(i);for(;t<i;t++)n[t]&&p.isFunction(n[t].promise)?n[t].promise().done(u(t,l,n)).fail(o.reject).progress(u(t,f,a)):--s}return s||o.resolveWith(l,n),o.promise()}});var P;p.fn.ready=function(e){return p.ready.promise().done(e),this},p.extend({isReady:!1,readyWait:1,holdReady:function(e){e?p.readyWait++:p.ready(!0)},ready:function(e){if(e===!0?--p.readyWait:p.isReady)return;if(!N.body)return setTimeout(p.ready);p.isReady=!0;if(e!==!0&&--p.readyWait>0)return;P.resolveWith(N,[p]),p.fn.trigger&&p(N).trigger("ready").off("ready")}}),p.ready.promise=function(t){if(!P){P=p.Deferred();if(N.readyState==="complete")setTimeout(p.ready);else if(N.addEventListener)N.addEventListener("DOMContentLoaded",B,!1),e.addEventListener("load",B,!1);else{N.attachEvent("onreadystatechange",B),e.attachEvent("onload",B);var n=!1;try{n=e.frameElement==null&&N.documentElement}catch(r){}n&&n.doScroll&&function i(){if(!p.isReady){try{n.doScroll("left")}catch(e){return setTimeout(i,50)}H(),p.ready()}}()}}return P.promise(t)};var j=typeof undefined,F;for(F in p(c))break;c.ownLast=F!=="0",c.inlineBlockNeedsLayout=!1,p(function(){var e,t,n=N.getElementsByTagName("body")[0];if(!n)return;e=N.createElement("div"),e.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",t=N.createElement("div"),n.appendChild(e).appendChild(t);if(typeof t.style.zoom!==j){t.style.cssText="border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1";if(c.inlineBlockNeedsLayout=t.offsetWidth===3)n.style.zoom=1}n.removeChild(e),e=t=null}),function(){var e=N.createElement("div");if(c.deleteExpando==null){c.deleteExpando=!0;try{delete e.test}catch(t){c.deleteExpando=!1}}e=null}(),p.acceptData=function(e){var t=p.noData[(e.nodeName+" ").toLowerCase()],n=+e.nodeType||1;return n!==1&&n!==9?!1:!t||t!==!0&&e.getAttribute("classid")===t};var I=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,q=/([A-Z])/g;p.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?p.cache[e[p.expando]]:e[p.expando],!!e&&!U(e)},data:function(e,t,n){return z(e,t,n)},removeData:function(e,t){return W(e,t)},_data:function(e,t,n){return z(e,t,n,!0)},_removeData:function(e,t){return W(e,t,!0)}}),p.fn.extend({data:function(e,t){var n,r,i,s=this[0],o=s&&s.attributes;if(e===undefined){if(this.length){i=p.data(s);if(s.nodeType===1&&!p._data(s,"parsedAttrs")){n=o.length;while(n--)r=o[n].name,r.indexOf("data-")===0&&(r=p.camelCase(r.slice(5)),R(s,r,i[r]));p._data(s,"parsedAttrs",!0)}}return i}return typeof e=="object"?this.each(function(){p.data(this,e)}):arguments.length>1?this.each(function(){p.data(this,e,t)}):s?R(s,e,p.data(s,e)):undefined},removeData:function(e){return this.each(function(){p.removeData(this,e)})}}),p.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=p._data(e,t),n&&(!r||p.isArray(n)?r=p._data(e,t,p.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=p.queue(e,t),r=n.length,i=n.shift(),s=p._queueHooks(e,t),o=function(){p.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return p._data(e,n)||p._data(e,n,{empty:p.Callbacks("once memory").add(function(){p._removeData(e,t+"queue"),p._removeData(e,n)})})}}),p.fn.extend({queue:function(e,t){var n=2;return typeof e!="string"&&(t=e,e="fx",n--),arguments.length<n?p.queue(this[0],e):t===undefined?this:this.each(function(){var n=p.queue(this,e,t);p._queueHooks(this,e),e==="fx"&&n[0]!=="inprogress"&&p.dequeue(this,e)})},dequeue:function(e){return this.each(function(){p.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=p.Deferred(),s=this,o=this.length,u=function(){--r||i.resolveWith(s,[s])};typeof e!="string"&&(t=e,e=undefined),e=e||"fx";while(o--)n=p._data(s[o],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(u));return u(),i.promise(t)}});var X=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,V=["Top","Right","Bottom","Left"],$=function(e,t){return e=t||e,p.css(e,"display")==="none"||!p.contains(e.ownerDocument,e)},J=p.access=function(e,t,n,r,i,s,o){var u=0,a=e.length,f=n==null;if(p.type(n)==="object"){i=!0;for(u in n)p.access(e,t,u,n[u],!0,s,o)}else if(r!==undefined){i=!0,p.isFunction(r)||(o=!0),f&&(o?(t.call(e,r),t=null):(f=t,t=function(e,t,n){return f.call(p(e),n)}));if(t)for(;u<a;u++)t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)))}return i?e:f?t.call(e):a?t(e[0],n):s},K=/^(?:checkbox|radio)$/i;(function(){var e=N.createDocumentFragment(),t=N.createElement("div"),n=N.createElement("input");t.setAttribute("className","t"),t.innerHTML="  <link/><table></table><a href='/a'>a</a>",c.leadingWhitespace=t.firstChild.nodeType===3,c.tbody=!t.getElementsByTagName("tbody").length,c.htmlSerialize=!!t.getElementsByTagName("link").length,c.html5Clone=N.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",n.type="checkbox",n.checked=!0,e.appendChild(n),c.appendChecked=n.checked,t.innerHTML="<textarea>x</textarea>",c.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue,e.appendChild(t),t.innerHTML="<input type='radio' checked='checked' name='t'/>",c.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,c.noCloneEvent=!0,t.attachEvent&&(t.attachEvent("onclick",function(){c.noCloneEvent=!1}),t.cloneNode(!0).click());if(c.deleteExpando==null){c.deleteExpando=!0;try{delete t.test}catch(r){c.deleteExpando=!1}}e=t=n=null})(),function(){var t,n,r=N.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})n="on"+t,(c[t+"Bubbles"]=n in e)||(r.setAttribute(n,"t"),c[t+"Bubbles"]=r.attributes[n].expando===!1);r=null}();var Q=/^(?:input|select|textarea)$/i,G=/^key/,Y=/^(?:mouse|contextmenu)|click/,Z=/^(?:focusinfocus|focusoutblur)$/,et=/^([^.]*)(?:\.(.+)|)$/;p.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,d,v,m,g=p._data(e);if(!g)return;n.handler&&(a=n,n=a.handler,i=a.selector),n.guid||(n.guid=p.guid++),(o=g.events)||(o=g.events={}),(l=g.handle)||(l=g.handle=function(e){return typeof p===j||!!e&&p.event.triggered===e.type?undefined:p.event.dispatch.apply(l.elem,arguments)},l.elem=e),t=(t||"").match(M)||[""],u=t.length;while(u--){s=et.exec(t[u])||[],d=m=s[1],v=(s[2]||"").split(".").sort();if(!d)continue;f=p.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=p.event.special[d]||{},c=p.extend({type:d,origType:m,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&p.expr.match.needsContext.test(i),namespace:v.join(".")},a);if(!(h=o[d])){h=o[d]=[],h.delegateCount=0;if(!f.setup||f.setup.call(e,r,v,l)===!1)e.addEventListener?e.addEventListener(d,l,!1):e.attachEvent&&e.attachEvent("on"+d,l)}f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,c):h.push(c),p.event.global[d]=!0}e=null},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,d,v,m,g=p.hasData(e)&&p._data(e);if(!g||!(l=g.events))return;t=(t||"").match(M)||[""],f=t.length;while(f--){u=et.exec(t[f])||[],d=m=u[1],v=(u[2]||"").split(".").sort();if(!d){for(d in l)p.event.remove(e,d+t[f],n,r,!0);continue}c=p.event.special[d]||{},d=(r?c.delegateType:c.bindType)||d,h=l[d]||[],u=u[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=h.length;while(s--)o=h[s],(i||m===o.origType)&&(!n||n.guid===o.guid)&&(!u||u.test(o.namespace))&&(!r||r===o.selector||r==="**"&&o.selector)&&(h.splice(s,1),o.selector&&h.delegateCount--,c.remove&&c.remove.call(e,o));a&&!h.length&&((!c.teardown||c.teardown.call(e,v,g.handle)===!1)&&p.removeEvent(e,d,g.handle),delete l[d])}p.isEmptyObject(l)&&(delete g.handle,p._removeData(e,"events"))},trigger:function(t,n,r,i){var s,o,u,a,l,c,h,d=[r||N],v=f.call(t,"type")?t.type:t,m=f.call(t,"namespace")?t.namespace.split("."):[];u=c=r=r||N;if(r.nodeType===3||r.nodeType===8)return;if(Z.test(v+p.event.triggered))return;v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),o=v.indexOf(":")<0&&"on"+v,t=t[p.expando]?t:new p.Event(v,typeof t=="object"&&t),t.isTrigger=i?2:3,t.namespace=m.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=undefined,t.target||(t.target=r),n=n==null?[t]:p.makeArray(n,[t]),l=p.event.special[v]||{};if(!i&&l.trigger&&l.trigger.apply(r,n)===!1)return;if(!i&&!l.noBubble&&!p.isWindow(r)){a=l.delegateType||v,Z.test(a+v)||(u=u.parentNode);for(;u;u=u.parentNode)d.push(u),c=u;c===(r.ownerDocument||N)&&d.push(c.defaultView||c.parentWindow||e)}h=0;while((u=d[h++])&&!t.isPropagationStopped())t.type=h>1?a:l.bindType||v,s=(p._data(u,"events")||{})[t.type]&&p._data(u,"handle"),s&&s.apply(u,n),s=o&&u[o],s&&s.apply&&p.acceptData(u)&&(t.result=s.apply(u,n),t.result===!1&&t.preventDefault());t.type=v;if(!i&&!t.isDefaultPrevented()&&(!l._default||l._default.apply(d.pop(),n)===!1)&&p.acceptData(r)&&o&&r[v]&&!p.isWindow(r)){c=r[o],c&&(r[o]=null),p.event.triggered=v;try{r[v]()}catch(g){}p.event.triggered=undefined,c&&(r[o]=c)}return t.result},dispatch:function(e){e=p.event.fix(e);var t,n,i,s,o,u=[],a=r.call(arguments),f=(p._data(this,"events")||{})[e.type]||[],l=p.event.special[e.type]||{};a[0]=e,e.delegateTarget=this;if(l.preDispatch&&l.preDispatch.call(this,e)===!1)return;u=p.event.handlers.call(this,e,f),t=0;while((s=u[t++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,o=0;while((i=s.handlers[o++])&&!e.isImmediatePropagationStopped())if(!e.namespace_re||e.namespace_re.test(i.namespace))e.handleObj=i,e.data=i.data,n=((p.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,a),n!==undefined&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation())}return l.postDispatch&&l.postDispatch.call(this,e),e.result},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||e.type!=="click"))for(;a!=this;a=a.parentNode||this)if(a.nodeType===1&&(a.disabled!==!0||e.type!=="click")){i=[];for(s=0;s<u;s++)r=t[s],n=r.selector+" ",i[n]===undefined&&(i[n]=r.needsContext?p(n,this).index(a)>=0:p.find(n,this,null,[a]).length),i[n]&&i.push(r);i.length&&o.push({elem:a,handlers:i})}return u<t.length&&o.push({elem:this,handlers:t.slice(u)}),o},fix:function(e){if(e[p.expando])return e;var t,n,r,i=e.type,s=e,o=this.fixHooks[i];o||(this.fixHooks[i]=o=Y.test(i)?this.mouseHooks:G.test(i)?this.keyHooks:{}),r=o.props?this.props.concat(o.props):this.props,e=new p.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=s.srcElement||N),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,o.filter?o.filter(e,s):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button,o=t.fromElement;return e.pageX==null&&t.clientX!=null&&(r=e.target.ownerDocument||N,i=r.documentElement,n=r.body,e.pageX=t.clientX+(i&&i.scrollLeft||n&&n.scrollLeft||0)-(i&&i.clientLeft||n&&n.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||n&&n.scrollTop||0)-(i&&i.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&o&&(e.relatedTarget=o===e.target?t.toElement:o),!e.which&&s!==undefined&&(e.which=s&1?1:s&2?3:s&4?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==rt()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){if(this===rt()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(p.nodeName(this,"input")&&this.type==="checkbox"&&this.click)return this.click(),!1},_default:function(e){return p.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==undefined&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=p.extend(new p.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?p.event.trigger(i,null,t):p.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},p.removeEvent=N.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===j&&(e[r]=null),e.detachEvent(r,n))},p.Event=function(e,t){if(!(this instanceof p.Event))return new p.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.defaultPrevented===undefined&&(e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault())?tt:nt):this.type=e,t&&p.extend(this,t),this.timeStamp=e&&e.timeStamp||p.now(),this[p.expando]=!0},p.Event.prototype={isDefaultPrevented:nt,isPropagationStopped:nt,isImmediatePropagationStopped:nt,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=tt;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=tt;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=tt,this.stopPropagation()}},p.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){p.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;if(!i||i!==r&&!p.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),c.submitBubbles||(p.event.special.submit={setup:function(){if(p.nodeName(this,"form"))return!1;p.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,n=p.nodeName(t,"input")||p.nodeName(t,"button")?t.form:undefined;n&&!p._data(n,"submitBubbles")&&(p.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),p._data(n,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&p.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(p.nodeName(this,"form"))return!1;p.event.remove(this,"._submit")}}),c.changeBubbles||(p.event.special.change={setup:function(){if(Q.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")p.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),p.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),p.event.simulate("change",this,e,!0)});return!1}p.event.add(this,"beforeactivate._change",function(e){var t=e.target;Q.test(t.nodeName)&&!p._data(t,"changeBubbles")&&(p.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&p.event.simulate("change",this.parentNode,e,!0)}),p._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return p.event.remove(this,"._change"),!Q.test(this.nodeName)}}),c.focusinBubbles||p.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){p.event.simulate(t,e.target,p.event.fix(e),!0)};p.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=p._data(r,t);i||r.addEventListener(e,n,!0),p._data(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=p._data(r,t)-1;i?p._data(r,t,i):(r.removeEventListener(e,n,!0),p._removeData(r,t))}}}),p.fn.extend({on:function(e,t,n,r,i){var s,o;if(typeof e=="object"){typeof t!="string"&&(n=n||t,t=undefined);for(s in e)this.on(s,t,n,e[s],i);return this}n==null&&r==null?(r=t,n=t=undefined):r==null&&(typeof t=="string"?(r=n,n=undefined):(r=n,n=t,t=undefined));if(r===!1)r=nt;else if(!r)return this;return i===1&&(o=r,r=function(e){return p().off(e),o.apply(this,arguments)},r.guid=o.guid||(o.guid=p.guid++)),this.each(function(){p.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,p(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if(typeof e=="object"){for(i in e)this.off(i,t,e[i]);return this}if(t===!1||typeof t=="function")n=t,t=undefined;return n===!1&&(n=nt),this.each(function(){p.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){p.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return p.event.trigger(e,t,n,!0)}});var st="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ot=/ jQuery\d+="(?:null|\d+)"/g,ut=new RegExp("<(?:"+st+")[\\s/>]","i"),at=/^\s+/,ft=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,lt=/<([\w:]+)/,ct=/<tbody/i,ht=/<|&#?\w+;/,pt=/<(?:script|style|link)/i,dt=/checked\s*(?:[^=]|=\s*.checked.)/i,vt=/^$|\/(?:java|ecma)script/i,mt=/^true\/(.*)/,gt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,yt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:c.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},bt=it(N),wt=bt.appendChild(N.createElement("div"));yt.optgroup=yt.option,yt.tbody=yt.tfoot=yt.colgroup=yt.caption=yt.thead,yt.th=yt.td,p.extend({clone:function(e,t,n){var r,i,s,o,u,a=p.contains(e.ownerDocument,e);c.html5Clone||p.isXMLDoc(e)||!ut.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(wt.innerHTML=e.outerHTML,wt.removeChild(s=wt.firstChild));if((!c.noCloneEvent||!c.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!p.isXMLDoc(e)){r=Et(s),u=Et(e);for(o=0;(i=u[o])!=null;++o)r[o]&&Lt(i,r[o])}if(t)if(n){u=u||Et(e),r=r||Et(s);for(o=0;(i=u[o])!=null;o++)kt(i,r[o])}else kt(e,s);return r=Et(s,"script"),r.length>0&&Ct(r,!a&&Et(e,"script")),r=u=i=null,s},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l,h=e.length,d=it(t),v=[],m=0;for(;m<h;m++){s=e[m];if(s||s===0)if(p.type(s)==="object")p.merge(v,s.nodeType?[s]:s);else if(!ht.test(s))v.push(t.createTextNode(s));else{u=u||d.appendChild(t.createElement("div")),a=(lt.exec(s)||["",""])[1].toLowerCase(),l=yt[a]||yt._default,u.innerHTML=l[1]+s.replace(ft,"<$1></$2>")+l[2],i=l[0];while(i--)u=u.lastChild;!c.leadingWhitespace&&at.test(s)&&v.push(t.createTextNode(at.exec(s)[0]));if(!c.tbody){s=a==="table"&&!ct.test(s)?u.firstChild:l[1]==="<table>"&&!ct.test(s)?u:0,i=s&&s.childNodes.length;while(i--)p.nodeName(f=s.childNodes[i],"tbody")&&!f.childNodes.length&&s.removeChild(f)}p.merge(v,u.childNodes),u.textContent="";while(u.firstChild)u.removeChild(u.firstChild);u=d.lastChild}}u&&d.removeChild(u),c.appendChecked||p.grep(Et(v,"input"),St),m=0;while(s=v[m++]){if(r&&p.inArray(s,r)!==-1)continue;o=p.contains(s.ownerDocument,s),u=Et(d.appendChild(s),"script"),o&&Ct(u);if(n){i=0;while(s=u[i++])vt.test(s.type||"")&&n.push(s)}}return u=null,d},cleanData:function(e,t){var r,i,s,o,u=0,a=p.expando,f=p.cache,l=c.deleteExpando,h=p.event.special;for(;(r=e[u])!=null;u++)if(t||p.acceptData(r)){s=r[a],o=s&&f[s];if(o){if(o.events)for(i in o.events)h[i]?p.event.remove(r,i):p.removeEvent(r,i,o.handle);f[s]&&(delete f[s],l?delete r[a]:typeof r.removeAttribute!==j?r.removeAttribute(a):r[a]=null,n.push(s))}}}}),p.fn.extend({text:function(e){return J(this,function(e){return e===undefined?p.text(this):this.empty().append((this[0]&&this[0].ownerDocument||N).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=xt(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=xt(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?p.filter(e,this):this,i=0;for(;(n=r[i])!=null;i++)!t&&n.nodeType===1&&p.cleanData(Et(n)),n.parentNode&&(t&&p.contains(n.ownerDocument,n)&&Ct(Et(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&p.cleanData(Et(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&p.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return p.clone(this,e,t)})},html:function(e){return J(this,function(e){var t=this[0]||{},n=0,r=this.length;if(e===undefined)return t.nodeType===1?t.innerHTML.replace(ot,""):undefined;if(typeof e=="string"&&!pt.test(e)&&(c.htmlSerialize||!ut.test(e))&&(c.leadingWhitespace||!at.test(e))&&!yt[(lt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(ft,"<$1></$2>");try{for(;n<r;n++)t=this[n]||{},t.nodeType===1&&(p.cleanData(Et(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,p.cleanData(Et(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=i.apply([],e);var n,r,s,o,u,a,f=0,l=this.length,h=this,d=l-1,v=e[0],m=p.isFunction(v);if(m||l>1&&typeof v=="string"&&!c.checkClone&&dt.test(v))return this.each(function(n){var r=h.eq(n);m&&(e[0]=v.call(this,n,r.html())),r.domManip(e,t)});if(l){a=p.buildFragment(e,this[0].ownerDocument,!1,this),n=a.firstChild,a.childNodes.length===1&&(a=n);if(n){o=p.map(Et(a,"script"),Tt),s=o.length;for(;f<l;f++)r=a,f!==d&&(r=p.clone(r,!0,!0),s&&p.merge(o,Et(r,"script"))),t.call(this[f],r,f);if(s){u=o[o.length-1].ownerDocument,p.map(o,Nt);for(f=0;f<s;f++)r=o[f],vt.test(r.type||"")&&!p._data(r,"globalEval")&&p.contains(u,r)&&(r.src?p._evalUrl&&p._evalUrl(r.src):p.globalEval((r.text||r.textContent||r.innerHTML||"").replace(gt,"")))}a=n=null}}return this}}),p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){p.fn[e]=function(e){var n,r=0,i=[],o=p(e),u=o.length-1;for(;r<=u;r++)n=r===u?this:this.clone(!0),p(o[r])[t](n),s.apply(i,n.get());return this.pushStack(i)}});var At,Ot={};(function(){var e,t,n=N.createElement("div"),r="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=n.getElementsByTagName("a")[0],e.style.cssText="float:left;opacity:.5",c.opacity=/^0.5/.test(e.style.opacity),c.cssFloat=!!e.style.cssFloat,n.style.backgroundClip="content-box",n.cloneNode(!0).style.backgroundClip="",c.clearCloneStyle=n.style.backgroundClip==="content-box",e=n=null,c.shrinkWrapBlocks=function(){var e,n,i,s;if(t==null){e=N.getElementsByTagName("body")[0];if(!e)return;s="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",n=N.createElement("div"),i=N.createElement("div"),e.appendChild(n).appendChild(i),t=!1,typeof i.style.zoom!==j&&(i.style.cssText=r+";width:1px;padding:1px;zoom:1",i.innerHTML="<div></div>",i.firstChild.style.width="5px",t=i.offsetWidth!==3),e.removeChild(n),e=n=i=null}return t}})();var Dt=/^margin/,Pt=new RegExp("^("+X+")(?!px)[a-z%]+$","i"),Ht,Bt,jt=/^(top|right|bottom|left)$/;e.getComputedStyle?(Ht=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)},Bt=function(e,t,n){var r,i,s,o,u=e.style;return n=n||Ht(e),o=n?n.getPropertyValue(t)||n[t]:undefined,n&&(o===""&&!p.contains(e.ownerDocument,e)&&(o=p.style(e,t)),Pt.test(o)&&Dt.test(t)&&(r=u.width,i=u.minWidth,s=u.maxWidth,u.minWidth=u.maxWidth=u.width=o,o=n.width,u.width=r,u.minWidth=i,u.maxWidth=s)),o===undefined?o:o+""}):N.documentElement.currentStyle&&(Ht=function(e){return e.currentStyle},Bt=function(e,t,n){var r,i,s,o,u=e.style;return n=n||Ht(e),o=n?n[t]:undefined,o==null&&u&&u[t]&&(o=u[t]),Pt.test(o)&&!jt.test(t)&&(r=u.left,i=e.runtimeStyle,s=i&&i.left,s&&(i.left=e.currentStyle.left),u.left=t==="fontSize"?"1em":o,o=u.pixelLeft+"px",u.left=r,s&&(i.left=s)),o===undefined?o:o+""||"auto"}),function(){function l(){var t,n,u=N.getElementsByTagName("body")[0];if(!u)return;t=N.createElement("div"),n=N.createElement("div"),t.style.cssText=a,u.appendChild(t).appendChild(n),n.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;display:block;padding:1px;border:1px;width:4px;margin-top:1%;top:1%",p.swap(u,u.style.zoom!=null?{zoom:1}:{},function(){r=n.offsetWidth===4}),i=!0,s=!1,o=!0,e.getComputedStyle&&(s=(e.getComputedStyle(n,null)||{}).top!=="1%",i=(e.getComputedStyle(n,null)||{width:"4px"}).width==="4px"),u.removeChild(t),n=u=null}var t,n,r,i,s,o,u=N.createElement("div"),a="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",f="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";u.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=u.getElementsByTagName("a")[0],t.style.cssText="float:left;opacity:.5",c.opacity=/^0.5/.test(t.style.opacity),c.cssFloat=!!t.style.cssFloat,u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",c.clearCloneStyle=u.style.backgroundClip==="content-box",t=u=null,p.extend(c,{reliableHiddenOffsets:function(){if(n!=null)return n;var e,t,r,i=N.createElement("div"),s=N.getElementsByTagName("body")[0];if(!s)return;return i.setAttribute("className","t"),i.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=N.createElement("div"),e.style.cssText=a,s.appendChild(e).appendChild(i),i.innerHTML="<table><tr><td></td><td>t</td></tr></table>",t=i.getElementsByTagName("td"),t[0].style.cssText="padding:0;margin:0;border:0;display:none",r=t[0].offsetHeight===0,t[0].style.display="",t[1].style.display="none",n=r&&t[0].offsetHeight===0,s.removeChild(e),i=s=null,n},boxSizing:function(){return r==null&&l(),r},boxSizingReliable:function(){return i==null&&l(),i},pixelPosition:function(){return s==null&&l(),s},reliableMarginRight:function(){var t,n,r,i;if(o==null&&e.getComputedStyle){t=N.getElementsByTagName("body")[0];if(!t)return;n=N.createElement("div"),r=N.createElement("div"),n.style.cssText=a,t.appendChild(n).appendChild(r),i=r.appendChild(N.createElement("div")),i.style.cssText=r.style.cssText=f,i.style.marginRight=i.style.width="0",r.style.width="1px",o=!parseFloat((e.getComputedStyle(i,null)||{}).marginRight),t.removeChild(n)}return o}})}(),p.swap=function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i};var It=/alpha\([^)]*\)/i,qt=/opacity\s*=\s*([^)]*)/,Rt=/^(none|table(?!-c[ea]).+)/,Ut=new RegExp("^("+X+")(.*)$","i"),zt=new RegExp("^([+-])=("+X+")","i"),Wt={position:"absolute",visibility:"hidden",display:"block"},Xt={letterSpacing:0,fontWeight:400},Vt=["Webkit","O","Moz","ms"];p.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Bt(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":c.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,n,r){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var i,s,o,u=p.camelCase(t),a=e.style;t=p.cssProps[u]||(p.cssProps[u]=$t(a,u)),o=p.cssHooks[t]||p.cssHooks[u];if(n===undefined)return o&&"get"in o&&(i=o.get(e,!1,r))!==undefined?i:a[t];s=typeof n,s==="string"&&(i=zt.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(p.css(e,t)),s="number");if(n==null||n!==n)return;s==="number"&&!p.cssNumber[u]&&(n+="px"),!c.clearCloneStyle&&n===""&&t.indexOf("background")===0&&(a[t]="inherit");if(!o||!("set"in o)||(n=o.set(e,n,r))!==undefined)try{a[t]="",a[t]=n}catch(f){}},css:function(e,t,n,r){var i,s,o,u=p.camelCase(t);return t=p.cssProps[u]||(p.cssProps[u]=$t(e.style,u)),o=p.cssHooks[t]||p.cssHooks[u],o&&"get"in o&&(s=o.get(e,!0,n)),s===undefined&&(s=Bt(e,t,r)),s==="normal"&&t in Xt&&(s=Xt[t]),n===""||n?(i=parseFloat(s),n===!0||p.isNumeric(i)?i||0:s):s}}),p.each(["height","width"],function(e,t){p.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&Rt.test(p.css(e,"display"))?p.swap(e,Wt,function(){return Gt(e,t,r)}):Gt(e,t,r)},set:function(e,n,r){var i=r&&Ht(e);return Kt(e,n,r?Qt(e,t,r,c.boxSizing()&&p.css(e,"boxSizing",!1,i)==="border-box",i):0)}}}),c.opacity||(p.cssHooks.opacity={get:function(e,t){return qt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=p.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if((t>=1||t==="")&&p.trim(s.replace(It,""))===""&&n.removeAttribute){n.removeAttribute("filter");if(t===""||r&&!r.filter)return}n.filter=It.test(s)?s.replace(It,i):s+" "+i}}),p.cssHooks.marginRight=Ft(c.reliableMarginRight,function(e,t){if(t)return p.swap(e,{display:"inline-block"},Bt,[e,"marginRight"])}),p.each({margin:"",padding:"",border:"Width"},function(e,t){p.cssHooks[e+t]={expand:function(n){var r=0,i={},s=typeof n=="string"?n.split(" "):[n];for(;r<4;r++)i[e+V[r]+t]=s[r]||s[r-2]||s[0];return i}},Dt.test(e)||(p.cssHooks[e+t].set=Kt)}),p.fn.extend({css:function(e,t){return J(this,function(e,t,n){var r,i,s={},o=0;if(p.isArray(t)){r=Ht(e),i=t.length;for(;o<i;o++)s[t[o]]=p.css(e,t[o],!1,r);return s}return n!==undefined?p.style(e,t,n):p.css(e,t)},e,t,arguments.length>1)},show:function(){return Jt(this,!0)},hide:function(){return Jt(this)},toggle:function(e){return typeof e=="boolean"?e?this.show():this.hide():this.each(function(){$(this)?p(this).show():p(this).hide()})}}),p.Tween=Yt,Yt.prototype={constructor:Yt,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(p.cssNumber[n]?"":"px")},cur:function(){var e=Yt.propHooks[this.prop];return e&&e.get?e.get(this):Yt.propHooks._default.get(this)},run:function(e){var t,n=Yt.propHooks[this.prop];return this.options.duration?this.pos=t=p.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Yt.propHooks._default.set(this),this}},Yt.prototype.init.prototype=Yt.prototype,Yt.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=p.css(e.elem,e.prop,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){p.fx.step[e.prop]?p.fx.step[e.prop](e):e.elem.style&&(e.elem.style[p.cssProps[e.prop]]!=null||p.cssHooks[e.prop])?p.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Yt.propHooks.scrollTop=Yt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},p.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},p.fx=Yt.prototype.init,p.fx.step={};var Zt,en,tn=/^(?:toggle|show|hide)$/,nn=new RegExp("^(?:([+-])=|)("+X+")([a-z%]*)$","i"),rn=/queueHooks$/,sn=[ln],on={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=nn.exec(t),s=i&&i[3]||(p.cssNumber[e]?"":"px"),o=(p.cssNumber[e]||s!=="px"&&+r)&&nn.exec(p.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,p.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&u!==1&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};p.Animation=p.extend(hn,{tweener:function(e,t){p.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],on[n]=on[n]||[],on[n].unshift(t)},prefilter:function(e,t){t?sn.unshift(e):sn.push(e)}}),p.speed=function(e,t,n){var r=e&&typeof e=="object"?p.extend({},e):{complete:n||!n&&t||p.isFunction(e)&&e,duration:e,easing:n&&t||t&&!p.isFunction(t)&&t};r.duration=p.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in p.fx.speeds?p.fx.speeds[r.duration]:p.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){p.isFunction(r.old)&&r.old.call(this),r.queue&&p.dequeue(this,r.queue)},r},p.fn.extend({fadeTo:function(e,t,n,r){return this.filter($).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=p.isEmptyObject(e),s=p.speed(t,n,r),o=function(){var t=hn(this,p.extend({},e),s);(i||p._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return typeof e!="string"&&(n=t,t=e,e=undefined),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=e!=null&&e+"queueHooks",s=p.timers,o=p._data(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&rn.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem===this&&(e==null||s[i].queue===e)&&(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&p.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=p._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=p.timers,o=r?r.length:0;n.finish=!0,p.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0);for(t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),p.each(["toggle","show","hide"],function(e,t){var n=p.fn[t];p.fn[t]=function(e,r,i){return e==null||typeof e=="boolean"?n.apply(this,arguments):this.animate(an(t,!0),e,r,i)}}),p.each({slideDown:an("show"),slideUp:an("hide"),slideToggle:an("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){p.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),p.timers=[],p.fx.tick=function(){var e,t=p.timers,n=0;Zt=p.now();for(;n<t.length;n++)e=t[n],!e()&&t[n]===e&&t.splice(n--,1);t.length||p.fx.stop(),Zt=undefined},p.fx.timer=function(e){p.timers.push(e),e()?p.fx.start():p.timers.pop()},p.fx.interval=13,p.fx.start=function(){en||(en=setInterval(p.fx.tick,p.fx.interval))},p.fx.stop=function(){clearInterval(en),en=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fn.delay=function(e,t){return e=p.fx?p.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},function(){var e,t,n,r,i=N.createElement("div");i.setAttribute("className","t"),i.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=i.getElementsByTagName("a")[0],n=N.createElement("select"),r=n.appendChild(N.createElement("option")),t=i.getElementsByTagName("input")[0],e.style.cssText="top:1px",c.getSetAttribute=i.className!=="t",c.style=/top/.test(e.getAttribute("style")),c.hrefNormalized=e.getAttribute("href")==="/a",c.checkOn=!!t.value,c.optSelected=r.selected,c.enctype=!!N.createElement("form").enctype,n.disabled=!0,c.optDisabled=!r.disabled,t=N.createElement("input"),t.setAttribute("value",""),c.input=t.getAttribute("value")==="",t.value="t",t.setAttribute("type","radio"),c.radioValue=t.value==="t",e=t=n=r=i=null}();var pn=/\r/g;p.fn.extend({val:function(e){var t,n,r,i=this[0];if(!arguments.length){if(i)return t=p.valHooks[i.type]||p.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&(n=t.get(i,"value"))!==undefined?n:(n=i.value,typeof n=="string"?n.replace(pn,""):n==null?"":n);return}return r=p.isFunction(e),this.each(function(n){var i;if(this.nodeType!==1)return;r?i=e.call(this,n,p(this).val()):i=e,i==null?i="":typeof i=="number"?i+="":p.isArray(i)&&(i=p.map(i,function(e){return e==null?"":e+""})),t=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()];if(!t||!("set"in t)||t.set(this,i,"value")===undefined)this.value=i})}}),p.extend({valHooks:{option:{get:function(e){var t=p.find.attr(e,"value");return t!=null?t:p.text(e)}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(c.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!p.nodeName(n.parentNode,"optgroup"))){t=p(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n,r,i=e.options,s=p.makeArray(t),o=i.length;while(o--){r=i[o];if(p.inArray(p.valHooks.option.get(r),s)>=0)try{r.selected=n=!0}catch(u){r.scrollHeight}else r.selected=!1}return n||(e.selectedIndex=-1),i}}}}),p.each(["radio","checkbox"],function(){p.valHooks[this]={set:function(e,t){if(p.isArray(t))return e.checked=p.inArray(p(e).val(),t)>=0}},c.checkOn||(p.valHooks[this].get=function(e){return e.getAttribute("value")===null?"on":e.value})});var dn,vn,mn=p.expr.attrHandle,gn=/^(?:checked|selected)$/i,yn=c.getSetAttribute,bn=c.input;p.fn.extend({attr:function(e,t){return J(this,p.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){p.removeAttr(this,e)})}}),p.extend({attr:function(e,t,n){var r,i,s=e.nodeType;if(!e||s===3||s===8||s===2)return;if(typeof e.getAttribute===j)return p.prop(e,t,n);if(s!==1||!p.isXMLDoc(e))t=t.toLowerCase(),r=p.attrHooks[t]||(p.expr.match.bool.test(t)?vn:dn);if(n===undefined)return r&&"get"in r&&(i=r.get(e,t))!==null?i:(i=p.find.attr(e,t),i==null?undefined:i);if(n!==null)return r&&"set"in r&&(i=r.set(e,n,t))!==undefined?i:(e.setAttribute(t,n+""),n);p.removeAttr(e,t)},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(M);if(s&&e.nodeType===1)while(n=s[i++])r=p.propFix[n]||n,p.expr.match.bool.test(n)?bn&&yn||!gn.test(n)?e[r]=!1:e[p.camelCase("default-"+n)]=e[r]=!1:p.attr(e,n,""),e.removeAttribute(yn?n:r)},attrHooks:{type:{set:function(e,t){if(!c.radioValue&&t==="radio"&&p.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),vn={set:function(e,t,n){return t===!1?p.removeAttr(e,n):bn&&yn||!gn.test(n)?e.setAttribute(!yn&&p.propFix[n]||n,n):e[p.camelCase("default-"+n)]=e[n]=!0,n}},p.each(p.expr.match.bool.source.match(/\w+/g),function(e,t){var n=mn[t]||p.find.attr;mn[t]=bn&&yn||!gn.test(t)?function(e,t,r){var i,s;return r||(s=mn[t],mn[t]=i,i=n(e,t,r)!=null?t.toLowerCase():null,mn[t]=s),i}:function(e,t,n){if(!n)return e[p.camelCase("default-"+t)]?t.toLowerCase():null}});if(!bn||!yn)p.attrHooks.value={set:function(e,t,n){if(!p.nodeName(e,"input"))return dn&&dn.set(e,t,n);e.defaultValue=t}};yn||(dn={set:function(e,t,n){var r=e.getAttributeNode(n);r||e.setAttributeNode(r=e.ownerDocument.createAttribute(n)),r.value=t+="";if(n==="value"||t===e.getAttribute(n))return t}},mn.id=mn.name=mn.coords=function(e,t,n){var r;if(!n)return(r=e.getAttributeNode(t))&&r.value!==""?r.value:null},p.valHooks.button={get:function(e,t){var n=e.getAttributeNode(t);if(n&&n.specified)return n.value},set:dn.set},p.attrHooks.contenteditable={set:function(e,t,n){dn.set(e,t===""?!1:t,n)}},p.each(["width","height"],function(e,t){p.attrHooks[t]={set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}}})),c.style||(p.attrHooks.style={get:function(e){return e.style.cssText||undefined},set:function(e,t){return e.style.cssText=t+""}});var wn=/^(?:input|select|textarea|button|object)$/i,En=/^(?:a|area)$/i;p.fn.extend({prop:function(e,t){return J(this,p.prop,e,t,arguments.length>1)},removeProp:function(e){return e=p.propFix[e]||e,this.each(function(){try{this[e]=undefined,delete this[e]}catch(t){}})}}),p.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(!e||o===3||o===8||o===2)return;return s=o!==1||!p.isXMLDoc(e),s&&(t=p.propFix[t]||t,i=p.propHooks[t]),n!==undefined?i&&"set"in i&&(r=i.set(e,n,t))!==undefined?r:e[t]=n:i&&"get"in i&&(r=i.get(e,t))!==null?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=p.find.attr(e,"tabindex");return t?parseInt(t,10):wn.test(e.nodeName)||En.test(e.nodeName)&&e.href?0:-1}}}}),c.hrefNormalized||p.each(["href","src"],function(e,t){p.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),c.optSelected||(p.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),p.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){p.propFix[this.toLowerCase()]=this}),c.enctype||(p.propFix.enctype="encoding");var Sn=/[\t\r\n\f]/g;p.fn.extend({addClass:function(e){var t,n,r,i,s,o,u=0,a=this.length,f=typeof e=="string"&&e;if(p.isFunction(e))return this.each(function(t){p(this).addClass(e.call(this,t,this.className))});if(f){t=(e||"").match(M)||[];for(;u<a;u++){n=this[u],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(Sn," "):" ");if(r){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");o=p.trim(r),n.className!==o&&(n.className=o)}}}return this},removeClass:function(e){var t,n,r,i,s,o,u=0,a=this.length,f=arguments.length===0||typeof e=="string"&&e;if(p.isFunction(e))return this.each(function(t){p(this).removeClass(e.call(this,t,this.className))});if(f){t=(e||"").match(M)||[];for(;u<a;u++){n=this[u],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(Sn," "):"");if(r){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");o=e?p.trim(r):"",n.className!==o&&(n.className=o)}}}return this},toggleClass:function(e,t){var n=typeof e;return typeof t=="boolean"&&n==="string"?t?this.addClass(e):this.removeClass(e):p.isFunction(e)?this.each(function(n){p(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var t,r=0,i=p(this),s=e.match(M)||[];while(t=s[r++])i.hasClass(t)?i.removeClass(t):i.addClass(t)}else if(n===j||n==="boolean")this.className&&p._data(this,"__className__",this.className),this.className=this.className||e===!1?"":p._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(Sn," ").indexOf(t)>=0)return!0;return!1}}),p.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){p.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),p.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)}});var xn=p.now(),Tn=/\?/,Nn=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;p.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t+"");var n,r=null,i=p.trim(t+"");return i&&!p.trim(i.replace(Nn,function(e,t,i,s){return n&&t&&(r=0),r===0?e:(n=i||t,r+=!s-!i,"")}))?Function("return "+i)():p.error("Invalid JSON: "+t)},p.parseXML=function(t){var n,r;if(!t||typeof t!="string")return null;try{e.DOMParser?(r=new DOMParser,n=r.parseFromString(t,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t))}catch(i){n=undefined}return(!n||!n.documentElement||n.getElementsByTagName("parsererror").length)&&p.error("Invalid XML: "+t),n};var Cn,kn,Ln=/#.*$/,An=/([?&])_=[^&]*/,On=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,Mn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,_n=/^(?:GET|HEAD)$/,Dn=/^\/\//,Pn=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Hn={},Bn={},jn="*/".concat("*");try{kn=location.href}catch(Fn){kn=N.createElement("a"),kn.href="",kn=kn.href}Cn=Pn.exec(kn.toLowerCase())||[],p.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:kn,type:"GET",isLocal:Mn.test(Cn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":jn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":p.parseJSON,"text xml":p.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Rn(Rn(e,p.ajaxSettings),t):Rn(p.ajaxSettings,e)},ajaxPrefilter:In(Hn),ajaxTransport:In(Bn),ajax:function(e,t){function x(e,t,n,r){var f,g,y,w,S,x=t;if(b===2)return;b=2,o&&clearTimeout(o),a=undefined,s=r||"",E.readyState=e>0?4:0,f=e>=200&&e<300||e===304,n&&(w=Un(l,E,n)),w=zn(l,w,E,f);if(f)l.ifModified&&(S=E.getResponseHeader("Last-Modified"),S&&(p.lastModified[i]=S),S=E.getResponseHeader("etag"),S&&(p.etag[i]=S)),e===204||l.type==="HEAD"?x="nocontent":e===304?x="notmodified":(x=w.state,g=w.data,y=w.error,f=!y);else{y=x;if(e||!x)x="error",e<0&&(e=0)}E.status=e,E.statusText=(t||x)+"",f?d.resolveWith(c,[g,x,E]):d.rejectWith(c,[E,x,y]),E.statusCode(m),m=undefined,u&&h.trigger(f?"ajaxSuccess":"ajaxError",[E,l,f?g:y]),v.fireWith(c,[E,x]),u&&(h.trigger("ajaxComplete",[E,l]),--p.active||p.event.trigger("ajaxStop"))}typeof e=="object"&&(t=e,e=undefined),t=t||{};var n,r,i,s,o,u,a,f,l=p.ajaxSetup({},t),c=l.context||l,h=l.context&&(c.nodeType||c.jquery)?p(c):p.event,d=p.Deferred(),v=p.Callbacks("once memory"),m=l.statusCode||{},g={},y={},b=0,w="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(b===2){if(!f){f={};while(t=On.exec(s))f[t[1].toLowerCase()]=t[2]}t=f[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return b===2?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return b||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(b<2)for(t in e)m[t]=[m[t],e[t]];else E.always(e[E.status]);return this},abort:function(e){var t=e||w;return a&&a.abort(t),x(0,t),this}};d.promise(E).complete=v.add,E.success=E.done,E.error=E.fail,l.url=((e||l.url||kn)+"").replace(Ln,"").replace(Dn,Cn[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=p.trim(l.dataType||"*").toLowerCase().match(M)||[""],l.crossDomain==null&&(n=Pn.exec(l.url.toLowerCase()),l.crossDomain=!(!n||n[1]===Cn[1]&&n[2]===Cn[2]&&(n[3]||(n[1]==="http:"?"80":"443"))===(Cn[3]||(Cn[1]==="http:"?"80":"443")))),l.data&&l.processData&&typeof l.data!="string"&&(l.data=p.param(l.data,l.traditional)),qn(Hn,l,t,E);if(b===2)return E;u=l.global,u&&p.active++===0&&p.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!_n.test(l.type),i=l.url,l.hasContent||(l.data&&(i=l.url+=(Tn.test(i)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=An.test(i)?i.replace(An,"$1_="+xn++):i+(Tn.test(i)?"&":"?")+"_="+xn++)),l.ifModified&&(p.lastModified[i]&&E.setRequestHeader("If-Modified-Since",p.lastModified[i]),p.etag[i]&&E.setRequestHeader("If-None-Match",p.etag[i])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&E.setRequestHeader("Content-Type",l.contentType),E.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+jn+"; q=0.01":""):l.accepts["*"]);for(r in l.headers)E.setRequestHeader(r,l.headers[r]);if(!l.beforeSend||l.beforeSend.call(c,E,l)!==!1&&b!==2){w="abort";for(r in{success:1,error:1,complete:1})E[r](l[r]);a=qn(Bn,l,t,E);if(!a)x(-1,"No Transport");else{E.readyState=1,u&&h.trigger("ajaxSend",[E,l]),l.async&&l.timeout>0&&(o=setTimeout(function(){E.abort("timeout")},l.timeout));try{b=1,a.send(g,x)}catch(S){if(!(b<2))throw S;x(-1,S)}}return E}return E.abort()},getJSON:function(e,t,n){return p.get(e,t,n,"json")},getScript:function(e,t){return p.get(e,undefined,t,"script")}}),p.each(["get","post"],function(e,t){p[t]=function(e,n,r,i){return p.isFunction(n)&&(i=i||r,r=n,n=undefined),p.ajax({url:e,type:t,dataType:i,data:n,success:r})}}),p.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){p.fn[t]=function(e){return this.on(t,e)}}),p._evalUrl=function(e){return p.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},p.fn.extend({wrapAll:function(e){if(p.isFunction(e))return this.each(function(t){p(this).wrapAll(e.call(this,t))});if(this[0]){var t=p(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return p.isFunction(e)?this.each(function(t){p(this).wrapInner(e.call(this,t))}):this.each(function(){var t=p(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=p.isFunction(e);return this.each(function(n){p(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){p.nodeName(this,"body")||p(this).replaceWith(this.childNodes)}).end()}}),p.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!c.reliableHiddenOffsets()&&(e.style&&e.style.display||p.css(e,"display"))==="none"},p.expr.filters.visible=function(e){return!p.expr.filters.hidden(e)};var Wn=/%20/g,Xn=/\[\]$/,Vn=/\r?\n/g,$n=/^(?:submit|button|image|reset|file)$/i,Jn=/^(?:input|select|textarea|keygen)/i;p.param=function(e,t){var n,r=[],i=function(e,t){t=p.isFunction(t)?t():t==null?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};t===undefined&&(t=p.ajaxSettings&&p.ajaxSettings.traditional);if(p.isArray(e)||e.jquery&&!p.isPlainObject(e))p.each(e,function(){i(this.name,this.value)});else for(n in e)Kn(n,e[n],t,i);return r.join("&").replace(Wn,"+")},p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=p.prop(this,"elements");return e?p.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!p(this).is(":disabled")&&Jn.test(this.nodeName)&&!$n.test(e)&&(this.checked||!K.test(e))}).map(function(e,t){var n=p(this).val();return n==null?null:p.isArray(n)?p.map(n,function(e){return{name:t.name,value:e.replace(Vn,"\r\n")}}):{name:t.name,value:n.replace(Vn,"\r\n")}}).get()}}),p.ajaxSettings.xhr=e.ActiveXObject!==undefined?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&Zn()||er()}:Zn;var Qn=0,Gn={},Yn=p.ajaxSettings.xhr();e.ActiveXObject&&p(e).on("unload",function(){for(var e in Gn)Gn[e](undefined,!0)}),c.cors=!!Yn&&"withCredentials"in Yn,Yn=c.ajax=!!Yn,Yn&&p.ajaxTransport(function(e){if(!e.crossDomain||c.cors){var t;return{send:function(n,r){var i,s=e.xhr(),o=++Qn;s.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),!e.crossDomain&&!n["X-Requested-With"]&&(n["X-Requested-With"]="XMLHttpRequest");for(i in n)n[i]!==undefined&&s.setRequestHeader(i,n[i]+"");s.send(e.hasContent&&e.data||null),t=function(n,i){var u,a,f;if(t&&(i||s.readyState===4)){delete Gn[o],t=undefined,s.onreadystatechange=p.noop;if(i)s.readyState!==4&&s.abort();else{f={},u=s.status,typeof s.responseText=="string"&&(f.text=s.responseText);try{a=s.statusText}catch(l){a=""}!u&&e.isLocal&&!e.crossDomain?u=f.text?200:404:u===1223&&(u=204)}}f&&r(u,a,f,s.getAllResponseHeaders())},e.async?s.readyState===4?setTimeout(t):s.onreadystatechange=Gn[o]=t:t()},abort:function(){t&&t(undefined,!0)}}}}),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return p.globalEval(e),e}}}),p.ajaxPrefilter("script",function(e){e.cache===undefined&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),p.ajaxTransport("script",function(e){if(e.crossDomain){var t,n=N.head||p("head")[0]||N.documentElement;return{send:function(r,i){t=N.createElement("script"),t.async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,n){if(n||!t.readyState||/loaded|complete/.test(t.readyState))t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,n||i(200,"success")},n.insertBefore(t,n.firstChild)},abort:function(){t&&t.onload(undefined,!0)}}}});var tr=[],nr=/(=)\?(?=&|$)|\?\?/;p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=tr.pop()||p.expando+"_"+xn++;return this[e]=!0,e}}),p.ajaxPrefilter("json jsonp",function(t,n,r){var i,s,o,u=t.jsonp!==!1&&(nr.test(t.url)?"url":typeof t.data=="string"&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&nr.test(t.data)&&"data");if(u||t.dataTypes[0]==="jsonp")return i=t.jsonpCallback=p.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,u?t[u]=t[u].replace(nr,"$1"+i):t.jsonp!==!1&&(t.url+=(Tn.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return o||p.error(i+" was not called"),o[0]},t.dataTypes[0]="json",s=e[i],e[i]=function(){o=arguments},r.always(function(){e[i]=s,t[i]&&(t.jsonpCallback=n.jsonpCallback,tr.push(i)),o&&p.isFunction(s)&&s(o[0]),o=s=undefined}),"script"}),p.parseHTML=function(e,t,n){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||N;var r=E.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=p.buildFragment([e],t,i),i&&i.length&&p(i).remove(),p.merge([],r.childNodes))};var rr=p.fn.load;p.fn.load=function(e,t,n){if(typeof e!="string"&&rr)return rr.apply(this,arguments);var r,i,s,o=this,u=e.indexOf(" ");return u>=0&&(r=e.slice(u,e.length),e=e.slice(0,u)),p.isFunction(t)?(n=t,t=undefined):t&&typeof t=="object"&&(s="POST"),o.length>0&&p.ajax({url:e,type:s,dataType:"html",data:t}).done(function(e){i=arguments,o.html(r?p("<div>").append(p.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,i||[e.responseText,t,e])}),this},p.expr.filters.animated=function(e){return p.grep(p.timers,function(t){return e===t.elem}).length};var ir=e.document.documentElement;p.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=p.css(e,"position"),c=p(e),h={};l==="static"&&(e.style.position="relative"),u=c.offset(),s=p.css(e,"top"),a=p.css(e,"left"),f=(l==="absolute"||l==="fixed")&&p.inArray("auto",[s,a])>-1,f?(r=c.position(),o=r.top,i=r.left):(o=parseFloat(s)||0,i=parseFloat(a)||0),p.isFunction(t)&&(t=t.call(e,n,u)),t.top!=null&&(h.top=t.top-u.top+o),t.left!=null&&(h.left=t.left-u.left+i),"using"in t?t.using.call(e,h):c.css(h)}},p.fn.extend({offset:function(e){if(arguments.length)return e===undefined?this:this.each(function(t){p.offset.setOffset(this,e,t)});var t,n,r={top:0,left:0},i=this[0],s=i&&i.ownerDocument;if(!s)return;return t=s.documentElement,p.contains(t,i)?(typeof i.getBoundingClientRect!==j&&(r=i.getBoundingClientRect()),n=sr(s),{top:r.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0),left:r.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):r},position:function(){if(!this[0])return;var e,t,n={top:0,left:0},r=this[0];return p.css(r,"position")==="fixed"?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),p.nodeName(e[0],"html")||(n=e.offset()),n.top+=p.css(e[0],"borderTopWidth",!0),n.left+=p.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-p.css(r,"marginTop",!0),left:t.left-n.left-p.css(r,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||ir;while(e&&!p.nodeName(e,"html")&&p.css(e,"position")==="static")e=e.offsetParent;return e||ir})}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n=/Y/.test(t);p.fn[e]=function(r){return J(this,function(e,r,i){var s=sr(e);if(i===undefined)return s?t in s?s[t]:s.document.documentElement[r]:e[r];s?s.scrollTo(n?p(s).scrollLeft():i,n?i:p(s).scrollTop()):e[r]=i},e,r,arguments.length,null)}}),p.each(["top","left"],function(e,t){p.cssHooks[t]=Ft(c.pixelPosition,function(e,n){if(n)return n=Bt(e,t),Pt.test(n)?p(e).position()[t]+"px":n})}),p.each({Height:"height",Width:"width"},function(e,t){p.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){p.fn[r]=function(r,i){var s=arguments.length&&(n||typeof r!="boolean"),o=n||(r===!0||i===!0?"margin":"border");return J(this,function(t,n,r){var i;return p.isWindow(t)?t.document.documentElement["client"+e]:t.nodeType===9?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):r===undefined?p.css(t,n,o):p.style(t,n,r,o)},t,s?r:undefined,s,null)}})}),p.fn.size=function(){return this.length},p.fn.andSelf=p.fn.addBack,typeof define=="function"&&define.amd&&define("jquery",[],function(){return p});var or=e.jQuery,ur=e.$;return p.noConflict=function(t){return e.$===p&&(e.$=ur),t&&e.jQuery===p&&(e.jQuery=or),p},typeof t===j&&(e.jQuery=e.$=p),p});if("undefined"==typeof jQuery)throw new Error("Bootstrap requires jQuery");+function(e){function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]}}e.fn.emulateTransitionEnd=function(t){var n=!1,r=this;e(this).one(e.support.transition.end,function(){n=!0});var i=function(){n||e(r).trigger(e.support.transition.end)};return setTimeout(i,t),this},e(function(){e.support.transition=t()})}(jQuery),+function(e){var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function n(){s.trigger("closed.bs.alert").remove()}var r=e(this),i=r.attr("data-target");i||(i=r.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,""));var s=e(i);t&&t.preventDefault(),s.length||(s=r.hasClass("alert")?r:r.parent()),s.trigger(t=e.Event("close.bs.alert")),t.isDefaultPrevented()||(s.removeClass("in"),e.support.transition&&s.hasClass("fade")?s.one(e.support.transition.end,n).emulateTransitionEnd(150):n())};var r=e.fn.alert;e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("bs.alert");i||r.data("bs.alert",i=new n(this)),"string"==typeof t&&i[t].call(r)})},e.fn.alert.Constructor=n,e.fn.alert.noConflict=function(){return e.fn.alert=r,this},e(document).on("click.bs.alert.data-api",t,n.prototype.close)}(jQuery),+function(e){var t=function(n,r){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,r)};t.DEFAULTS={loadingText:"loading..."},t.prototype.setState=function(e){var t="disabled",n=this.$element,r=n.is("input")?"val":"html",i=n.data();e+="Text",i.resetText||n.data("resetText",n[r]()),n[r](i[e]||this.options[e]),setTimeout(function(){"loadingText"==e?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.closest('[data-toggle="buttons"]'),t=!0;if(e.length){var n=this.$element.find("input");"radio"===n.prop("type")&&(n.prop("checked")&&this.$element.hasClass("active")?t=!1:e.find(".active").removeClass("active")),t&&n.prop("checked",!this.$element.hasClass("active")).trigger("change")}t&&this.$element.toggleClass("active")};var n=e.fn.button;e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("bs.button"),s="object"==typeof n&&n;i||r.data("bs.button",i=new t(this,s)),"toggle"==n?i.toggle():n&&i.setState(n)})},e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=n,this},e(document).on("click.bs.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle"),t.preventDefault()})}(jQuery),+function(e){var t=function(t,n){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},t.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},t.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},t.prototype.to=function(t){var n=this,r=this.getActiveIndex();return t>this.$items.length-1||0>t?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){n.to(t)}):r==t?this.pause().cycle():this.slide(t>r?"next":"prev",e(this.$items[t]))},t.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},t.prototype.next=function(){return this.sliding?void 0:this.slide("next")},t.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},t.prototype.slide=function(t,n){var r=this.$element.find(".item.active"),i=n||r[t](),s=this.interval,o="next"==t?"left":"right",u="next"==t?"first":"last",f=this;if(!i.length){if(!this.options.wrap)return;i=this.$element.find(".item")[u]()}this.sliding=!0,s&&this.pause();var l=e.Event("slide.bs.carousel",{relatedTarget:i[0],direction:o});if(!i.hasClass("active")){if(this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid.bs.carousel",function(){var t=e(f.$indicators.children()[f.getActiveIndex()]);t&&t.addClass("active")})),e.support.transition&&this.$element.hasClass("slide")){if(this.$element.trigger(l),l.isDefaultPrevented())return;i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),r.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),f.sliding=!1,setTimeout(function(){f.$element.trigger("slid.bs.carousel")},0)}).emulateTransitionEnd(600)}else{if(this.$element.trigger(l),l.isDefaultPrevented())return;r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger("slid.bs.carousel")}return s&&this.cycle(),this}};var n=e.fn.carousel;e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("bs.carousel"),s=e.extend({},t.DEFAULTS,r.data(),"object"==typeof n&&n),o="string"==typeof n?n:s.slide;i||r.data("bs.carousel",i=new t(this,s)),"number"==typeof n?i.to(n):o?i[o]():s.interval&&i.pause().cycle()})},e.fn.carousel.Constructor=t,e.fn.carousel.noConflict=function(){return e.fn.carousel=n,this},e(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(t){var n,r=e(this),i=e(r.attr("data-target")||(n=r.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"")),s=e.extend({},i.data(),r.data()),o=r.attr("data-slide-to");o&&(s.interval=!1),i.carousel(s),(o=r.attr("data-slide-to"))&&i.data("bs.carousel").to(o),t.preventDefault()}),e(window).on("load",function(){e('[data-ride="carousel"]').each(function(){var t=e(this);t.carousel(t.data())})})}(jQuery),+function(e){var t=function(n,r){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,r),this.transitioning=null,this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.DEFAULTS={toggle:!0},t.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},t.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t=e.Event("show.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var n=this.$parent&&this.$parent.find("> .panel > .in");if(n&&n.length){var r=n.data("bs.collapse");if(r&&r.transitioning)return;n.collapse("hide"),r||n.data("bs.collapse",null)}var i=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[i](0),this.transitioning=1;var s=function(){this.$element.removeClass("collapsing").addClass("in")[i]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return s.call(this);var o=e.camelCase(["scroll",i].join("-"));this.$element.one(e.support.transition.end,e.proxy(s,this)).emulateTransitionEnd(350)[i](this.$element[0][o])}}},t.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=e.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var r=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return e.support.transition?(this.$element[n](0).one(e.support.transition.end,e.proxy(r,this)).emulateTransitionEnd(350),void 0):r.call(this)}}},t.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var n=e.fn.collapse;e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("bs.collapse"),s=e.extend({},t.DEFAULTS,r.data(),"object"==typeof n&&n);i||r.data("bs.collapse",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.collapse.Constructor=t,e.fn.collapse.noConflict=function(){return e.fn.collapse=n,this},e(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(t){var n,r=e(this),i=r.attr("data-target")||t.preventDefault()||(n=r.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""),s=e(i),o=s.data("bs.collapse"),u=o?"toggle":r.data(),f=r.attr("data-parent"),l=f&&e(f);o&&o.transitioning||(l&&l.find('[data-toggle=collapse][data-parent="'+f+'"]').not(r).addClass("collapsed"),r[s.hasClass("in")?"addClass":"removeClass"]("collapsed")),s.collapse(u)})}(jQuery),+function(e){function t(){e(r).remove(),e(i).each(function(t){var r=n(e(this));r.hasClass("open")&&(r.trigger(t=e.Event("hide.bs.dropdown")),t.isDefaultPrevented()||r.removeClass("open").trigger("hidden.bs.dropdown"))})}function n(t){var n=t.attr("data-target");n||(n=t.attr("href"),n=n&&/#/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var r=n&&e(n);return r&&r.length?r:t.parent()}var r=".dropdown-backdrop",i="[data-toggle=dropdown]",s=function(t){e(t).on("click.bs.dropdown",this.toggle)};s.prototype.toggle=function(r){var i=e(this);if(!i.is(".disabled, :disabled")){var s=n(i),o=s.hasClass("open");if(t(),!o){if("ontouchstart"in document.documentElement&&!s.closest(".navbar-nav").length&&e('<div class="dropdown-backdrop"/>').insertAfter(e(this)).on("click",t),s.trigger(r=e.Event("show.bs.dropdown")),r.isDefaultPrevented())return;s.toggleClass("open").trigger("shown.bs.dropdown"),i.focus()}return!1}},s.prototype.keydown=function(t){if(/(38|40|27)/.test(t.keyCode)){var r=e(this);if(t.preventDefault(),t.stopPropagation(),!r.is(".disabled, :disabled")){var s=n(r),o=s.hasClass("open");if(!o||o&&27==t.keyCode)return 27==t.which&&s.find(i).focus(),r.click();var u=e("[role=menu] li:not(.divider):visible a",s);if(u.length){var f=u.index(u.filter(":focus"));38==t.keyCode&&f>0&&f--,40==t.keyCode&&f<u.length-1&&f++,~f||(f=0),u.eq(f).focus()}}}};var o=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var n=e(this),r=n.data("bs.dropdown");r||n.data("bs.dropdown",r=new s(this)),"string"==typeof t&&r[t].call(n)})},e.fn.dropdown.Constructor=s,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=o,this},e(document).on("click.bs.dropdown.data-api",t).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",i,s.prototype.toggle).on("keydown.bs.dropdown.data-api",i+", [role=menu]",s.prototype.keydown)}(jQuery),+function(e){var t=function(t,n){this.options=n,this.$element=e(t),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.load(this.options.remote)};t.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},t.prototype.toggle=function(e){return this[this.isShown?"hide":"show"](e)},t.prototype.show=function(t){var n=this,r=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(r),this.isShown||r.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.$element.on("click.dismiss.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.backdrop(function(){var r=e.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(document.body),n.$element.show(),r&&n.$element[0].offsetWidth,n.$element.addClass("in").attr("aria-hidden",!1),n.enforceFocus();var i=e.Event("shown.bs.modal",{relatedTarget:t});r?n.$element.find(".modal-dialog").one(e.support.transition.end,function(){n.$element.focus().trigger(i)}).emulateTransitionEnd(300):n.$element.focus().trigger(i)}))},t.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one(e.support.transition.end,e.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},t.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.focus()},this))},t.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},t.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.removeBackdrop(),e.$element.trigger("hidden.bs.modal")})},t.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},t.prototype.backdrop=function(t){var n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var r=e.support.transition&&n;if(this.$backdrop=e('<div class="modal-backdrop '+n+'" />').appendTo(document.body),this.$element.on("click.dismiss.modal",e.proxy(function(e){e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),r&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;r?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()):t&&t()};var n=e.fn.modal;e.fn.modal=function(n,r){return this.each(function(){var i=e(this),s=i.data("bs.modal"),o=e.extend({},t.DEFAULTS,i.data(),"object"==typeof n&&n);s||i.data("bs.modal",s=new t(this,o)),"string"==typeof n?s[n](r):o.show&&s.show(r)})},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=n,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());t.preventDefault(),i.modal(s,this).one("hide",function(){n.is(":visible")&&n.focus()})}),e(document).on("show.bs.modal",".modal",function(){e(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){e(document.body).removeClass("modal-open")})}(jQuery),+function(e){var t=function(e,t){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",e,t)};t.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},t.prototype.init=function(t,n,r){this.enabled=!0,this.type=t,this.$element=e(n),this.options=this.getOptions(r);for(var i=this.options.trigger.split(" "),s=i.length;s--;){var o=i[s];if("click"==o)this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if("manual"!=o){var u="hover"==o?"mouseenter":"focus",f="hover"==o?"mouseleave":"blur";this.$element.on(u+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(f+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},t.prototype.getDelegateOptions=function(){var t={},n=this.getDefaults();return this._options&&e.each(this._options,function(e,r){n[e]!=r&&(t[e]=r)}),t},t.prototype.enter=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(n.timeout),n.hoverState="in",n.options.delay&&n.options.delay.show?(n.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show),void 0):n.show()},t.prototype.leave=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(n.timeout),n.hoverState="out",n.options.delay&&n.options.delay.hide?(n.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide),void 0):n.hide()},t.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){if(this.$element.trigger(t),t.isDefaultPrevented())return;var n=this.tip();this.setContent(),this.options.animation&&n.addClass("fade");var r="function"==typeof this.options.placement?this.options.placement.call(this,n[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,s=i.test(r);s&&(r=r.replace(i,"")||"top"),n.detach().css({top:0,left:0,display:"block"}).addClass(r),this.options.container?n.appendTo(this.options.container):n.insertAfter(this.$element);var o=this.getPosition(),u=n[0].offsetWidth,f=n[0].offsetHeight;if(s){var l=this.$element.parent(),c=r,h=document.documentElement.scrollTop||document.body.scrollTop,p="body"==this.options.container?window.innerWidth:l.outerWidth(),d="body"==this.options.container?window.innerHeight:l.outerHeight(),v="body"==this.options.container?0:l.offset().left;r="bottom"==r&&o.top+o.height+f-h>d?"top":"top"==r&&o.top-h-f<0?"bottom":"right"==r&&o.right+u>p?"left":"left"==r&&o.left-u<v?"right":r,n.removeClass(c).addClass(r)}var m=this.getCalculatedOffset(r,o,u,f);this.applyPlacement(m,r),this.$element.trigger("shown.bs."+this.type)}},t.prototype.applyPlacement=function(e,t){var n,r=this.tip(),i=r[0].offsetWidth,s=r[0].offsetHeight,o=parseInt(r.css("margin-top"),10),u=parseInt(r.css("margin-left"),10);isNaN(o)&&(o=0),isNaN(u)&&(u=0),e.top=e.top+o,e.left=e.left+u,r.offset(e).addClass("in");var a=r[0].offsetWidth,f=r[0].offsetHeight;if("top"==t&&f!=s&&(n=!0,e.top=e.top+s-f),/bottom|top/.test(t)){var l=0;e.left<0&&(l=-2*e.left,e.left=0,r.offset(e),a=r[0].offsetWidth,f=r[0].offsetHeight),this.replaceArrow(l-i+a,a,"left")}else this.replaceArrow(f-s,f,"top");n&&r.offset(e)},t.prototype.replaceArrow=function(e,t,n){this.arrow().css(n,e?50*(1-e/t)+"%":"")},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},t.prototype.hide=function(){function t(){"in"!=n.hoverState&&r.detach()}var n=this,r=this.tip(),i=e.Event("hide.bs."+this.type);return this.$element.trigger(i),i.isDefaultPrevented()?void 0:(r.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?r.one(e.support.transition.end,t).emulateTransitionEnd(150):t(),this.$element.trigger("hidden.bs."+this.type),this)},t.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},t.prototype.hasContent=function(){return this.getTitle()},t.prototype.getPosition=function(){var t=this.$element[0];return e.extend({},"function"==typeof t.getBoundingClientRect?t.getBoundingClientRect():{width:t.offsetWidth,height:t.offsetHeight},this.$element.offset())},t.prototype.getCalculatedOffset=function(e,t,n,r){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-n/2}:"top"==e?{top:t.top-r,left:t.left+t.width/2-n/2}:"left"==e?{top:t.top+t.height/2-r/2,left:t.left-n}:{top:t.top+t.height/2-r/2,left:t.left+t.width}},t.prototype.getTitle=function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||("function"==typeof n.title?n.title.call(t[0]):n.title)},t.prototype.tip=function(){return this.$tip=this.$tip||e(this.options.template)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},t.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},t.prototype.enable=function(){this.enabled=!0},t.prototype.disable=function(){this.enabled=!1},t.prototype.toggleEnabled=function(){this.enabled=!this.enabled},t.prototype.toggle=function(t){var n=t?e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;n.tip().hasClass("in")?n.leave(n):n.enter(n)},t.prototype.destroy=function(){this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var n=e.fn.tooltip;e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("bs.tooltip"),s="object"==typeof n&&n;i||r.data("bs.tooltip",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=n,this}}(jQuery),+function(e){var t=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");t.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),t.prototype.constructor=t,t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content")[this.options.html?"html":"text"](n),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},t.prototype.hasContent=function(){return this.getTitle()||this.getContent()},t.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||("function"==typeof t.content?t.content.call(e[0]):t.content)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},t.prototype.tip=function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip};var n=e.fn.popover;e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("bs.popover"),s="object"==typeof n&&n;i||r.data("bs.popover",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.noConflict=function(){return e.fn.popover=n,this}}(jQuery),+function(e){function t(n,r){var i,s=e.proxy(this.process,this);this.$element=e(n).is("body")?e(window):e(n),this.$body=e("body"),this.$scrollElement=this.$element.on("scroll.bs.scroll-spy.data-api",s),this.options=e.extend({},t.DEFAULTS,r),this.selector=(this.options.target||(i=e(n).attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.offsets=e([]),this.targets=e([]),this.activeTarget=null,this.refresh(),this.process()}t.DEFAULTS={offset:10},t.prototype.refresh=function(){var t=this.$element[0]==window?"offset":"position";this.offsets=e([]),this.targets=e([]);var n=this;this.$body.find(this.selector).map(function(){var r=e(this),i=r.data("target")||r.attr("href"),s=/^#\w/.test(i)&&e(i);return s&&s.length&&[[s[t]().top+(!e.isWindow(n.$scrollElement.get(0))&&n.$scrollElement.scrollTop()),i]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){n.offsets.push(this[0]),n.targets.push(this[1])})},t.prototype.process=function(){var e,t=this.$scrollElement.scrollTop()+this.options.offset,n=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,r=n-this.$scrollElement.height(),i=this.offsets,s=this.targets,o=this.activeTarget;if(t>=r)return o!=(e=s.last()[0])&&this.activate(e);for(e=i.length;e--;)o!=s[e]&&t>=i[e]&&(!i[e+1]||t<=i[e+1])&&this.activate(s[e])},t.prototype.activate=function(t){this.activeTarget=t,e(this.selector).parents(".active").removeClass("active");var n=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',r=e(n).parents("li").addClass("active");r.parent(".dropdown-menu").length&&(r=r.closest("li.dropdown").addClass("active")),r.trigger("activate.bs.scrollspy")};var n=e.fn.scrollspy;e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("bs.scrollspy"),s="object"==typeof n&&n;i||r.data("bs.scrollspy",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=n,this},e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(jQuery),+function(e){var t=function(t){this.element=e(t)};t.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.data("target");if(r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var i=n.find(".active:last a")[0],s=e.Event("show.bs.tab",{relatedTarget:i});if(t.trigger(s),!s.isDefaultPrevented()){var o=e(r);this.activate(t.parent("li"),n),this.activate(o,o.parent(),function(){t.trigger({type:"shown.bs.tab",relatedTarget:i})})}}},t.prototype.activate=function(t,n,r){function i(){s.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),o?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var s=n.find("> .active"),o=r&&e.support.transition&&s.hasClass("fade");o?s.one(e.support.transition.end,i).emulateTransitionEnd(150):i(),s.removeClass("in")};var n=e.fn.tab;e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("bs.tab");i||r.data("bs.tab",i=new t(this)),"string"==typeof n&&i[n]()})},e.fn.tab.Constructor=t,e.fn.tab.noConflict=function(){return e.fn.tab=n,this},e(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})}(jQuery),+function(e){var t=function(n,r){this.options=e.extend({},t.DEFAULTS,r),this.$window=e(window).on("scroll.bs.affix.data-api",e.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",e.proxy(this.checkPositionWithEventLoop,this)),this.$element=e(n),this.affixed=this.unpin=null,this.checkPosition()};t.RESET="affix affix-top affix-bottom",t.DEFAULTS={offset:0},t.prototype.checkPositionWithEventLoop=function(){setTimeout(e.proxy(this.checkPosition,this),1)},t.prototype.checkPosition=function(){if(this.$element.is(":visible")){var n=e(document).height(),r=this.$window.scrollTop(),i=this.$element.offset(),s=this.options.offset,o=s.top,u=s.bottom;"object"!=typeof s&&(u=o=s),"function"==typeof o&&(o=s.top()),"function"==typeof u&&(u=s.bottom());var f=null!=this.unpin&&r+this.unpin<=i.top?!1:null!=u&&i.top+this.$element.height()>=n-u?"bottom":null!=o&&o>=r?"top":!1;this.affixed!==f&&(this.unpin&&this.$element.css("top",""),this.affixed=f,this.unpin="bottom"==f?i.top-r:null,this.$element.removeClass(t.RESET).addClass("affix"+(f?"-"+f:"")),"bottom"==f&&this.$element.offset({top:document.body.offsetHeight-u-this.$element.height()}))}};var n=e.fn.affix;e.fn.affix=function(n){return this.each(function(){var r=e(this),i=r.data("bs.affix"),s="object"==typeof n&&n;i||r.data("bs.affix",i=new t(this,s)),"string"==typeof n&&i[n]()})},e.fn.affix.Constructor=t,e.fn.affix.noConflict=function(){return e.fn.affix=n,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),n=t.data();n.offset=n.offset||{},n.offsetBottom&&(n.offset.bottom=n.offsetBottom),n.offsetTop&&(n.offset.top=n.offsetTop),t.affix(n)})})}(jQuery),define("bootstrap",["jquery"],function(e){return function(){var t,n;return t||e.bootstrap}}(this)),define("storage/StorageManager",[],function(){var e={saveFile:function(e,t,n,r){n()},deleteFile:function(e,t,n){t()},getPathUrl:function(e){return e=="/epub_library.json"?"epub_content/epub_library.json":e},initStorage:function(e,t){e()}};return e}),define("storage/Settings",[],function(){var e=undefined,t=function(){if(e)return!0;if(typeof e=="undefined"){e=!1;if(localStorage)try{localStorage.setItem("_isLocalStorageEnabled","?"),localStorage.removeItem("_isLocalStorageEnabled"),e=!0}catch(t){}return e}return!1};return Settings={put:function(e,n,r){if(!t()){r&&r();return}var n=JSON.stringify(n);localStorage[e]=n,r&&r()},get:function(e,n){if(!t()){n&&n(null);return}var r=localStorage[e];r?n(JSON.parse(r)):n(null)},getMultiple:function(e,n){if(!t()){n&&n({});return}var r={};for(var i=0;i<e.length;i++)localStorage[e[i]]&&(r[e[i]]=localStorage[e[i]]);n(r)}},Settings}),function(){function e(r,i,s){s===void 0&&(s=i);if(t(r)==="array"){var o=[];if(r[0]!=null)if(n=="msie"){i.setProperty("SelectionLanguage","XPath");for(var s=s.selectNodes(r[0]),u;u=s.nextNode();)o.push(e(r[1],i,u))}else if(n=="node"){s=s.find(r[0]);for(u=0;u<s.length;u++)o.push(e(r[1],i,s[u]))}else for(s=i.evaluate(r[0],s,Jath.resolver,XPathResult.ANY_TYPE,null);u=s.iterateNext();)o.push(e(r[1],i,u));else for(u=1;u<r.length;u++)o.push(e(r[u],i,s));r=o}else if(t(r)==="object"){u={};for(o in r)u[o]=e(r[o],i,s);r=u}else o=s,n=="msie"?(i.setProperty("SelectionLanguage","XPath"),r=t(r)=="string"&&r.substring(0,1)!=Jath.literalChar?o.selectSingleNode(r).text:r.substring(1)):n=="node"?(require("sys").puts(r),r=o.get(r).text()):r=t(r)=="string"&&r[0]!=Jath.literalChar?i.evaluate(r,o,Jath.resolver,XPathResult.STRING_TYPE,null).stringValue:r.substring(1);return r}function t(e){var t=typeof e;return t==="object"&&(e?typeof e.length=="number"&&!e.propertyIsEnumerable("length")&&typeof e.splice=="function"&&(t="array"):t="null"),t}Jath={},Jath.parse=e,Jath.resolver=null,Jath.literalChar=":";var n;typeof WScript!="undefined"?n="msie":typeof process!="undefined"?(n="node",require("libxmljs"),exports.parse=e):n=navigator.userAgent.toLowerCase().indexOf("msie")>-1?"msie":"standards"}(),define("jath",function(e){return function(){var t,n;return t||e.Jath}}(this)),define("PackageParser",["jath"],function(e){e.resolver=function(e){var t={def:"http://www.idpf.org/2007/opf",dc:"http://purl.org/dc/elements/1.1/"};return t[e]};var t={metadata:{id:"//def:metadata/dc:identifier",epub_version:"//def:package/@version",title:"//def:metadata/dc:title",author:"//def:metadata/dc:creator",publisher:"//def:metadata/dc:publisher",description:"//def:metadata/dc:description",rights:"//def:metadata/dc:rights",language:"//def:metadata/dc:language",pubdate:"//def:metadata/dc:date",modified_date:"//def:metadata/def:meta[@property='dcterms:modified']",layout:"//def:metadata/def:meta[@property='rendition:layout']",spread:"//def:metadata/def:meta[@property='rendition:spread']",orientation:"//def:metadata/def:meta[@property='rendition:orientation']",ncx:"//def:spine/@toc",page_prog_dir:"//def:spine/@page-progression-direction",active_class:"//def:metadata/def:meta[@property='media:active-class']"},manifest:["//def:item",{id:"@id",href:"@href",media_type:"@media-type",properties:"@properties",media_overlay:"@media-overlay"}],spine:["//def:itemref",{idref:"@idref",properties:"@properties",linear:"@linear"}],bindings:["//def:bindings/def:mediaType",{handler:"@handler",media_type:"@media-type"}]};return PackageParser={parsePackageDom:function(n){var r=e.parse(t,n);return r=r.metadata,r.coverHref=PackageParser.getCoverHref(n),r},getCoverHref:function(e){var t,n;t=e.getElementsByTagName("manifest")[0],n=$('item[properties~="cover-image"]',t);if(n.length===1&&n.attr("href"))return n.attr("href");var r=$('meta[name="cover"]',e),i=r.attr("content");if(r.length>=1&&i){n=$('item[id="'+i+'"]',t);if(n.length===1&&n.attr("href"))return n.attr("href")}return n=$("#cover",t),n.length===1&&n.attr("href")?n.attr("href"):null}},PackageParser}),define("workers/Messages",[],function(){return{IMPORT_ZIP:0,OVERWRITE_CONTINUE:1,FIND_PACKAGE_RESPONSE:2,PARSE_PACKAGE_RESPONSE:3,DELETE_EPUB:4,IMPORT_DIR:5,IMPORT_URL:6,MIGRATE:7,OVERWRITE_SIDE_BY_SIDE:8,SUCCESS:100,PROGRESS:101,ERROR:102,OVERWRITE:103,FIND_PACKAGE:104,PARSE_PACKAGE:105,PROGRESS_EXTRACTING:200,PROGRESS_WRITING:201,PROGRESS_DELETING:202,PROGRESS_MIGRATING:203,ERROR_STORAGE:300,ERROR_EPUB:301,ERROR_AJAX:302}}),define("encryptionHandler",["require","module"],function(e,t){var n=function(e){function r(e,t){var n=new FileReader;n.onload=function(){var e=this.result;t(new Uint8Array(e))},n.readAsArrayBuffer(e)}function i(e,t,n,i){var s=e.slice(0,t);r(s,function(r){var s=n.length;for(var o=0;o<t;o++)r[o]=r[o]^n[o%s];var u=new Blob([r],{type:e.type}),a=e.slice(t),f=new Blob([u,a],{type:e.type});i(f)})}function s(t,n){var r=1040;i(t,r,e.uidHash,n)}function o(e){var t=/(urn:uuid:)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})/i,n=t.exec(e),r=n[2]+n[3]+n[4]+n[5]+n[6];(!r||r.length!=32)&&console.error("Bad UUID format for ID :"+e);var i=[];for(var s=0;s<16;s++){var o=r.substr(s*2,2),u=parseInt(o,16);i.push(u)}return i}function u(t,n){var r=o(e.uid),s=1024;i(t,s,r,n)}var t=this,n={"http://www.idpf.org/2008/embedding":s,"http://ns.adobe.com/pdf/enc#RC":u};this.isEncryptionSpecified=function(){return e&&e.encryptions},this.getEncryptionMethodForRelativePath=function(n){return t.isEncryptionSpecified()?e.encryptions[n]:undefined},this.getDecryptionFunctionForRelativePath=function(e){var r=t.getEncryptionMethodForRelativePath(e);return r&&n[r]?n[r]:undefined}};return n.CreateEncryptionData=function(e,t){var n={uid:e,uidHash:window.Crypto.SHA1(unescape(encodeURIComponent(e.trim())),{asBytes:!0}),encryptions:undefined},r=$("EncryptedData",t);return r.each(function(e,t){var r=$("EncryptionMethod",t).first().attr("Algorithm"),i=$("CipherReference",t);i.each(function(e,t){var i=$(t).attr("URI");console.log("Encryption/obfuscation algorithm "+r+" specified for "+i),n.encryptions||(n.encryptions={}),n.encryptions[i]=r})}),n},n}),define("workers/WorkerProxy",["module","workers/Messages","jquery","PackageParser","encryptionHandler"],function(e,t,n,r,i){var s,o=function(){s.terminate(),s=null},u=function(u,a){s&&console.log("dangling worker");var f=e.config().workerUrl;s=new Worker(f);var l=function(){s.postMessage({msg:t.OVERWRITE_CONTINUE})},c=function(){s.postMessage({msg:t.OVERWRITE_SIDE_BY_SIDE})},h=function(){o()},p=a.error||n.noop,d=function(e){o(),p(e)};s.onmessage=function(e){var u=e.data;switch(u.msg){case t.SUCCESS:a.success&&a.success(u.libraryItems),o();break;case t.PROGRESS:a.progress&&a.progress(u.percent,u.progressType,u.progressData);break;case t.OVERWRITE:a.overwrite&&a.overwrite(u.item,l,c,h);break;case t.FIND_PACKAGE:var f=(new DOMParser).parseFromString(u.containerStr,"text/xml"),p=n("rootfile",f);p.length?s.postMessage({msg:t.FIND_PACKAGE_RESPONSE,path:p.attr("full-path")}):(d(t.ERROR_EPUB),console.error("Epub container.xml missing rootfile element"));break;case t.PARSE_PACKAGE:var v=(new DOMParser).parseFromString(u.packageStr,"text/xml"),m=r.parsePackageDom(v),g;if(u.encryptionStr){var y=(new DOMParser).parseFromString(u.encryptionStr,"text/xml");g=i.CreateEncryptionData(m.id,y)}s.postMessage({msg:t.PARSE_PACKAGE_RESPONSE,packageObj:m,encryptionData:g});break;default:d(u.errorMsg||"Unknown error"),o()}},s.onerror=function(){console.error(arguments)},currentWorker=s,s.postMessage(u)};return{importZip:function(e,n,r){u({msg:t.IMPORT_ZIP,buf:e,libraryItems:n},r)},importDirectory:function(e,n,r){u({msg:t.IMPORT_DIR,files:e,libraryItems:n},r)},importUrl:function(e,n,r){u({msg:t.IMPORT_URL,url:e,libraryItems:n},r)},deleteEpub:function(e,n,r){u({msg:t.DELETE_EPUB,id:e,libraryItems:n},r)},migrateOldBooks:function(e){u({msg:t.MIGRATE},e)}}}),define("text",["module"],function(e){var t,n,r,i,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,a=typeof location!="undefined"&&location.href,f=a&&location.protocol&&location.protocol.replace(/\:/,""),l=a&&location.hostname,c=a&&(location.port||undefined),h=[],p=e.config&&e.config()||{};t={version:"2.0.6",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(u);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(r){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,p.isBuild&&(h[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}p.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),h=p.useXhr||t.useXhr;!a||h(u,f,l,c)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(h.hasOwnProperty(n)){var s=t.jsEscape(h[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(p.env==="node"||!p.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)};else if(p.env==="xhr"||!p.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);p.onXhr&&p.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),p.onXhrComplete&&p.onXhrComplete(s,e))},s.send(null)};else if(p.env==="rhino"||!p.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(p.env==="xpconnect"||!p.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,t){var n,s,o={},u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),s=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),s.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),o),s.close(),n.close(),t(o.value)}catch(a){throw new Error((u&&u.path||"")+": "+a)}};return t}),define("text!i18n/_locales/de/messages.json",[],function(){return'{ "about": {\n    "message": "Über Readium"\n    },\n    "preview": {\n        "message": "Vorschau"\n    },\n    "list_view": {\n        "message": "Listenansicht"\n    },\n    "thumbnail_view": {\n        "message": "Kachelansicht"\n    },\n    "view_library": {\n        "message": "Bibliothek"\n    },\n    "highlight_selection": {\n        "message": "Ausgewählten Text hervorheben"\n    },\n    "toc": {\n        "message": "Inhaltsverzeichnis"\n    },\n    "settings": {\n        "message": "Einstellungen"\n    },\n    "enter_fullscreen": {\n        "message": "Vollbildmodus"\n    },\n    "exit_fullscreen": {\n        "message": "Vollbildmodus verlassen"\n    },\n    "chrome_extension_name": {\n        "message": "Readium"\n    },\n    "chrome_extension_description": {\n        "message": "Ein Leseprogramm für EPUB3 Bücher."\n    },\n    "ok" : {\n        "message" : "Ok"\n    },\n    "i18n_readium_library": {\n        "message": "Readium Bibliothek"\n    },\n    "i18n_loading": {\n        "message": "Bibliothek wird geladen"\n    },\n    "i18n_readium_options": {\n        "message": "Readium Einstellungen:"\n    },\n    "i18n_save_changes": {\n        "message": "Änderungen speichern"\n    },\n    "i18n_close": {\n        "message": "Schließen"\n    },\n    "i18n_keyboard_shortcuts": {\n        "message": "Funktionstasten"\n    },\n    "i18n_keyboard_reload": {\n        "message": "Bitte laden Sie die Seite im Browser neu, damit die Änderungen der Tastaturkürzel wirksam werden."\n    },\n    "i18n_reset_key": {\n        "message": "Taste zurücksetzen"\n    },\n    "i18n_reset_key_all": {\n        "message": "Alle Funktionstasten auf Standard zurücksetzen"\n    },\n    "i18n_duplicate_keyboard_shortcut": {\n        "message": "Doppelbelegung"\n    },\n    "i18n_invalid_keyboard_shortcut": {\n        "message": "Nicht zulässig"\n    },\n    "i18n_paginate_all": {\n        "message": "Fließtext des EPUB Inhalts paginieren"\n    },\n    "i18n_automatically": {\n        "message": "*.epub URLs automatisch in Readium öffnen"\n    },\n    "i18n_show_warning": {\n        "message": "Warnhinweise beim Entpacken von EPUB Dateien anzeigen"\n    },\n    "i18n_details": {\n        "message": "Details"\n    },\n    "i18n_read": {\n        "message": "Lesen"\n    },\n    "i18n_delete": {\n        "message": "Löschen"\n    },\n    "i18n_are_you_sure": {\n        "message": "Möchten Sie diese Datei wirklich unwiderruflich löschen?"\n    },\n    "delete_dlg_title": {\n        "message": "Löschen bestätigen"\n    },\n\n    "i18n_auto_page_turn_enable": {\n        "message": "Automatisches Umblättern einschalten"\n    },\n    "i18n_auto_page_turn_disable": {\n        "message": "Automatisches Umblättern ausschalten"\n    },\n\n    "i18n_playback_scroll_enable": {\n        "message": "Scrollen während der Wiedergabe"\n    },\n    "i18n_playback_scroll_disable": {\n        "message": "Kein Scrollen während der Wiedergabe"\n    },\n    "i18n_audio_touch_enable": {\n        "message": "Touch-to-play einschalten"\n    },\n    "i18n_audio_touch_disable": {\n        "message": "Touch-to-play ausschalten"\n    },\n    "i18n_audio_highlight_default": {\n        "message": "Standard"\n    },\n    "i18n_audio_highlight": {\n        "message": "Hervorhebungsfarbe"\n    },\n\n    "delete_progress_title": {\n        "message": "Löschen wird ausgeführt"\n    },\n    "delete_progress_message": {\n        "message": "Löschen"\n    },\n    "migrate_dlg_title": {\n        "message": "Bücher migrieren"\n    },\n    "migrate_dlg_message": {\n        "message": "Daten werden geladen..."\n    },\n    "migrating": {\n        "message": "Migrieren..."\n    },\n    "replace_dlg_title": {\n        "message": "Konflikt festgestellt"\n    },\n    "replace_dlg_message": {\n        "message": "Soll das bestehende EPUB wirklich ersetzt werden?"\n    },\n    "import_dlg_title": {\n        "message": "EPUB importieren"\n    },\n    "import_dlg_message": {\n        "message": "EPUB Inhalt überprüfen..."\n    },\n    "storing_file": {\n        "message": "Datei speichern"\n    },\n    "err_unknown": {\n        "message": "Unbekannter Fehler. Für Details öffnen Sie die Konsole."\n    },\n    "err_storage": {\n        "message": "Zugriff auf Dateispeicher nicht möglich."\n    },\n    "err_epub_corrupt": {\n        "message": "Ungültiges oder beschädigtes EPUB Paket"\n    },\n    "err_dlg_title": {\n        "message": "Unerwarteter Fehler"\n    },\n    "replace" : {\n        "message": "Ersetzen"\n    },\n    "i18n_author": {\n        "message": "Autor: "\n    },\n    "i18n_publisher": {\n        "message": "Verlag: "\n    },\n    "i18n_source": {\n        "message": "Quelle: "\n    },\n    "i18n_pub_date": {\n        "message": "Veröffentlicht am: "\n    },\n    "i18n_modified_date": {\n        "message": "Zuletzt geändert am: "\n    },\n    "i18n_id": {\n        "message": "ID: "\n    },\n    "i18n_epub_version": {\n        "message": "EPUB Version: "\n    },\n    "i18n_created_at": {\n        "message": "Erstellt am: "\n    },\n    "i18n_format": {\n        "message": "Format: "\n    },\n    "i18n_added": {\n        "message": "Hinzugefügt am: "\n    },\n    "i18n_unknown": {\n        "message": "Unbekannt"\n    },\n    "i18n_sorry": {\n        "message": "Das aktuelle EPUB enthält für diesen Inhalt keine Media Overlays."\n    },\n    "i18n_add_items": {\n        "message": "Füge Werke zur Bibliothek hinzu."\n    },\n    "i18n_extracting": {\n        "message": "Entpacke: "\n    },\n    "i18n_add_book_to_readium_library": {\n        "message": "Buch zur Readium Bibliothek hinzufügen:"\n    },\n    "i18n_add_book": {\n        "message": "Buch hinzufügen"\n    },\n    "i18n_cancel": {\n        "message": "Abbrechen"\n    },\n    "i18n_from_the_web": {\n        "message": "Internet:"\n    },\n    "i18n_from_local_file": {\n        "message": "Lokale Datei:"\n    },\n    "i18n_enter_a_url": {\n        "message": "URL einer .epub Datei eingeben"\n    },\n    "i18n_unpacked_directory": {\n        "message": "Entpacktes Verzeichnis:"\n    },\n    "i18n_validate": {\n        "message": "Prüfe:"\n    },\n    "i18n_confirm_that_this_book": {\n        "message": "Bestätigung, dass dieses Buch mit EPUB Standards übereinstimmt"\n    },\n    "i18n_single_pages": {\n        "message": "Einzelseiten"\n    },\n    "i18n_double_pages": {\n        "message": "Doppelseiten"\n    },\n    "i18n_save_settings": {\n        "message": "Einstellungen speichern"\n    },\n    "i18n_font_size": {\n        "message": "Schriftgröße"\n    },\n    "i18n_margins": {\n        "message": "Rand"\n    },\n    "i18n_text_and_background_color": {\n        "message": "Text- und Hintergrundfarbe"\n    },\n    "i18n_author_theme": {\n        "message": "Vorgabe des Autors"\n    },\n    "i18n_black_and_white": {\n        "message": "Schwarzweiss"\n    },\n    "i18n_arabian_nights": {\n        "message": "Arabian Nights"\n    },\n    "i18n_sands_of_dune": {\n        "message": "Sands of Dune"\n    },\n    "i18n_ballard_blues": {\n        "message": "Ballard Blues"\n    },\n    "i18n_vancouver_mist": {\n        "message": "Vancouver Mist"\n    },\n    "i18n_display_format": {\n        "message": "Anzeigeformat"\n    },\n    "i18n_spread_auto": {\n        "message": "Automatisch"\n    },\n    "i18n_scroll_mode": {\n        "message": "Scroll Modus"\n    },\n    "i18n_scroll_mode_auto": {\n        "message": "Automatisch"\n    },\n    "i18n_scroll_mode_doc": {\n        "message": "Dokument"\n    },\n    "i18n_scroll_mode_continuous": {\n        "message": "Kontinuierlich"\n    },\n\n    "i18n_page_transition": {\n        "message": "Umblätter-Effekt"\n    },\n    "i18n_page_transition_none": {\n        "message": "Keiner"\n    },\n    "i18n_page_transition_fade": {\n        "message": "Fade"\n    },\n    "i18n_page_transition_slide": {\n        "message": "Slide"\n    },\n    "i18n_page_transition_swoosh": {\n        "message": "Swoosh"\n    },\n    "i18n_page_transition_butterfly": {\n        "message": "Butterfly"\n    },\n    "i18n_html_readium_tm_a_project": {\n        "message": "Readium für Chrome ist die Chrome Browser Erweiterung basierend auf ReadiumJS, einem Open-Source Lesesystem und einer JavaScript Bibliothek zur Darstellung von EPUB® Veröffentlichungen in Web-Browsern. ReadiumJS ist ein Projekt der Readium Foundation (Readium.org). Wenn Sie mehr darüber erfahren möchten oder das Projekt unterstützen wollen, besuchen Sie bitte die <a href=\\"http://readium.org/\\">Projekt Homepage</a>."\n\n    },\n    "gethelp": {\n        "message": "Falls Sie auf Probleme stoßen, Fragen haben oder \\"Hallo\\" sagen möchten, besuchen Sie <a href=\\"http://idpf.org/forums/readium\\">unser Forum</a>."\n    },\n    "i18n_toolbar": {\n        "message": "Werkzeugleiste"\n    },\n    "i18n_toolbar_show": {\n        "message": "Werkzeugleiste anzeigen"\n    },\n    "i18n_toolbar_hide": {\n        "message": "Werkzeugleiste ausblenden"\n    },\n    "i18n_audio_play": {\n        "message": "Audio - Abspielen"\n    },\n    "i18n_audio_pause": {\n        "message": "Audio - Pause"\n    },\n    "i18n_audio_play_background": {\n        "message": "Hintergrundaudio ein"\n    },\n    "i18n_audio_pause_background": {\n        "message": "Hintergrundaudio aus"\n    },\n    "i18n_audio_previous": {\n        "message": "Vorige Audiophrase"\n    },\n    "i18n_audio_next": {\n        "message": "Nächste Audiophrase"\n    },\n    "i18n_audio_volume": {\n        "message": "Lautstärke"\n    },\n    "i18n_audio_volume_increase": {\n        "message": "Lautstärke erhöhen"\n    },\n    "i18n_audio_volume_decrease": {\n        "message": "Lautstärke verringern"\n    },\n    "i18n_audio_time": {\n        "message": "Audio - Zeitmarke"\n    },\n    "i18n_audio_mute": {\n        "message": "Audio ausschalten"\n    },\n    "i18n_audio_unmute": {\n        "message": "Audio einschalten"\n    },\n    "i18n_audio_expand": {\n        "message": "Erweiterte Audio-Steuerung anzeigen"\n    },\n    "i18n_audio_collapse": {\n        "message": "Erweiterte Audio-Steuerung ausblenden"\n    },\n    "i18n_audio_esc": {\n        "message": "Aktuellen Audio-Bereich verlassen"\n    },\n    "i18n_audio_rate": {\n        "message": "Audio - Wiedergabegeschwindigkeit"\n    },\n    "i18n_audio_rate_increase": {\n        "message": "Audio - Wiedergabegeschwindigkeit erhöhen"\n    },\n    "i18n_audio_rate_decrease": {\n        "message": "Audio - Wiedergabegeschwindigkeit verringern"\n    },\n    "i18n_audio_rate_reset": {\n        "message": "Audio - Wiedergabegeschwindigkeit zurücksetzen"\n    },\n    "i18n_audio_skip_disable": {\n        "message": "Audio - Überspringen unterbinden "\n    },\n    "i18n_audio_skip_enable": {\n        "message": "Audio - Überspringen ermöglichen"\n    },\n    "i18n_audio_sync": {\n        "message": "Text-Audio-Synchronisation"\n    },\n    "i18n_audio_sync_default": {\n        "message": "Nach Vorgabe"\n    },\n    "i18n_audio_sync_word": {\n        "message": "Wort"\n    },\n    "i18n_audio_sync_sentence": {\n        "message": "Satz"\n    },\n    "i18n_audio_sync_paragraph": {\n        "message": "Absatz"\n    },\n    "i18n_page_previous": {\n        "message": "Vorige Seite"\n    },\n    "i18n_page_next": {\n        "message": "Nächste Seite"\n    },\n    "chrome_accept_languages": {\n        "message": "$CHROME$ akzeptiert $languages$ Sprachen",\n        "placeholders": {\n            "chrome": {\n                "content": "Chrome",\n                "example": "Chrome"\n            },\n            "languages": {\n                "content": "$1",\n                "example": "en-US,ja,sr,de,zh_CN"\n            }\n        }\n    }\n}'}),define("text!i18n/_locales/es/messages.json",[],function(){return'{\n\n    "chrome_extension_name": {\n        "message": "Readium"\n    },\n    "about" : {\n        "message" : "Acerca de"\n    },\n    "preview" : {\n        "message" : "Vista previa"\n    },\n    "list_view" : {\n        "message" : "Vista en lista"\n    },\n    "thumbnail_view" : {\n        "message" : "Vista en miniaturas"\n    },\n    "view_library": {\n        "message" : "Biblioteca"\n    },\n    "highlight_selection" : {\n        "message" : "Subrayar texto seleccionado"\n    },\n    "toc" : {\n        "message" : "Tabla de contenidos"\n    },\n    "settings" : {\n        "message" : "Preferencias"\n    },\n    "enter_fullscreen" : {\n        "message" : "Abrir modo de pantalla completa"\n    },\n    "exit_fullscreen" : {\n        "message" : "Cerrar modo de pantalla completa"\n    },\n    "chrome_extension_description": {\n        "message": "Lector de libros EPUB3."\n    },\n    "ok" : {\n        "message" : "Ok"\n    },\n    "delete_dlg_title" : {\n        "message" : "Confirmar eliminación"\n    },\n    "delete_progress_title" : {\n        "message" : "Eliminación en progreso"\n    },\n    "delete_progress_message" : {\n        "message" : "Eliminando"\n    },\n    "migrate_dlg_title" : {\n        "message" : "Migrando libros"\n    },\n    "migrate_dlg_message" : {\n        "message" : "Cargando datos..."\n    },\n    "migrating" : {\n        "message" : "Migrando"\n    },\n    "replace_dlg_title" : {\n        "message": "Se ha detectado un conflicto"\n    },\n    "replace_dlg_message": {\n        "message": "Si decide continuar, el siguiente epub será reemplazado por el que está siendo importado"\n    },\n    "import_dlg_title" : {\n        "message": "Importando EPUB"\n    },\n    "import_dlg_message" : {\n        "message": "Examinando contenido del EPUB..."\n    },\n    "storing_file" : {\n        "message": "Guardando archivo"\n    },\n    "err_unknown" : {\n        "message": "Error desconocido. Chequear la consola para conocer más detalles."\n    },\n    "err_storage" : {\n        "message": "No es posible acceder al dispositvo"\n    },\n    "err_epub_corrupt" : {\n        "message": "Paquete EPUB inválido o corrupto"\n    },\n    "err_dlg_title" : {\n        "message": "Error inesperado"\n    },\n    "replace" : {\n        "message": "Reemplazar"\n    },\n    "gethelp" : {\n        "message" : "Si encuentra algún problema, tiene preguntas, o le gustaría decir hola, visite <a href=\\"http://idpf.org/forums/readium\\">nuestro foro</a>"\n    },\n    "i18n_readium_library" : {\n        "message" : "Biblioteca Readium"\n    },\n    "i18n_loading" : {\n        "message" : "Cargando biblioteca"\n    },\n    "i18n_readium_options" : {\n        "message" : "Readium Opciones:"\n    },\n    "i18n_save_changes" : {\n        "message" : "Guardar cambios"\n    },\n    "i18n_close" : {\n        "message" : "Cerrar"\n    },\n    "i18n_keyboard_shortcuts" : {\n        "message" : "Teclas de acceso rápido"\n    },\n    "i18n_keyboard_reload" : {\n        "message" : "Por favor, actualiza la página para que las teclas de acceso rápido tengan efecto."\n    },\n    "i18n_reset_key" : {\n        "message" : "Reestablecer tecla"\n    },\n    "i18n_reset_key_all" : {\n        "message" : "Reestablecer todos las teclas de acceso rápido"\n    },\n    "i18n_duplicate_keyboard_shortcut" : {\n        "message" : "DUPLICADO"\n    },\n    "i18n_invalid_keyboard_shortcut" : {\n        "message" : "INVALIDO"\n    },\n    "i18n_paginate_all" : {\n        "message" : "Paginar todo el contenido ePUB repaginable"\n    },\n    "i18n_automatically" : {\n        "message" : "Abrir automáticamente urls *.epub en readium"\n    },\n    "i18n_show_warning" : {\n        "message" : "Mostrar advertencias al desempaquetar archivos EPUB"\n    },\n    "i18n_details" : {\n        "message" : "Detalles"\n    },\n    "i18n_read" : {\n        "message" : "Leer"\n    },\n    "i18n_delete" : {\n        "message" : "Eliminar"\n    },\n    "i18n_author" : {\n        "message" : "Autor: "\n    },\n    "i18n_publisher" : {\n        "message" : "Editor: "\n    },\n    "i18n_source" : {\n        "message" : "Fuente: "\n    },\n    "i18n_pub_date" : {\n        "message" : "Fecha de publicación: "\n    },\n    "i18n_modified_date" : {\n        "message" : "Fecha de modificación: "\n    },\n    "i18n_id" : {\n        "message" : "ID: "\n    },\n    "i18n_epub_version" : {\n        "message" : "Versión EPUB: "\n    },\n    "i18n_created_at" : {\n        "message" : "Creado en: "\n    },\n    "i18n_format" : {\n        "message" : "Formato: "\n    },\n    "i18n_added" : {\n        "message" : "Añadido: "\n    },\n    "i18n_unknown" : {\n        "message" : "Desconocido"\n    },\n    "i18n_sorry" : {\n        "message" : "Disculpa, el EPUB actual no contiene superposición multimedia para este contenido"\n    },\n    "i18n_add_items" : {\n        "message" : "¡Añade aquí elementos a tu biblioteca!"\n    },\n    "i18n_extracting" : {\n        "message" : "extrayendo: "\n    },\n    "i18n_are_you_sure" : {\n        "message" : "¿Está seguro que desea eliminar de forma permanente"\n    },\n    "i18n_add_book_to_readium_library" : {\n        "message" : "Añadir libro a biblioteca Readium:"\n    },\n    "i18n_add_book" : {\n        "message" : "Añadir a la biblioteca"\n    },\n    "i18n_cancel" : {\n        "message" : "Cancelar"\n    },\n    "i18n_from_the_web" : {\n        "message" : "Desde la web:"\n    },\n    "i18n_from_local_file" : {\n        "message" : "Desde un archivo local:"\n    },\n    "i18n_enter_a_url" : {\n        "message" : "Ingresa una URL a un archivo .epub"\n    },\n    "i18n_unpacked_directory" : {\n        "message" : "Carpeta descomprimida:"\n    },\n    "i18n_validate" : {\n        "message" : "Validar:"\n    },\n    "i18n_confirm_that_this_book" : {\n        "message" : "Confirmar que este libro cumple con los estándares ePUB"\n    },\n    "i18n_single_pages" : {\n        "message" : "Páginas simple"\n    },\n    "i18n_double_pages" : {\n        "message" : "Páginas doble"\n    },\n    "i18n_save_settings" : {\n        "message" : "Guardar preferencias"\n    },\n    "i18n_font_size" : {\n        "message" : "TAMAÑO DE FUENTE"\n    },\n    "i18n_margins" : {\n        "message" : "MARGENES"\n    },\n    "i18n_text_and_background_color" : {\n        "message" : "COLOR DE FUENTE Y FONDO"\n    },\n    "i18n_black_and_white" : {\n        "message" : "Blanco y negro"\n    },\n    "i18n_arabian_nights" : {\n        "message" : "Las mil y una noches"\n    },\n    "i18n_sands_of_dune" : {\n        "message" : "Arenas de duna"\n    },\n    "i18n_ballard_blues" : {\n        "message" : "Ballard Blues"\n    },\n    "i18n_vancouver_mist" : {\n        "message" : "Bruma de Vancouver"\n    },\n    "i18n_display_format" : {\n        "message" : "MOSTRAR FORMATO"\n    },\n    "i18n_scroll_mode" : {\n        "message" : "MODO DE DESPLAZAMIENTO"\n    },\n    "i18n_scroll_mode_default" : {\n        "message" : "Por defecto"\n    },\n    "i18n_scroll_mode_doc" : {\n        "message" : "Documento"\n    },\n    "i18n_scroll_mode_continuous" : {\n        "message" : "Continuo"\n    },\n    "i18n_html_readium_tm_a_project" : {\n        "message" : "Readium para Chrome es la extensión para Chrome de ReadiumJS, un sistema de lectura de código abierto y librería JavaScript para renderizar publicaciones EPUB® en navegadores web. ReadiumJS es un proyecto de Readium Foundation (Readium.org). Para saber más o contribuir, visita el <a href=\\"http://readium.org/projects/readiumjs\\">sitio del proyecto</a>"\n    },\n    "i18n_toolbar_show" : {\n        "message" : "Mostrar barra de herramientas"\n    },\n    "i18n_toolbar_hide" : {\n        "message" : "Ocultar barra de herramientas"\n    },\n    "i18n_audio_play" : {\n        "message" : "Reproducir"\n    },\n    "i18n_audio_pause" : {\n        "message" : "Pausa"\n    },\n    "i18n_audio_previous" : {\n        "message" : "Frase de audio anterior"\n    },\n    "i18n_audio_next" : {\n        "message" : "Frase de audio siguiente"\n    },\n    "i18n_audio_volume" : {\n        "message" : "Volumen de audio"\n    },\n    "i18n_audio_volume_increase" : {\n        "message" : "Incrementar volumen de audio"\n    },\n    "i18n_audio_volume_decrease" : {\n        "message" : "Reducir volumen de audio"\n    },\n    "i18n_audio_time" : {\n        "message" : "Cursor de tiempo de audio"\n    },\n    "i18n_audio_mute" : {\n        "message" : "Desactivar audio"\n    },\n    "i18n_audio_unmute" : {\n        "message" : "Activar audio"\n    },\n    "i18n_audio_expand" : {\n        "message" : "Mostrar controles avanzados de audio"\n    },\n    "i18n_audio_collapse" : {\n        "message" : "Cerrar controles avanzados de audio"\n    },\n    "i18n_audio_esc" : {\n        "message" : "Salir de contexto actual de audio"\n    },\n    "i18n_audio_rate" : {\n        "message" : "Velocidad de reproducción de audio"\n    },\n    "i18n_audio_rate_increase" : {\n        "message" : "Incrementar velocidad de reproducción de audio"\n    },\n    "i18n_audio_rate_decrease" : {\n        "message" : "Reducir velocidad de reproducción de audio"\n    },\n    "i18n_audio_rate_reset" : {\n        "message" : "Reestablecer reproducción de audio a velocidad normal"\n    },\n    "i18n_audio_skip_disable" : {\n        "message" : "Desactivar capacidad de omisión"\n    },\n    "i18n_audio_skip_enable" : {\n        "message" : "Activar capacidad de omisión"\n    },\n    "i18n_audio_touch_enable" : {\n        "message" : "Activar touch-to-play"\n    },\n    "i18n_audio_touch_disable" : {\n        "message" : "Desactivar touch-to-play"\n    },\n    "i18n_audio_highlight_default" : {\n        "message" : "por defecto"\n    },\n    "i18n_audio_highlight" : {\n        "message" : "Color de audio"\n    },\n    "i18n_audio_sync" : {\n        "message" : "Granularidad de sincronización texto/audio"\n    },\n    "i18n_audio_sync_default" : {\n        "message" : "Por defecto"\n    },\n    "i18n_audio_sync_word" : {\n        "message" : "Palabra"\n    },\n    "i18n_audio_sync_sentence" : {\n        "message" : "Oración"\n    },\n    "i18n_audio_sync_paragraph" : {\n        "message" : "Párrafo"\n    },\n    "i18n_page_previous" : {\n        "message" : "Página previa"\n    },\n    "i18n_page_next" : {\n        "message" : "Página siguiente"\n    },\n    "i18n_author_theme" : {\n      "message" : "Por defecto (estilos de autor)"\n    },\n\n  "i18n_spread_auto" : {\n       "message" : "Automático"\n    },\n\n  "i18n_scroll_mode_auto" : {\n      "message" : "Automático"\n    },\n\n   "i18n_page_transition" : {\n      "message" : "EFECTOS DE PÁGINA"\n    },\n    "i18n_page_transition_none" : {\n      "message" : "Desactivado"\n    },\n    "i18n_page_transition_fade" : {\n      "message" : "Apagarse"\n    },\n    "i18n_page_transition_slide" : {\n      "message" : "Deslizar"\n    },\n    "i18n_page_transition_swoosh" : {\n      "message" : "Swoosh"\n    },\n    "i18n_page_transition_butterfly" : {\n      "message" : "Mariposa"\n    },\n\n  "i18n_toolbar" : {\n      "message" : "Barra de herramientas"\n    },\n\n   "i18n_audio_play_background" : {\n      "message" : "Reproducir pista en segundo plano"\n    },\n    "i18n_audio_pause_background" : {\n      "message" : "Pausar pista en segundo plano"\n},\n\n   "i18n_auto_page_turn_enable" : {\n      "message" : "Activar vuelta de página automática"\n    },\n    "i18n_auto_page_turn_disable" : {\n      "message" : "Desactivar vuelta de página automática"\n    },\n\n   "i18n_playback_scroll_enable" : {\n      "message" : "Activar desplazamiento durante la reproducción"\n    },\n\n    "i18n_playback_scroll_disable" : {\n      "message" : "Desactivar desplazamiento durante la reproducción"\n    },\n\n    "chrome_accept_languages": {\n        "message": "$CHROME$ acepta idiomas $languages$",\n        "placeholders": {\n            "chrome": {\n                "content": "Chrome",\n                "example": "Chrome"\n            },\n            "languages": {\n                "content": "$1",\n                "example": "en-US,ja,sr,de,zh_CN"\n            }\n        }\n    }\n}'}),define("text!i18n/_locales/en_US/messages.json",[],function(){return'{\n  "chrome_extension_name": {\n    "message": "Readium"\n  },\n  "about" : {\n    "message" : "About"\n  }, \n   \n  "add_epub_dialog"  : {\n      "message" : "Add Epub to Library"\n  },\n     \n  "list_view_thumbnail_view_toggle" : {\n      "message" : "Toggle List View and Thumbnail View"},\n      \n  "preview" : {\n    "message" : "PREVIEW"\n  },\n  "list_view" : {\n    "message" : "List View"\n  },\n  "thumbnail_view" : {\n    "message" : "Thumbnail View"\n  },\n  "view_library": {\n    "message" : "Library"\n  },\n  "highlight_selection" : {\n    "message" : "Highlight Selected Text"\n  },\n  "toc" : {\n    "message" : "Table of Contents"\n  },\n  "settings" : {\n    "message" : "Settings"\n  },\n  "layout" : {\n    "message" : "Layout"\n  },\n  "style" : {\n    "message" : "Style"\n  },\n  "enter_fullscreen" : {\n    "message" : "Enter Fullscreen"\n  },\n  "exit_fullscreen" : {\n    "message" : "Exit Fullscreen"\n  },\n  "chrome_extension_description": {\n    "message": "A reader for EPUB3 books."\n  },\n  "ok" : {\n    "message" : "Ok"\n  },\n  "delete_dlg_title" : {\n    "message" : "Confirm Delete"\n  },\n  "delete_progress_title" : {\n    "message" : "Delete in Progress"\n  },\n  "delete_progress_message" : {\n    "message" : "Deleting"\n  },\n  "migrate_dlg_title" : {\n    "message" : "Migrating Books"\n  },\n  "migrate_dlg_message" : {\n    "message" : "Loading data..."\n  },\n  "migrating" : {\n    "message" : "Migrating"\n  },\n  "replace_dlg_title" : {\n    "message": "Conflict Detected"\n  },\n  "replace_dlg_message": {\n    "message": "If you continue, the following epub will be replaced with the one you are importing"\n  },\n  "import_dlg_title" : {\n    "message": "Importing EPUB"\n  },\n  "import_dlg_message" : {\n    "message": "Examining EPUB content..."\n  },\n  "storing_file" : {\n    "message": "Storing file"\n  },\n  "err_unknown" : {\n    "message": "Unknown error. Check console for more details."\n  },\n  "err_storage" : {\n    "message": "Unable to access storage"\n  },\n  "err_epub_corrupt" : {\n    "message": "Invalid or corrupted EPUB package"\n  },\n  "err_dlg_title" : {\n    "message": "Unexpected Error"\n  },\n  "replace" : {\n    "message": "Replace"\n  },\n  "gethelp" : {\n    "message" : "If you encounter any problems, have questions, or would like to say hello, visit <a href=\\"http://idpf.org/forums/readium\\">our forum</a>"\n  },\n  "i18n_readium_library" : {\n    "message" : "Readium Library"\n  },\n  "i18n_loading" : {\n    "message" : "Loading Library"\n  },\n  "i18n_readium_options" : {\n    "message" : "Readium Options:"\n  },\n  "i18n_save_changes" : {\n    "message" : "Save changes"\n  },\n  "i18n_close" : {\n    "message" : "Close"\n  },\n  "i18n_keyboard_shortcuts" : {\n    "message" : "Keyboard shortcuts"\n  },\n  "i18n_keyboard_reload" : {\n    "message" : "Please reload the page for keyboard shortcuts to take effect."\n  },\n  "i18n_reset_key" : {\n    "message" : "Reset key"\n  },\n  "i18n_reset_key_all" : {\n    "message" : "Reset all keyboard shortcuts"\n  },\n  "i18n_duplicate_keyboard_shortcut" : {\n    "message" : "DUPLICATE"\n  },\n  "i18n_invalid_keyboard_shortcut" : {\n    "message" : "INVALID"\n  },\n  "i18n_paginate_all" : {\n    "message" : "Paginate all reflowable ePUB content"\n  },\n  "i18n_automatically" : {\n    "message" : "Automatically open *.epub urls in readium"\n  },\n  "i18n_show_warning" : {\n    "message" : "Show warning messages when unpacking EPUB files"\n  },\n  "i18n_details" : {\n    "message" : "Details"\n  },\n  "i18n_read" : {\n    "message" : "Read"\n  },\n  "i18n_delete" : {\n    "message" : "Delete"\n  },\n  "i18n_author" : {\n    "message" : "Author: "\n  },\n  "i18n_publisher" : {\n    "message" : "Publisher: "\n  },\n  "i18n_source" : {\n    "message" : "Source: "\n  },\n  "i18n_pub_date" : {\n    "message" : "Pub Date: "\n  },\n  "i18n_modified_date" : {\n    "message" : "Modified Date: "\n  },\n  "i18n_id" : {\n    "message" : "ID: "\n  },\n  "i18n_epub_version" : {\n    "message" : "EPUB version: "\n  },\n  "i18n_created_at" : {\n    "message" : "Created at: "\n  },\n  "i18n_format" : {\n    "message" : "Format: "\n  },\n  "i18n_added" : {\n    "message" : "Added: "\n  },\n  "i18n_unknown" : {\n    "message" : "Unknown"\n  },\n  "i18n_sorry" : {\n    "message" : "Sorry, the current EPUB does not contain a media overlay for this content"\n  },\n  "i18n_add_items" : {\n    "message" : "Add items to your library here!"\n  },\n  "i18n_extracting" : {\n    "message" : "extracting: "\n  },\n  "i18n_are_you_sure" : {\n    "message" : "Are you sure you want to permanently delete "\n  },\n  "i18n_show_metadata_dialog": {\n        "message": "Show Epub Metadata"\n  },\n  "i18n_add_book_to_readium_library" : {\n    "message" : "Add Book To Readium Library:"\n  },\n  "i18n_add_book" : {\n    "message" : "Add to Library"\n  },\n  "i18n_cancel" : {\n    "message" : "Cancel"\n  },\n  "i18n_from_the_web" : {\n    "message" : "From the web:"\n  },\n  "i18n_from_local_file" : {\n    "message" : "From Local File:"\n  },\n  "i18n_enter_a_url" : {\n    "message" : "Enter a URL to a .epub file"\n  },\n  "i18n_unpacked_directory" : {\n    "message" : "Unpacked Directory:"\n  },\n  "i18n_validate" : {\n    "message" : "Validate:"\n  },\n  "i18n_confirm_that_this_book" : {\n    "message" : "Confirm that this book complies with ePUB standards"\n  },\n  "i18n_single_pages" : {\n    "message" : "Single Pages"\n  },\n  "i18n_double_pages" : {\n    "message" : "Double Pages"\n  },\n  "i18n_save_settings" : {\n    "message" : "Save Settings"\n  },\n  "i18n_font_size" : {\n    "message" : "FONT SIZE"\n  },\n  "i18n_margins" : {\n    "message" : "MARGINS"\n  },\n  "i18n_text_and_background_color" : {\n    "message" : "TEXT AND BACKGROUND COLOR"\n  },\n  "i18n_author_theme" : {\n    "message" : "Default (author styles)"\n  },\n  "i18n_black_and_white" : {\n    "message" : "Black and White"\n  },\n  "i18n_arabian_nights" : {\n    "message" : "Arabian Nights"\n  },\n  "i18n_sands_of_dune" : {\n    "message" : "Sands of Dune"\n  },\n  "i18n_ballard_blues" : {\n    "message" : "Ballard Blues"\n  },\n  "i18n_vancouver_mist" : {\n    "message" : "Vancouver Mist"\n  },\n  "i18n_custom_theme" : {\n    "message" : "Custom Theme"\n  },\n  "i18n_display_format" : {\n    "message" : "DISPLAY FORMAT"\n  },\n  "i18n_spread_auto" : {\n     "message" : "Auto"\n  },\n  "i18n_scroll_mode" : {\n    "message" : "SCROLL MODE"\n  },\n  "i18n_scroll_mode_auto" : {\n    "message" : "Auto"\n  },\n  "i18n_scroll_mode_doc" : {\n    "message" : "Document"\n  },\n  "i18n_scroll_mode_continuous" : {\n    "message" : "Continuous"\n  },\n  \n  "i18n_page_transition" : {\n    "message" : "PAGE EFFECTS"\n  },\n  "i18n_page_transition_none" : {\n    "message" : "Disabled"\n  },\n  "i18n_page_transition_fade" : {\n    "message" : "Fade"\n  },\n  "i18n_page_transition_slide" : {\n    "message" : "Slide"\n  },\n  "i18n_page_transition_swoosh" : {\n    "message" : "Swoosh"\n  },\n  "i18n_page_transition_butterfly" : {\n    "message" : "Butterfly"\n  },\n  "i18n_foreground_color_customize_theme" : {\n    "message" : "Foreground Color"\n  },\n  "i18n_background_color_customize_theme" : {\n    "message" : "Background Color"\n  },\n  "i18n_customize_theme_header" : {\n    "message" : "Custom Theme"\n  },\n  "i18n_html_readium_tm_a_project" : {\n    "message" : "Readium for Chrome is the Chrome browser extension configuration of ReadiumJS, an open source reading system and JavaScript library for displaying EPUB® publications in web browsers. ReadiumJS is a project of the Readium Foundation (Readium.org). To learn more or to contribute, visit the <a href=\\"http://readium.org/projects/readiumjs\\">project homepage</a>"\n  },\n  "i18n_toolbar" : {\n    "message" : "Toolbar"\n  },\n  "i18n_toolbar_show" : {\n    "message" : "Show toolbar"\n  },\n  "i18n_toolbar_hide" : {\n    "message" : "Hide toolbar"\n  },\n  "i18n_audio_play" : {\n    "message" : "Play"\n  },\n  "i18n_audio_pause" : {\n    "message" : "Pause"\n  },\n  "i18n_audio_play_background" : {\n    "message" : "Play background track"\n  },\n  "i18n_audio_pause_background" : {\n    "message" : "Pause background track"\n  },\n  "i18n_audio_previous" : {\n    "message" : "Previous audio phrase"\n  },\n  "i18n_audio_next" : {\n    "message" : "Next audio phrase"\n  },\n  "i18n_audio_volume" : {\n    "message" : "Audio volume"\n  },\n  "i18n_audio_volume_increase" : {\n    "message" : "Increase audio volume"\n  },\n  "i18n_audio_volume_decrease" : {\n    "message" : "Decrease audio volume"\n  },\n  "i18n_audio_time" : {\n    "message" : "Audio time cursor"\n  },\n  "i18n_audio_mute" : {\n    "message" : "Mute audio"\n  },\n  "i18n_audio_unmute" : {\n    "message" : "Unmute audio"\n  },\n  "i18n_audio_expand" : {\n    "message" : "Show advanced audio controls"\n  },\n  "i18n_audio_collapse" : {\n    "message" : "Close advanced audio controls"\n  },\n  "i18n_audio_esc" : {\n    "message" : "Escape current audio context"\n  },\n  "i18n_audio_rate" : {\n    "message" : "Audio playback rate"\n  },\n  "i18n_audio_rate_increase" : {\n    "message" : "Increase audio playback rate"\n  },\n  "i18n_audio_rate_decrease" : {\n    "message" : "Decrease audio playback rate"\n  },\n  "i18n_audio_rate_reset" : {\n    "message" : "Reset audio playback to normal speed"\n  },\n  "i18n_audio_skip_disable" : {\n    "message" : "Disable skippability"\n  },\n  "i18n_audio_skip_enable" : {\n    "message" : "Enable skippability"\n  },\n\n  "i18n_auto_page_turn_enable" : {\n    "message" : "Enable automatic page turn"\n  },\n  "i18n_auto_page_turn_disable" : {\n    "message" : "Disable automatic page turn"\n  },\n\n  "i18n_playback_scroll_enable" : {\n    "message" : "Enable scroll during playback"\n  },\n  "i18n_playback_scroll_disable" : {\n    "message" : "Disable scroll during playback"\n  },\n  \n  "i18n_audio_touch_enable" : {\n    "message" : "Enable touch-to-play"\n  },\n  "i18n_audio_touch_disable" : {\n    "message" : "Disable touch-to-play"\n  },\n  "i18n_audio_highlight_default" : {\n    "message" : "default"\n  },\n  "i18n_audio_highlight" : {\n    "message" : "Audio color"\n  },\n  "i18n_audio_sync" : {\n    "message" : "Text/audio synchronization granularity"\n  },\n  "i18n_audio_sync_default" : {\n    "message" : "Default"\n  },\n  "i18n_audio_sync_word" : {\n    "message" : "Word"\n  },\n  "i18n_audio_sync_sentence" : {\n    "message" : "Sentence"\n  },\n  "i18n_audio_sync_paragraph" : {\n    "message" : "Paragraph"\n  },\n  "i18n_page_previous" : {\n    "message" : "Previous Page"\n  },\n  "i18n_page_next" : {\n    "message" : "Next Page"\n  },\n  "i18n_page_navigation" : {\n    "message" : "Page Navigation"\n  },\n  "chrome_accept_languages": {\n    "message": "$CHROME$ accepts $languages$ languages",\n    "placeholders": {\n      "chrome": {\n        "content": "Chrome",\n        "example": "Chrome"\n      },\n      "languages": {\n        "content": "$1",\n        "example": "en-US,ja,sr,de,zh_CN"\n      }\n    }\n  }\n}\n'}),define("text!i18n/_locales/fr/messages.json",[],function(){return'{\n  "chrome_extension_name": {\n    "message": "Readium"\n  },\n  "chrome_extension_description": {\n    "message": "Un lecteur de livres numériques EPUB3."\n  },\n  "i18n_readium_library" : {\n    "message" : "Bibliothèque Readium"\n  },\n  "i18n_loading" : {\n    "message" : "Chargement de la bibliothèque"\n  },\n  "i18n_readium_options" : {\n    "message" : "Options de Readium :"\n  },\n  "i18n_save_changes" : {\n    "message" : "Enregistrer les changements"\n  },\n  "i18n_close" : {\n    "message" : "Fermer"\n  },\n  "i18n_keyboard_shortcuts" : {\n    "message" : "Raccourcis clavier"\n  },\n  "i18n_keyboard_reload" : {\n    "message" : "Veuillez recharger la page pour que les raccourcis clavier prennent effet."\n  },\n  "i18n_reset_key" : {\n    "message" : "Réinitialiser le raccourci clavier par défaut"\n  },\n  "i18n_reset_key_all" : {\n    "message" : "Réinitialiser tous les raccourcis clavier par défaut"\n  },\n  "i18n_duplicate_keyboard_shortcut" : {\n    "message" : "DUPLIQUE"\n  },\n  "i18n_invalid_keyboard_shortcut" : {\n    "message" : "INVALIDE"\n  },\n  "i18n_paginate_all" : {\n    "message" : "Paginer tout le contenu des EPUB recomposables"\n  },\n  "i18n_automatically" : {\n    "message" : "Ouvrir automatiquement les urls *.epub dans Readium"\n  },\n  "i18n_show_warning" : {\n    "message" : "Montrer les messages d\'avertissement pendant la décompression des fichiers EPUB"\n  },\n  "i18n_details" : {\n    "message" : "Détails"\n  },\n  "i18n_read" : {\n    "message" : "Lire"\n  },\n  "i18n_delete" : {\n    "message" : "Supprimer"\n  },\n  "i18n_author" : {\n    "message" : "Auteur : "\n  },\n  "i18n_publisher" : {\n    "message" : "Éditeur : "\n  },\n  "i18n_source" : {\n    "message" : "Source : "\n  },\n  "i18n_pub_date" : {\n    "message" : "Date de publication :  "\n  },\n  "i18n_modified_date" : {\n    "message" : "Date de modification : "\n  },\n  "i18n_id" : {\n    "message" : "ID: "\n  },\n  "i18n_epub_version" : {\n    "message" : "version de l\'EPUB : "\n  },\n  "i18n_created_at" : {\n    "message" : "Ajouté le : "\n  },\n  "i18n_format" : {\n    "message" : "Format : "\n  },\n  "i18n_added" : {\n    "message" : "Ajouté le : "\n  },\n  "i18n_unknown" : {\n    "message" : "Inconnu"\n  },\n  "i18n_sorry" : {\n    "message" : "Désolé, l\'EPUB actuel ne contient pas de média associé (media overlay) pour ce contenu"\n  },\n  "i18n_add_items" : {\n    "message" : "Ajoutez des articles à votre bibliothèque ici !"\n  },\n  "i18n_extracting" : {\n    "message" : "extraction : "\n  },\n  "i18n_are_you_sure" : {\n    "message" : "Voulez-vous vraiment supprimer "\n  },\n  "i18n_add_book_to_readium_library" : {\n    "message" : "Ajoutez un livre à la bibliothèque de Readium :"\n  },\n  "i18n_add_book" : {\n    "message" : "Ajouter un livre"\n  },\n  "i18n_cancel" : {\n    "message" : "Annuler"\n  },\n  "i18n_from_the_web" : {\n    "message" : "À partir du Web :"\n  },\n  "i18n_from_local_file" : {\n    "message" : "À partir d\'un fichier local :"\n  },\n  "i18n_enter_a_url" : {\n    "message" : "Entrez l\'URL d\'un fichier .epub"\n  },\n  "i18n_unpacked_directory" : {\n    "message" : "Répertoire non-compressé :"\n  },\n  "i18n_validate" : {\n    "message" : "Valider :"\n  },\n  "i18n_confirm_that_this_book" : {\n    "message" : "Confirmer que ce livre est conforme aux standards EPUB"\n  },\n  "i18n_single_pages" : {\n    "message" : "Pages simples"\n  },\n  "i18n_double_pages" : {\n    "message" : "Doubles-pages"\n  },\n  "i18n_save_settings" : {\n    "message" : "Enregistrer"\n  },\n  "i18n_font_size" : {\n    "message" : "TAILLE DE LA POLICE"\n  },\n  "i18n_margins" : {\n    "message" : "MARGES"\n  },\n  "i18n_text_and_background_color" : {\n    "message" : "COULEUR DU TEXTE ET DU FOND"\n  },\n  "i18n_black_and_white" : {\n    "message" : "Noir et Blanc"\n  },\n  "i18n_arabian_nights" : {\n    "message" : "Mille et une Nuits"\n  },\n  "i18n_sands_of_dune" : {\n    "message" : "Sables de Dune"\n  },\n  "i18n_ballard_blues" : {\n    "message" : "Le Blues de Ballard"\n  },\n  "i18n_vancouver_mist" : {\n    "message" : "Le Brouillard de Vancouver"\n  },\n  "i18n_display_format" : {\n    "message" : "FORMAT D\'AFFICHAGE"\n  },\n  "i18n_scroll_mode" : {\n    "message" : "MODE DE DÉFILEMENT"\n  },\n  "i18n_scroll_mode_auto" : {\n    "message" : "Auto"\n  },\n  "i18n_scroll_mode_doc" : {\n    "message" : "Document"\n  },\n  "i18n_scroll_mode_continuous" : {\n    "message" : "Continu"\n  },\n  "i18n_html_readium_tm_a_project" : {\n    "message" : "Readium pour Chrome est l\'extension du navigateur Chrome de ReadiumJS, un système de lecture open-source et une librairie JavaScript pour afficher des documents EPUB® dans les navigateurs web. ReadiumJS est un projet de la fondation Readium (Readium.org). Pour en savoir plus ou pour contribuer, visiter la <a href=\\"http://readium.org/projects/readiumjs\\">page d\'accueil du projet</a>."\n  },\n  "i18n_audio_play" : {\n    "message" : "Jouer"\n  },\n  "i18n_audio_pause" : {\n    "message" : "Pauser"\n  },\n  "i18n_audio_previous" : {\n    "message" : "Phrase audio précédente"\n  },\n  "i18n_audio_next" : {\n    "message" : "Phrase audio suivante"\n  },\n  "i18n_audio_volume" : {\n    "message" : "Ajustement du volume audio"\n  },\n  "i18n_audio_time" : {\n    "message" : "Contrôle du curseur temporel audio"\n  },\n  "i18n_audio_mute" : {\n    "message" : "Silence audio"\n  },\n  "i18n_audio_unmute" : {\n    "message" : "Restaurer le volume audio"\n  },\n  "i18n_audio_expand" : {\n    "message" : "Afficher les contrôles audio avancés"\n  },\n  "i18n_audio_collapse" : {\n    "message" : "Fermer les contrôles audio avancés"\n  },\n  "i18n_audio_esc" : {\n    "message" : "Échapper le contexte audio actuel"\n  },\n  "i18n_audio_rate" : {\n    "message" : "Vitesse de lecture audio"\n  },\n  "i18n_audio_rate_reset" : {\n    "message" : "Retour à la vitesse normale de lecture audio"\n  },\n  "i18n_audio_skip_disable" : {\n    "message" : "Désactiver la \'skippabilité\'"\n  },\n  "i18n_audio_skip_enable" : {\n    "message" : "Activer la \'skippabilité\'"\n  },\n  "i18n_audio_touch_enable" : {\n    "message" : "Activer la fonction \'toucher pour jouer\'"\n  },\n  "i18n_audio_touch_disable" : {\n    "message" : "Désactiver la fonction \'toucher pour jouer\'"\n  },\n  "i18n_audio_highlight_default" : {\n    "message" : "défaut"\n  },\n  "i18n_audio_highlight" : {\n    "message" : "Couleur audio"\n  },\n  "i18n_audio_sync" : {\n    "message" : "Granularité de synchronisation texte / audio"\n  },\n  "i18n_audio_sync_default" : {\n    "message" : "Défaut"\n  },\n  "i18n_audio_sync_word" : {\n    "message" : "Mot"\n  },\n  "i18n_audio_sync_sentence" : {\n    "message" : "Phrase"\n  },\n  "i18n_audio_sync_paragraph" : {\n    "message" : "Paragraphe"\n  },\n  "i18n_page_previous" : {\n    "message" : "Page précédente"\n  },\n  "i18n_page_next" : {\n    "message" : "Page suivante"\n  },\n  "chrome_accept_languages": {\n    "message": "$CHROME$ accepts $languages$ languages",\n    "placeholders": {\n      "chrome": {\n        "content": "Chrome",\n        "example": "Chrome"\n      },\n      "languages": {\n        "content": "$1",\n        "example": "en-US,fr,ja,de"\n      }\n    }\n  }\n}\n'}),define("text!i18n/_locales/id/messages.json",[],function(){return'{\n  "chrome_extension_name": {\n    "message": "Readium"\n  },\n  "chrome_extension_description": {\n    "message": "reader untuk buku-buku EPUB3 ."\n  },\n  "i18n_readium_library" : {\n    "message" : "Perpustakaan Readium"\n  },\n  "i18n_loading" : {\n    "message" : "Loading Library"\n  },\n  "i18n_readium_options" : {\n    "message" : "Pilihan Readium :"\n  },\n  "i18n_save_changes" : {\n    "message" : "Simpan perubahan"\n  },\n  "i18n_close" : {\n    "message" : "Tutup"\n  },\n  "i18n_paginate_all" : {\n    "message" : "Paginate all reflowable ePUB content"\n  },\n  "i18n_automatically" : {\n    "message" : "Secara otomatis buka *.epub urls di readium"\n  },\n  "i18n_show_warning" : {\n    "message" : "Tampilkan pesan peringatan ketika unpacking file EPUB"\n  },\n  "i18n_details" : {\n    "message" : "Detail"\n  },\n  "i18n_read" : {\n    "message" : "Baca"\n  },\n  "i18n_delete" : {\n    "message" : "Hapus"\n  },\n  "i18n_author" : {\n    "message" : "Penulis: "\n  },\n  "i18n_publisher" : {\n    "message" : "Penerbit: "\n  },\n  "i18n_source" : {\n    "message" : "Sumber: "\n  },\n  "i18n_pub_date" : {\n    "message" : "Tgl Terbit: "\n  },\n  "i18n_modified_date" : {\n    "message" : "Tgl Modifikasi: "\n  },\n  "i18n_id" : {\n    "message" : "ID: "\n  },\n  "i18n_epub_version" : {\n    "message" : "Versi EPUB: "\n  },\n  "i18n_created_at" : {\n    "message" : "Dibuat di: "\n  },\n  "i18n_format" : {\n    "message" : "Format: "\n  },\n  "i18n_added" : {\n    "message" : "Menambahkan: "\n  },\n  "i18n_unknown" : {\n    "message" : "Tidak dikenal"\n  },\n  "i18n_sorry" : {\n    "message" : "Maaf, EPUB saat ini tidak berisi overlay media untuk konten ini "\n  },\n  "i18n_add_items" : {\n    "message" : "Masukkan item r Library disini!"\n  },\n  "i18n_extracting" : {\n    "message" : "extracting: "\n  },\n  "i18n_are_you_sure" : {\n    "message" : "Apakah and yakin ingin menghapus secara permanen "\n  },\n  "i18n_add_book_to_readium_library" : {\n    "message" : "Masukkan Buku ke Readium Library:"\n  },\n  "i18n_add_book" : {\n    "message" : "Add Book"\n  },\n  "i18n_cancel" : {\n    "message" : "Batal"\n  },\n  "i18n_from_the_web" : {\n    "message" : "Dari Web:"\n  },\n  "i18n_from_local_file" : {\n    "message" : "Dari File local:"\n  },\n  "i18n_enter_a_url" : {\n    "message" : "Masukkan  URL ke file .epub "\n  },\n  "i18n_unpacked_directory" : {\n    "message" : "Unpacked Directory:"\n  },\n  "i18n_validate" : {\n    "message" : "Validasi:"\n  },\n  "i18n_confirm_that_this_book" : {\n    "message" : "Konfirmasikan bahwa buku ini sesuai dengan standar EPUB"\n  },\n  "i18n_single_pages" : {\n    "message" : "Single Pages"\n  },\n  "i18n_double_pages" : {\n    "message" : "Double Pages"\n  },\n  "i18n_save_settings" : {\n    "message" : "Save Settings"\n  },\n  "i18n_font_size" : {\n    "message" : "FONT SIZE"\n  },\n  "i18n_margins" : {\n    "message" : "MARGINS"\n  },\n  "i18n_text_and_background_color" : {\n    "message" : "TEKS DAN WARNA LATAR"\n  },\n  "i18n_black_and_white" : {\n    "message" : "Black and White"\n  },\n  "i18n_arabian_nights" : {\n    "message" : "Arabian Nights"\n  },\n  "i18n_sands_of_dune" : {\n    "message" : "Sands of Dune"\n  },\n  "i18n_ballard_blues" : {\n    "message" : "Ballard Blues"\n  },\n  "i18n_vancouver_mist" : {\n    "message" : "Vancouver Mist"\n  },\n  "i18n_display_format" : {\n    "message" : "DISPLAY FORMAT"\n  },\n  "i18n_html_readium_tm_a_project" : {\n    "message" : "Readium<sup>TM</sup>, a project of the International Digital Publishing Forum (IDPF) and supporters, adalah sistem referensi open source DAN rendering engine untuk EPUB&reg; publikasi.  Untuk mengetahui lebih lanjut, kunjungi <a href=\\"http://readium.org/\\">project homepage</a>. Sampai saat ini, pengembangan project telah dipimpin oleh  <a href=\\"http://evidentpoint.com/\\">Evident Point</a> and <a href=\\"http://www.bluefirereader.com/\\">Bluefire Productions</a>. Untuk kontribusi, kunjungi <a href=\\"https://github.com/readium/readium-js-viewer\\">github repository</a>"\n  },\n  "chrome_accept_languages": {\n    "message": "$CHROME$ accepts $languages$ languages",\n    "placeholders": {\n      "chrome": {\n        "content": "Chrome",\n        "example": "Chrome"\n      },\n      "languages": {\n        "content": "$1",\n        "example": "en-US,ja,sr,de,zh_CN"\n      }\n    }\n  }\n}\n'}),define("text!i18n/_locales/it/messages.json",[],function(){return'{\n  "chrome_extension_name": {\n    "message": "Readium"\n  },\n  "chrome_extension_description": {\n    "message": "Un visualizzatore di documenti EPUB3"\n  },\n  "i18n_readium_library" : {\n    "message" : "Biblioteca di Readium"\n  },\n  "i18n_loading" : {\n    "message" : "Caricamento biblioteca"\n  },\n  "i18n_readium_options" : {\n    "message" : "Opzioni di Readium"\n  },\n  "i18n_save_changes" : {\n    "message" : "Applica"\n  },\n  "i18n_close" : {\n    "message" : "Chiudi"\n  },\n  "i18n_paginate_all" : {\n    "message" : "Impagina anche i file EPUB reflowable"\n  },\n  "i18n_automatically" : {\n    "message" : "Apri in Readium gli URL che terminano in .epub"\n  },\n  "i18n_show_warning" : {\n    "message" : "Mostra errori e avvisi relativi ai file EPUB"\n  },\n  "i18n_details" : {\n    "message" : "Dettagli"\n  },\n  "i18n_read" : {\n    "message" : "Leggi"\n  },\n  "i18n_delete" : {\n    "message" : "Elimina"\n  },\n  "i18n_author" : {\n    "message" : "Autore: "\n  },\n  "i18n_publisher" : {\n    "message" : "Editore: "\n  },\n  "i18n_source" : {\n    "message" : "Origine: "\n  },\n  "i18n_pub_date" : {\n    "message" : "Data pubblicazione: "\n  },\n  "i18n_modified_date" : {\n    "message" : "Data ultima modifica: "\n  },\n  "i18n_id" : {\n    "message" : "ID: "\n  },\n  "i18n_epub_version" : {\n    "message" : "Versione EPUB: "\n  },\n  "i18n_created_at" : {\n    "message" : "Data importazione: "\n  },\n  "i18n_format" : {\n    "message" : "Formato: "\n  },\n  "i18n_added" : {\n    "message" : "Aggiunto: "\n  },\n  "i18n_unknown" : {\n    "message" : "Sconosciuto"\n  },\n  "i18n_sorry" : {\n    "message" : "Spiacente, non ci sono risorse Media Overlays associate a questo elemento."\n  },\n  "i18n_add_items" : {\n    "message" : "Aggiungi libri alla tua biblioteca!"\n  },\n  "i18n_extracting" : {\n    "message" : "Decomprimendo: "\n  },\n  "i18n_are_you_sure" : {\n    "message" : "Sei sicuro di voler cancellare definitivamente "\n  },\n  "i18n_add_book_to_readium_library" : {\n    "message" : "Aggiungi libro alla Biblioteca di Readium"\n  },\n  "i18n_add_book" : {\n    "message" : "Aggiungi libro"\n  },\n  "i18n_cancel" : {\n    "message" : "Annulla"\n  },\n  "i18n_from_the_web" : {\n    "message" : "Scarica dal Web:"\n  },\n  "i18n_from_local_file" : {\n    "message" : "Importa file EPUB dal tuo computer:"\n  },\n  "i18n_enter_a_url" : {\n    "message" : "Indirizzo Web del file EPUB che vuoi aggiungere:"\n  },\n  "i18n_unpacked_directory" : {\n    "message" : "Importa directory decompressa:"\n  },\n  "i18n_validate" : {\n    "message" : "Convalida:"\n  },\n  "i18n_confirm_that_this_book" : {\n    "message" : "Controlla che i file siano conformi allo standard EPUB prima di aprirli"\n  },\n  "i18n_single_pages" : {\n    "message" : "Singole"\n  },\n  "i18n_double_pages" : {\n    "message" : "Affiancate"\n  },\n  "i18n_save_settings" : {\n    "message" : "Applica"\n  },\n  "i18n_font_size" : {\n    "message" : "DIMENSIONE CARATTERE"\n  },\n  "i18n_margins" : {\n    "message" : "MARGINI"\n  },\n  "i18n_text_and_background_color" : {\n    "message" : "COMBINAZIONE COLORE TESTO/SFONDO"\n  },\n  "i18n_black_and_white" : {\n    "message" : "Bianco su nero"\n  },\n  "i18n_arabian_nights" : {\n    "message" : "Notturno"\n  },\n  "i18n_sands_of_dune" : {\n    "message" : "Deserto"\n  },\n  "i18n_ballard_blues" : {\n    "message" : "Mediterraneo"\n  },\n  "i18n_vancouver_mist" : {\n    "message" : "Nebbia"\n  },\n  "i18n_display_format" : {\n    "message" : "VISUALIZZAZIONE PAGINE"\n  },\n  "i18n_html_readium_tm_a_project" : {\n    "message" : "Readium<sup>TM</sup>, progetto dell\'International Digital Publishing Forum (IDPF) e dei suoi sostenitori, è una piattaforma open source di lettura e un motore di rendering per documenti in formato EPUB&reg;. Per saperne di più, visita la <a href=\\"http://readium.org/\\">pagina principale del progetto</a>. Lo sviluppo del progetto è stato guidato da <a href=\\"http://evidentpoint.com/\\">Evident Point</a> e <a href=\\"http://www.bluefirereader.com/\\">Bluefire Productions</a>. Per contribuire, visita il <a href=\\"https://github.com/readium/readium-js-viewer\\">repository github</a>."\n  },\n  "chrome_accept_languages": {\n    "message": "$CHROME$ accetta le seguenti lingue: $languages$",\n    "placeholders": {\n      "chrome": {\n        "content": "Chrome",\n        "example": "Chrome"\n      },\n      "languages": {\n        "content": "$1",\n        "example": "en-US,it,ja,sr,de,zh_CN"\n      }\n    }\n  }\n}\n'}),define("text!i18n/_locales/ja/messages.json",[],function(){return'{\n  "chrome_extension_name": {\n    "message": "Readium"\n  },\n  "chrome_extension_description": {\n    "message": "EPUB3ブックリーダ"\n  },\n  "i18n_readium_library" : {\n    "message" : "Readiumライブラリ"\n  },\n  "i18n_loading" : {\n    "message" : "Loading Library"\n  },\n  "i18n_readium_options" : {\n    "message" : "Readiumオプション:"\n  },\n  "i18n_save_changes" : {\n    "message" : "変更を保存"\n  },\n  "i18n_close" : {\n    "message" : "閉じる"\n  },\n  "i18n_paginate_all" : {\n    "message" : "リフロー可能なEPUBコンテンツをすべてページネートする"\n  },\n  "i18n_automatically" : {\n    "message" : "URLが*.epubなら自動でReadiumで開く"\n  },\n  "i18n_show_warning" : {\n    "message" : "EPUBファイルを展開する際には警告メッセージを表示する"\n  },\n  "i18n_details" : {\n    "message" : "詳細"\n  },\n  "i18n_read" : {\n    "message" : "読む"\n  },\n  "i18n_delete" : {\n    "message" : "削除"\n  },\n  "i18n_author" : {\n    "message" : "著者: "\n  },\n  "i18n_publisher" : {\n    "message" : "出版社: "\n  },\n  "i18n_source" : {\n    "message" : "ソース: "\n  },\n  "i18n_pub_date" : {\n    "message" : "出版日時: "\n  },\n  "i18n_modified_date" : {\n    "message" : "更新日時: "\n  },\n  "i18n_id" : {\n    "message" : "ID: "\n  },\n  "i18n_epub_version" : {\n    "message" : "EPUBバージョン: "\n  },\n  "i18n_created_at" : {\n    "message" : "追加日時: "\n  },\n  "i18n_format" : {\n    "message" : "フォーマット: "\n  },\n  "i18n_added" : {\n    "message" : "追加日時: "\n  },\n  "i18n_unknown" : {\n    "message" : "不明"\n  },\n  "i18n_sorry" : {\n    "message" : "現在のEPUBにはこのコンテンツのメディアオーバーレイが含まれていません"\n  },\n  "i18n_add_items" : {\n    "message" : "ここをクリックして本を登録します!"\n  },\n  "i18n_extracting" : {\n    "message" : "展開しています: "\n  },\n  "i18n_are_you_sure" : {\n    "message" : "本を削除します: "\n  },\n  "i18n_add_book_to_readium_library" : {\n    "message" : "Readiumライブラリに本を追加します:"\n  },\n  "i18n_add_book" : {\n    "message" : "本の追加"\n  },\n  "i18n_cancel" : {\n    "message" : "キャンセル"\n  },\n  "i18n_from_the_web" : {\n    "message" : "Webから:"\n  },\n  "i18n_from_local_file" : {\n    "message" : "ローカルファイルから:"\n  },\n  "i18n_enter_a_url" : {\n    "message" : ".epubファイルのURLを入力してください"\n  },\n  "i18n_unpacked_directory" : {\n    "message" : "パッケージ化されていないフォルダ:"\n  },\n  "i18n_validate" : {\n    "message" : "検証（バリデート）:"\n  },\n  "i18n_confirm_that_this_book" : {\n    "message" : "この本がEPUB仕様に準拠していることを確認する"\n  },\n  "i18n_single_pages" : {\n    "message" : "単ページ"\n  },\n  "i18n_double_pages" : {\n    "message" : "ダブル"\n  },\n  "i18n_save_settings" : {\n    "message" : "設定を保存する"\n  },\n  "i18n_font_size" : {\n    "message" : "文字サイズ"\n  },\n  "i18n_margins" : {\n    "message" : "マージン"\n  },\n  "i18n_text_and_background_color" : {\n    "message" : "文字色と背景色"\n  },\n  "i18n_black_and_white" : {\n    "message" : "白背景に黒文字"\n  },\n  "i18n_arabian_nights" : {\n    "message" : "アラビアンナイト"\n  },\n  "i18n_sands_of_dune" : {\n    "message" : "砂丘の砂"\n  },\n  "i18n_ballard_blues" : {\n    "message" : "バラード ブルース"\n  },\n  "i18n_vancouver_mist" : {\n    "message" : "バンクーバーの霧"\n  },\n  "i18n_display_format" : {\n    "message" : "表示形式"\n  },\n  "i18n_html_readium_tm_a_project" : {\n    "message" : "Readium<sup>TM</sup>とは, International Digital Publishing Forum (IDPF) と支援企業によるプロジェクトで, EPUB&reg; 出版のためのシステムとレンダリングエンジンのオープンソースリファレンスです。詳しくは、<a href=\\"http://readium.org/\\">プロジェクトホームページ</a>をご覧ください。これまでは<a href=\\"http://evidentpoint.com/\\">Evident Point</a>と<a href=\\"http://www.bluefirereader.com/\\">Bluefire Productions</a>がプロジェクト開発をリードしてきました。 コントリビュートするには<a href=\\"https://github.com/readium/readium-js-viewer\\">githubレポジトリ</a>をご覧ください。"\n  },\n  "chrome_accept_languages": {\n    "message": "$CHROME$ accepts $languages$ languages",\n    "placeholders": {\n      "chrome": {\n        "content": "Chrome",\n        "example": "Chrome"\n      },\n      "languages": {\n        "content": "$1",\n        "example": "en-US,ja,sr,de"\n      }\n    }\n  }\n}\n'}),define("text!i18n/_locales/ko/messages.json",[],function(){return'{\n  "chrome_extension_name": {\n    "message": "Readium"\n  },\n  "chrome_extension_description": {\n    "message": "EPUB3책 리더."\n  },\n  "i18n_readium_library" : {\n    "message" : "Readium 라이브러리"\n  },\n  "i18n_loading" : {\n    "message" : "Loading Library"\n  },\n  "i18n_readium_options" : {\n    "message" : "Readium 옵션:"\n  },\n  "i18n_save_changes" : {\n    "message" : "변경사항 저장"\n  },\n  "i18n_close" : {\n    "message" : "닫기"\n  },\n  "i18n_paginate_all" : {\n    "message" : "모든 리플로우 컨텐츠의 페이지네이션"\n  },\n  "i18n_automatically" : {\n    "message" : "*.epub url들을 radium에서 자동으로 열기"\n  },\n  "i18n_show_warning" : {\n    "message" : "EPUB파일들을 열 때 경고메시지 표시"\n  },\n  "i18n_details" : {\n    "message" : "세부항목"\n  },\n  "i18n_read" : {\n    "message" : "읽기"\n  },\n  "i18n_delete" : {\n    "message" : "삭제"\n  },\n  "i18n_author" : {\n    "message" : "저자: "\n  },\n  "i18n_publisher" : {\n    "message" : "출판사: "\n  },\n  "i18n_source" : {\n    "message" : "소스: "\n  },\n  "i18n_pub_date" : {\n    "message" : "출판일: "\n  },\n  "i18n_modified_date" : {\n    "message" : "개정일: "\n  },\n  "i18n_id" : {\n    "message" : "ID: "\n  },\n  "i18n_epub_version" : {\n    "message" : "EPUB 버전: "\n  },\n  "i18n_created_at" : {\n    "message" : "생성: "\n  },\n  "i18n_format" : {\n    "message" : "포맷: "\n  },\n  "i18n_added" : {\n    "message" : "추가일시: "\n  },\n  "i18n_unknown" : {\n    "message" : "미상"\n  },\n  "i18n_sorry" : {\n    "message" : "현재 EPUB은 이 컨텐츠를 위한 미디어 오버레이가 포함되어 있지 않습니다."\n  },\n  "i18n_add_items" : {\n    "message" : "책을 등록하기 위하여 여기를 클릭하세요!"\n  },\n  "i18n_extracting" : {\n    "message" : "정보 추출 중: "\n  },\n  "i18n_are_you_sure" : {\n    "message" : "영구히 삭제하시길 원하십니까? "\n  },\n  "i18n_add_book_to_readium_library" : {\n    "message" : "Readium 라이브러리에 책 추가:"\n  },\n  "i18n_add_book" : {\n    "message" : "책 추가"\n  },\n  "i18n_cancel" : {\n    "message" : "취소"\n  },\n  "i18n_from_the_web" : {\n    "message" : "웹에서:"\n  },\n  "i18n_from_local_file" : {\n    "message" : "로컬 파일에서:"\n  },\n  "i18n_enter_a_url" : {\n    "message" : ".epub 파일의 URL을 입력하세요"\n  },\n  "i18n_unpacked_directory" : {\n    "message" : "추출된 디렉토리:"\n  },\n  "i18n_validate" : {\n    "message" : "승인:"\n  },\n  "i18n_confirm_that_this_book" : {\n    "message" : "이 책이 ePUB표준을 따르는지 확인"\n  },\n  "i18n_single_pages" : {\n    "message" : "단일 페이지"\n  },\n  "i18n_double_pages" : {\n    "message" : "더블 페이지"\n  },\n  "i18n_save_settings" : {\n    "message" : "설정 저장"\n  },\n  "i18n_font_size" : {\n    "message" : "폰트 크기"\n  },\n  "i18n_margins" : {\n    "message" : "여백"\n  },\n  "i18n_text_and_background_color" : {\n    "message" : "글자와 배경 색"\n  },\n  "i18n_black_and_white" : {\n    "message" : "흑백"\n  },\n  "i18n_arabian_nights" : {\n    "message" : "아라비안 나이트"\n  },\n  "i18n_sands_of_dune" : {\n    "message" : "샌즈 오브 듄"\n  },\n  "i18n_ballard_blues" : {\n    "message" : "발라드 블루스"\n  },\n  "i18n_vancouver_mist" : {\n    "message" : "밴쿠버 안개"\n  },\n  "i18n_display_format" : {\n    "message" : "디스플레이 포맷"\n  },\n  "i18n_html_readium_tm_a_project" : {\n    "message" : "Readium<sup>TM</sup>는 EPUB&reg;컨텐츠의 출판을 위한 국제디지털출판포럼(IDPF, International Digital Publishing Forum)과 지원 기업들의 오픈소스 시스템 및 렌더링 엔진 프로젝트입니다. 자세한 내용은 <a href=\\"http://readium.org/\\">프로젝트 홈페이지</a>를 참조하세요. 지금까지, 프로젝트 개발은 <a href=\\"http://evidentpoint.com/\\">Evident Point</a>와 <a href=\\"http://www.bluefirereader.com/\\">Bluefire Productions</a>에 의해서 주도 되었습니다. 프로젝트에 기여하시기 위해서는 <a href=\\"https://github.com/readium/readium-js-viewer\\">github 저장소</a>를 확인하시기 바랍니다."\n  },\n  "chrome_accept_languages": {\n    "message": "$CHROME$ accepts $languages$ languages",\n    "placeholders": {\n      "chrome": {\n        "content": "Chrome",\n        "example": "Chrome"\n      },\n      "languages": {\n        "content": "$1",\n        "example": "en-US,ja,sr,de,zh_CN"\n      }\n    }\n  }\n}\n\n'}),define("text!i18n/_locales/pt_BR/messages.json",[],function(){return'{\n  "chrome_extension_name": {\n    "message": "Readium"\n  },\n  "chrome_extension_description" : {\n    "message": "Um leitor para livros para EPUB3."\n  },\n  "i18n_readium_library" : {\n    "message" : "Biblioteca Readium"\n  },\n  "i18n_loading" : {\n   "message" : "Loading Library"\n  },\n  "i18n_readium_options" : {\n    "message" : "Opções do Readium:"\n  },\n  "i18n_save_changes" : {\n    "message" : "Salvar mudanças"\n  },\n  "i18n_close" : {\n    "message" : "Fechar"\n  },\n  "i18n_paginate_all" : {\n    "message" : "Paginar todo o conteúdo ePUB fluído"\n  },\n  "i18n_automatically" : {\n    "message" : "Abrir automaticamente urls *.epub no readium"\n  },\n  "i18n_show_warning" : {\n    "message" : "Exibir mensagem de alerta quando extraindo arquivos EPUB"\n  },\n  "i18n_details" : {\n    "message" : "Detalhes"\n  },\n  "i18n_read" : {\n    "message" : "Ler"\n  },\n  "i18n_delete" : {\n    "message" : "Excluir"\n  },\n  "i18n_author" : {\n    "message" : "Autor: "\n  },\n  "i18n_publisher" : {\n    "message" : "Editora: "\n  },\n  "i18n_source" : {\n    "message" : "Origem: "\n  },\n  "i18n_pub_date" : {\n    "message" : "Publicação: "\n  },\n  "i18n_modified_date" : {\n    "message" : "Data de Modificação: "\n  },\n  "i18n_id" : {\n    "message" : "ID: "\n  },\n  "i18n_epub_version" : {\n    "message" : "Versão do EPUB: "\n  },\n  "i18n_created_at" : {\n    "message" : "Criado aos: "\n  },\n  "i18n_format" : {\n    "message" : "Formato: "\n  },\n  "i18n_added" : {\n    "message" : "Adicionado: "\n  },\n  "i18n_unknown" : {\n    "message" : "Desconhecido"\n  },\n  "i18n_sorry" : {\n    "message" : "Desculpe, o atual EPUB não contém uma mídia de sobreposição para este conteúdo"\n  },\n  "i18n_add_items" : {\n    "message" : "Adicione itens para sua biblioteca aqui!"\n  },\n  "i18n_extracting" : {\n    "message" : "extraindo: "\n  },\n  "i18n_are_you_sure" : {\n    "message" : "Você tem certeza de que deseja excluir permanentemente "\n  },\n  "i18n_add_book_to_readium_library" : {\n    "message" : "Adicionar Livro à Biblioteca Readium:"\n  },\n  "i18n_add_book" : {\n    "message" : "Adicionar Livro"\n  },\n  "i18n_cancel" : {\n    "message" : "Cancelar"\n  },\n  "i18n_from_the_web" : {\n    "message" : "Da Rede:"\n  },\n  "i18n_from_local_file" : {\n    "message" : "De Arquivo Local:"\n  },\n  "i18n_enter_a_url" : {\n    "message" : "Insira uma URL para um arquivo .epub"\n  },\n  "i18n_unpacked_directory" : {\n    "message" : "Diretório Extraido:"\n  },\n  "i18n_validate" : {\n    "message" : "Validar:"\n  },\n  "i18n_confirm_that_this_book" : {\n    "message" : "Confirmar que este livro obedece aos padrões ePUB"\n  },\n  "i18n_single_pages" : {\n    "message" : "Pág. Simples"\n  },\n  "i18n_double_pages" : {\n    "message" : "Pág. Duplas"\n  },\n  "i18n_save_settings" : {\n    "message" : "Salvar Configurações"\n  },\n  "i18n_font_size" : {\n    "message" : "TAMANHO DA FONTE"\n  },\n  "i18n_margins" : {\n    "message" : "MARGENS"\n  },\n  "i18n_text_and_background_color" : {\n    "message" : "COR DO TEXTO E PLANO DE FUNDO"\n  },\n  "i18n_black_and_white" : {\n    "message" : "Preto e Branco"\n  },\n  "i18n_arabian_nights" : {\n    "message" : "Noites Árabes"\n  },\n  "i18n_sands_of_dune" : {\n    "message" : "Areias de Duna"\n  },\n  "i18n_ballard_blues" : {\n    "message" : "Ballard Blues"\n  },\n  "i18n_vancouver_mist" : {\n    "message" : "Névoa de Vancouver"\n  },\n  "i18n_display_format" : {\n    "message" : "FORMATO DE EXIBIÇÃO"\n  },\n  "i18n_html_readium_tm_a_project" : {\n    "message" : "Readium<sup>TM</sup>, a project of the International Digital Publishing Forum (IDPF) and supporters, is an open source reference system and rendering engine for EPUB&reg; publications.  To learn more, visit the <a href=\\"http://readium.org/\\">project homepage</a>. To date, the project development has been lead by <a href=\\"http://evidentpoint.com/\\">Evident Point</a> and <a href=\\"http://www.bluefirereader.com/\\">Bluefire Productions</a>. To contribute visit the <a href=\\"https://github.com/readium/readium-js-viewer\\">github repository</a>"\n  },\n  "chrome_accept_languages": {\n    "message": "$CHROME$ accepts $languages$ languages",\n    "placeholders": {\n      "chrome": {\n        "content": "Chrome",\n        "example": "Chrome"\n      },\n      "languages": {\n        "content": "$1",\n        "example": "en-US,pt-BR,ja,sr,de,zh_CN"\n      }\n    }\n  }\n}\n'}),define("text!i18n/_locales/zh_CN/messages.json",[],function(){return'{\n  "chrome_extension_name": {\n    "message": "Readium"\n  },\n  "chrome_extension_description": {\n    "message": "EPUB3电子书阅览器"\n  },\n  "i18n_readium_library" : {\n    "message" : "Readium书库"\n  },\n  "i18n_loading" : {\n    "message" : "Loading Library"\n  },\n  "i18n_readium_options" : {\n    "message" : "Readium选项:"\n  },\n  "i18n_save_changes" : {\n    "message" : "保存更改"\n  },\n  "i18n_close" : {\n    "message" : "关闭"\n  },\n  "i18n_paginate_all" : {\n    "message" : "分页显示所有可重排版EPUB文件"\n  },\n  "i18n_automatically" : {\n    "message" : "自动用Readium打开*.epub网址"\n  },\n  "i18n_show_warning" : {\n    "message" : "解压缩EPUB文件时显示警告消息"\n  },\n  "i18n_details" : {\n    "message" : "详细信息"\n  },\n  "i18n_read" : {\n    "message" : "阅读"\n  },\n  "i18n_delete" : {\n    "message" : "删除"\n  },\n  "i18n_author" : {\n    "message" : "作者: "\n  },\n  "i18n_publisher" : {\n    "message" : "出版社: "\n  },\n  "i18n_source" : {\n    "message" : "源自: "\n  },\n  "i18n_pub_date" : {\n    "message" : "出版日期: "\n  },\n  "i18n_modified_date" : {\n    "message" : "更新日期: "\n  },\n  "i18n_id" : {\n    "message" : "ID: "\n  },\n  "i18n_epub_version" : {\n    "message" : "EPUB版本: "\n  },\n  "i18n_created_at" : {\n    "message" : "创建日期: "\n  },\n  "i18n_format" : {\n    "message" : "格式: "\n  },\n  "i18n_added" : {\n    "message" : "添加: "\n  },\n  "i18n_unknown" : {\n    "message" : "未知"\n  },\n  "i18n_sorry" : {\n    "message" : "目前EPUB不支持此内容的媒体格式"\n  },\n  "i18n_add_items" : {\n    "message" : "点击这里添加新书"\n  },\n  "i18n_extracting" : {\n    "message" : "解压中: "\n  },\n  "i18n_are_you_sure" : {\n    "message" : "确定永久删除 "\n  },\n  "i18n_add_book_to_readium_library" : {\n    "message" : "添加新书到Readium书库:"\n  },\n  "i18n_add_book" : {\n    "message" : "添加"\n  },\n  "i18n_cancel" : {\n    "message" : "取消"\n  },\n  "i18n_from_the_web" : {\n    "message" : "从网络:"\n  },\n  "i18n_from_local_file" : {\n    "message" : "从本地文件:"\n  },\n  "i18n_enter_a_url" : {\n    "message" : "请输入一个.EPUB文件的URL"\n  },\n  "i18n_unpacked_directory" : {\n    "message" : "未打包目录:"\n  },\n  "i18n_validate" : {\n    "message" : "验证:"\n  },\n  "i18n_confirm_that_this_book" : {\n    "message" : "确认这本书是否符合EPUB标准"\n  },\n  "i18n_single_pages" : {\n    "message" : "单页"\n  },\n  "i18n_double_pages" : {\n    "message" : "双页"\n  },\n  "i18n_save_settings" : {\n    "message" : "保存设置"\n  },\n  "i18n_font_size" : {\n    "message" : "字体大小"\n  },\n  "i18n_margins" : {\n    "message" : "页边距"\n  },\n  "i18n_text_and_background_color" : {\n    "message" : "字体和背景颜色"\n  },\n  "i18n_black_and_white" : {\n    "message" : "Black and White"\n  },\n  "i18n_arabian_nights" : {\n    "message" : "Arabian Nights"\n  },\n  "i18n_sands_of_dune" : {\n    "message" : "Sands of Dune"\n  },\n  "i18n_ballard_blues" : {\n    "message" : "Ballard Blues"\n  },\n  "i18n_vancouver_mist" : {\n    "message" : "Vancouver Mist"\n  },\n  "i18n_display_format" : {\n    "message" : "显示格式"\n  },\n  "i18n_html_readium_tm_a_project" : {\n    "message" : "Readium<sup>TM</sup>，是一个International Digital Publishing Forum (IDPF)和技术支持者们共同开发的项目，也是一个开放源代码的EPUB格式出版物的渲染引擎。要了解更多信息，请访问<a href=\\"http://readium.org/\\">项目主页</a>。迄今为止，该项目的开发一直由<a href=\\"http://evidentpoint.com/\\">Evident Point</a>和<a href=\\"http://www.bluefirereader.com/\\">Bluefire Productions</a>来领导。要贡献请访问<a href=\\"https://github.com/readium/readium-js-viewer\\">GitHub资料库</a>"\n  },\n  "chrome_accept_languages": {\n    "message": "$CHROME$ accepts $languages$ languages",\n    "placeholders": {\n      "chrome": {\n        "content": "Chrome",\n        "example": "Chrome"\n      },\n      "languages": {\n        "content": "$1",\n        "example": "en-US,ja,sr,de,zh_CN"\n      }\n    }\n  }\n}\n'}),define("text!i18n/_locales/zh_TW/messages.json",[],function(){return'{\n  "chrome_extension_name": {\n    "message": "Readium"\n  },\n  "chrome_extension_description": {\n    "message": "EPUB3電子書閱讀器"\n  },\n  "i18n_readium_library" : {\n    "message" : "Readium書櫃"\n  },\n  "i18n_loading" : {\n    "message" : "Loading Library"\n  },\n  "i18n_readium_options" : {\n    "message" : "Readium設定:"\n  },\n  "i18n_save_changes" : {\n    "message" : "儲存變更"\n  },\n  "i18n_close" : {\n    "message" : "關閉"\n  },\n  "i18n_paginate_all" : {\n    "message" : "分頁呈現所有文字順走型的EPUB內容"\n  },\n  "i18n_automatically" : {\n    "message" : "自動以Readium開啟任何以.epub結尾的網址"\n  },\n  "i18n_show_warning" : {\n    "message" : "解壓縮EPUB檔案時顯示警告訊息"\n  },\n  "i18n_details" : {\n    "message" : "詳細"\n  },\n  "i18n_read" : {\n    "message" : "閱讀"\n  },\n  "i18n_delete" : {\n    "message" : "刪除"\n  },\n  "i18n_author" : {\n    "message" : "作者："\n  },\n  "i18n_publisher" : {\n    "message" : "出版社："\n  },\n  "i18n_source" : {\n    "message" : "來源："\n  },\n  "i18n_pub_date" : {\n    "message" : "出版日期："\n  },\n  "i18n_modified_date" : {\n    "message" : "更新日期："\n  },\n  "i18n_id" : {\n    "message" : "ID："\n  },\n  "i18n_epub_version" : {\n    "message" : "EPUB版本："\n  },\n  "i18n_created_at" : {\n    "message" : "建立日期："\n  },\n  "i18n_format" : {\n    "message" : "格式："\n  },\n  "i18n_added" : {\n    "message" : "加入日期："\n  },\n  "i18n_unknown" : {\n    "message" : "未知"\n  },\n  "i18n_sorry" : {\n    "message" : "目前的EPUB內容並不包含朗讀聲音"\n  },\n  "i18n_add_items" : {\n    "message" : "按下這裡加入新書"\n  },\n  "i18n_extracting" : {\n    "message" : "解壓縮中："\n  },\n  "i18n_are_you_sure" : {\n    "message" : "你確定要永久刪除 "\n  },\n  "i18n_add_book_to_readium_library" : {\n    "message" : "將書籍加入Readium書櫃："\n  },\n  "i18n_add_book" : {\n    "message" : "加入書籍"\n  },\n  "i18n_cancel" : {\n    "message" : "取消"\n  },\n  "i18n_from_the_web" : {\n    "message" : "從網站加入："\n  },\n  "i18n_from_local_file" : {\n    "message" : "從檔案加入："\n  },\n  "i18n_enter_a_url" : {\n    "message" : "請輸入 .epub 檔案所在網址"\n  },\n  "i18n_unpacked_directory" : {\n    "message" : "未壓縮目錄："\n  },\n  "i18n_validate" : {\n    "message" : "檢證："\n  },\n  "i18n_confirm_that_this_book" : {\n    "message" : "確認這本書是否符合EPUB標準"\n  },\n  "i18n_single_pages" : {\n    "message" : "單頁呈現"\n  },\n  "i18n_double_pages" : {\n    "message" : "跨頁呈現"\n  },\n  "i18n_save_settings" : {\n    "message" : "儲存設定"\n  },\n  "i18n_font_size" : {\n    "message" : "文字尺寸"\n  },\n  "i18n_margins" : {\n    "message" : "頁緣餘白"\n  },\n  "i18n_text_and_background_color" : {\n    "message" : "文字與背景色彩"\n  },\n  "i18n_black_and_white" : {\n    "message" : "黑底與白字"\n  },\n  "i18n_arabian_nights" : {\n    "message" : "阿拉伯之夜"\n  },\n  "i18n_sands_of_dune" : {\n    "message" : "砂丘之黃砂"\n  },\n  "i18n_ballard_blues" : {\n    "message" : "抒情曲藍調"\n  },\n  "i18n_vancouver_mist" : {\n    "message" : "溫哥華之霧"\n  },\n  "i18n_display_format" : {\n    "message" : "顯示格式"\n  },\n  "i18n_html_readium_tm_a_project" : {\n    "message" : "Readium<sup>TM</sup>是由是International Digital Publishing Forum (IDPF)與技術協助者們共同開發的專案，是供EPUB&reg; 出版品使用的開放原始碼參考系統與排版引擎。要了解更多訊息，請前往<a href=\\"http://readium.org/\\">專案網頁</a>。迄今為止，本專案持續由<a href=\\"http://evidentpoint.com/\\">Evident Point</a>和<a href=\\"http://www.bluefirereader.com/\\">Bluefire Productions</a>所主導。若想協助開發，請前往<a href=\\"https://github.com/readium/readium-js-viewer\\">GitHub專案</a>"\n  },\n  "chrome_accept_languages": {\n    "message": "$CHROME$ accepts $languages$ languages",\n    "placeholders": {\n      "chrome": {\n        "content": "Chrome",\n        "example": "Chrome"\n      },\n      "languages": {\n        "content": "$1",\n        "example": "en-US,zh-TW,zh-HK,ja,sr,de"\n      }\n    }\n  }\n}\n'}),define("i18n/Strings",["text!i18n/_locales/de/messages.json","text!i18n/_locales/es/messages.json","text!i18n/_locales/en_US/messages.json","text!i18n/_locales/fr/messages.json","text!i18n/_locales/id/messages.json","text!i18n/_locales/it/messages.json","text!i18n/_locales/ja/messages.json","text!i18n/_locales/ko/messages.json","text!i18n/_locales/pt_BR/messages.json","text!i18n/_locales/zh_CN/messages.json","text!i18n/_locales/zh_TW/messages.json"],function(e,t,n,r,i,s,o,u,a,f,l){var c={};c.de=e,c.es=t,c.en_US=n,c.fr=r,c.id=i,c.it=s,c.ja=o,c.ko=u,c.pt_BR=a,c.zh_CN=f,c.zh_TW=l;var h=navigator.userLanguage||navigator.language;console.log("Language: ["+h+"]");var p=!0,d=c[h]||n,v=JSON.parse(d),m=d===n?v:JSON.parse(n);for(var g in m){var y=g in v;y||console.log("Language ["+h+"], missing string: ["+g+"]"),v[g]=y?v[g].message:p?"*"+m[g].message:""}return v}),define("EpubLibraryManager",["jquery","module","PackageParser","workers/WorkerProxy","storage/StorageManager","i18n/Strings"],function(e,t,n,r,i,s){var o=t.config(),u=function(){};return u.prototype={_getFullUrl:function(e,t){if(!t)return null;var n=e.split("/");n.pop();var r=n.join("/");return r+(t.charAt(0)=="/"?"":"/")+t},retrieveAvailableEpubs:function(t,n){var r=i.getPathUrl("/epub_library.json");if(this.libraryData){t(this.libraryData);return}var s=this;e.getJSON(r,function(e){s.libraryData=e,t(e)}).fail(function(){s.libraryData=[],t([])})},deleteEpubWithId:function(e,t,n){r.deleteEpub(e,this.libraryData,{success:this._refreshLibraryFromWorker.bind(this,t),error:n})},retrieveFullEpubDetails:function(t,r,i,s,o,u){var a=this;e.get(t,function(e){if(typeof e=="string"){var u=new window.DOMParser;e=u.parseFromString(e,"text/xml")}var f=n.parsePackageDom(e,t);f.coverHref=a._getFullUrl(t,f.coverHref),f.packageUrl=t,f.rootDir=i,f.rootUrl=r,f.noCoverBackground=s,o(f)}).fail(u)},_refreshLibraryFromWorker:function(e,t){this.libraryData=t,e()},handleZippedEpub:function(e){r.importZip(e.file,this.libraryData,{progress:e.progress,overwrite:e.overwrite,success:this._refreshLibraryFromWorker.bind(this,e.success),error:e.error})},handleDirectoryImport:function(e){var t=e.files,n={};for(var i=0;i<t.length;i++){var s=t[i].webkitRelativePath;if(s.indexOf("/.")!=-1)continue;var o=s.split("/");o.shift();var u=o.join("/");n[u]=t[i]}r.importDirectory(n,this.libraryData,{progress:e.progress,overwrite:e.overwrite,success:this._refreshLibraryFromWorker.bind(this,e.success),error:e.error})},handleUrlImport:function(e){r.importUrl(e.url,this.libraryData,{progress:e.progress,overwrite:e.overwrite,success:this._refreshLibraryFromWorker.bind(this,e.success),error:e.error})},handleMigration:function(e){r.migrateOldBooks({progress:e.progress,success:this._refreshLibraryFromWorker.bind(this,e.success),error:e.error})},handleUrl:function(e){},canHandleUrl:function(){return o.canHandleUrl},canHandleDirectory:function(){return o.canHandleDirectory}},window.cleanEntireLibrary=function(){i.deleteFile("/",function(){console.log("done")},console.error)},new u});var Hogan={};(function(e,t){function n(e,t,n){var r,i;return t&&typeof t=="object"&&(t[e]!=null?r=t[e]:n&&t.get&&typeof t.get=="function"&&(r=t.get(e))),r}function r(e,t,n,r){function i(){}function s(){}i.prototype=e,s.prototype=e.subs;var o,u=new i;u.subs=new s,u.subsText={},u.ib();for(o in t)u.subs[o]=t[o],u.subsText[o]=r;for(o in n)u.partials[o]=n[o];return u}function l(e){return String(e===null||e===undefined?"":e)}function c(e){return e=l(e),f.test(e)?e.replace(i,"&amp;").replace(s,"&lt;").replace(o,"&gt;").replace(u,"&#39;").replace(a,"&quot;"):e}e.Template=function(e,t,n,r){e=e||{},this.r=e.code||this.r,this.c=n,this.options=r||{},this.text=t||"",this.partials=e.partials||{},this.subs=e.subs||{},this.ib()},e.Template.prototype={r:function(e,t,n){return""},v:c,t:l,render:function(t,n,r){return this.ri([t],n||{},r)},ri:function(e,t,n){return this.r(e,t,n)},ep:function(e,t){var n=this.partials[e],i=t[n.name];if(n.instance&&n.base==i)return n.instance;if(typeof i=="string"){if(!this.c)throw new Error("No compiler available.");i=this.c.compile(i,this.options)}return i?(this.partials[e].base=i,n.subs&&(this.activeSub===undefined&&(t.stackText=this.text),i=r(i,n.subs,n.partials,t.stackText||this.text)),this.partials[e].instance=i,i):null},rp:function(e,t,n,r){var i=this.ep(e,n);return i?i.ri(t,n,r):""},rs:function(e,t,n){var r=e[e.length-1];if(!h(r)){n(e,t,this);return}for(var i=0;i<r.length;i++)e.push(r[i]),n(e,t,this),e.pop()},s:function(e,t,n,r,i,s,o){var u;return h(e)&&e.length===0?!1:(typeof e=="function"&&(e=this.ms(e,t,n,r,i,s,o)),u=!!e,!r&&u&&t&&t.push(typeof e=="object"?e:t[t.length-1]),u)},d:function(e,t,r,i){var s,o=e.split("."),u=this.f(o[0],t,r,i),a=this.options.modelGet,f=null;if(e==="."&&h(t[t.length-2]))u=t[t.length-1];else for(var l=1;l<o.length;l++)s=n(o[l],u,a),s!=null?(f=u,u=s):u="";return i&&!u?!1:(!i&&typeof u=="function"&&(t.push(f),u=this.mv(u,t,r),t.pop()),u)},f:function(e,t,r,i){var s=!1,o=null,u=!1,a=this.options.modelGet;for(var f=t.length-1;f>=0;f--){o=t[f],s=n(e,o,a);if(s!=null){u=!0;break}}return u?(!i&&typeof s=="function"&&(s=this.mv(s,t,r)),s):i?!1:""},ls:function(e,t,n,r,i){var s=this.options.delimiters;return this.options.delimiters=i,this.b(this.ct(l(e.call(t,r)),t,n)),this.options.delimiters=s,!1},ct:function(e,t,n){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(e,this.options).render(t,n)},b:t?function(e){this.buf.push(e)}:function(e){this.buf+=e},fl:t?function(){var e=this.buf.join("");return this.buf=[],e}:function(){var e=this.buf;return this.buf="",e},ib:function(){this.buf=t?[]:""},ms:function(e,t,n,r,i,s,o){var u,a=t[t.length-1],f=e.call(a);return typeof f=="function"?r?!0:(u=this.activeSub&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(f,a,n,u.substring(i,s),o)):f},mv:function(e,t,n){var r=t[t.length-1],i=e.call(r);return typeof i=="function"?this.ct(l(i.call(r)),r,n):i},sub:function(e,t,n,r){var i=this.subs[e];i&&(this.activeSub=e,i(t,n,this,r),this.activeSub=!1)}};var i=/&/g,s=/</g,o=/>/g,u=/\'/g,a=/\"/g,f=/[&<>\"\']/,h=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}})(typeof exports!="undefined"?exports:Hogan),function(e){function o(e){e.n.substr(e.n.length-1)==="}"&&(e.n=e.n.substring(0,e.n.length-1))}function u(e){return e.trim?e.trim():e.replace(/^\s*|\s*$/g,"")}function a(e,t,n){if(t.charAt(n)!=e.charAt(0))return!1;for(var r=1,i=e.length;r<i;r++)if(t.charAt(n+r)!=e.charAt(r))return!1;return!0}function l(t,n,r,i){var s=[],o=null,u=null,a=null;u=r[r.length-1];while(t.length>0){a=t.shift();if(!(!u||u.tag!="<"||a.tag in f))throw new Error("Illegal content in < super tag.");if(e.tags[a.tag]<=e.tags.$||c(a,i))r.push(a),a.nodes=l(t,a.tag,r,i);else{if(a.tag=="/"){if(r.length===0)throw new Error("Closing tag without opener: /"+a.n);o=r.pop();if(a.n!=o.n&&!h(a.n,o.n,i))throw new Error("Nesting error: "+o.n+" vs. "+a.n);return o.end=a.i,s}a.tag=="\n"&&(a.last=t.length==0||t[0].tag=="\n")}s.push(a)}if(r.length>0)throw new Error("missing closing tag: "+r.pop().n);return s}function c(e,t){for(var n=0,r=t.length;n<r;n++)if(t[n].o==e.n)return e.tag="#",!0}function h(e,t,n){for(var r=0,i=n.length;r<i;r++)if(n[r].c==e&&n[r].o==t)return!0}function p(e){var t=[];for(var n in e)t.push('"'+m(n)+'": function(c,p,t,i) {'+e[n]+"}");return"{ "+t.join(",")+" }"}function d(e){var t=[];for(var n in e.partials)t.push('"'+m(n)+'":{name:"'+m(e.partials[n].name)+'", '+d(e.partials[n])+"}");return"partials: {"+t.join(",")+"}, subs: "+p(e.subs)}function m(e){return e.replace(s,"\\\\").replace(n,'\\"').replace(r,"\\n").replace(i,"\\r")}function g(e){return~e.indexOf(".")?"d":"f"}function y(e,t){var n="<"+(t.prefix||""),r=n+e.n+v++;return t.partials[r]={name:e.n,partials:{}},t.code+='t.b(t.rp("'+m(r)+'",c,p,"'+(e.indent||"")+'"));',r}function b(e,t){t.code+="t.b(t.t(t."+g(e.n)+'("'+m(e.n)+'",c,p,0)));'}function w(e){return"t.b("+e+");"}var t=/\S/,n=/\"/g,r=/\n/g,i=/\r/g,s=/\\/g;e.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},e.scan=function(r,i){function S(){v.length>0&&(m.push({tag:"_t",text:new String(v)}),v="")}function x(){var n=!0;for(var r=b;r<m.length;r++){n=e.tags[m[r].tag]<e.tags._v||m[r].tag=="_t"&&m[r].text.match(t)===null;if(!n)return!1}return n}function T(e,t){S();if(e&&x())for(var n=b,r;n<m.length;n++)m[n].text&&((r=m[n+1])&&r.tag==">"&&(r.indent=m[n].text.toString()),m.splice(n,1));else t||m.push({tag:"\n"});g=!1,b=m.length}function N(e,t){var n="="+E,r=e.indexOf(n,t),i=u(e.substring(e.indexOf("=",t)+1,r)).split(" ");return w=i[0],E=i[i.length-1],r+n.length-1}var s=r.length,f=0,l=1,c=2,h=f,p=null,d=null,v="",m=[],g=!1,y=0,b=0,w="{{",E="}}";i&&(i=i.split(" "),w=i[0],E=i[1]);for(y=0;y<s;y++)h==f?a(w,r,y)?(--y,S(),h=l):r.charAt(y)=="\n"?T(g):v+=r.charAt(y):h==l?(y+=w.length-1,d=e.tags[r.charAt(y+1)],p=d?r.charAt(y+1):"_v",p=="="?(y=N(r,y),h=f):(d&&y++,h=c),g=y):a(E,r,y)?(m.push({tag:p,n:u(v),otag:w,ctag:E,i:p=="/"?g-w.length:y+E.length}),v="",y+=E.length-1,h=f,p=="{"&&(E=="}}"?y++:o(m[m.length-1]))):v+=r.charAt(y);return T(g,!0),m};var f={_t:!0,"\n":!0,$:!0,"/":!0};e.stringify=function(t,n,r){return"{code: function (c,p,i) { "+e.wrapMain(t.code)+" },"+d(t)+"}"};var v=0;e.generate=function(t,n,r){v=0;var i={code:"",subs:{},partials:{}};return e.walk(t,i),r.asString?this.stringify(i,n,r):this.makeTemplate(i,n,r)},e.wrapMain=function(e){return'var t=this;t.b(i=i||"");'+e+"return t.fl();"},e.template=e.Template,e.makeTemplate=function(e,t,n){var r=this.makePartials(e);return r.code=new Function("c","p","i",this.wrapMain(e.code)),new this.template(r,t,this,n)},e.makePartials=function(e){var t,n={subs:{},partials:e.partials,name:e.name};for(t in n.partials)n.partials[t]=this.makePartials(n.partials[t]);for(t in e.subs)n.subs[t]=new Function("c","p","t","i",e.subs[t]);return n},e.codegen={"#":function(t,n){n.code+="if(t.s(t."+g(t.n)+'("'+m(t.n)+'",c,p,1),'+"c,p,0,"+t.i+","+t.end+',"'+t.otag+" "+t.ctag+'")){'+"t.rs(c,p,"+"function(c,p,t){",e.walk(t.nodes,n),n.code+="});c.pop();}"},"^":function(t,n){n.code+="if(!t.s(t."+g(t.n)+'("'+m(t.n)+'",c,p,1),c,p,1,0,0,"")){',e.walk(t.nodes,n),n.code+="};"},">":y,"<":function(t,n){var r={partials:{},code:"",subs:{},inPartial:!0};e.walk(t.nodes,r);var i=n.partials[y(t,n)];i.subs=r.subs,i.partials=r.partials},$:function(t,n){var r={subs:{},code:"",partials:n.partials,prefix:t.n};e.walk(t.nodes,r),n.subs[t.n]=r.code,n.inPartial||(n.code+='t.sub("'+m(t.n)+'",c,p,i);')},"\n":function(e,t){t.code+=w('"\\n"'+(e.last?"":" + i"))},_v:function(e,t){t.code+="t.b(t.v(t."+g(e.n)+'("'+m(e.n)+'",c,p,0)));'},_t:function(e,t){t.code+=w('"'+m(e.text)+'"')},"{":b,"&":b},e.walk=function(t,n){var r;for(var i=0,s=t.length;i<s;i++)r=e.codegen[t[i].tag],r&&r(t[i],n);return n},e.parse=function(e,t,n){return n=n||{},l(e,"",[],n.sectionTags||[])},e.cache={},e.cacheKey=function(e,t){return[e,!!t.asString,!!t.disableLambda,t.delimiters,!!t.modelGet].join("||")},e.compile=function(t,n){n=n||{};var r=e.cacheKey(t,n),i=this.cache[r];return i?i:(i=this.generate(this.parse(this.scan(t,n.delimiters),t,n),t,n),this.cache[r]=i)}}(typeof exports!="undefined"?exports:Hogan),typeof define=="function"&&define.amd&&define("hogan",Hogan),define("hgn",["hogan","text"],function(e,t){function o(i,s,o,f){var l=f.hgn||{},c=i;c+=l&&l.templateExtension!=null?l.templateExtension:n,t.get(s.toUrl(c),function(t){var n=l.compilationOptions?a({},l.compilationOptions):{};f.isBuild&&(n.asString=!0,r[i]=e.compile(t,n));var s=e.compile(t,n),c=u(s.render,s);c.text=s.text,c.template=s,o(c)})}function u(e,t){return function(){return e.apply(t,arguments)}}function a(e,t){var n;for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}function f(t,n,o){if(n in r){s||(s=e.compile(i));var u=r[n];o(s.render({pluginName:t,moduleName:n,fn:u}))}}var n=".mustache",r={},i='define("{{pluginName}}!{{moduleName}}", ["hogan"], function(hogan){  var tmpl = new hogan.Template({{{fn}}}, "", hogan);  function render(){ return tmpl.render.apply(tmpl, arguments); } render.template = tmpl; return render;});\n',s;return{load:o,write:f}}),define("hgn!templates/library-navbar.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div class="btn-group navbar-left">'),r.b("\n"+n),r.b('    <button id="aboutButt1" tabindex="1" type="button" class="btn icon-logo" data-toggle="modal" data-target="#about-dialog" title="'),r.b(r.v(r.d("strings.about",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.AboutDialog",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.about",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.AboutDialog",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.AboutDialog",e,t,0))),r.b('"></button>'),r.b("\n"+n),r.b("</div>"),r.b("\n"+n),r.b('<div class="btn-group navbar-right">'),r.b("\n"+n),r.b('    <button tabindex="1" type="button" class="btn icon-thumbnails" title="'),r.b(r.v(r.d("strings.thumbnail_view",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.ListViewThumbnailViewToggle",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.thumbnail_view",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.ListViewThumbnailViewToggle",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.ListViewThumbnailViewToggle",e,t,0))),r.b('">'),r.b("\n"+n),r.b('	<span class="glyphicon glyphicon-th" aria-hidden="true"></span>'),r.b("\n"+n),r.b("    </button>"),r.b("\n"+n),r.b('    <button tabindex="1" type="button" class="btn icon-list-view" title="'),r.b(r.v(r.d("strings.list_view",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.ListViewThumbnailViewToggle",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.list_view",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.ListViewThumbnailViewToggle",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.ListViewThumbnailViewToggle",e,t,0))),r.b('">'),r.b("\n"+n),r.b('        <span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span>'),r.b("\n"+n),r.b("    </button>"),r.b("\n"+n),r.b('    <button id="addbutt" tabindex="1" type="button" class="btn icon-add-epub" title="'),r.b(r.v(r.d("strings.i18n_add_book",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.AddEpubDialog",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.i18n_add_book",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.AddEpubDialog",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.AddEpubDialog",e,t,0))),r.b('"data-toggle="modal" data-target="#add-epub-dialog">'),r.b("\n"+n),r.b('    	<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>'),r.b("\n"+n),r.b("    </button>"),r.b("\n"+n),r.b('    <button id="settbutt1" tabindex="1" type="button" class="btn icon-settings" title="'),r.b(r.v(r.d("strings.settings",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.ShowSettingsModal",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.settings",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.ShowSettingsModal",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.ShowSettingsModal",e,t,0))),r.b('" data-toggle="modal" data-target="#settings-dialog">'),r.b("\n"+n),r.b('    	<span class="glyphicon glyphicon-cog" aria-hidden="true"></span>'),r.b("\n"+n),r.b("    </button>"),r.b("\n"+n),r.b("</div>"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/library-body.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div class="row library-items" role="main">'),r.b("\n"+n),r.b("</div>"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/empty-library.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div class="pull-right">'),r.b("\n"+n),r.b('	<div id="empty-message">'),r.b("\n"+n),r.b("		"),r.b(r.v(r.d("strings.i18n_add_items",e,t,0))),r.b("\n"+n),r.b("	</div>"),r.b("\n"+n),r.b('	<img id="empty-message-arrow" src="images/library_arrow.png" alt="">'),r.b("\n"+n),r.b("</div>"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/library-item.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div class="col-xs-4 col-sm-3 col-md-2 library-item">'),r.b("\n"+n),r.b("    <div class='info-wrap'>"),r.b("\n"+n),r.b("        <!-- <div class='caption book-info'>"),r.b("\n"+n),r.b("            <h4 class='title'>"),r.b(r.v(r.d("epub.title",e,t,0))),r.b("</h4>"),r.b("\n"+n),r.b("            <div class='author'>"),r.b(r.v(r.d("epub.author",e,t,0))),r.s(r.d("epub.author",e,t,1),e,t,1,0,0,"")||r.b("No Author Listed"),r.b("</div>"),r.b("\n"+n),r.b("        </div> -->"),r.b("\n"),r.b("\n"+n),r.b('            <button type="button" style="background: none; border: none; padding: 0; margin: 0;" class="read" data-book="'),r.b(r.v(r.d("epub.rootUrl",e,t,0))),r.b('"  aria-label="('),r.b(r.v(r.d("count.n",e,t,0))),r.b(") "),r.b(r.v(r.d("epub.title",e,t,0))),r.b('" title="('),r.b(r.v(r.d("count.n",e,t,0))),r.b(") "),r.b(r.v(r.d("epub.title",e,t,0))),r.b('"  tabindex="'),r.b(r.v(r.d("count.tabindex",e,t,0))),r.b('">'),r.b("\n"+n),r.b("            "),r.b("\n"+n),r.s(r.d("epub.coverHref",e,t,1),e,t,0,601,749,"{{ }}")&&(r.rs(e,t,function(e,t,r){r.b('        <div aria-hidden="true" class="no-cover has-cover" style="background-image:url('),r.b(r.v(r.d("epub.coverHref",e,t,0))),r.b(');"><p>&nbsp;</p></div>'),r.b("\n"+n)}),e.pop()),r.b("            "),r.b("\n"+n),r.b("                "),r.b("\n"+n),r.s(r.d("epub.coverHref",e,t,1),e,t,1,0,0,"")||(r.b('        <div aria-hidden="true" class="no-cover" style="background-image: url(\''),r.b(r.v(r.f("noCoverBackground",e,t,0))),r.b("')\"><p>"),r.b(r.v(r.d("epub.title",e,t,0))),r.b("</p></div>"),r.b("\n"+n)),r.b("    </button>"),r.b("\n"+n),r.b("    </div>"),r.b("\n"+n),r.b("            "),r.b("\n"+n),r.b('    <!-- <div class="caption buttons">'),r.b("\n"+n),r.b('        <a href="#" class="btn btn-default read" data-book="'),r.b(r.v(r.d("epub.packageUrl",e,t,0))),r.b('" role="button">'),r.b(r.v(r.d("strings.i18n_read",e,t,0))),r.b("</a>"),r.b("\n"+n),r.b('        <a href="#details-modal" data-book="'),r.b(r.v(r.d("epub.packageUrl",e,t,0))),r.b('" aria-pressed="true" class="btn btn-default details" data-toggle="modal" role="button">'),r.b(r.v(r.d("strings.i18n_details",e,t,0))),r.b("</a>"),r.b("\n"+n),r.b("    </div> -->"),r.b("\n"+n),r.b("    <div class='caption book-info'>"),r.b("\n"+n),r.b("        <h4 class='title'>"),r.b(r.v(r.d("epub.title",e,t,0))),r.b("</h4>"),r.b("\n"+n),r.b("        <div class='author'>"),r.b(r.v(r.d("epub.author",e,t,0))),r.s(r.d("epub.author",e,t,1),e,t,1,0,0,"")||r.b("No Author Listed"),r.b("</div>"),r.b("\n"),r.b("\n"+n),r.b('        <div class="buttons">'),r.b("\n"),r.b("\n"+n),r.b('         <button aria-label="'),r.b(r.v(r.d("strings.i18n_details",e,t,0))),r.b(" ("),r.b(r.v(r.d("count.n",e,t,0))),r.b(") "),r.b(r.v(r.d("epub.title",e,t,0))),r.b('" title="'),r.b(r.v(r.d("strings.i18n_details",e,t,0))),r.b(" ("),r.b(r.v(r.d("count.n",e,t,0))),r.b(") "),r.b(r.v(r.d("epub.title",e,t,0))),r.b('" tabindex="'),r.b(r.v(r.d("count.tabindex",e,t,0))),r.b('" data-toggle="modal" data-target="#details-modal" data-package="'),r.b(r.v(r.d("epub.rootUrl",e,t,0))),r.b("/"),r.b(r.v(r.d("epub.packagePath",e,t,0))),r.b('" data-root="'),r.b(r.v(r.d("epub.rootUrl",e,t,0))),r.b('" data-root-dir="'),r.b(r.v(r.d("epub.rootDir",e,t,0))),r.b('" '),r.s(r.d("epub.coverHref",e,t,1),e,t,1,0,0,"")||(r.b(' data-no-cover="'),r.b(r.v(r.f("noCoverBackground",e,t,0))),r.b('" ')),r.b(' class="btn btn-info details">'),r.b(r.v(r.d("strings.i18n_details",e,t,0))),r.b("</button></div>"),r.b("\n"+n),r.b("    </div>"),r.b("\n"+n),r.b("</div>"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/details-dialog.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div id="details-dialog" class="modal fade details-dialog" tabindex="-1">'),r.b("\n"+n),r.b('  <div class="modal-dialog">'),r.b("\n"+n),r.b('    <div class="modal-content">'),r.b("\n"+n),r.b('      <div class="modal-body">'),r.b("\n"+n),r.b("        <p>Loading Details...</p>"),r.b("\n"+n),r.b("        <progress></progress>"),r.b("\n"+n),r.b("      </div>"),r.b("\n"+n),r.b("    </div><!-- /.modal-content -->"),r.b("\n"+n),r.b("  </div><!-- /.modal-dialog -->"),r.b("\n"+n),r.b("</div><!-- /.modal -->"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/about-dialog.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div class="modal fade" id="about-dialog" tabindex="-1">'),r.b("\n"+n),r.b('  <div class="modal-dialog">'),r.b("\n"+n),r.b('    <div class="modal-content">'),r.b("\n"+n),r.b('      <div class="modal-body">'),r.b("\n"+n),r.b('      	<div class="splash-logo">'),r.b("\n"+n),r.b('      		<img src="images/about_readium_logo.png">'),r.b("\n"+n),r.b("      	</div>"),r.b("\n"),r.b("\n"+n),r.b('      	<div class="about-message">'),r.b("\n"+n),r.b("	      	<span>"),r.b(r.t(r.d("strings.i18n_html_readium_tm_a_project",e,t,0))),r.b("</span>"),r.b("\n"+n),r.b("      	</div>"),r.b("\n"+n),r.b("      	<div>"),r.b("\n"+n),r.b('			     <img src="images/partner_logos.png">'),r.b("\n"+n),r.b("		    </div>"),r.b("\n"+n),r.b('        <h4 style="color:#111155">'),r.b(r.t(r.d("strings.gethelp",e,t,0))),r.b("</h4>"),r.b("\n"+n),r.b('        <div class="version">'),r.b(r.v(r.d("viewer.chromeVersion",e,t,0))),r.b("</div>"),r.b("\n"+n),r.b('        <div class="build-date">'),r.b(r.v(r.d("viewer.dateTimeString",e,t,0))),r.b("</div>"),r.b("\n"+n),r.b('        <div class="version-details">'),r.b("\n"+n),r.b('        <div><a target="_blank" href="https://github.com/readium/readium-js-viewer/tree/'),r.b(r.v(r.d("viewer.sha",e,t,0))),r.b('">readium-js-viewer@'),r.b(r.v(r.d("viewer.sha",e,t,0))),r.b("</a>"),r.s(r.d("viewer.clean",e,t,1),e,t,1,0,0,"")||r.b('<span class="local-changes-alert">(with local changes)</span>'),r.b("</div>"),r.b("\n"+n),r.b('          <div><a target="_blank" href="https://github.com/readium/readium-js/tree/'),r.b(r.v(r.d("readium.sha",e,t,0))),r.b('">readium-js@'),r.b(r.v(r.d("readium.sha",e,t,0))),r.b("</a>"),r.s(r.d("readium.clean",e,t,1),e,t,1,0,0,"")||r.b('<span class="local-changes-alert">(with local changes)</span>'),r.b("</div>"),r.b("\n"+n),r.b('          <div><a target="_blank" href="https://github.com/readium/readium-shared-js/tree/'),r.b(r.v(r.d("sharedJs.sha",e,t,0))),r.b('">readium-shared-js@'),r.b(r.v(r.d("sharedJs.sha",e,t,0))),r.b("</a>"),r.s(r.d("sharedJs.clean",e,t,1),e,t,1,0,0,"")||r.b('<span class="local-changes-alert">(with local changes)</span>'),r.b("</div>"),r.b("\n"+n),r.b("        </div>"),r.b("\n"+n),r.b("      </div>"),r.b("\n"+n),r.b("    </div><!-- /.modal-content -->"),r.b("\n"+n),r.b("  </div><!-- /.modal-dialog -->"),r.b("\n"+n),r.b("</div><!-- /.modal -->"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/details-body.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div class="details-body">'),r.b("\n"+n),r.b('    <button type="button" class="close" data-dismiss="modal"  tabindex="1000" title="'),r.b(r.v(r.d("strings.i18n_close",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_details",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_close",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_details",e,t,0))),r.b('"><span aria-hidden="true">&times;</span></button>'),r.b("\n"+n),r.b('    <div class="offscreenText">Details Start</div>'),r.b("\n"+n),r.b('    <div class="modal-cover-wrap">'),r.b("\n"+n),r.s(r.d("data.coverHref",e,t,1),e,t,0,384,494,"{{ }}")&&(r.rs(e,t,function(e,t,r){r.b('        <img class="details-cover-image img-responsive" src="'),r.b(r.v(r.d("data.coverHref",e,t,0))),r.b('" alt="ePUB cover">'),r.b("\n"+n)}),e.pop()),r.s(r.d("data.coverHref",e,t,1),e,t,1,0,0,"")||(r.b('        <div class="no-cover" style="background-image: url(\''),r.b(r.v(r.d("data.noCoverBackground",e,t,0))),r.b("')\"><p>"),r.b(r.v(r.d("data.title",e,t,0))),r.b("</p></div>"),r.b("\n"+n)),r.b("        <div id='details-button-div' class=\"buttons\" hidden aria-hidden='true'>"),r.b("\n"+n),r.b('            <button tabindex="1000" class="btn btn-default read" data-dismiss="modal" data-book="'),r.b(r.v(r.d("data.rootUrl",e,t,0))),r.b('" type="button">'),r.b(r.v(r.d("strings.i18n_read",e,t,0))),r.b("</button>"),r.b("\n"+n),r.b('            <button tabindex="1000" class="btn btn-danger delete" data-dismiss="modal" type="button">'),r.b(r.v(r.d("strings.i18n_delete",e,t,0))),r.b("</button>"),r.b("\n"+n),r.b("        </div>"),r.b("\n"+n),r.b("    </div>"),r.b("\n"+n),r.b("    <div class='modal-book-info'>"),r.b("\n"+n),r.b("        <h3 class='modal-title'>"),r.b(r.v(r.d("data.title",e,t,0))),r.b("</h3>"),r.b("\n"+n),r.b("        <div class='modal-detail'>"),r.b(r.v(r.d("strings.i18n_author",e,t,0))),r.b(r.v(r.d("data.author",e,t,0))),r.b("</div>"),r.b("\n"+n),r.b("        <div class='modal-detail'>"),r.b(r.v(r.d("strings.i18n_publisher",e,t,0))),r.b(r.v(r.d("data.publisher",e,t,0))),r.b("</div>"),r.b("\n"+n),r.b("        <div class='modal-detail'>"),r.b(r.v(r.d("strings.i18n_pub_date",e,t,0))),r.b(r.v(r.d("data.pubdate",e,t,0))),r.b("</div>"),r.b("\n"+n),r.b("        <div class='modal-detail'>"),r.b(r.v(r.d("strings.i18n_modified_date",e,t,0))),r.b(r.v(r.d("data.modified_date",e,t,0))),r.b("</div>"),r.b("\n"+n),r.b("        <div class='modal-detail'>"),r.b(r.v(r.d("strings.i18n_id",e,t,0))),r.b(r.v(r.d("data.id",e,t,0))),r.b("</div>"),r.b("\n"+n),r.b("        <div class='modal-detail'>"),r.b(r.v(r.d("strings.i18n_epub_version",e,t,0))),r.b(r.v(r.d("data.epub_version",e,t,0))),r.b("</div>        "),r.b("\n"+n),r.b("    </div>"),r.b("\n"),r.b("\n"+n),r.b('    <div class="offscreenText">Details End</div>'),r.b("\n"+n),r.b("</div>"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/add-epub-dialog.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div class="modal fade" id="add-epub-dialog" tabindex="-1" role="dialog" aria-labelledby="add-epub-label" aria-hidden="true">'),r.b("\n"+n),r.b('    <div class="modal-dialog">'),r.b("\n"+n),r.b('        <div class="modal-content">'),r.b("\n"+n),r.b('            <div class="modal-header">'),r.b("\n"),r.b("\n"+n),r.b('                <button id="closeAddEpubCross" type="button" class="close" data-dismiss="modal" tabindex="999" title="'),r.b(r.v(r.d("strings.i18n_close",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_add_book",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_close",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_add_book",e,t,0))),r.b('"><span aria-hidden="true">&times;</span></button>'),r.b("\n"),r.b("\n"+n),r.b('                <h4 class="modal-title" id="add-epub-label">'),r.b(r.v(r.d("strings.i18n_add_book",e,t,0))),r.b("</h4>"),r.b("\n"+n),r.b("            </div>"),r.b("\n"+n),r.b('            <div class="modal-body">'),r.b("\n"+n),r.b('                <form class="form-horizontal" role="form">'),r.b("\n"+n),r.s(r.f("canHandleUrl",e,t,1),e,t,0,752,1172,"{{ }}")&&(r.rs(e,t,function(e,t,r){r.b('                <div class="form-group">'),r.b("\n"+n),r.b('                    <label id="add1" class="control-label col-sm-5">'),r.b(r.v(r.d("strings.i18n_from_the_web",e,t,0))),r.b("</label>"),r.b("\n"+n),r.b('                    <div class="col-sm-7">'),r.b("\n"+n),r.b('                        <input tabindex="1000" type="text" id="url-upload" class="form-control" placeholder="'),r.b(r.v(r.d("strings.i18n_enter_a_url",e,t,0))),r.b('" aria-labelledby="add1">'),r.b("\n"+n),r.b("                    </div>"),r.b("\n"+n),r.b("                </div>"),r.b("\n"+n)}),e.pop()),r.b('                <div id="epub-upload-div" class="form-group">'),r.b("\n"+n),r.b('                    <label id="add2" class="control-label col-sm-5">'),r.b(r.v(r.d("strings.i18n_from_local_file",e,t,0))),r.b("</label>"),r.b("\n"+n),r.b('                    <div class="col-sm-7">'),r.b("\n"+n),r.b('                        <input tabindex="1000" type="file" id="epub-upload" class="form-control" aria-labelledby="add2" role="button">'),r.b("\n"+n),r.b("                    </div>"),r.b("\n"+n),r.b("                </div>"),r.b("\n"+n),r.s(r.f("canHandleDirectory",e,t,1),e,t,0,1628,2074,"{{ }}")&&(r.rs(e,t,function(e,t,r){r.b('                <div class="form-group">'),r.b("\n"+n),r.b('                    <label id="add3" class="control-label col-sm-5">'),r.b(r.v(r.d("strings.i18n_unpacked_directory",e,t,0))),r.b("</label>"),r.b("\n"+n),r.b('                    <div class="col-sm-7">'),r.b("\n"+n),r.b('                        <input tabindex="1000" type="file" id="dir-upload" webkitdirectory="" mozdirectory="" directory="" class="form-control" aria-labelledby="add3"  role="button">'),r.b("\n"+n),r.b("                    </div>"),r.b("\n"+n),r.b("                </div>"),r.b("\n"+n)}),e.pop()),r.b("                </form>"),r.b("\n"+n),r.b("            </div>"),r.b("\n"+n),r.b('            <div class="modal-footer">'),r.b("\n"+n),r.b('                <button tabindex="1000" type="button" class="btn btn-default add-book" data-dismiss="modal" disabled="disabled">'),r.b(r.v(r.d("strings.i18n_add_book",e,t,0))),r.b("</button>"),r.b("\n"+n),r.b('                <button tabindex="1000" type="button" class="btn btn-primary" data-dismiss="modal">'),r.b(r.v(r.d("strings.i18n_cancel",e,t,0))),r.b("</button>"),r.b("\n"+n),r.b("            </div>"),r.b("\n"+n),r.b("        </div>"),r.b("\n"+n),r.b("        <!-- /.modal-content --> "),r.b("\n"+n),r.b("    </div><!-- /.modal-dialog -->"),r.b("\n"+n),r.b("</div>"),r.b("\n"+n),r.b("<!-- /.modal -->"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/settings-dialog.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div tabindex="-1" class="modal fade" id="settings-dialog" role="dialog" aria-label="'),r.b(r.v(r.d("strings.settings",e,t,0))),r.b('" aria-hidden="true">'),r.b("\n"+n),r.b('    <div class="modal-dialog">'),r.b("\n"+n),r.b('        <div class="modal-content">'),r.b("\n"),r.b("\n"+n),r.b('           <!-- div class="modal-header">'),r.b("\n"+n),r.b('            <h4 class="modal-title" id="settings-label">'),r.b(r.v(r.d("strings.settings",e,t,0))),r.b("</h4>"),r.b("\n"+n),r.b("           </div -->"),r.b("\n"+n),r.b("               "),r.b("\n"+n),r.b('            <div class="modal-body">'),r.b("\n"+n),r.b('           <button type="button" class="close" id="closeSettingsCross" data-dismiss="modal" title="'),r.b(r.v(r.d("strings.i18n_close",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.settings",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_close",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.settings",e,t,0))),r.b('"><span aria-hidden="true">&times;</span></button>'),r.b("\n"),r.b("\n"+n),r.b('           <ul class="nav nav-tabs" role="tablist" aria-owns="tab-butt-style tab-butt-layout tab-butt-keys">'),r.b("\n"+n),r.b('             <li class="active" role="presentation"><button id="tab-butt-style"  title="'),r.b(r.v(r.d("strings.style",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.style",e,t,0))),r.b('" role=\'tab\' aria-controls="tab-style" data-toggle="tab" data-target="#tab-style">'),r.b(r.v(r.d("strings.style",e,t,0))),r.b("</button></li>"),r.b("\n"+n),r.b('             <li role="presentation"><button id="tab-butt-layout"  title="'),r.b(r.v(r.d("strings.layout",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.layout",e,t,0))),r.b('" role=\'tab\' aria-controls="tab-layout" data-toggle="tab" data-target="#tab-layout">'),r.b(r.v(r.d("strings.layout",e,t,0))),r.b("</button></li>"),r.b("\n"+n),r.b('             <li role="presentation"><button id="tab-butt-keys"  title="'),r.b(r.v(r.d("strings.i18n_keyboard_shortcuts",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_keyboard_shortcuts",e,t,0))),r.b('" role=\'tab\' aria-controls="tab-keyboard" data-toggle="tab" data-target="#tab-keyboard">'),r.b(r.v(r.d("strings.i18n_keyboard_shortcuts",e,t,0))),r.b("</button></li>"),r.b("\n"+n),r.b("           </ul>"),r.b("\n"+n),r.b("           "),r.b("\n"+n),r.b("           "),r.b("\n"+n),r.b('           <div class="tab-content">'),r.b("\n"+n),r.b('                <div id="tab-style" class="tab-pane active" role="tabpanel" aria-expanded="true">'),r.b("\n"+n),r.b("                    "),r.b("\n"+n),r.b('                    <div id="theme-preview">'),r.b("\n"+n),r.b('                        <h5 aria-hidden="true">'),r.b(r.v(r.d("strings.preview",e,t,0))),r.b("</h5>"),r.b("\n"+n),r.b('                        <div  aria-hidden="true" class="row">'),r.b("\n"+n),r.b('                            <div data-theme="default-theme" class="col-xs-10 col-xs-offset-1 preview-text default-theme">'),r.b("\n"+n),r.b("                                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus neque dui, congue a suscipit non, feugiat eu urna. Cras in felis sed orci aliquam sagittis. "),r.b("\n"+n),r.b("                            </div>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b("                    </div>"),r.b("\n"),r.b("\n"+n),r.b('<!-- button  type="button" title="TESTING" aria-label="TESTING">TESTING DANIEL</button -->'),r.b("\n"+n),r.b("                "),r.b("\n"+n),r.b('                    <h5 id="setting-header-font-size" class="setting-header">'),r.b(r.v(r.d("strings.i18n_font_size",e,t,0))),r.b("</h5>"),r.b("\n"+n),r.b('                    <div class="row">'),r.b("\n"+n),r.b('                        <div class="col-xs-2 icon-scale-down">'),r.b("\n"+n),r.b('                            <img src="images/glyphicons_115_text_smaller.png" alt="" aria-hidden="true">'),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b('                        <div class="col-xs-8">'),r.b("\n"+n),r.b('                            <input  type="range" role="slider" aria-labelledby="setting-header-font-size" id="font-size-input" min="60" aria-value-min="60" aria-valuemin="60" step="10" max="170" aria-value-max="170" aria-valuemax="170" value="100" aria-valuenow="100" aria-value-now="100" aria-valuetext="1em" aria-value-text="1em" title="'),r.b(r.v(r.d("strings.i18n_font_size",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_font_size",e,t,0))),r.b('" />'),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b('                        <div class="col-xs-2">'),r.b("\n"+n),r.b('                            <img src="images/glyphicons_116_text_bigger.png" alt="" aria-hidden="true">'),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b("                    </div>"),r.b("\n"),r.b("\n"+n),r.b('                    <h5 id="setting-header-color-legend" class="setting-header">'),r.b(r.v(r.d("strings.i18n_text_and_background_color",e,t,0))),r.b("</h5>"),r.b("\n"),r.b("\n"+n),r.b('                    <div role="radiogroup" aria-labelledby="setting-header-color-legend" class="row">'),r.b("\n"),r.b("\n"+n),r.b('                        <div id="author-theme-radio-div" role="radio"'),r.b("\n"+n),r.b('                             class="col-xs-8 col-xs-offset-2 theme-option author-theme clickable">'),r.b("\n"+n),r.b('                            <div class="col-xs-offset-4">'),r.b("\n"),r.b("\n"+n),r.b('                             <input id="author-theme-radio" name="color-theme" value="author-theme" type="radio"'),r.b("\n"+n),r.b("                                    />"),r.b("\n"+n),r.b('                            <label for="author-theme-radio" class="underlinedLabel">'),r.b("\n"+n),r.b("                                "),r.b(r.v(r.d("strings.i18n_author_theme",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                            </div>"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"),r.b("\n"+n),r.b('                        <div id="default-theme-radio-div" role="radio"'),r.b("\n"+n),r.b('                            class="col-xs-8 col-xs-offset-2 theme-option default-theme clickable">'),r.b("\n"+n),r.b('                            <div class="col-xs-offset-4">'),r.b("\n"+n),r.b('                            <input id="default-theme-radio" name="color-theme" value="default-theme" type="radio"'),r.b("\n"+n),r.b("                                   />"),r.b("\n"+n),r.b('                            <label for="default-theme-radio" class="underlinedLabel">'),r.b("\n"+n),r.b("                                "),r.b(r.v(r.d("strings.i18n_black_and_white",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                            </div>"),r.b("\n"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"),r.b("\n"+n),r.b('                        <div id="night-theme-radio-div" role="radio"'),r.b("\n"+n),r.b('                             class="col-xs-8 col-xs-offset-2 theme-option night-theme clickable">'),r.b("\n"+n),r.b('                            <div class="col-xs-offset-4">'),r.b("\n"+n),r.b('                            <input id="night-theme-radio" name="color-theme" value="night-theme" type="radio"'),r.b("\n"+n),r.b("                                   />"),r.b("\n"+n),r.b('                            <label id="night-theme-radio-label" for="night-theme-radio" class="underlinedLabel">'),r.b("\n"+n),r.b("                                "),r.b(r.v(r.d("strings.i18n_arabian_nights",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                            </div>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"),r.b("\n"+n),r.b('                        <div id="parchment-theme-radio-div" role="radio"'),r.b("\n"+n),r.b('                             class="col-xs-8 col-xs-offset-2 theme-option parchment-theme clickable">'),r.b("\n"+n),r.b('                            <div class="col-xs-offset-4">'),r.b("\n"+n),r.b('                            <input id="parchment-theme-radio" name="color-theme" value="parchment-theme" type="radio"'),r.b("\n"+n),r.b("                                   />"),r.b("\n"+n),r.b('                            <label for="parchment-theme-radio" class="underlinedLabel">'),r.b("\n"+n),r.b("                                "),r.b(r.v(r.d("strings.i18n_sands_of_dune",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                            </div>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"),r.b("\n"+n),r.b('                        <div id="ballard-theme-radio-div" role="radio"'),r.b("\n"+n),r.b('                            class="col-xs-8 col-xs-offset-2 theme-option ballard-theme clickable">'),r.b("\n"+n),r.b('                            <div class="col-xs-offset-4">'),r.b("\n"+n),r.b('                            <input id="ballard-theme-radio" name="color-theme" value="ballard-theme" type="radio"'),r.b("\n"+n),r.b("                                   />"),r.b("\n"+n),r.b('                            <label id="ballard-theme-radio-label" for="ballard-theme-radio" class="underlinedLabel">'),r.b("\n"+n),r.b("                                "),r.b(r.v(r.d("strings.i18n_ballard_blues",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                            </div>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b('                        <div id="custom-theme-radio-div" role="radio" class="col-xs-8 col-xs-offset-2 theme-option default-theme clickable">'),r.b("\n"+n),r.b('                            <div class="col-xs-offset-4">'),r.b("\n"+n),r.b('                            <input id="custom-theme-radio" name="color-theme" value="custom-theme" type="radio"'),r.b("\n"+n),r.b("                                  />"),r.b("\n"+n),r.b('                            <label id="custom-theme-radio-label" for="custom-theme-radio" class="underlinedLabel">'),r.b("\n"+n),r.b("                                "),r.b(r.v(r.d("strings.i18n_custom_theme",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                            </div>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b("                    </div>"),r.b("\n"+n),r.b("                </div>"),r.b("\n"+n),r.b('                    <div id="tab-layout" class="tab-pane" role="tabpanel">'),r.b("\n"+n),r.b("                    "),r.b("\n"+n),r.b('                    <h5 id="setting-header-margins-legend" class="setting-header">'),r.b(r.v(r.d("strings.i18n_margins",e,t,0))),r.b("</h5>"),r.b("\n"+n),r.b('                     <div class="row">'),r.b("\n"+n),r.b('                        <div class="col-xs-2 icon-scale-down">'),r.b("\n"+n),r.b('                            <img style="height: 32px;" src="images/margin1_off.png" alt="" aria-hidden="true">'),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b('                        <div class="col-xs-8">'),r.b("\n"+n),r.b('                            <input  type="range" role="slider" aria-labelledby="setting-header-margins-legend" id="margin-size-input" min="20" aria-value-min="20" aria-valuemin="20" step="20" max="100" aria-value-max="100" aria-valuemax="100" value="20" aria-valuenow="20" aria-value-now="20" aria-valuetext="20" aria-value-text="20" title="'),r.b(r.v(r.d("strings.i18n_margins",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_margins",e,t,0))),r.b('"/>'),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b('                        <div class="col-xs-2">'),r.b("\n"+n),r.b('                            <img style="height: 32px;" src="images/margin4_off.png" alt="" aria-hidden="true">'),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b("                    </div>"),r.b("\n"),r.b("\n"+n),r.b('                    <h5 id="setting-header-display-legend" class="setting-header">'),r.b(r.v(r.d("strings.i18n_display_format",e,t,0))),r.b("</h5>"),r.b("\n"+n),r.b("                    "),r.b("\n"+n),r.b('                    <div role="radiogroup" class="row" style="width:100%;text-align:center;" aria-labelledby="setting-header-display-legend">'),r.b("\n"),r.b("\n"+n),r.b('                        <div role="radio" id="spread-default-option"'),r.b("\n"+n),r.b('                        style="vertical-align:middle;width:30%;display:inline-block;position:relative;">'),r.b("\n"+n),r.b('                            <input style=""  name="display-format" value="single" type="radio" id="spread-default-radio"/>'),r.b("\n"+n),r.b('                            <label style="" for="spread-default-radio" class="underlinedLabel">'),r.b("\n"+n),r.b("                                "),r.b(r.v(r.d("strings.i18n_spread_auto",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b('                        <div role="radio" id="one-up-option"'),r.b("\n"+n),r.b('                        style="vertical-align:middle;width:30%;display:inline-block;position:relative;">'),r.b("\n"+n),r.b("                            "),r.b("\n"+n),r.b('                            <input  name="display-format" value="single" type="radio" id="single-page-radio" />'),r.b("\n"+n),r.b('                                            <label for="single-page-radio" class="underlinedLabel">'),r.b("\n"+n),r.b('                                            <img src="images/ico_singlepage_up.png" alt="'),r.b(r.v(r.d("strings.i18n_display_format",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_single_pages",e,t,0))),r.b('"/>'),r.b("\n"+n),r.b("                                            </label>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b('                        <div role="radio" id="two-up-option"'),r.b("\n"+n),r.b('                        style="vertical-align:middle;width:30%;display:inline-block;position:relative;">'),r.b("\n"+n),r.b("                            "),r.b("\n"+n),r.b('                                <input  name="display-format" value="double" type="radio" id="double-page-radio" />'),r.b("\n"+n),r.b('                                            <label for="double-page-radio" class="underlinedLabel">'),r.b("\n"+n),r.b('                                            <img src="images/ico_doublepage_up.png" alt="'),r.b(r.v(r.d("strings.i18n_display_format",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_double_pages",e,t,0))),r.b('">'),r.b("\n"+n),r.b("                                            </label>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b("                    </div>"),r.b("\n"),r.b("\n"+n),r.b('                    <h5 id="setting-header-scroll-legend" class="setting-header">'),r.b(r.v(r.d("strings.i18n_scroll_mode",e,t,0))),r.b("</h5>"),r.b("\n"+n),r.b("                    "),r.b("\n"+n),r.b('                    <div role="radiogroup" class="row" style="width:100%;text-align:center;" aria-labelledby="setting-header-scroll-legend">'),r.b("\n"+n),r.b("                        "),r.b("\n"+n),r.b('                        <div role="radio" id="scroll-default-option" style="vertical-align:middle;width:30%;display:inline-block;position:relative;">'),r.b("\n"+n),r.b('                            <input style=""  name="scrolling" value="single" type="radio" id="scroll-default-radio"/>'),r.b("\n"+n),r.b('                            <label style="" for="scroll-default-radio" class="underlinedLabel">'),r.b("\n"+n),r.b("                                "),r.b(r.v(r.d("strings.i18n_scroll_mode_auto",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b("                        "),r.b("\n"+n),r.b('                        <div role="radio" id="scroll-doc-option" style="vertical-align:middle;width:30%;display:inline-block;position:relative;">'),r.b("\n"+n),r.b('                            <input style=""  name="scrolling" value="single" type="radio" id="scroll-doc-radio"/>'),r.b("\n"+n),r.b('                            <label style="" for="scroll-doc-radio" class="underlinedLabel">'),r.b("\n"+n),r.b('                                <span style="font-size:150%;color:#888888;" class="glyphicon glyphicon-file" aria-hidden="true"></span> '),r.b(r.v(r.d("strings.i18n_scroll_mode_doc",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b("                        "),r.b("\n"+n),r.b('                        <div role="radio" id="scroll-continuous-option" style="vertical-align:middle;width:30%;display:inline-block;position:relative;">'),r.b("\n"+n),r.b('                            <input style=""  name="scrolling" value="single" type="radio" id="scroll-continuous-radio"/>'),r.b("\n"+n),r.b('                            <label style="" for="scroll-continuous-radio" class="underlinedLabel">'),r.b("\n"+n),r.b('                                <span style="font-size:150%;color:#888888;" class="glyphicon glyphicon-road" aria-hidden="true"></span> '),r.b(r.v(r.d("strings.i18n_scroll_mode_continuous",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b("                        "),r.b("\n"+n),r.b("                    </div>"),r.b("\n"),r.b("\n"+n),r.b('                    <h5 hiddenx="hidden" id="setting-header-pageTransition-legend" class="setting-header">'),r.b(r.v(r.d("strings.i18n_page_transition",e,t,0))),r.b("</h5>"),r.b("\n"+n),r.b("                    "),r.b("\n"+n),r.b('                    <div hiddenx="hidden" role="radiogroup" class="row" style="width:100%;text-align:center;" aria-labelledby="setting-header-pageTransition-legend">'),r.b("\n"+n),r.b("                        "),r.b("\n"+n),r.b('                        <div role="radio" id="pageTransition-none-option" style="vertical-align:middle;width:15%;display:inline-block;position:relative;">'),r.b("\n"+n),r.b('                            <input style=""  name="pageTransition" value="single" type="radio" id="pageTransition-none-radio"/>'),r.b("\n"+n),r.b('                            <label style="" for="pageTransition-none-radio" class="underlinedLabel">'),r.b("\n"+n),r.b("                                "),r.b(r.v(r.d("strings.i18n_page_transition_none",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b("                        "),r.b("\n"+n),r.b('                        <div role="radio" id="pageTransition-1-option" style="vertical-align:middle;width:15%;display:inline-block;position:relative;">'),r.b("\n"+n),r.b('                            <input style=""  name="pageTransition" value="single" type="radio" id="pageTransition-1-radio"/>'),r.b("\n"+n),r.b('                            <label style="" for="pageTransition-1-radio" class="underlinedLabel">'),r.b("\n"+n),r.b("                                "),r.b(r.v(r.d("strings.i18n_page_transition_fade",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b("                        "),r.b("\n"+n),r.b('                        <div role="radio" id="pageTransition-2-option" style="vertical-align:middle;width:15%;display:inline-block;position:relative;">'),r.b("\n"+n),r.b('                            <input style=""  name="pageTransition" value="single" type="radio" id="pageTransition-2-radio"/>'),r.b("\n"+n),r.b('                            <label style="" for="pageTransition-2-radio" class="underlinedLabel">'),r.b("\n"+n),r.b("                                "),r.b(r.v(r.d("strings.i18n_page_transition_slide",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b("                        "),r.b("\n"+n),r.b('                        <div role="radio" id="pageTransition-3-option" style="vertical-align:middle;width:15%;display:inline-block;position:relative;">'),r.b("\n"+n),r.b('                            <input style=""  name="pageTransition" value="single" type="radio" id="pageTransition-3-radio"/>'),r.b("\n"+n),r.b('                            <label style="" for="pageTransition-3-radio" class="underlinedLabel">'),r.b("\n"+n),r.b("                                "),r.b(r.v(r.d("strings.i18n_page_transition_swoosh",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b("                        "),r.b("\n"+n),r.b('                        <div role="radio" id="pageTransition-4-option" style="vertical-align:middle;width:15%;display:inline-block;position:relative;">'),r.b("\n"+n),r.b('                            <input style=""  name="pageTransition" value="single" type="radio" id="pageTransition-4-radio"/>'),r.b("\n"+n),r.b('                            <label style="" for="pageTransition-4-radio" class="underlinedLabel">'),r.b("\n"+n),r.b("                                "),r.b(r.v(r.d("strings.i18n_page_transition_butterfly",e,t,0))),r.b("\n"+n),r.b("                            </label>"),r.b("\n"+n),r.b("                        </div>"),r.b("\n"+n),r.b("                        "),r.b("\n"+n),r.b("                        "),r.b("\n"+n),r.b("                    </div>"),r.b("\n"+n),r.b("                    "),r.b("\n"+n),r.b("                    "),r.b("\n"+n),r.b("                    </div>"),r.b("\n"+n),r.b('                    <div id="tab-keyboard" class="tab-pane" role="tabpanel">'),r.b("\n"),r.b("\n"+n),r.b('                    <div class="row" style="position:relative;">'),r.b("\n"+n),r.b("                        "),r.b("\n"+n),r.b('                        <div id="invalid_keyboard_shortcut_ALERT"></div>'),r.b("\n"+n),r.b("                        "),r.b("\n"+n),r.b('                        <ul id="keyboard-list">'),r.b("\n"+n),r.b("                        </ul>"),r.b("\n"+n),r.b("                    </div>"),r.b("\n"+n),r.b("                     </div>"),r.b("\n"+n),r.b("                </div>"),r.b("\n"+n),r.b("            </div>"),r.b("\n"+n),r.b('            <div class="modal-footer">'),r.b("\n"+n),r.b('                <button id="buttClose"  type="button" class="btn btn-default" data-dismiss="modal" title="'),r.b(r.v(r.d("strings.i18n_close",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.SettingsModalClose",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.i18n_close",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.SettingsModalClose",e,t,0))),r.b(']">'),r.b(r.v(r.d("strings.i18n_close",e,t,0))),r.b("</button>"),r.b("\n"+n),r.b('                <button id="buttSave"  type="button" class="btn btn-primary" data-dismiss="modal" title="'),r.b(r.v(r.d("strings.i18n_save_changes",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.SettingsModalSave",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.i18n_save_changes",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.SettingsModalSave",e,t,0))),r.b(']">'),r.b(r.v(r.d("strings.i18n_save_changes",e,t,0))),r.b("</button>"),r.b("\n"+n),r.b("            </div>"),r.b("\n"+n),r.b("        </div>"),r.b("\n"+n),r.b("        <!-- /.modal-content -->"),r.b("\n"+n),r.b("    </div>"),r.b("\n"+n),r.b("    <!-- /.modal-dialog -->"),r.b("\n"+n),r.b("</div>"),r.b("\n"),r.b("\n"+n),r.b('<div tabindex="-1" class="modal fade" id="custom-theme-dialog" role="dialog" aria-label="'),r.b(r.v(r.d("strings.settings",e,t,0))),r.b('"'),r.b("\n"+n),r.b('     aria-hidden="true">'),r.b("\n"),r.b("\n"+n),r.b('    <div class="modal-dialog">'),r.b("\n"+n),r.b('        <div class="modal-content">'),r.b("\n"+n),r.b('            <div class="modal-header">'),r.b("\n"+n),r.b('                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'),r.b("\n"+n),r.b("                <h5>"),r.b(r.v(r.d("strings.i18n_custom_theme",e,t,0))),r.b("</h5>"),r.b("\n"+n),r.b("            </div>"),r.b("\n"),r.b("\n"+n),r.b('            <div class="modal-body" id="custom-theme-dialog-body">'),r.b("\n"+n),r.b('                <div role="group" aria-labelledby="custom-theme-options" id="custom-theme-options" class="row">'),r.b("\n"+n),r.b('                    <button style="" type="button" id="foreground-color-btn"'),r.b("\n"+n),r.b('                            class="col-xs-8 col-xs-offset-2 theme-option-custom clickable ">'),r.b("\n"+n),r.b("                    "),r.b(r.v(r.d("strings.i18n_foreground_color_customize_theme",e,t,0))),r.b("\n"+n),r.b("                    </button>"),r.b("\n"+n),r.b('                    <button style="" type="button" id="background-color-btn"'),r.b("\n"+n),r.b('                            class="col-xs-8 col-xs-offset-2 theme-option-custom clickable">'),r.b("\n"+n),r.b("                    "),r.b(r.v(r.d("strings.i18n_background_color_customize_theme",e,t,0))),r.b("\n"+n),r.b("                    </button>"),r.b("\n"+n),r.b("                </div>"),r.b("\n"+n),r.b("            </div>"),r.b("\n"),r.b("\n"+n),r.b('            <div class="modal-footer">'),r.b("\n"+n),r.b('                <button id="Custom-Theme-Close" type="button" class="btn btn-primary" data-dismiss="modal"'),r.b("\n"+n),r.b('                        title="'),r.b(r.v(r.d("strings.ok",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.ok",e,t,0))),r.b('">'),r.b("\n"+n),r.b("                    "),r.b(r.v(r.d("strings.ok",e,t,0))),r.b("\n"+n),r.b("                </button>"),r.b("\n"+n),r.b("            </div>"),r.b("\n"+n),r.b("        </div>"),r.b("\n"+n),r.b("    </div>"),r.b("\n"+n),r.b("</div>"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/settings-keyboard-item.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.s(r.f("name",e,t,1),e,t,0,9,739,"{{ }}")&&(r.rs(e,t,function(e,t,r){r.b("<li>"),r.b("\n"+n),r.b('<label id="label_'),r.b(r.v(r.f("name",e,t,0))),r.b('">'),r.b(r.v(r.f("i18n",e,t,0))),r.b("<br/><span>"),r.b(r.v(r.f("name",e,t,0))),r.b("</span></label>"),r.b("\n"+n),r.b('<input id="'),r.b(r.v(r.f("name",e,t,0))),r.b('" name="'),r.b(r.v(r.f("name",e,t,0))),r.b('" class="keyboardInput" type="text"  placeholder="'),r.b(r.v(r.f("shortcut",e,t,0))),r.b('" value="'),r.b(r.v(r.f("shortcut",e,t,0))),r.b('" aria-labelledbyxxx="label_'),r.b(r.v(r.f("name",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.f("i18n",e,t,0))),r.b('" title="'),r.b(r.v(r.f("i18n",e,t,0))),r.b('"></input>'),r.b("\n"+n),r.b('<button class="resetKey captureKeyboardShortcut" role="button" data-key="'),r.b(r.v(r.f("name",e,t,0))),r.b('"  title="'),r.b(r.v(r.d("strings.i18n_reset_key",e,t,0))),r.b(" ("),r.b(r.v(r.f("def",e,t,0))),r.b(')" aria-label="'),r.b(r.v(r.d("strings.i18n_reset_key",e,t,0))),r.b(" ("),r.b(r.v(r.f("def",e,t,0))),r.b(')"><span aria-hidden="true">&#8855;</span></button>'),r.b("\n"+n),r.b('<span id="duplicate_keyboard_shortcut" aria-hidden="true">'),r.b(r.v(r.d("strings.i18n_duplicate_keyboard_shortcut",e,t,0))),r.b("</span>"),r.b("\n"+n),r.b('<span id="invalid_keyboard_shortcut" aria-hidden="true">'),r.b(r.v(r.d("strings.i18n_invalid_keyboard_shortcut",e,t,0))),r.b("</span>"),r.b("\n"+n),r.b("</li>"),r.b("\n"+n)}),e.pop()),r.s(r.f("name",e,t,1),e,t,1,0,0,"")||(r.b('<li id="resetAllKeys'),r.b(r.v(r.f("id",e,t,0))),r.b('" class="resetAllKeys">'),r.b("\n"+n),r.b('<button class="resetKey" role="button"  title="'),r.b(r.v(r.d("strings.i18n_reset_key_all",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_reset_key_all",e,t,0))),r.b('"><span aria-hidden="true">'),r.b(r.v(r.d("strings.i18n_reset_key_all",e,t,0))),r.b("  &#8855;</span></button>"),r.b("\n"+n),r.b("</li>"),r.b("\n"+n)),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/managed-dialog.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div class="modal fade" id="managed-dialog" tabindex="-1" role="dialog" aria-labelledby="managed-label">'),r.b("\n"+n),r.b('    <div class="modal-dialog">'),r.b("\n"+n),r.b('        <div class="modal-content">'),r.b("\n"+n),r.b('            <div class="modal-header">'),r.b("\n"+n),r.b('                <button type="button" class="close" data-dismiss="modal" aria-label="close" title="close"><span aria-hidden="true">&times;<span></button>'),r.b("\n"+n),r.b('                <h4 class="modal-title" id="managed-label"></h4>'),r.b("\n"+n),r.b("            </div>"),r.b("\n"+n),r.b('            <div class="modal-body">'),r.b("\n"+n),r.b("            </div>"),r.b("\n"+n),r.b('            <div class="modal-footer">'),r.b("\n"+n),r.b("            </div>"),r.b("\n"+n),r.b("        </div>"),r.b("\n"+n),r.b("        <!-- /.modal-content --> "),r.b("\n"+n),r.b("    </div><!-- /.modal-dialog -->"),r.b("\n"+n),r.b("</div>"),r.b("\n"+n),r.b("<!-- /.modal -->"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/progress-dialog.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div class="progress progress-striped active">'),r.b("\n"+n),r.b('  <div class="progress-bar"  role="progressbar" aria-valuenow="1" aria-valuemin="1" aria-valuemax="100" style="width: 1%">'),r.b("\n"+n),r.b('    <!-- <span class="progress-message sr-only">'),r.b(r.v(r.f("message",e,t,0))),r.b("</span> -->"),r.b("\n"+n),r.b("  </div>"),r.b("\n"+n),r.b("</div>"),r.b("\n"+n),r.b('<div class="progress-message">'),r.b(r.v(r.f("message",e,t,0))),r.b("</div>"),r.b("\n"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/managed-buttons.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.s(r.f("buttons",e,t,1),e,t,0,12,155,"{{ }}")&&(r.rs(e,t,function(e,t,r){r.b('<button type="button" class="btn btn-default '),r.s(r.f("classes",e,t,1),e,t,0,70,76,"{{ }}")&&(r.rs(e,t,function(e,t,n){n.b(n.v(n.d(".",e,t,0))),n.b(" ")}),e.pop()),r.b('" '),r.s(r.f("dismiss",e,t,1),e,t,0,102,124,"{{ }}")&&(r.rs(e,t,function(e,t,n){n.b(' data-dismiss="modal" ')}),e.pop()),r.b(">"),r.b(r.v(r.f("text",e,t,0))),r.b("</button>"),r.b("\n"+n)}),e.pop()),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("Dialogs",["hgn!templates/managed-dialog.html","hgn!templates/progress-dialog.html","hgn!templates/managed-buttons.html","i18n/Strings","workers/Messages"],function(e,t,n,r,i){var s,o,u=function(){s&&s.modal("hide")},a=function(t,n,r,i){s||(s=$(e({})),$("#app-container").append(s)),$("#managed-label").text(n),$("#managed-dialog .modal-body").empty().append(r),$("#managed-dialog .modal-footer").empty().append(i),t?$("#managed-dialog .close").show():$("#managed-dialog .close").hide(),s.is(":hidden")&&$("#managed-dialog").modal("show")};return Dialogs={showError:function(e,t){var n=r.err_unknown;switch(e){case i.ERROR_STORAGE:n=r.err_storage;break;case i.ERROR_EPUB:n=r.err_epub_corrupt;break;default:n=r.err_unknown,console.trace()}Dialogs.showModalMessage(r.err_dlg_title,n)},showModalMessage:function(e,t){var i=$("<p></p>").text(t),s=n({buttons:[{dismiss:!0,text:r.ok}]});a(!0,e,i,s)},showModalPromptEx:function(e,t,r,i){var s=$("<p></p>").text(t),o=n({buttons:r});a(!1,e,s,o);for(var u=0;u<i.length;u++)i[u]&&$("#managed-dialog ."+r[u].classes[0]).on("click",i[u])},showModalPrompt:function(e,t,n,r,i,s){var o=[{dismiss:!0,text:r,classes:["no-button"]},{dismiss:!0,text:n,classes:["yes-button","btn-primary"]}];handlers=[s,i],Dialogs.showModalPromptEx(e,t,o,handlers)},showReplaceConfirm:function(e,t,n,r,i,s,o,u){var a=[{dismiss:!0,text:r,classes:["no-button"]},{dismiss:!0,text:n,classes:["yes-button","btn-danger"]},{dismiss:!0,text:i,classes:["keep-both-button","btn-primary"]}];handlers=[o,s,u],Dialogs.showModalPromptEx(e,t,a,handlers)},showModalProgress:function(e,n){var r={message:n};o=e,a(!1,e,t(r),"")},updateProgress:function(e,t,n,s){var o="";switch(t){case i.PROGRESS_MIGRATING:o=r.migrating+" "+n;break;case i.PROGRESS_EXTRACTING:o=r.i18n_extracting+" "+n;break;case i.PROGRESS_WRITING:o=r.storing_file+" "+n;break;case i.PROGRESS_DELETING:o=r.delete_progress_message+" "+n}$("#managed-dialog .progress-bar").attr("aria-valuenow",e).css("width",e+"%"),$("#managed-dialog .progress-message").text(o)},closeModal:function(){u()},reset:function(){s&&(s.remove(),s=null)}},Dialogs}),function(e){function f(e,t){var n=e.length;while(n--)if(e[n]===t)return n;return-1}function l(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function h(e){for(t in r)r[t]=e[c[t]]}function p(e){return e.keyCode||e.charCode||e.which||e.key||0}function d(e){var t,i,o,u,l,c;t=p(e),f(a,t)==-1&&a.push(t);if(t==93||t==224)t=91;if(t in r){r[t]=!0;for(o in s)s[o]==t&&(g[o]=!0);return}h(e);if(!g.filter.call(this,e))return;if(!(t in n))return;c=x();for(u=0;u<n[t].length;u++){i=n[t][u];if(i.scope==c||i.scope=="all"){l=i.mods.length>0;for(o in r)if(!r[o]&&f(i.mods,+o)>-1||r[o]&&f(i.mods,+o)==-1)l=!1;(i.mods.length==0&&!r[16]&&!r[18]&&!r[17]&&!r[91]||l)&&i.method(e,i)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}}function v(e){var t=p(e),n,i=f(a,t);i>=0&&a.splice(i,1);if(t==93||t==224)t=91;if(t in r){r[t]=!1;for(n in s)s[n]==t&&(g[n]=!1)}}function m(){for(t in r)r[t]=!1;for(t in s)g[t]=!1}function g(e,t,r){var i,s;i=N(e),r===undefined&&(r=t,t="all");for(var o=0;o<i.length;o++)s=[],e=i[o].split("+"),e.length>1&&(s=C(e),e=[e[e.length-1]]),e=e[0],e=u(e),e in n||(n[e]=[]),n[e].push({shortcut:i[o],scope:t,method:r,key:i[o],mods:s})}function y(e,t){var r,i,s=[],o,a,f;r=N(e);for(a=0;a<r.length;a++){i=r[a].split("+"),i.length>1&&(s=C(i)),e=i[i.length-1],e=u(e),t===undefined&&(t=x());if(!n[e])return;for(o=0;o<n[e].length;o++)f=n[e][o],f.scope===t&&l(f.mods,s)&&(n[e][o]={})}}function b(e){return typeof e=="string"&&(e=u(e)),f(a,e)!=-1}function w(){return a.slice(0)}function E(e){var t=(e.target||e.srcElement).tagName;return t!="INPUT"&&t!="SELECT"&&t!="TEXTAREA"}function S(e){i=e||"all"}function x(){return i||"all"}function T(e){var t,r,i;for(t in n){r=n[t];for(i=0;i<r.length;)r[i].scope===e?r.splice(i,1):i++}}function N(e){var t;return e=e.replace(/\s/g,""),t=e.split(","),t[t.length-1]==""&&(t[t.length-2]+=","),t}function C(e){var t=e.slice(0,e.length-1);for(var n=0;n<t.length;n++)t[n]=s[t[n]];return t}function k(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,function(){n(window.event)})}function A(){var t=e.key;return e.key=L,t}var t,n={},r={16:!1,18:!1,17:!1,91:!1},i="all",s={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},o={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},u=function(e){return e.toUpperCase?o[e]||e.toUpperCase().charCodeAt(0):e},a=[];for(t=1;t<20;t++)o["f"+t]=111+t;var c={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(t in s)g[t]=!1;k(document,"keydown",function(e){d(e)}),k(document,"keyup",v),k(window,"focus",m);var L=e.key;e.key=g,e.key.setScope=S,e.key.getScope=x,e.key.deleteScope=T,e.key.filter=E,e.key.isPressed=b,e.key.getPressedKeyCodes=w,e.key.noConflict=A,e.key.unbind=y,typeof module!="undefined"&&(module.exports=g)}(this),define("keymaster",function(e){return function(){var t,n;return t||e.key}}(this)),define("Keyboard",["i18n/Strings","keymaster","storage/Settings"],function(e,t,n){var r={};void function(){function s(s,o){var u;t?u=document.createEvent("KeyboardEvent"):u=document.createEvent("Event");var a,f={};for(a in n)r(n,a)&&(f[a]=(r(o,a)&&o||n)[a]);var l=f.ctrlKey,c=f.shiftKey,h=f.altKey,p=f.metaKey,d=f.altGraphKey,v=t>3?((l?"Control":"")+(c?" Shift":"")+(h?" Alt":"")+(p?" Meta":"")+(d?" AltGraph":"")).trim():null,m=f.key+"",g=f["char"]+"",y=f.location,b=f.keyCode||(f.keyCode=m&&m.charCodeAt(0)||0),w=f.charCode||(f.charCode=g&&g.charCodeAt(0)||0),E=f.bubbles,S=f.cancelable,x=f.repeat,T=f.locale,N=e;f.which||(f.which=f.keyCode),"initKeyEvent"in u?u.initKeyEvent(s,E,S,N,l,h,c,p,b,w):t&&"initKeyboardEvent"in u?t==1?u.initKeyboardEvent(s,E,S,N,m,y,l,c,h,p,d):t==2?u.initKeyboardEvent(s,E,S,N,l,h,c,p,b,w):t==3?u.initKeyboardEvent(s,E,S,N,m,y,l,h,c,p,d):t==4?u.initKeyboardEvent(s,E,S,N,m,y,v,x,T):u.initKeyboardEvent(s,E,S,N,g,m,y,v,x,T):u.initEvent(s,E,S);for(a in n)if(r(n,a)&&u[a]!=f[a])try{delete u[a],i(u,a,{writable:!0,value:f[a]})}catch(C){}return u}var e=this,t=function(n){try{return n.initKeyboardEvent("keyup",!1,!1,e,"+",3,!0,!1,!0,!1,!1),(n["keyIdentifier"]||n["key"])=="+"&&(n["keyLocation"]||n["location"])==3&&(n.ctrlKey?n.altKey?1:3:n.shiftKey?2:4)||9}catch(r){t=0}}(document.createEvent("KeyboardEvent")),n={"char":"",key:"",location:0,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,repeat:!1,locale:"",detail:0,bubbles:!1,cancelable:!1,keyCode:0,charCode:0,which:0},r=Function.prototype.call.bind(Object.prototype.hasOwnProperty),i=Object.defineProperty||function(e,t,n){"value"in n&&(e[t]=n.value)};e.crossBrowser_initKeyboardEvent=s}.call(window),Keyboard={resetToDefaults:function(){for(prop in Keyboard.defaultOptions){if(!Keyboard.defaultOptions.hasOwnProperty(prop))continue;if(typeof Keyboard.defaultOptions[prop]!="string")continue;Keyboard[prop]=Keyboard.defaultOptions[prop]}},resetAccessKeys:function(){var e=function(e){if(!e||!e.length)return"";var t=e[e.length-1];return/^[a-z0-9]+$/i.test(t)?t:""};Keyboard.accesskeys={};for(prop in Keyboard){if(!Keyboard.hasOwnProperty(prop))continue;var t=Keyboard[prop];if(typeof t!="string")continue;Keyboard.accesskeys[prop]=e(t)}},applySettings:function(e){this.resetToDefaults();if(e&&e.keyboard)for(prop in Keyboard){if(!Keyboard.hasOwnProperty(prop))continue;if(typeof Keyboard[prop]!="string")continue;if(typeof e.keyboard[prop]!="string")continue;Keyboard[prop]=e.keyboard[prop]}this.resetAccessKeys()},dispatch:function(e,t){if(t.cancelBubble)return;if(t.defaultPrevented)return;if(typeof t.returnValue!="undefined"&&!t.returnValue)return;var n=t.srcElement||t.target;if(n){var r=n;while(r){var i=r.nodeName;if(i==="input"||i==="textarea")return;if(r.getAttribute){var s=r.getAttribute("contenteditable");if(s==="true"||s==="contenteditable")return}if(r.classList&&r.classList.contains("keyboard-input"))return;r=r.parentNode}}var o=crossBrowser_initKeyboardEvent(t.type,{bubbles:!0,cancelable:!1,keyCode:t.keyCode,charCode:t.charCode,which:t.which,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey,"char":t.char?t.char:String.fromCharCode(t.charCode),key:t.key?t.key:t.keyCode});e.dispatchEvent(o)},scope:function(e){e||alert("!SCOPE ACTIVATE!"),t.setScope(e)},on:function(e,n,i){e||console.error("!KEYS!"),r.hasOwnProperty(n)||(r[n]=[]),r[n].push(e),t.unbind(e,n),t(e,n,function(){$(document.body).addClass("keyboard"),i()})},off:function(e){e||alert("!SCOPE OFF!");if(!r.hasOwnProperty(e))return;for(k in r[e])t.unbind(k,e)},i18n:{AddEpubDialog:e.add_epub_dialog,AboutDialog:e.about,ListViewThumbnailViewToggle:e.list_view_thumbnail_view_toggle,ShowSettingsModal:e.settings,SettingsModalSave:e.settings+" - "+e.i18n_save_changes,SettingsModalClose:e.settings+" - "+e.i18n_close,PagePrevious:e.i18n_page_previous,PageNext:e.i18n_page_next,PagePreviousAlt:e.i18n_page_previous+" (access key)",PageNextAlt:e.i18n_page_next+" (access key)",ToolbarShow:e.i18n_toolbar_show,ToolbarHide:e.i18n_toolbar_hide,FullScreenToggle:e.enter_fullscreen+" / "+e.exit_fullscreen,SwitchToLibrary:e.view_library,TocShowHideToggle:e.toc,MetadataDialog:e.i18n_show_metadata_dialog,NightTheme:e.i18n_arabian_nights,MediaOverlaysPlayPause:e.i18n_audio_play+" / "+e.i18n_audio_pause,MediaOverlaysPrevious:e.i18n_audio_previous,MediaOverlaysNext:e.i18n_audio_next,MediaOverlaysEscape:e.i18n_audio_esc,MediaOverlaysRateIncrease:e.i18n_audio_rate_increase,MediaOverlaysRateDecrease:e.i18n_audio_rate_decrease,MediaOverlaysRateReset:e.i18n_audio_rate_reset,MediaOverlaysVolumeIncrease:e.i18n_audio_volume_increase,MediaOverlaysVolumeDecrease:e.i18n_audio_volume_decrease,MediaOverlaysVolumeMuteToggle:e.i18n_audio_mute+" / "+e.i18n_audio_unmute,MediaOverlaysAdvancedPanelShowHide:e.i18n_audio_expand,BackgroundAudioPlayPause:e.i18n_audio_play_background+" / "+e.i18n_audio_pause_background},defaultOptions:{},accesskeys:{},MetadataDialog:"z",AboutDialog:"e",AddEpubDialog:"p",ListViewThumbnailViewToggle:"f",ShowSettingsModal:"o",SettingsModalSave:"s",SettingsModalClose:"c",PagePrevious:"left",PageNext:"right",PagePreviousAlt:"1",PageNextAlt:"2",ToolbarShow:"v",ToolbarHide:"x",FullScreenToggle:"h",SwitchToLibrary:"b",TocShowHideToggle:"t",NightTheme:"n",MediaOverlaysEscape:"r",MediaOverlaysPlayPause:"m",MediaOverlaysRateIncrease:"l",MediaOverlaysRateDecrease:"j",MediaOverlaysRateReset:"k",MediaOverlaysVolumeIncrease:"w",MediaOverlaysVolumeDecrease:"q",MediaOverlaysVolumeMuteToggle:"a",MediaOverlaysPrevious:"y",MediaOverlaysNext:"u",MediaOverlaysAdvancedPanelShowHide:"g",BackgroundAudioPlayPause:"d"};try{Keyboard.defaultOptions={};for(prop in Keyboard){if(!Keyboard.hasOwnProperty(prop))continue;if(typeof Keyboard[prop]!="string")continue;Keyboard.defaultOptions[prop]=Keyboard[prop]}Keyboard.resetAccessKeys()}catch(i){console.error(i)}return Keyboard}),define("ReaderSettingsDialog_Keyboard",["hgn!templates/settings-keyboard-item.html","i18n/Strings","Dialogs","storage/Settings","Keyboard"],function(e,t,n,r,i){var s=function(e,n){var r=!1,i=!1,s=$("#keyboard-list"),u=s.hasClass("atLeastOneInvalidOrDuplicateShortcut");s.removeClass("atLeastOneInvalidOrDuplicateShortcut");var a=$("#invalid_keyboard_shortcut_ALERT")[0];a.removeAttribute("role"),a.removeAttribute("aria-live"),a.removeAttribute("aria-atomic");while(a.firstChild)a.removeChild(a.firstChild);var f=!1,l=$(".keyboardInput");l.each(function(){var t=$(this);t.parent().removeClass("duplicateShortcut"),t[0].removeAttribute("aria-invalid"),o(t,n),t.parent().hasClass("invalidShortcut")&&(t[0].setAttribute("aria-invalid","true"),i=!0,e&&e.length&&e[0]===t[0]&&(f=!0))});var c=!1;for(var h=0;h<2;h++)l.each(function(){var t=$(this),n=t.parent().hasClass("invalidShortcut"),i=t.parent().hasClass("duplicateShortcut"),s=t.attr("placeholder"),o=n||i?s:t.attr("data-val");if(i)return!0;l.each(function(){var n=$(this);if(n[0]===t[0])return!0;var i=n.attr("placeholder"),s=n.parent().hasClass("invalidShortcut"),u=n.parent().hasClass("duplicateShortcut"),a=s||u?i:n.attr("data-val");o===a&&(r=!0,e&&e.length&&(e[0]===t[0]||e[0]===n[0])&&(c=!0),t[0].setAttribute("aria-invalid","true"),n[0].setAttribute("aria-invalid","true"),n.parent().hasClass("duplicateShortcut")||n.parent().addClass("duplicateShortcut"),t.parent().hasClass("duplicateShortcut")||t.parent().addClass("duplicateShortcut"))})});if(r||i){s.addClass("atLeastOneInvalidOrDuplicateShortcut");if(f||c){u?a.setAttribute("aria-live","polite"):a.setAttribute("role","alert"),a.setAttribute("aria-atomic","true");var p=document.createTextNode(f?t.i18n_invalid_keyboard_shortcut:t.i18n_duplicate_keyboard_shortcut);a.appendChild(p),a.style.visibility="hidden",a.style.visibility="visible"}}},o=function(e,t){e.parent().removeClass("invalidShortcut"),e.attr("data-val",e.val());var n=e.val().toLowerCase().trim(),r=!1,i=!1,s=!1;n.indexOf("shift")>=0&&(r=!0),n.indexOf("ctrl")>=0&&(i=!0),n.indexOf("alt")>=0&&(s=!0);var o=n.lastIndexOf("+")===n.length-1;n=n.replace(/shift/g,""),n=n.replace(/ctrl/g,""),n=n.replace(/alt/g,""),n=n.replace(/\+/g,""),n=n.replace(/\s/g,""),n=n.trim(),o&&(n+="+");if(n.match(/^[0-9A-Za-z]$/)||n.match(/^backspace$/)||n.match(/^space$/)||n.match(/^return$/)||n.match(/^enter$/)||n.match(/^left$/)||n.match(/^right$/)||n.match(/^up$/)||n.match(/^down$/)){var u=(r?"shift + ":"")+(i?"ctrl + ":"")+(s?"alt + ":"")+n;e.attr("data-val",u),t||e.val(u)}else e.parent().addClass("invalidShortcut")},u=function(){var n=$("#keyboard-list");n.empty(),n.append(e({strings:t,id:"TOP"}));for(prop in i){if(!i.hasOwnProperty(prop))continue;if(typeof i[prop]!="string")continue;n.append(e({strings:t,keyboard:i,name:prop,shortcut:i[prop],i18n:i.i18n[prop],def:i.defaultOptions[prop]}))}n.append(e({strings:t,id:"BOTTOM"})),s();var r=undefined;$(".keyboardInput").on("blur",function(e){var t=$(this);r=undefined,s()}),$(".keyboardInput").on("focus",function(e){var t=$(this);s(t,!0)});var o=_.bind(_.debounce(s,700),this);$(".keyboardInput").on("keyup",function(){var e=$(this),t=e.val();t!==r&&o(e,!0),r=t}),$(".resetKey").on("click",function(){$that=$(this);var e=$that.attr("data-key");if(e){var t=$("input#"+e);t.val(i.defaultOptions[e])}else $(".resetKey[data-key]").each(function(){var e=$(this),t=e.attr("data-key");if(t){var n=$("input#"+t);n.val(i.defaultOptions[t])}});s()})},a=function(){var e=!1,r={};return s(),$(".keyboardInput").each(function(){var t=$(this),n=t.attr("placeholder"),s=t.attr("id"),o=t.attr("data-val");if(t.parent().hasClass("invalidShortcut")||t.parent().hasClass("duplicateShortcut"))o=n;if(!o.length)return!0;o=o.toLowerCase(),n!==o&&(e=!0),o!==i.defaultOptions[s]&&(r[s]=o)}),e&&n.showModalMessage("Readium - "+t.i18n_keyboard_shortcuts,t.i18n_keyboard_reload),r};return{initKeyboardList:u,saveKeys:a}}),function(e){var t=function(){var t='<div class="colpick"><div class="colpick_color"><div class="colpick_color_overlay1"><div class="colpick_color_overlay2"><div class="colpick_selector_outer"><div class="colpick_selector_inner"></div></div></div></div></div><div class="colpick_hue"><div class="colpick_hue_arrs"><div class="colpick_hue_larr"></div><div class="colpick_hue_rarr"></div></div></div><div class="colpick_new_color"></div><div class="colpick_current_color"></div><div class="colpick_hex_field"><div class="colpick_field_letter">#</div><input type="text" maxlength="6" size="6" /></div><div class="colpick_rgb_r colpick_field"><div class="colpick_field_letter">R</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_g colpick_field"><div class="colpick_field_letter">G</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_h colpick_field"><div class="colpick_field_letter">H</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_s colpick_field"><div class="colpick_field_letter">S</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_submit"></div></div>',n={showEvent:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},colorScheme:"light",color:"3289c7",livePreview:!0,flat:!1,layout:"full",submit:1,submitText:"OK",height:156},o=function(t,n){var r=s(t);e(n).data("colpick").fields.eq(1).val(r.r).end().eq(2).val(r.g).end().eq(3).val(r.b).end()},a=function(t,n){e(n).data("colpick").fields.eq(4).val(Math.round(t.h)).end().eq(5).val(Math.round(t.s)).end().eq(6).val(Math.round(t.b)).end()},f=function(t,n){e(n).data("colpick").fields.eq(0).val(u(t))},l=function(t,n){e(n).data("colpick").selector.css("backgroundColor","#"+u({h:t.h,s:100,b:100})),e(n).data("colpick").selectorIndic.css({left:parseInt(e(n).data("colpick").height*t.s/100,10),top:parseInt(e(n).data("colpick").height*(100-t.b)/100,10)})},c=function(t,n){e(n).data("colpick").hue.css("top",parseInt(e(n).data("colpick").height-e(n).data("colpick").height*t.h/360,10))},h=function(t,n){e(n).data("colpick").currentColor.css("backgroundColor","#"+u(t))},p=function(t,n){e(n).data("colpick").newColor.css("backgroundColor","#"+u(t))},d=function(t){var n=e(this).parent().parent(),h;this.parentNode.className.indexOf("_hex")>0?(n.data("colpick").color=h=r(_(this.value)),o(h,n.get(0)),a(h,n.get(0))):this.parentNode.className.indexOf("_hsb")>0?(n.data("colpick").color=h=O({h:parseInt(n.data("colpick").fields.eq(4).val(),10),s:parseInt(n.data("colpick").fields.eq(5).val(),10),b:parseInt(n.data("colpick").fields.eq(6).val(),10)}),o(h,n.get(0)),f(h,n.get(0))):(n.data("colpick").color=h=i(M({r:parseInt(n.data("colpick").fields.eq(1).val(),10),g:parseInt(n.data("colpick").fields.eq(2).val(),10),b:parseInt(n.data("colpick").fields.eq(3).val(),10)})),f(h,n.get(0)),a(h,n.get(0))),l(h,n.get(0)),c(h,n.get(0)),p(h,n.get(0)),n.data("colpick").onChange.apply(n.parent(),[h,u(h),s(h),n.data("colpick").el,0])},v=function(t){e(this).parent().removeClass("colpick_focus")},m=function(){e(this).parent().parent().data("colpick").fields.parent().removeClass("colpick_focus"),e(this).parent().addClass("colpick_focus")},g=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var n=e(this).parent().find("input").focus(),r={el:e(this).parent().addClass("colpick_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:t.pageY,field:n,val:parseInt(n.val(),10),preview:e(this).parent().parent().data("colpick").livePreview};e(document).mouseup(r,b),e(document).mousemove(r,y)},y=function(e){return e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val-e.pageY+e.data.y,10)))),e.data.preview&&d.apply(e.data.field.get(0),[!0]),!1},b=function(t){return d.apply(t.data.field.get(0),[!0]),t.data.el.removeClass("colpick_slider").find("input").focus(),e(document).off("mouseup",b),e(document).off("mousemove",y),!1},w=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var n={cal:e(this).parent(),y:e(this).offset().top};e(document).on("mouseup touchend",n,S),e(document).on("mousemove touchmove",n,E);var r=t.type=="touchstart"?t.originalEvent.changedTouches[0].pageY:t.pageY;return d.apply(n.cal.data("colpick").fields.eq(4).val(parseInt(360*(n.cal.data("colpick").height-(r-n.y))/n.cal.data("colpick").height,10)).get(0),[n.cal.data("colpick").livePreview]),!1},E=function(e){var t=e.type=="touchmove"?e.originalEvent.changedTouches[0].pageY:e.pageY;return d.apply(e.data.cal.data("colpick").fields.eq(4).val(parseInt(360*(e.data.cal.data("colpick").height-Math.max(0,Math.min(e.data.cal.data("colpick").height,t-e.data.y)))/e.data.cal.data("colpick").height,10)).get(0),[e.data.preview]),!1},S=function(t){return o(t.data.cal.data("colpick").color,t.data.cal.get(0)),f(t.data.cal.data("colpick").color,t.data.cal.get(0)),e(document).off("mouseup touchend",S),e(document).off("mousemove touchmove",E),!1},x=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var n={cal:e(this).parent(),pos:e(this).offset()};n.preview=n.cal.data("colpick").livePreview,e(document).on("mouseup touchend",n,N),e(document).on("mousemove touchmove",n,T);var r,i;return t.type=="touchstart"?(pageX=t.originalEvent.changedTouches[0].pageX,i=t.originalEvent.changedTouches[0].pageY):(pageX=t.pageX,i=t.pageY),d.apply(n.cal.data("colpick").fields.eq(6).val(parseInt(100*(n.cal.data("colpick").height-(i-n.pos.top))/n.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*(pageX-n.pos.left)/n.cal.data("colpick").height,10)).get(0),[n.preview]),!1},T=function(e){var t,n;return e.type=="touchmove"?(pageX=e.originalEvent.changedTouches[0].pageX,n=e.originalEvent.changedTouches[0].pageY):(pageX=e.pageX,n=e.pageY),d.apply(e.data.cal.data("colpick").fields.eq(6).val(parseInt(100*(e.data.cal.data("colpick").height-Math.max(0,Math.min(e.data.cal.data("colpick").height,n-e.data.pos.top)))/e.data.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(e.data.cal.data("colpick").height,pageX-e.data.pos.left))/e.data.cal.data("colpick").height,10)).get(0),[e.data.preview]),!1},N=function(t){return o(t.data.cal.data("colpick").color,t.data.cal.get(0)),f(t.data.cal.data("colpick").color,t.data.cal.get(0)),e(document).off("mouseup touchend",N),e(document).off("mousemove touchmove",T),!1},C=function(t){var n=e(this).parent(),r=n.data("colpick").color;n.data("colpick").origColor=r,h(r,n.get(0)),n.data("colpick").onSubmit(r,u(r),s(r),n.data("colpick").el)},k=function(t){t.stopPropagation();var n=e("#"+e(this).data("colpickId"));n.data("colpick").onBeforeShow.apply(this,[n.get(0)]);var r=e(this).offset(),i=r.top+this.offsetHeight,s=r.left,o=A(),u=n.width();s+u>o.l+o.w&&(s-=u),n.css({left:s+"px",top:i+"px"}),n.data("colpick").onShow.apply(this,[n.get(0)])!=0&&n.show(),e("html").mousedown({cal:n},L),n.mousedown(function(e){e.stopPropagation()})},L=function(t){t.data.cal.data("colpick").onHide.apply(this,[t.data.cal.get(0)])!=0&&t.data.cal.hide(),e("html").off("mousedown",L)},A=function(){var e=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth)}},O=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},M=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},_=function(e){var t=6-e.length;if(t>0){var n=[];for(var r=0;r<t;r++)n.push("0");n.push(e),e=n.join("")}return e},D=function(){var t=e(this).parent(),n=t.data("colpick").origColor;t.data("colpick").color=n,o(n,t.get(0)),f(n,t.get(0)),a(n,t.get(0)),l(n,t.get(0)),c(n,t.get(0)),p(n,t.get(0))};return{init:function(s){s=e.extend({},n,s||{});if(typeof s.color=="string")s.color=r(s.color);else if(s.color.r!=undefined&&s.color.g!=undefined&&s.color.b!=undefined)s.color=i(s.color);else{if(s.color.h==undefined||s.color.s==undefined||s.color.b==undefined)return this;s.color=O(s.color)}return this.each(function(){if(!e(this).data("colpickId")){var n=e.extend({},s);n.origColor=s.color;var r="collorpicker_"+parseInt(Math.random()*1e3);e(this).data("colpickId",r);var i=e(t).attr("id",r);i.addClass("colpick_"+n.layout+(n.submit?"":" colpick_"+n.layout+"_ns")),n.colorScheme!="light"&&i.addClass("colpick_"+n.colorScheme),i.find("div.colpick_submit").html(n.submitText).click(C),n.fields=i.find("input").change(d).blur(v).focus(m),i.find("div.colpick_field_arrs").mousedown(g).end().find("div.colpick_current_color").click(D),n.selector=i.find("div.colpick_color").on("mousedown touchstart",x),n.selectorIndic=n.selector.find("div.colpick_selector_outer"),n.el=this,n.hue=i.find("div.colpick_hue_arrs"),huebar=n.hue.parent();var u=navigator.userAgent.toLowerCase(),y=navigator.appName==="Microsoft Internet Explorer",b=y?parseFloat(u.match(/msie ([0-9]{1,}[\.0-9]{0,})/)[1]):0,E=y&&b<10,S=["#ff0000","#ff0080","#ff00ff","#8000ff","#0000ff","#0080ff","#00ffff","#00ff80","#00ff00","#80ff00","#ffff00","#ff8000","#ff0000"];if(E){var T,N;for(T=0;T<=11;T++)N=e("<div></div>").attr("style","height:8.333333%; filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr="+S[T]+", endColorstr="+S[T+1]+'); -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='+S[T]+", endColorstr="+S[T+1]+')";'),huebar.append(N)}else stopList=S.join(","),huebar.attr("style","background:-webkit-linear-gradient(top,"+stopList+"); background: -o-linear-gradient(top,"+stopList+"); background: -ms-linear-gradient(top,"+stopList+"); background:-moz-linear-gradient(top,"+stopList+"); -webkit-linear-gradient(top,"+stopList+"); background:linear-gradient(to bottom,"+stopList+"); ");i.find("div.colpick_hue").on("mousedown touchstart",w),n.newColor=i.find("div.colpick_new_color"),n.currentColor=i.find("div.colpick_current_color"),i.data("colpick",n),o(n.color,i.get(0)),a(n.color,i.get(0)),f(n.color,i.get(0)),c(n.color,i.get(0)),l(n.color,i.get(0)),h(n.color,i.get(0)),p(n.color,i.get(0)),n.flat?(i.appendTo(this).show(),i.css({position:"relative",display:"block"})):(i.appendTo(document.body),e(this).on(n.showEvent,k),i.css({position:"absolute"}))}})},showPicker:function(){return this.each(function(){e(this).data("colpickId")&&k.apply(this)})},hidePicker:function(){return this.each(function(){e(this).data("colpickId")&&e("#"+e(this).data("colpickId")).hide()})},setColor:function(t,n){n=typeof n=="undefined"?1:n;if(typeof t=="string")t=r(t);else if(t.r!=undefined&&t.g!=undefined&&t.b!=undefined)t=i(t);else{if(t.h==undefined||t.s==undefined||t.b==undefined)return this;t=O(t)}return this.each(function(){if(e(this).data("colpickId")){var r=e("#"+e(this).data("colpickId"));r.data("colpick").color=t,r.data("colpick").origColor=t,o(t,r.get(0)),a(t,r.get(0)),f(t,r.get(0)),c(t,r.get(0)),l(t,r.get(0)),p(t,r.get(0)),r.data("colpick").onChange.apply(r.parent(),[t,u(t),s(t),r.data("colpick").el,1]),n&&h(t,r.get(0))}})}}}(),n=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(e&65280)>>8,b:e&255}},r=function(e){return i(n(e))},i=function(e){var t={h:0,s:0,b:0},n=Math.min(e.r,e.g,e.b),r=Math.max(e.r,e.g,e.b),i=r-n;return t.b=r,t.s=r!=0?255*i/r:0,t.s!=0?e.r==r?t.h=(e.g-e.b)/i:e.g==r?t.h=2+(e.b-e.r)/i:t.h=4+(e.r-e.g)/i:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},s=function(e){var t={},n=e.h,r=e.s*255/100,i=e.b*255/100;if(r==0)t.r=t.g=t.b=i;else{var s=i,o=(255-r)*i/255,u=(s-o)*(n%60)/60;n==360&&(n=0),n<60?(t.r=s,t.b=o,t.g=o+u):n<120?(t.g=s,t.b=o,t.r=s-u):n<180?(t.g=s,t.r=o,t.b=o+u):n<240?(t.b=s,t.r=o,t.g=s-u):n<300?(t.b=s,t.g=o,t.r=o+u):n<360?(t.r=s,t.g=o,t.b=s-u):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},o=function(t){var n=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return e.each(n,function(e,t){t.length==1&&(n[e]="0"+t)}),n.join("")},u=function(e){return o(s(e))};e.fn.extend({colpick:t.init,colpickHide:t.hidePicker,colpickShow:t.showPicker,colpickSetColor:t.setColor}),e.extend({colpick:{rgbToHex:o,rgbToHsb:i,hsbToHex:u,hsbToRgb:s,hexToHsb:r,hexToRgb:n}})}(jQuery),define("colpick",function(){}),define("ReaderSettingsDialog",["hgn!templates/settings-dialog.html","ReaderSettingsDialog_Keyboard","i18n/Strings","Dialogs","storage/Settings","Keyboard","colpick","bootstrap"],function(e,t,n,r,i,s){function d(){localStorage.tempThemeColor={color:$previewText.css("color"),backgroundColor:$previewText.css("background-color")}}function v(){localStorage.removeItem("tempThemeColor")}function m(){return localStorage.hasOwnProperty("tempThemeColor")}var o={fontSize:100,syntheticSpread:"auto",scroll:"auto",columnGap:60},u=function(e){var t=e.theme==="author-theme",n=$(".preview-text");a(n,e);var r=window.getComputedStyle(n[0]),i=[{selector:"body",declarations:{backgroundColor:t?"":r.backgroundColor,color:t?"":r.color}}];return i},a=function(e,t){var n=e.attr("data-theme"),r=t.theme;e.removeClass(n),e.addClass(r),e.attr("data-theme",r),l(r)?f(e,t):(e.css("color","").css("background-color",""),v())},f=function(e,t){e.css("color",t.themeColor.color),e.css("background-color",t.themeColor.backgroundColor)},l=function(e){return e=="custom-theme"},c=function(e,t){e.updateSettings(t);if(t.theme){$("html").attr("data-theme",t.theme);var n=u(t);e.setBookStyles(n),$("#reading-area").css(n[0].declarations)}},h=function(e,t,n,r){e.attr("aria-valuenow",t+""),e.attr("aria-value-now",t+""),e.attr("aria-valuetext",n+""),e.attr("aria-value-text",n+""),e.attr("title",r+" "+n),e.attr("aria-label",r+" "+n)},p=function(){function e(e){function t(e){return("0"+parseInt(e).toString(16)).slice(-2)}return e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/),"#"+t(e[1])+t(e[2])+t(e[3])}function t(e){return e[0]=="#"&&(e=e.substring(1)),parseInt(e,16)>8388607.5?"black":"white"}$("#custom-theme-radio-div").on("click",function(){$("#settings-dialog").modal("hide"),$("#custom-theme-dialog").modal("show")}),$("#custom-theme-dialog").on("hidden.bs.modal",function(){$("#settings-dialog").modal("show")}),$("#custom-theme-dialog").on("hide.bs.modal",function(){$("#background-color-btn").colpickHide(),$("#foreground-color-btn").colpickHide(),$("#tab-style").prepend($("#theme-preview")),$previewText.attr("data-theme","custom-theme"),$("#custom-theme-radio").prop("checked",!0),d()}),$("#custom-theme-dialog").on("show.bs.modal",function(){$("#custom-theme-dialog-body").prepend($("#theme-preview"));var t=$("#custom-theme-radio-div").css("color"),n=$("#custom-theme-radio-div").css("background-color");$("#foreground-color-btn").colpickSetColor(e(t)),$("#background-color-btn").colpickSetColor(e(n))}),$("#background-color-btn").colpick({layout:"hex",submit:0,colorScheme:"light",onChange:function(e,n,r,i,s){n="#"+n,$(i).css("color",t(n)).css("background-color",n),$("#custom-theme-radio-div").css("background-color",n),$(".preview-text").css("background-color",n)}}),$("#foreground-color-btn").colpick({layout:"hex",submit:0,colorScheme:"light",onChange:function(e,n,r,i,s){$(i).css("background-color","#"+n),n="#"+n,$(i).css("color",t(n)).css("background-color",n),$("#custom-theme-radio-div").css("color",n),$(".preview-text").css("color",n)}})},g=function(u){$("#app-container").append(e({strings:n,dialogs:r,keyboard:s})),$previewText=$(".preview-text"),$("[id*=theme-radio-div]").on("click",function(){$(this).children().first().prop("checked",!0);var e=$(this).children().first().val();l(e)||a($previewText,{theme:e})});var d=$("#margin-size-input");d.on("change",function(){var e=d.val();h(d,e,e+"px",n.i18n_margins)});var g=$("#font-size-input");g.on("change",function(){var e=g.val();$previewText.css({fontSize:e/100+"em"}),h(g,e,e+"%",n.i18n_font_size)}),$("#tab-butt-main").on("click",function(){$("#tab-keyboard").attr("aria-expanded","false"),$("#tab-main").attr("aria-expanded","true")}),$("#tab-butt-keys").on("click",function(){$("#tab-main").attr("aria-expanded","false"),$("#tab-keyboard").attr("aria-expanded","true")}),$("#buttSave").on("keydown",function(e){e.which===9&&!(e.shiftKey|e.ctrlKey|e.metaKey|e.altKey)&&(e.preventDefault(),$("#closeSettingsCross").focus())}),$("#closeSettingsCross").on("keydown",function(e){e.which===9&&e.shiftKey&&(e.preventDefault(),$("#buttSave").focus())}),$("#settings-dialog").on("hide.bs.modal",function(){setTimeout(function(){$("#keyboard-list").empty()},500)}),$("#settings-dialog").on("show.bs.modal",function(){$("#tab-butt-main").trigger("click"),t.initKeyboardList(),setTimeout(function(){$("#closeSettingsCross")[0].focus()},1e3),i.get("reader",function(e){e=e||o;for(prop in o)o.hasOwnProperty(prop)&&!e.hasOwnProperty(prop)&&!e[prop]&&(e[prop]=o[prop]);g.val(e.fontSize),h(g,e.fontSize,e.fontSize+"%",n.i18n_font_size),d.val(e.columnGap),h(d,e.columnGap,e.columnGap+"px",n.i18n_margins),e.syntheticSpread=="double"?$("#two-up-option input").prop("checked",!0):e.syntheticSpread=="single"?$("#one-up-option input").prop("checked",!0):$("#spread-default-option input").prop("checked",!0),e.scroll=="scroll-doc"?$("#scroll-doc-option input").prop("checked",!0):e.scroll=="scroll-continuous"?$("#scroll-continuous-option input").prop("checked",!0):$("#scroll-default-option input").prop("checked",!0),e.pageTransition===0?$("#pageTransition-1-option input").prop("checked",!0):e.pageTransition===1?$("#pageTransition-2-option input").prop("checked",!0):e.pageTransition===2?$("#pageTransition-3-option input").prop("checked",!0):e.pageTransition===3?$("#pageTransition-4-option input").prop("checked",!0):$("#pageTransition-none-option input").prop("checked",!0),e.theme?m()||(a($previewText,e),f($("#custom-theme-radio-div"),e),$("#"+e.theme+"-radio").prop("checked",!0)):$("#author-theme-radio").prop("checked",!0),$previewText.css({fontSize:e.fontSize/100+"em"})})});var y=function(){var e={fontSize:Number(g.val()),syntheticSpread:"auto",columnGap:Number(d.val()),scroll:"auto"};$("#scroll-doc-option input").prop("checked")?e.scroll="scroll-doc":$("#scroll-continuous-option input").prop("checked")&&(e.scroll="scroll-continuous"),$("#two-up-option input").prop("checked")?e.syntheticSpread="double":$("#one-up-option input").prop("checked")&&(e.syntheticSpread="single"),$("#pageTransition-1-option input").prop("checked")?e.pageTransition=0:$("#pageTransition-2-option input").prop("checked")?e.pageTransition=1:$("#pageTransition-3-option input").prop("checked")?e.pageTransition=2:$("#pageTransition-4-option input").prop("checked")?e.pageTransition=3:e.pageTransition=-1,e.theme=$previewText.attr("data-theme"),l(e.theme)?e.themeColor={color:$previewText.css("color"),backgroundColor:$previewText.css("background-color")}:e.themeColor={color:"black",backgroundColor:"white"},u&&c(u,e);var n=t.saveKeys();i.get("reader",function(t){t||(t={});for(prop in e)e.hasOwnProperty(prop)&&(t[prop]=e[prop]);t.keyboard=n,i.put("reader",t),setTimeout(function(){s.applySettings(t)},100)})};s.on(s.NightTheme,"settings",function(){i.get("reader",function(e){e||(e={});var t=e.theme==="night-theme";e.theme=t?"author-theme":"night-theme",i.put("reader",e),u&&c(u,e)})}),s.on(s.SettingsModalSave,"settings",function(){y(),$("#settings-dialog").modal("hide")}),s.on(s.SettingsModalClose,"settings",function(){$("#settings-dialog").modal("hide")}),$("#settings-dialog .btn-primary").on("click",y),v(),p()};return{initDialog:g,updateReader:c,defaultSettings:o}}),define("analytics/Analytics",[],function(){return{trackView:function(){},sendEvent:function(){}}}),define("text!viewer-version",[],function(){return'{"version":"0.16.0","chromeVersion":"2.16.0","sha":"8017279232dd729268b9879864a101ce9b2bdbce","tag":"0.16.0-157-g8017279","clean":false,"release":false,"timestamp":1417776595076}'}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return t.length===0&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]==null&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=O(e[o],t[o],n,r)))break}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&O(e[c],t[c],n,r)))break}if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:new RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(e==null)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(e){return function(){var t,n;return t||e._}}(this)),function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="0.9.10";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=/\s+/,f=function(e,t,n,r){if(!n)return!0;if(typeof n=="object")for(var i in n)e[t].apply(e,[i,n[i]].concat(r));else{if(!a.test(n))return!0;var s=n.split(a);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r))}},l=function(e,t){var n,r=-1,i=e.length;switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0]);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0],t[1]);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0],t[1],t[2]);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},c=o.Events={on:function(e,t,n){if(!f(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!f(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n),this},off:function(e,t,n){var r,i,s,o,a,l,c,h;if(!this._events||!f(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events);for(a=0,l=o.length;a<l;a++){e=o[a];if(r=this._events[e]){s=[];if(t||n)for(c=0,h=r.length;c<h;c++)i=r[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&s.push(i);this._events[e]=s}}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!f(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&l(n,t),r&&l(r,arguments),this},listenTo:function(e,t,n){var r=this._listeners||(this._listeners={}),i=e._listenerId||(e._listenerId=u.uniqueId("l"));return r[i]=e,e.on(t,typeof t=="object"?this:n,this),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return;if(e)e.off(t,typeof t=="object"?this:n,this),!t&&!n&&delete r[e._listenerId];else{typeof t=="object"&&(n=this);for(var i in r)r[i].off(t,n,this);this._listeners={}}return this}};c.bind=c.on,c.unbind=c.off,u.extend(o,c);var h=o.Model=function(e,t){var n,r=e||{};this.cid=u.uniqueId("c"),this.attributes={},t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(r=this.parse(r,t)||{});if(n=u.result(this,"defaults"))r=u.defaults({},r,n);this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};u.extend(h.prototype,c,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,s,o,a,f,l,c;if(e==null)return this;typeof e=="object"?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,a=n.silent,o=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=u.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],u.isEqual(c[r],t)||o.push(r),u.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete c[r]:c[r]=t;if(!a){o.length&&(this._pending=!0);for(var h=0,p=o.length;h<p;h++)this.trigger("change:"+o[h],this,c[o[h]],n)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success;return e.success=function(e,n,r){if(!e.set(e.parse(n,r),r))return!1;t&&t(e,n,r)},this.sync("read",this,e)},save:function(e,t,n){var r,i,s,o,a=this.attributes;return e==null||typeof e=="object"?(r=e,n=t):(r={})[e]=t,r&&(!n||!n.wait)&&!this.set(r,n)?!1:(n=u.extend({validate:!0},n),this._validate(r,n)?(r&&n.wait&&(this.attributes=u.extend({},a,r)),n.parse===void 0&&(n.parse=!0),i=n.success,n.success=function(e,t,n){e.attributes=a;var s=e.parse(t,n);n.wait&&(s=u.extend(r||{},s));if(u.isObject(s)&&!e.set(s,n))return!1;i&&i(e,t,n)},s=this.isNew()?"create":n.patch?"patch":"update",s==="patch"&&(n.attrs=r),o=this.sync(s,this,n),r&&n.wait&&(this.attributes=a),o):!1)},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(e,t,i){(i.wait||e.isNew())&&r(),n&&n(e,t,i)};if(this.isNew())return e.success(this,null,e),!1;var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||M();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return!this.validate||!this.validate(this.attributes,e)},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,t||{}),!1):!0}});var p=o.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this.models=[],this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))};u.extend(p.prototype,c,{model:h,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,i,o,a,f,l,c,h,p,d;c=[],h=t.at,p=this.comparator&&h==null&&t.sort!=0,d=u.isString(this.comparator)?this.comparator:null;for(n=0,i=e.length;n<i;n++){if(!(o=this._prepareModel(a=e[n],t))){this.trigger("invalid",this,a,t);continue}if(f=this.get(o)){t.merge&&(f.set(a===o?o.attributes:a,t),p&&!l&&f.hasChanged(d)&&(l=!0));continue}c.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,o.id!=null&&(this._byId[o.id]=o)}c.length&&(p&&(l=!0),this.length+=c.length,h!=null?s.apply(this.models,[h,0].concat(c)):r.apply(this.models,c)),l&&this.sort({silent:!0});if(t.silent)return this;for(n=0,i=c.length;n<i;n++)(o=c[n]).trigger("add",o,this,t);return l&&this.trigger("sort",this,t),this},remove:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s;for(n=0,r=e.length;n<r;n++){s=this.get(e[n]);if(!s)continue;delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:(this._idAttr||(this._idAttr=this.model.prototype.idAttribute),this._byId[e.id||e.cid||e[this._idAttr]||e])},at:function(e){return this.models[e]},where:function(e){return u.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return u.invoke(this.models,"get",e)},update:function(e,t){t=u.extend({add:!0,merge:!0,remove:!0},t),t.parse&&(e=this.parse(e,t));var n,r,i,s,o=[],a=[],f={};u.isArray(e)||(e=e?[e]:[]);if(t.add&&!t.remove)return this.add(e,t);for(r=0,i=e.length;r<i;r++)n=e[r],s=this.get(n),t.remove&&s&&(f[s.cid]=!0),(t.add&&!s||t.merge&&s)&&o.push(n);if(t.remove)for(r=0,i=this.models.length;r<i;r++)n=this.models[r],f[n.cid]||a.push(n);return a.length&&this.remove(a,t),o.length&&this.add(o,t),this},reset:function(e,t){t||(t={}),t.parse&&(e=this.parse(e,t));for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models.slice(),this._reset(),e&&this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success;return e.success=function(e,n,r){var i=r.update?"update":"reset";e[i](n,r),t&&t(e,n,r)},this.sync("read",this,e)},create:function(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models.length=0,this._byId={}},_prepareModel:function(e,t){if(e instanceof h)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:!1},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=u.isFunction(t)?t:function(e){return e.get(t)};return u.sortedIndex(this.models,e,r,n)}});var d=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];u.each(d,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var v=["groupBy","countBy","sortBy"];u.each(v,function(e){p.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var m=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},g=/\((.*?)\)/g,y=/(\(\?)?:\w+/g,b=/\*\w+/g,w=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(m.prototype,c,{initialize:function(){},route:function(e,t,n){return u.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),o.history.route(e,u.bind(function(r){var i=this._extractParameters(e,r);n&&n.apply(this,i),this.trigger.apply(this,["route:"+t].concat(i)),this.trigger("route",t,i),o.history.trigger("route",this,t,i)},this)),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(w,"\\$&").replace(g,"(?:$1)?").replace(y,function(e,t){return t?e:"([^/]+)"}).replace(b,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var E=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},S=/^[#\/]|\s+$/g,x=/^\/+|\/+$/g,T=/msie [\w.]+/,N=/\/$/;E.started=!1,u.extend(E.prototype,c,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(N,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(S,"")},start:function(e){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=T.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(x,"/"),r&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(S,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search));if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!E.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new E;var C=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},k=/^(\S+)\s*(.*)$/,L=["model","collection","el","id","attributes","className","tagName","events"];u.extend(C.prototype,c,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)throw new Error('Method "'+e[t]+'" does not exist');var r=t.match(k),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.on(i,n):this.$el.on(i,s,n)}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,L)),this.options=e},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className"));var t=o.$("<"+u.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}else this.setElement(u.result(this,"el"),!1)}});var A={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.sync=function(e,t,n){var r=A[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||M()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1);var a=n.success;n.success=function(e){a&&a(t,e,n),t.trigger("sync",t,e,n)};var f=n.error;n.error=function(e){f&&f(t,e,n),t.trigger("error",t,e,n)};var l=n.xhr=o.ajax(u.extend(i,n));return t.trigger("request",t,l,n),l},o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var O=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){return n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};h.extend=p.extend=m.extend=C.extend=E.extend=O;var M=function(){throw new Error('A "url" property or function must be specified')}}.call(this),define("backbone",["underscore","jquery"],function(e){return function(){var t,n;return t||e.Backbone}}(this)),function(e){function m(){var e=-1,t=this;t.append=function(n){var r,i=t.table;for(r=0;r<n.length;r++)e=e>>>8^i[(e^n[r])&255]},t.get=function(){return~e}}function g(e,t,n){if(e.slice)return e.slice(t,t+n);if(e.webkitSlice)return e.webkitSlice(t,t+n);if(e.mozSlice)return e.mozSlice(t,t+n);if(e.msSlice)return e.msSlice(t,t+n)}function y(e,t){var n,r;return n=new ArrayBuffer(e),r=new Uint8Array(n),t&&r.set(t,0),{buffer:n,array:r,view:new DataView(n)}}function b(){}function w(e){function r(r,i){var s=new Blob([e],{type:h});n=new S(s),n.init(function(){t.size=n.size,r()},i)}function i(e,t,r,i){n.readUint8Array(e,t,r,i)}var t=this,n;t.size=0,t.init=r,t.readUint8Array=i}function E(t){function i(e){var i=t.length;while(t.charAt(i-1)=="=")i--;r=t.indexOf(",")+1,n.size=Math.floor((i-r)*.75),e()}function s(n,i,s){var o,u=y(i),a=Math.floor(n/3)*4,f=Math.ceil((n+i)/3)*4,l=e.atob(t.substring(a+r,f+r)),c=n-Math.floor(a/4)*3;for(o=c;o<c+i;o++)u.array[o-c]=l.charCodeAt(o);s(u.array)}var n=this,r;n.size=0,n.init=i,n.readUint8Array=s}function S(e){function n(t){this.size=e.size,t()}function r(t,n,r,i){var s=new FileReader;s.onload=function(e){r(new Uint8Array(e.target.result))},s.onerror=i,s.readAsArrayBuffer(g(e,t,n))}var t=this;t.size=0,t.init=n,t.readUint8Array=r}function x(){}function T(e){function r(e){n=new Blob([],{type:h}),e()}function i(e,t){n=new Blob([n,d?e:e.buffer],{type:h}),t()}function s(t,r){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=r,i.readAsText(n,e)}var t=this,n;t.init=r,t.writeUint8Array=i,t.getData=s}function N(t){function s(e){r+="data:"+(t||"")+";base64,",e()}function o(t,n){var s,o=i.length,u=i;i="";for(s=0;s<Math.floor((o+t.length)/3)*3-o;s++)u+=String.fromCharCode(t[s]);for(;s<t.length;s++)i+=String.fromCharCode(t[s]);u.length>2?r+=e.btoa(u):i=u,n()}function u(t){t(r+e.btoa(i))}var n=this,r="",i="";n.init=s,n.writeUint8Array=o,n.getData=u}function C(e){function r(n){t=new Blob([],{type:e}),n()}function i(n,r){t=new Blob([t,d?n:n.buffer],{type:e}),r()}function s(e){e(t)}var t,n=this;n.init=r,n.writeUint8Array=i,n.getData=s}function k(e,t,n,r,i,s,o,u,a,l){function v(){e.removeEventListener(p,m,!1),u(d)}function m(e){var t=e.data,r=t.data;t.onappend&&(d+=r.length,n.writeUint8Array(r,function(){s(!1,r),g()},l)),t.onflush&&(r?(d+=r.length,n.writeUint8Array(r,function(){s(!1,r),v()},l)):v()),t.progress&&o&&o(h+t.current,i)}function g(){h=c*f,h<i?t.readUint8Array(r+h,Math.min(f,i-h),function(t){e.postMessage({append:!0,data:t}),c++,o&&o(h,i),s(!0,t)},a):e.postMessage({flush:!0})}var c=0,h,d;d=0,e.addEventListener(p,m,!1),g()}function L(e,t,n,r,i,s,o,u,a,l){function d(){var v;h=c*f,h<i?t.readUint8Array(r+h,Math.min(f,i-h),function(t){var u=e.append(t,function(){o&&o(r+h,i)});p+=u.length,s(!0,t),n.writeUint8Array(u,function(){s(!1,u),c++,setTimeout(d,1)},l),o&&o(h,i)},a):(v=e.flush(),v?(p+=v.length,n.writeUint8Array(v,function(){s(!1,v),u(p)},l)):u(p))}var c=0,h,p=0;d()}function A(t,n,r,i,s,o,u,a,f){function p(e,t){s&&!e&&h.append(t)}function d(e){o(e,h.get())}var c,h=new m;return e.zip.useWebWorkers?(c=new Worker(e.zip.workerScriptsPath+l),k(c,t,n,r,i,p,u,d,a,f)):L(new e.zip.Inflater,t,n,r,i,p,u,d,a,f),c}function O(t,n,r,i,s,o,u){function l(e,t){e&&f.append(t)}function h(e){i(e,f.get())}function d(){a.removeEventListener(p,d,!1),k(a,t,n,0,t.size,l,s,h,o,u)}var a,f=new m;return e.zip.useWebWorkers?(a=new Worker(e.zip.workerScriptsPath+c),a.addEventListener(p,d,!1),a.postMessage({init:!0,level:r})):L(new e.zip.Deflater,t,n,0,t.size,l,s,h,o,u),a}function M(e,t,n,r,i,s,o,u,a){function h(){var p=l*f;p<r?e.readUint8Array(n+p,Math.min(f,r-p),function(e){i&&c.append(e),o&&o(p,r,e),t.writeUint8Array(e,function(){l++,h()},a)},u):s(r,c.get())}var l=0,c=new m;h()}function _(e){var t,n="",r,i=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "];for(t=0;t<e.length;t++)r=e.charCodeAt(t)&255,r>127?n+=i[r-128]:n+=String.fromCharCode(r);return n}function D(e){return decodeURIComponent(escape(e))}function P(e){var t,n="";for(t=0;t<e.length;t++)n+=String.fromCharCode(e[t]);return n}function H(e){var t=(e&4294901760)>>16,n=e&65535;try{return new Date(1980+((t&65024)>>9),((t&480)>>5)-1,t&31,(n&63488)>>11,(n&2016)>>5,(n&31)*2,0)}catch(r){}}function B(e,t,i,s,o){e.version=t.view.getUint16(i,!0),e.bitFlag=t.view.getUint16(i+2,!0),e.compressionMethod=t.view.getUint16(i+4,!0),e.lastModDateRaw=t.view.getUint32(i+6,!0),e.lastModDate=H(e.lastModDateRaw);if((e.bitFlag&1)===1){o(n);return}if(s||(e.bitFlag&8)!=8)e.crc32=t.view.getUint32(i+10,!0),e.compressedSize=t.view.getUint32(i+14,!0),e.uncompressedSize=t.view.getUint32(i+18,!0);if(e.compressedSize===4294967295||e.uncompressedSize===4294967295){o(r);return}e.filenameLength=t.view.getUint16(i+22,!0),e.extraFieldLength=t.view.getUint16(i+24,!0)}function j(e,n){function r(){}function s(t,r){e.readUint8Array(e.size-t,t,function(e){var n=y(e.length,e).view;n.getUint32(0)!=1347093766?s(t+1,r):r(n)},function(){n(i)})}return r.prototype.getData=function(r,i,s,a){function c(e,t){l&&l.terminate(),l=null,e&&e(t)}function h(e){var t=y(4);return t.view.setUint32(0,e),f.crc32==t.view.getUint32(0)}function p(e,t){a&&!h(t)?d():r.getData(function(e){c(i,e)})}function d(){c(n,u)}function v(){c(n,o)}var f=this,l;e.readUint8Array(f.offset,30,function(i){var o=y(i.length,i),u;if(o.view.getUint32(0)!=1347093252){n(t);return}B(f,o,4,!1,n),u=f.offset+30+f.filenameLength+f.extraFieldLength,r.init(function(){f.compressionMethod===0?M(e,r,u,f.compressedSize,a,p,s,d,v):l=A(e,r,u,f.compressedSize,a,p,s,d,v)},v)},d)},{getEntries:function(o){if(e.size<22){n(t);return}s(22,function(s){var u,a;u=s.getUint32(16,!0),a=s.getUint16(8,!0),e.readUint8Array(u,e.size-u,function(e){var i,s=0,u=[],f,l,c,h=y(e.length,e);for(i=0;i<a;i++){f=new r;if(h.view.getUint32(s)!=1347092738){n(t);return}B(f,h,s+6,!0,n),f.commentLength=h.view.getUint16(s+32,!0),f.directory=(h.view.getUint8(s+38)&16)==16,f.offset=h.view.getUint32(s+42,!0),l=P(h.array.subarray(s+46,s+46+f.filenameLength)),f.filename=(f.bitFlag&2048)===2048?D(l):_(l),!f.directory&&f.filename.charAt(f.filename.length-1)=="/"&&(f.directory=!0),c=P(h.array.subarray(s+46+f.filenameLength+f.extraFieldLength,s+46+f.filenameLength+f.extraFieldLength+f.commentLength)),f.comment=(f.bitFlag&2048)===2048?D(c):_(c),u.push(f),s+=46+f.filenameLength+f.extraFieldLength+f.commentLength}o(u)},function(){n(i)})})},close:function(e){e&&e()}}}function F(e){return unescape(encodeURIComponent(e))}function I(e){var t,n=[];for(t=0;t<e.length;t++)n.push(e.charCodeAt(t));return n}function q(e,t,n){function l(e,t){r&&r.terminate(),r=null,e&&e(t)}function c(){l(t,s)}function h(){l(t,u)}var r,i={},o=[],f=0;return{add:function(s,u,p,d,v){function w(t){var r;b=v.lastModDate||new Date,m=y(26),i[s]={headerArray:m.array,directory:v.directory,filename:g,offset:f,comment:I(F(v.comment||""))},m.view.setUint32(0,335546376),v.version&&m.view.setUint8(0,v.version),!n&&v.level!==0&&!v.directory&&m.view.setUint16(4,2048),m.view.setUint16(6,(b.getHours()<<6|b.getMinutes())<<5|b.getSeconds()/2,!0),m.view.setUint16(8,(b.getFullYear()-1980<<4|b.getMonth()+1)<<5|b.getDate(),!0),m.view.setUint16(22,g.length,!0),r=y(30+g.length),r.view.setUint32(0,1347093252),r.array.set(m.array,4),r.array.set(g,30),f+=r.array.length,e.writeUint8Array(r.array,t,c)}function E(t,n){var r=y(16);f+=t||0,r.view.setUint32(0,1347094280),typeof n!="undefined"&&(m.view.setUint32(10,n,!0),r.view.setUint32(4,n,!0)),u&&(r.view.setUint32(8,t,!0),m.view.setUint32(14,t,!0),r.view.setUint32(12,u.size,!0),m.view.setUint32(18,u.size,!0)),e.writeUint8Array(r.array,function(){f+=16,l(p)},c)}function S(){v=v||{},s=s.trim(),v.directory&&s.charAt(s.length-1)!="/"&&(s+="/");if(i.hasOwnProperty(s)){t(a);return}g=I(F(s)),o.push(s),w(function(){u?n||v.level===0?M(u,e,0,u.size,!0,E,d,h,c):r=O(u,e,v.level,E,d,h,c):E()},c)}var m,g,b;u?u.init(S,h):S()},close:function(t){var n,r=0,s=0,u,a;for(u=0;u<o.length;u++)a=i[o[u]],r+=46+a.filename.length+a.comment.length;n=y(r+22);for(u=0;u<o.length;u++)a=i[o[u]],n.view.setUint32(s,1347092738),n.view.setUint16(s+4,5120),n.array.set(a.headerArray,s+6),n.view.setUint16(s+32,a.comment.length,!0),a.directory&&n.view.setUint8(s+38,16),n.view.setUint32(s+42,a.offset,!0),n.array.set(a.filename,s+46),n.array.set(a.comment,s+46+a.filename.length),s+=46+a.filename.length+a.comment.length;n.view.setUint32(s,1347093766),n.view.setUint16(s+8,o.length,!0),n.view.setUint16(s+10,o.length,!0),n.view.setUint32(s+12,r,!0),n.view.setUint32(s+16,f,!0),e.writeUint8Array(n.array,function(){l(function(){e.getData(t)})},c)}}}var t="File format is not recognized.",n="File contains encrypted entry.",r="File is using Zip64 (4gb+ file size).",i="Error while reading zip file.",s="Error while writing zip file.",o="Error while writing file data.",u="Error while reading file data.",a="File already exists.",f=524288,l="inflate.js",c="deflate.js",h="text/plain",p="message",d;try{d=(new Blob([new DataView(new ArrayBuffer(0))])).size===0}catch(v){}m.prototype.table=function(){var e,t,n,r=[];for(e=0;e<256;e++){n=e;for(t=0;t<8;t++)n&1?n=n>>>1^3988292384:n>>>=1;r[e]=n}return r}(),w.prototype=new b,w.prototype.constructor=w,E.prototype=new b,E.prototype.constructor=E,S.prototype=new b,S.prototype.constructor=S,x.prototype.getData=function(e){e(this.data)},T.prototype=new x,T.prototype.constructor=T,N.prototype=new x,N.prototype.constructor=N,C.prototype=new x,C.prototype.constructor=C,e.zip={Reader:b,Writer:x,BlobReader:S,Data64URIReader:E,TextReader:w,BlobWriter:C,Data64URIWriter:N,TextWriter:T,createReader:function(e,t,n){e.init(function(){t(j(e,n))},n)},createWriter:function(e,t,n,r){e.init(function(){t(q(e,n,r))},n)},workerScriptsPath:"",useWebWorkers:!0}}(this),define("zip",function(e){return function(){var t,n;return t||e.zip}}(this)),function(){function l(e){function i(t){this.size=e.uncompressedSize,t()}function s(i){t.data?i():e.getData(new n,function(e){t.data=e,r=new o(e),i()},null,t.checkCrc32)}function u(e,t,n,i){s(function(){r.readUint8Array(e,t,n,i)},i)}var t=this,r;t.size=0,t.init=i,t.readUint8Array=u}function c(e){function n(e){t+=e.uncompressedSize||0,e.children.forEach(n)}var t=0;return n(e),t}function h(e,t,n){function i(){r++,r<e.children.length?s(e.children[r]):t()}function s(e){e.directory?h(e,i,n):(e.reader=new e.Reader(e.data,n),e.reader.init(function(){e.uncompressedSize=e.reader.size,i()}))}var r=0;e.children.length?s(e.children[r]):t()}function p(e){var t=e.parent.children;t.forEach(function(n,r){n.id==e.id&&t.splice(r,1)})}function d(e,t,n,r,i){function o(e,t,n,r,i){function a(){var f=t.children[u];f?e.add(f.getFullname(),f.reader,function(){s+=f.uncompressedSize||0,o(e,f,function(){u++,a()},r,i)},function(e){r&&r(s+e,i)},{directory:f.directory,version:f.zipVersion}):n()}var u=0;a()}var s=0;o(e,t,n,r,i)}function v(e,t,n,r){function i(e,t){e.isDirectory&&e.createReader().readEntries(t),e.isFile&&t([])}function s(e,t,n){i(t,function(t){function o(t){function n(e){s(e,t,function(){i++,u()})}t.isDirectory&&n(e.addDirectory(t.name)),t.isFile&&t.file(function(r){var i=e.addBlob(t.name,r);i.uncompressedSize=r.size,n(i)},r)}function u(){var e=t[i];e?o(e):n()}var i=0;u()})}t.isDirectory?s(e,t,n):t.file(function(r){e.addBlob(t.name,r),n()},r)}function m(e,t,n,r,i,s,o){function a(e,t,n,r,i,s){function l(t){function n(e){u+=t.uncompressedSize||0,a(e,t,function(){f++,c()},r,i,s)}t.directory?e.getDirectory(t.name,{create:!0},n,i):e.getFile(t.name,{create:!0},function(e){t.getData(new zip.FileWriter(e,zip.getMimeType(t.name)),n,function(e){r&&r(u+e,s)},o)},i)}function c(){var e=t.children[f];e?l(e):n()}var f=0;c()}var u=0;t.directory?a(e,t,n,r,i,s):t.getData(new zip.FileWriter(e,zip.getMimeType(t.name)),n,r,o)}function g(e){e.entries=[],e.root=new N(e)}function y(t,n,r,i,s){function u(){var a=o*e;i&&i(a,t.size),a<t.size?t.readUint8Array(a,Math.min(e,t.size-a),function(e){n.writeUint8Array(new Uint8Array(e),function(){o++,u()})},s):n.getData(r)}var o=0;u()}function b(e,t,n,r){var i=this;!e||e.constructor==i.Writer&&i.data?t(i.data):(i.reader||(i.reader=new i.Reader(i.data,r)),i.reader.init(function(){e.init(function(){y(i.reader,e,t,n,r)},r)}))}function w(e,t,n,r){if(e.directory)return r?new N(e.fs,t,n,e):new x(e.fs,t,n,e);throw"Parent entry is not a directory."}function E(){}function x(e,t,n,r){var i=this;E.prototype.init.call(i,e,t,n,r),i.Reader=n.Reader,i.Writer=n.Writer,i.data=n.data,i.getData=n.getData||b}function N(e,t,n,r){var i=this;E.prototype.init.call(i,e,t,n,r),i.directory=!0}function C(){g(this)}var e=524288,t=zip.TextWriter,n=zip.BlobWriter,r=zip.Data64URIWriter,i=zip.Reader,s=zip.TextReader,o=zip.BlobReader,u=zip.Data64URIReader,a=zip.createReader,f=zip.createWriter;l.prototype=new i,l.prototype.constructor=l,l.prototype.checkCrc32=!1,E.prototype={init:function(e,t,n,r){var i=this;if(e.root&&r&&r.getChildByName(t))throw"Entry filename already exists.";n||(n={}),i.fs=e,i.name=t,i.id=e.entries.length,i.parent=r,i.children=[],i.zipVersion=n.zipVersion||20,i.uncompressedSize=0,e.entries.push(i),r&&i.parent.children.push(i)},getFileEntry:function(e,t,n,r,i){var s=this;h(s,function(){m(e,s,t,n,r,c(s),i)},r)},moveTo:function(e){var t=this;if(!e.directory)throw"Target entry is not a directory.";if(!!e.isDescendantOf(t))throw"Entry is a ancestor of target entry.";if(t!=e){if(e.getChildByName(t.name))throw"Entry filename already exists.";p(t),t.parent=e,e.children.push(t)}},getFullname:function(){var e=this,t=e.name,n=e.parent;while(n)t=(n.name?n.name+"/":"")+t,n=n.parent;return t},isDescendantOf:function(e){var t=this.parent;while(t&&t.id!=e.id)t=t.parent;return!!t}},E.prototype.constructor=E;var S;x.prototype=S=new E,S.constructor=x,S.getText=function(e,n,r,i){this.getData(new t(i),e,n,r)},S.getBlob=function(e,t,r,i){this.getData(new n(e),t,r,i)},S.getData64URI=function(e,t,n,i){this.getData(new r(e),t,n,i)};var T;N.prototype=T=new E,T.constructor=N,T.addDirectory=function(e){return w(this,e,null,!0)},T.addText=function(e,n){return w(this,e,{data:n,Reader:s,Writer:t})},T.addBlob=function(e,t){return w(this,e,{data:t,Reader:o,Writer:n})},T.addData64URI=function(e,t){return w(this,e,{data:t,Reader:u,Writer:r})},T.addFileEntry=function(e,t,n){v(this,e,t,n)},T.addData=function(e,t){return w(this,e,t)},T.importBlob=function(e,t,n){this.importZip(new o(e),t,n)},T.importText=function(e,t,n){this.importZip(new s(e),t,n)},T.importData64URI=function(e,t,n){this.importZip(new u(e),t,n)},T.exportBlob=function(e,t,r){this.exportZip(new n("application/zip"),e,t,r)},T.exportText=function(e,n,r){this.exportZip(new t,e,n,r)},T.exportFileEntry=function(e,t,n,r){this.exportZip(new zip.FileWriter(e,"application/zip"),t,n,r)},T.exportData64URI=function(e,t,n){this.exportZip(new r("application/zip"),e,t,n)},T.importZip=function(e,t,n){var r=this;a(e,function(e){e.getEntries(function(e){e.forEach(function(e){var t=r,n=e.filename.split("/"),i=n.pop();n.forEach(function(e){t=t.getChildByName(e)||new N(r.fs,e,null,t)}),e.directory||w(t,i,{data:e,Reader:l})}),t()})},n)},T.exportZip=function(e,t,n,r){var i=this;h(i,function(){f(e,function(e){d(e,i,function(){e.close(t)},n,c(i))},r)},r)},T.getChildByName=function(e){var t,n,r=this;for(t=0;t<r.children.length;t++){n=r.children[t];if(n.name==e)return n}},C.prototype={remove:function(e){p(e),this.entries[e.id]=null},find:function(e){var t,n=e.split("/"),r=this.root;for(t=0;r&&t<n.length;t++)r=r.getChildByName(n[t]);return r},getById:function(e){return this.entries[e]},importBlob:function(e,t,n){g(this),this.root.importBlob(e,t,n)},importText:function(e,t,n){g(this),this.root.importText(e,t,n)},importData64URI:function(e,t,n){g(this),this.root.importData64URI(e,t,n)},exportBlob:function(e,t,n){this.root.exportBlob(e,t,n)},exportText:function(e,t,n){this.root.exportText(e,t,n)},exportFileEntry:function(e,t,n,r){this.root.exportFileEntry(e,t,n,r)},exportData64URI:function(e,t,n){this.root.exportData64URI(e,t,n)}},zip.fs={FS:C,ZipDirectoryEntry:N,ZipFileEntry:x},zip.getMimeType=function(){return"application/octet-stream"}}(),define("zip-fs",["zip"],function(e){return function(){var t,n;return t||e.zip-fs}}(this)),function(){function o(e){function n(n,r){var i;t.data?n():(i=new XMLHttpRequest,i.addEventListener("load",function(){t.size||(t.size=Number(i.getResponseHeader("Content-Length"))),t.data=new Uint8Array(i.response),n()},!1),i.addEventListener("error",r,!1),i.open("GET",e),i.responseType="arraybuffer",i.send())}function r(n,r){var i=new XMLHttpRequest;i.addEventListener("load",function(){t.size=Number(i.getResponseHeader("Content-Length")),n()},!1),i.addEventListener("error",r,!1),i.open("HEAD",e),i.send()}function i(e,r,i,s){n(function(){i(new Uint8Array(t.data.subarray(e,e+r)))},s)}var t=this;t.size=0,t.init=r,t.readUint8Array=i}function u(t){function r(r,i){var s=new XMLHttpRequest;s.addEventListener("load",function(){n.size=Number(s.getResponseHeader("Content-Length")),s.getResponseHeader("Accept-Ranges")=="bytes"?r():i(e)},!1),s.addEventListener("error",i,!1),s.open("HEAD",t),s.send()}function i(e,n,r,i){var s=new XMLHttpRequest;s.open("GET",t),s.responseType="arraybuffer",s.setRequestHeader("Range","bytes="+e+"-"+(e+n-1)),s.addEventListener("load",function(){r(s.response)},!1),s.addEventListener("error",i,!1),s.send()}function s(e,t,n,r){i(e,t,function(e){n(new Uint8Array(e))},r)}var n=this;n.size=0,n.init=r,n.readUint8Array=s}function a(e){function n(n,r){t.size=e.byteLength,n()}function r(t,n,r,i){r(new Uint8Array(e.slice(t,t+n)))}var t=this;t.size=0,t.init=n,t.readUint8Array=r}function f(){function n(t,n){e=new Uint8Array,t()}function r(t,n,r){var i=new Uint8Array(e.length+t.length);i.set(e),i.set(t,e.length),e=i,n()}function i(t){t(e.buffer)}var e,t=this;t.init=n,t.writeUint8Array=r,t.getData=i}function l(e,t){function s(t,r){e.createWriter(function(e){n=e,t()},r)}function o(e,r,s){var o=new Blob([i?e:e.buffer],{type:t});n.onwrite=function(){n.onwrite=null,r()},n.onerror=s,n.write(o)}function u(t){e.file(t)}var n,r=this;r.init=s,r.writeUint8Array=o,r.getData=u}var e="HTTP Range not supported.",t=zip.Reader,n=zip.Writer,r,i;try{i=(new Blob([new DataView(new ArrayBuffer(0))])).size===0}catch(s){}o.prototype=new t,o.prototype.constructor=o,u.prototype=new t,u.prototype.constructor=u,a.prototype=new t,a.prototype.constructor=a,f.prototype=new n,f.prototype.constructor=f,l.prototype=new n,l.prototype.constructor=l,zip.FileWriter=l,zip.HttpReader=o,zip.HttpRangeReader=u,zip.ArrayBufferReader=a,zip.ArrayBufferWriter=f,zip.fs&&(r=zip.fs.ZipDirectoryEntry,r.prototype.addHttpContent=function(e,t,n){function i(e,t,n,i){if(e.directory)return i?new r(e.fs,t,n,e):new zip.fs.ZipFileEntry(e.fs,t,n,e);throw"Parent entry is not a directory."}return i(this,e,{data:t,Reader:n?u:o})},r.prototype.importHttpContent=function(e,t,n,r){this.importZip(t?new u(e):new o(e),n,r)},zip.fs.FS.prototype.importHttpContent=function(e,t,n,i){this.entries=[],this.root=new r(this),this.root.importHttpContent(e,t,n,i)})}(),define("zip-ext",["zip-fs"],function(e){return function(){var t,n;return t||e.zip-ext}}(this)),(typeof Crypto=="undefined"||!Crypto.util)&&function(){var e=window.Crypto={},t=e.util={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return t.rotl(e,8)&16711935|t.rotl(e,24)&4278255360;for(var n=0;n<e.length;n++)e[n]=t.endian(e[n]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(Math.random()*256));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=(e[n]&255)<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<e.length*32;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((e[n]&15).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){if(typeof btoa=="function")return btoa(n.bytesToString(e));for(var t=[],r=0;r<e.length;r+=3)for(var i=e[r]<<16|e[r+1]<<8|e[r+2],s=0;s<4;s++)r*8+s*6<=e.length*8?t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>>6*(3-s)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){if(typeof atob=="function")return n.stringToBytes(atob(e));for(var e=e.replace(/[^A-Z0-9+\/]/ig,""),t=[],r=0,i=0;r<e.length;i=++r%4)i!=0&&t.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<i*2|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(r))>>>6-i*2);return t}},e=e.charenc={};e.UTF8={stringToBytes:function(e){return n.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(n.bytesToString(e)))}};var n=e.Binary={stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n)&255);return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}}(),function(){var e=Crypto,t=e.util,n=e.charenc,r=n.UTF8,i=n.Binary,s=e.SHA1=function(e,n){var r=t.wordsToBytes(s._sha1(e));return n&&n.asBytes?r:n&&n.asString?i.bytesToString(r):t.bytesToHex(r)};s._sha1=function(e){e.constructor==String&&(e=r.stringToBytes(e));var n=t.bytesToWords(e),i=e.length*8,e=[],s=1732584193,o=-271733879,u=-1732584194,f=271733878,l=-1009589776;n[i>>5]|=128<<24-i%32,n[(i+64>>>9<<4)+15]=i;for(i=0;i<n.length;i+=16){for(var c=s,h=o,p=u,d=f,v=l,g=0;g<80;g++){if(g<16)e[g]=n[i+g];else{var y=e[g-3]^e[g-8]^e[g-14]^e[g-16];e[g]=y<<1|y>>>31}y=(s<<5|s>>>27)+l+(e[g]>>>0)+(g<20?(o&u|~o&f)+1518500249:g<40?(o^u^f)+1859775393:g<60?(o&u|o&f|u&f)-1894007588:(o^u^f)-899497514),l=f,f=u,u=o<<30|o>>>2,o=s,s=y}s+=c,o+=h,u+=p,f+=d,l+=v}return[s,o,u,f,l]},s._blocksize=16,s._digestsize=20}(),define("crypto-sha1",function(){}),function(e){function S(e){throw RangeError(g[e])}function x(e,t){var n=e.length;while(n--)e[n]=t(e[n]);return e}function T(e,t){var n=".";return x(e.split(n),t).join(n)}function N(e){var t=[],n=0,r=e.length,i,s;while(n<r)i=e.charCodeAt(n++),(i&63488)==55296&&n<r?(s=e.charCodeAt(n++),(s&64512)==56320?t.push(((i&1023)<<10)+(s&1023)+65536):t.push(i,s)):t.push(i);return t}function C(e){return x(e,function(e){var t="";return e>65535&&(e-=65536,t+=w(e>>>10&1023|55296),e=56320|e&1023),t+=w(e),t}).join("")}function k(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:u}function L(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function A(e,t,n){var r=0;e=n?b(e/c):e>>1,e+=b(e/t);for(;e>y*f>>1;r+=u)e=b(e/y);return b(r+(y+1)*e/(e+l))}function O(e,t){return e-=(e-97<26)<<5,e+(!t&&e-65<26)<<5}function M(e){var t=[],n=e.length,r,i=0,s=p,l=h,c,v,m,g,y,w,E,x,T,N;c=e.lastIndexOf(d),c<0&&(c=0);for(v=0;v<c;++v)e.charCodeAt(v)>=128&&S("not-basic"),t.push(e.charCodeAt(v));for(m=c>0?c+1:0;m<n;){for(g=i,y=1,w=u;;w+=u){m>=n&&S("invalid-input"),E=k(e.charCodeAt(m++)),(E>=u||E>b((o-i)/y))&&S("overflow"),i+=E*y,x=w<=l?a:w>=l+f?f:w-l;if(E<x)break;N=u-x,y>b(o/N)&&S("overflow"),y*=N}r=t.length+1,l=A(i-g,r,g==0),b(i/r)>o-s&&S("overflow"),s+=b(i/r),i%=r,t.splice(i++,0,s)}return C(t)}function _(e){var t,n,r,i,s,l,c,v,m,g,y,E=[],x,T,C,k;e=N(e),x=e.length,t=p,n=0,s=h;for(l=0;l<x;++l)y=e[l],y<128&&E.push(w(y));r=i=E.length,i&&E.push(d);while(r<x){for(c=o,l=0;l<x;++l)y=e[l],y>=t&&y<c&&(c=y);T=r+1,c-t>b((o-n)/T)&&S("overflow"),n+=(c-t)*T,t=c;for(l=0;l<x;++l){y=e[l],y<t&&++n>o&&S("overflow");if(y==t){for(v=n,m=u;;m+=u){g=m<=s?a:m>=s+f?f:m-s;if(v<g)break;k=v-g,C=u-g,E.push(w(L(g+k%C,0))),v=b(k/C)}E.push(w(L(v,0))),s=A(n,T,r==i),n=0,++r}}++n,++t}return E.join("")}function D(e){return T(e,function(e){return m.test(e)?M(e.slice(4).toLowerCase()):e})}function P(e){return T(e,function(e){return v.test(e)?"xn--"+_(e):e})}var t,n=typeof define=="function"&&typeof define.amd=="object"&&define.amd&&define,r=typeof exports=="object"&&exports,i=typeof module=="object"&&module,s=typeof require=="function"&&require,o=2147483647,u=36,a=1,f=26,l=38,c=700,h=72,p=128,d="-",v=/[^ -~]/,m=/^xn--/,g={overflow:"Overflow: input needs wider integers to process.","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},y=u-a,b=Math.floor,w=String.fromCharCode,E;t={version:"1.1.1",ucs2:{decode:N,encode:C},decode:M,encode:_,toASCII:P,toUnicode:D};if(r)if(i&&i.exports==r)i.exports=t;else for(E in t)t.hasOwnProperty(E)&&(r[E]=t[E]);else n?define("punycode",t):e.punycode=t}(this),function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define("IPv6",t):e.IPv6=t()}(this,function(){function e(e){var t=e.toLowerCase(),n=t.split(":"),r=n.length,i=8;n[0]===""&&n[1]===""&&n[2]===""?(n.shift(),n.shift()):n[0]===""&&n[1]===""?n.shift():n[r-1]===""&&n[r-2]===""&&n.pop(),r=n.length,n[r-1].indexOf(".")!==-1&&(i=7);var s;for(s=0;s<r;s++)if(n[s]==="")break;if(s<i){n.splice(s,1,"0000");while(n.length<i)n.splice(s,0,"0000");r=n.length}var o;for(var u=0;u<i;u++){o=n[u].split("");for(var a=0;a<3;a++){if(!(o[0]==="0"&&o.length>1))break;o.splice(0,1)}n[u]=o.join("")}var f=-1,l=0,c=0,h=-1,p=!1;for(u=0;u<i;u++)p?n[u]==="0"?c+=1:(p=!1,c>l&&(f=h,l=c)):n[u]=="0"&&(p=!0,h=u,c=1);c>l&&(f=h,l=c),l>1&&n.splice(f,l,""),r=n.length;var d="";n[0]===""&&(beststr=":");for(u=0;u<r;u++){d+=n[u];if(u===r-1)break;d+=":"}return n[r-1]===""&&(d+=":"),d}return{best:e}}),function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define("SecondLevelDomains",t):e.SecondLevelDomains=t()}(this,function(){var e=Object.prototype.hasOwnProperty,t={list:{ac:"com|gov|mil|net|org",ae:"ac|co|gov|mil|name|net|org|pro|sch",af:"com|edu|gov|net|org",al:"com|edu|gov|mil|net|org",ao:"co|ed|gv|it|og|pb",ar:"com|edu|gob|gov|int|mil|net|org|tur",at:"ac|co|gv|or",au:"asn|com|csiro|edu|gov|id|net|org",ba:"co|com|edu|gov|mil|net|org|rs|unbi|unmo|unsa|untz|unze",bb:"biz|co|com|edu|gov|info|net|org|store|tv",bh:"biz|cc|com|edu|gov|info|net|org",bn:"com|edu|gov|net|org",bo:"com|edu|gob|gov|int|mil|net|org|tv",br:"adm|adv|agr|am|arq|art|ato|b|bio|blog|bmd|cim|cng|cnt|com|coop|ecn|edu|eng|esp|etc|eti|far|flog|fm|fnd|fot|fst|g12|ggf|gov|imb|ind|inf|jor|jus|lel|mat|med|mil|mus|net|nom|not|ntr|odo|org|ppg|pro|psc|psi|qsl|rec|slg|srv|tmp|trd|tur|tv|vet|vlog|wiki|zlg",bs:"com|edu|gov|net|org",bz:"du|et|om|ov|rg",ca:"ab|bc|mb|nb|nf|nl|ns|nt|nu|on|pe|qc|sk|yk",ck:"biz|co|edu|gen|gov|info|net|org",cn:"ac|ah|bj|com|cq|edu|fj|gd|gov|gs|gx|gz|ha|hb|he|hi|hl|hn|jl|js|jx|ln|mil|net|nm|nx|org|qh|sc|sd|sh|sn|sx|tj|tw|xj|xz|yn|zj",co:"com|edu|gov|mil|net|nom|org",cr:"ac|c|co|ed|fi|go|or|sa",cy:"ac|biz|com|ekloges|gov|ltd|name|net|org|parliament|press|pro|tm","do":"art|com|edu|gob|gov|mil|net|org|sld|web",dz:"art|asso|com|edu|gov|net|org|pol",ec:"com|edu|fin|gov|info|med|mil|net|org|pro",eg:"com|edu|eun|gov|mil|name|net|org|sci",er:"com|edu|gov|ind|mil|net|org|rochest|w",es:"com|edu|gob|nom|org",et:"biz|com|edu|gov|info|name|net|org",fj:"ac|biz|com|info|mil|name|net|org|pro",fk:"ac|co|gov|net|nom|org",fr:"asso|com|f|gouv|nom|prd|presse|tm",gg:"co|net|org",gh:"com|edu|gov|mil|org",gn:"ac|com|gov|net|org",gr:"com|edu|gov|mil|net|org",gt:"com|edu|gob|ind|mil|net|org",gu:"com|edu|gov|net|org",hk:"com|edu|gov|idv|net|org",id:"ac|co|go|mil|net|or|sch|web",il:"ac|co|gov|idf|k12|muni|net|org","in":"ac|co|edu|ernet|firm|gen|gov|i|ind|mil|net|nic|org|res",iq:"com|edu|gov|i|mil|net|org",ir:"ac|co|dnssec|gov|i|id|net|org|sch",it:"edu|gov",je:"co|net|org",jo:"com|edu|gov|mil|name|net|org|sch",jp:"ac|ad|co|ed|go|gr|lg|ne|or",ke:"ac|co|go|info|me|mobi|ne|or|sc",kh:"com|edu|gov|mil|net|org|per",ki:"biz|com|de|edu|gov|info|mob|net|org|tel",km:"asso|com|coop|edu|gouv|k|medecin|mil|nom|notaires|pharmaciens|presse|tm|veterinaire",kn:"edu|gov|net|org",kr:"ac|busan|chungbuk|chungnam|co|daegu|daejeon|es|gangwon|go|gwangju|gyeongbuk|gyeonggi|gyeongnam|hs|incheon|jeju|jeonbuk|jeonnam|k|kg|mil|ms|ne|or|pe|re|sc|seoul|ulsan",kw:"com|edu|gov|net|org",ky:"com|edu|gov|net|org",kz:"com|edu|gov|mil|net|org",lb:"com|edu|gov|net|org",lk:"assn|com|edu|gov|grp|hotel|int|ltd|net|ngo|org|sch|soc|web",lr:"com|edu|gov|net|org",lv:"asn|com|conf|edu|gov|id|mil|net|org",ly:"com|edu|gov|id|med|net|org|plc|sch",ma:"ac|co|gov|m|net|org|press",mc:"asso|tm",me:"ac|co|edu|gov|its|net|org|priv",mg:"com|edu|gov|mil|nom|org|prd|tm",mk:"com|edu|gov|inf|name|net|org|pro",ml:"com|edu|gov|net|org|presse",mn:"edu|gov|org",mo:"com|edu|gov|net|org",mt:"com|edu|gov|net|org",mv:"aero|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro",mw:"ac|co|com|coop|edu|gov|int|museum|net|org",mx:"com|edu|gob|net|org",my:"com|edu|gov|mil|name|net|org|sch",nf:"arts|com|firm|info|net|other|per|rec|store|web",ng:"biz|com|edu|gov|mil|mobi|name|net|org|sch",ni:"ac|co|com|edu|gob|mil|net|nom|org",np:"com|edu|gov|mil|net|org",nr:"biz|com|edu|gov|info|net|org",om:"ac|biz|co|com|edu|gov|med|mil|museum|net|org|pro|sch",pe:"com|edu|gob|mil|net|nom|org|sld",ph:"com|edu|gov|i|mil|net|ngo|org",pk:"biz|com|edu|fam|gob|gok|gon|gop|gos|gov|net|org|web",pl:"art|bialystok|biz|com|edu|gda|gdansk|gorzow|gov|info|katowice|krakow|lodz|lublin|mil|net|ngo|olsztyn|org|poznan|pwr|radom|slupsk|szczecin|torun|warszawa|waw|wroc|wroclaw|zgora",pr:"ac|biz|com|edu|est|gov|info|isla|name|net|org|pro|prof",ps:"com|edu|gov|net|org|plo|sec",pw:"belau|co|ed|go|ne|or",ro:"arts|com|firm|info|nom|nt|org|rec|store|tm|www",rs:"ac|co|edu|gov|in|org",sb:"com|edu|gov|net|org",sc:"com|edu|gov|net|org",sh:"co|com|edu|gov|net|nom|org",sl:"com|edu|gov|net|org",st:"co|com|consulado|edu|embaixada|gov|mil|net|org|principe|saotome|store",sv:"com|edu|gob|org|red",sz:"ac|co|org",tr:"av|bbs|bel|biz|com|dr|edu|gen|gov|info|k12|name|net|org|pol|tel|tsk|tv|web",tt:"aero|biz|cat|co|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel",tw:"club|com|ebiz|edu|game|gov|idv|mil|net|org",mu:"ac|co|com|gov|net|or|org",mz:"ac|co|edu|gov|org",na:"co|com",nz:"ac|co|cri|geek|gen|govt|health|iwi|maori|mil|net|org|parliament|school",pa:"abo|ac|com|edu|gob|ing|med|net|nom|org|sld",pt:"com|edu|gov|int|net|nome|org|publ",py:"com|edu|gov|mil|net|org",qa:"com|edu|gov|mil|net|org",re:"asso|com|nom",ru:"ac|adygeya|altai|amur|arkhangelsk|astrakhan|bashkiria|belgorod|bir|bryansk|buryatia|cbg|chel|chelyabinsk|chita|chukotka|chuvashia|com|dagestan|e-burg|edu|gov|grozny|int|irkutsk|ivanovo|izhevsk|jar|joshkar-ola|kalmykia|kaluga|kamchatka|karelia|kazan|kchr|kemerovo|khabarovsk|khakassia|khv|kirov|koenig|komi|kostroma|kranoyarsk|kuban|kurgan|kursk|lipetsk|magadan|mari|mari-el|marine|mil|mordovia|mosreg|msk|murmansk|nalchik|net|nnov|nov|novosibirsk|nsk|omsk|orenburg|org|oryol|penza|perm|pp|pskov|ptz|rnd|ryazan|sakhalin|samara|saratov|simbirsk|smolensk|spb|stavropol|stv|surgut|tambov|tatarstan|tom|tomsk|tsaritsyn|tsk|tula|tuva|tver|tyumen|udm|udmurtia|ulan-ude|vladikavkaz|vladimir|vladivostok|volgograd|vologda|voronezh|vrn|vyatka|yakutia|yamal|yekaterinburg|yuzhno-sakhalinsk",rw:"ac|co|com|edu|gouv|gov|int|mil|net",sa:"com|edu|gov|med|net|org|pub|sch",sd:"com|edu|gov|info|med|net|org|tv",se:"a|ac|b|bd|c|d|e|f|g|h|i|k|l|m|n|o|org|p|parti|pp|press|r|s|t|tm|u|w|x|y|z",sg:"com|edu|gov|idn|net|org|per",sn:"art|com|edu|gouv|org|perso|univ",sy:"com|edu|gov|mil|net|news|org",th:"ac|co|go|in|mi|net|or",tj:"ac|biz|co|com|edu|go|gov|info|int|mil|name|net|nic|org|test|web",tn:"agrinet|com|defense|edunet|ens|fin|gov|ind|info|intl|mincom|nat|net|org|perso|rnrt|rns|rnu|tourism",tz:"ac|co|go|ne|or",ua:"biz|cherkassy|chernigov|chernovtsy|ck|cn|co|com|crimea|cv|dn|dnepropetrovsk|donetsk|dp|edu|gov|if|in|ivano-frankivsk|kh|kharkov|kherson|khmelnitskiy|kiev|kirovograd|km|kr|ks|kv|lg|lugansk|lutsk|lviv|me|mk|net|nikolaev|od|odessa|org|pl|poltava|pp|rovno|rv|sebastopol|sumy|te|ternopil|uzhgorod|vinnica|vn|zaporizhzhe|zhitomir|zp|zt",ug:"ac|co|go|ne|or|org|sc",uk:"ac|bl|british-library|co|cym|gov|govt|icnet|jet|lea|ltd|me|mil|mod|national-library-scotland|nel|net|nhs|nic|nls|org|orgn|parliament|plc|police|sch|scot|soc",us:"dni|fed|isa|kids|nsn",uy:"com|edu|gub|mil|net|org",ve:"co|com|edu|gob|info|mil|net|org|web",vi:"co|com|k12|net|org",vn:"ac|biz|com|edu|gov|health|info|int|name|net|org|pro",ye:"co|com|gov|ltd|me|net|org|plc",yu:"ac|co|edu|gov|org",za:"ac|agric|alt|bourse|city|co|cybernet|db|edu|gov|grondar|iaccess|imt|inca|landesign|law|mil|net|ngo|nis|nom|olivetti|org|pix|school|tm|web",zm:"ac|co|com|edu|gov|net|org|sch"},has_expression:null,is_expression:null,has:function(e){return!!e.match(t.has_expression)},is:function(e){return!!e.match(t.is_expression)},get:function(e){var n=e.match(t.has_expression);return n&&n[1]||null},init:function(){var n="";for(var r in t.list){if(!e.call(t.list,r))continue;var i="("+t.list[r]+")."+r;n+="|("+i+")"}t.has_expression=new RegExp("\\.("+n.substr(1)+")$","i"),t.is_expression=new RegExp("^("+n.substr(1)+")$","i")}};return t.init(),t}),function(e,t){typeof exports=="object"?module.exports=t(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):typeof define=="function"&&define.amd?define("URIjs",["./punycode","./IPv6","./SecondLevelDomains"],t):e.URI=t(e.punycode,e.IPv6,e.SecondLevelDomains,e)}(this,function(e,t,n,r){function s(e,t){return this instanceof s?(e===undefined&&(typeof location!="undefined"?e=location.href+"":e=""),this.href(e),t!==undefined?this.absoluteTo(t):this):new s(e,t)}function a(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function f(e){return e===undefined?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function l(e){return f(e)==="Array"}function c(e,t){var n={},r,i;if(l(t))for(r=0,i=t.length;r<i;r++)n[t[r]]=!0;else n[t]=!0;for(r=0,i=e.length;r<i;r++)n[e[r]]!==undefined&&(e.splice(r,1),i--,r--);return e}function h(e,t){var n,r;if(l(t)){for(n=0,r=t.length;n<r;n++)if(!h(e,t[n]))return!1;return!0}var i=f(t);for(n=0,r=e.length;n<r;n++)if(i==="RegExp"){if(typeof e[n]=="string"&&e[n].match(t))return!0}else if(e[n]===t)return!0;return!1}function p(e,t){if(!l(e)||!l(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function d(e){return escape(e)}function v(e){return encodeURIComponent(e).replace(/[!'()*]/g,d).replace(/\*/g,"%2A")}var i=r&&r.URI,o=s.prototype,u=Object.prototype.hasOwnProperty;s._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:s.duplicateQueryParameters,escapeQuerySpace:s.escapeQuerySpace}},s.duplicateQueryParameters=!1,s.escapeQuerySpace=!0,s.protocol_expression=/^[a-z][a-z0-9-+-]*$/i,s.idn_expression=/[^a-z0-9\.-]/i,s.punycode_expression=/(xn--)/i,s.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,s.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,s.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,s.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},s.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,s.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src"},s.getDomAttribute=function(e){if(!e||!e.nodeName)return undefined;var t=e.nodeName.toLowerCase();return t==="input"&&e.type!=="image"?undefined:s.domAttributes[t]},s.encode=v,s.decode=decodeURIComponent,s.iso8859=function(){s.encode=escape,s.decode=unescape},s.unicode=function(){s.encode=v,s.decode=decodeURIComponent},s.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}},s.encodeQuery=function(e,t){var n=s.encode(e+"");return t?n.replace(/%20/g,"+"):n},s.decodeQuery=function(e,t){e+="";try{return s.decode(t?e.replace(/\+/g,"%20"):e)}catch(n){return e}},s.recodePath=function(e){var t=(e+"").split("/");for(var n=0,r=t.length;n<r;n++)t[n]=s.encodePathSegment(s.decode(t[n]));return t.join("/")},s.decodePath=function(e){var t=(e+"").split("/");for(var n=0,r=t.length;n<r;n++)t[n]=s.decodePathSegment(t[n]);return t.join("/")};var m={encode:"encode",decode:"decode"},g,y=function(e,t){return function(n){return s[t](n+"").replace(s.characters[e][t].expression,function(n){return s.characters[e][t].map[n]})}};for(g in m)s[g+"PathSegment"]=y("pathname",m[g]);s.encodeReserved=y("reserved","encode"),s.parse=function(e,t){var n;return t||(t={}),n=e.indexOf("#"),n>-1&&(t.fragment=e.substring(n+1)||null,e=e.substring(0,n)),n=e.indexOf("?"),n>-1&&(t.query=e.substring(n+1)||null,e=e.substring(0,n)),e.substring(0,2)==="//"?(t.protocol=null,e=e.substring(2),e=s.parseAuthority(e,t)):(n=e.indexOf(":"),n>-1&&(t.protocol=e.substring(0,n)||null,t.protocol&&!t.protocol.match(s.protocol_expression)?t.protocol=undefined:t.protocol==="file"?e=e.substring(n+3):e.substring(n+1,n+3)==="//"?(e=e.substring(n+3),e=s.parseAuthority(e,t)):(e=e.substring(n+1),t.urn=!0))),t.path=e,t},s.parseHost=function(e,t){var n=e.indexOf("/"),r,i;return n===-1&&(n=e.length),e.charAt(0)==="["?(r=e.indexOf("]"),t.hostname=e.substring(1,r)||null,t.port=e.substring(r+2,n)||null):e.indexOf(":")!==e.lastIndexOf(":")?(t.hostname=e.substring(0,n)||null,t.port=null):(i=e.substring(0,n).split(":"),t.hostname=i[0]||null,t.port=i[1]||null),t.hostname&&e.substring(n).charAt(0)!=="/"&&(n++,e="/"+e),e.substring(n)||"/"},s.parseAuthority=function(e,t){return e=s.parseUserinfo(e,t),s.parseHost(e,t)},s.parseUserinfo=function(e,t){var n=e.indexOf("/"),r=n>-1?e.lastIndexOf("@",n):e.indexOf("@"),i;return r>-1&&(n===-1||r<n)?(i=e.substring(0,r).split(":"),t.username=i[0]?s.decode(i[0]):null,i.shift(),t.password=i[0]?s.decode(i.join(":")):null,e=e.substring(r+1)):(t.username=null,t.password=null),e},s.parseQuery=function(e,t){if(!e)return{};e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");if(!e)return{};var n={},r=e.split("&"),i=r.length,o,u,a;for(var f=0;f<i;f++)o=r[f].split("="),u=s.decodeQuery(o.shift(),t),a=o.length?s.decodeQuery(o.join("="),t):null,n[u]?(typeof n[u]=="string"&&(n[u]=[n[u]]),n[u].push(a)):n[u]=a;return n},s.build=function(e){var t="";return e.protocol&&(t+=e.protocol+":"),!e.urn&&(t||e.hostname)&&(t+="//"),t+=s.buildAuthority(e)||"",typeof e.path=="string"&&(e.path.charAt(0)!=="/"&&typeof e.hostname=="string"&&(t+="/"),t+=e.path),typeof e.query=="string"&&e.query&&(t+="?"+e.query),typeof e.fragment=="string"&&e.fragment&&(t+="#"+e.fragment),t},s.buildHost=function(e){var t="";return e.hostname?(s.ip6_expression.test(e.hostname)?e.port?t+="["+e.hostname+"]:"+e.port:t+=e.hostname:(t+=e.hostname,e.port&&(t+=":"+e.port)),t):""},s.buildAuthority=function(e){return s.buildUserinfo(e)+s.buildHost(e)},s.buildUserinfo=function(e){var t="";return e.username&&(t+=s.encode(e.username),e.password&&(t+=":"+s.encode(e.password)),t+="@"),t},s.buildQuery=function(e,t,n){var r="",i,o,a,f;for(o in e)if(u.call(e,o)&&o)if(l(e[o])){i={};for(a=0,f=e[o].length;a<f;a++)e[o][a]!==undefined&&i[e[o][a]+""]===undefined&&(r+="&"+s.buildQueryParameter(o,e[o][a],n),t!==!0&&(i[e[o][a]+""]=!0))}else e[o]!==undefined&&(r+="&"+s.buildQueryParameter(o,e[o],n));return r.substring(1)},s.buildQueryParameter=function(e,t,n){return s.encodeQuery(e,n)+(t!==null?"="+s.encodeQuery(t,n):"")},s.addQuery=function(e,t,n){if(typeof t=="object")for(var r in t)u.call(t,r)&&s.addQuery(e,r,t[r]);else{if(typeof t!="string")throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(e[t]===undefined){e[t]=n;return}typeof e[t]=="string"&&(e[t]=[e[t]]),l(n)||(n=[n]),e[t]=e[t].concat(n)}},s.removeQuery=function(e,t,n){var r,i,o;if(l(t))for(r=0,i=t.length;r<i;r++)e[t[r]]=undefined;else if(typeof t=="object")for(o in t)u.call(t,o)&&s.removeQuery(e,o,t[o]);else{if(typeof t!="string")throw new TypeError("URI.addQuery() accepts an object, string as the first parameter");n!==undefined?e[t]===n?e[t]=undefined:l(e[t])&&(e[t]=c(e[t],n)):e[t]=undefined}},s.hasQuery=function(e,t,n,r){if(typeof t=="object"){for(var i in t)if(u.call(t,i)&&!s.hasQuery(e,i,t[i]))return!1;return!0}if(typeof t!="string")throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(f(n)){case"Undefined":return t in e;case"Boolean":var o=Boolean(l(e[t])?e[t].length:e[t]);return n===o;case"Function":return!!n(e[t],t,e);case"Array":if(!l(e[t]))return!1;var a=r?h:p;return a(e[t],n);case"RegExp":if(!l(e[t]))return Boolean(e[t]&&e[t].match(n));if(!r)return!1;return h(e[t],n);case"Number":n=String(n);case"String":if(!l(e[t]))return e[t]===n;if(!r)return!1;return h(e[t],n);default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},s.commonPath=function(e,t){var n=Math.min(e.length,t.length),r;for(r=0;r<n;r++)if(e.charAt(r)!==t.charAt(r)){r--;break}if(r<1)return e.charAt(0)===t.charAt(0)&&e.charAt(0)==="/"?"/":"";if(e.charAt(r)!=="/"||t.charAt(r)!=="/")r=e.substring(0,r).lastIndexOf("/");return e.substring(0,r+1)},s.withinString=function(e,t){return e.replace(s.find_uri_expression,t)},s.ensureValidHostname=function(t){if(t.match(s.invalid_hostname_characters)){if(!e)throw new TypeError("Hostname '"+t+"' contains characters other than [A-Z0-9.-] and Punycode.js is not available");if(e.toASCII(t).match(s.invalid_hostname_characters))throw new TypeError("Hostname '"+t+"' contains characters other than [A-Z0-9.-]")}},s.noConflict=function(e){if(e){var n={URI:this.noConflict()};return URITemplate&&typeof URITemplate.noConflict=="function"&&(n.URITemplate=URITemplate.noConflict()),t&&typeof t.noConflict=="function"&&(n.IPv6=t.noConflict()),SecondLevelDomains&&typeof SecondLevelDomains.noConflict=="function"&&(n.SecondLevelDomains=SecondLevelDomains.noConflict()),n}return r.URI===this&&(r.URI=i),this},o.build=function(e){if(e===!0)this._deferred_build=!0;else if(e===undefined||this._deferred_build)this._string=s.build(this._parts),this._deferred_build=!1;return this},o.clone=function(){return new s(this)},o.valueOf=o.toString=function(){return this.build(!1)._string},m={protocol:"protocol",username:"username",password:"password",hostname:"hostname",port:"port"},y=function(e){return function(t,n){return t===undefined?this._parts[e]||"":(this._parts[e]=t||null,this.build(!n),this)}};for(g in m)o[g]=y(m[g]);m={query:"?",fragment:"#"},y=function(e,t){return function(n,r){return n===undefined?this._parts[e]||"":(n!==null&&(n+="",n.charAt(0)===t&&(n=n.substring(1))),this._parts[e]=n,this.build(!r),this)}};for(g in m)o[g]=y(g,m[g]);m={search:["?","query"],hash:["#","fragment"]},y=function(e,t){return function(n,r){var i=this[e](n,r);return typeof i=="string"&&i.length?t+i:i}};for(g in m)o[g]=y(m[g][1],m[g][0]);o.pathname=function(e,t){if(e===undefined||e===!0){var n=this._parts.path||(this._parts.hostname?"/":"");return e?s.decodePath(n):n}return this._parts.path=e?s.recodePath(e):"/",this.build(!t),this},o.path=o.pathname,o.href=function(e,t){var n;if(e===undefined)return this.toString();this._string="",this._parts=s._parts();var r=e instanceof s,i=typeof e=="object"&&(e.hostname||e.path||e.pathname);if(e.nodeName){var o=s.getDomAttribute(e);e=e[o]||"",i=!1}!r&&i&&e.pathname!==undefined&&(e=e.toString());if(typeof e=="string")this._parts=s.parse(e,this._parts);else{if(!r&&!i)throw new TypeError("invalid input");var a=r?e._parts:e;for(n in a)u.call(this._parts,n)&&(this._parts[n]=a[n])}return this.build(!t),this},o.is=function(e){var t=!1,r=!1,i=!1,o=!1,u=!1,a=!1,f=!1,l=!this._parts.urn;this._parts.hostname&&(l=!1,r=s.ip4_expression.test(this._parts.hostname),i=s.ip6_expression.test(this._parts.hostname),t=r||i,o=!t,u=o&&n&&n.has(this._parts.hostname),a=o&&s.idn_expression.test(this._parts.hostname),f=o&&s.punycode_expression.test(this._parts.hostname));switch(e.toLowerCase()){case"relative":return l;case"absolute":return!l;case"domain":case"name":return o;case"sld":return u;case"ip":return t;case"ip4":case"ipv4":case"inet4":return r;case"ip6":case"ipv6":case"inet6":return i;case"idn":return a;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return f}return null};var b=o.protocol,w=o.port,E=o.hostname;o.protocol=function(e,t){if(e!==undefined&&e){e=e.replace(/:(\/\/)?$/,"");if(e.match(/[^a-zA-z0-9\.+-]/))throw new TypeError("Protocol '"+e+"' contains characters other than [A-Z0-9.+-]")}return b.call(this,e,t)},o.scheme=o.protocol,o.port=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e!==undefined){e===0&&(e=null);if(e){e+="",e.charAt(0)===":"&&(e=e.substring(1));if(e.match(/[^0-9]/))throw new TypeError("Port '"+e+"' contains characters other than [0-9]")}}return w.call(this,e,t)},o.hostname=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e!==undefined){var n={};s.parseHost(e,n),e=n.hostname}return E.call(this,e,t)},o.host=function(e,t){return this._parts.urn?e===undefined?"":this:e===undefined?this._parts.hostname?s.buildHost(this._parts):"":(s.parseHost(e,this._parts),this.build(!t),this)},o.authority=function(e,t){return this._parts.urn?e===undefined?"":this:e===undefined?this._parts.hostname?s.buildAuthority(this._parts):"":(s.parseAuthority(e,this._parts),this.build(!t),this)},o.userinfo=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e===undefined){if(!this._parts.username)return"";var n=s.buildUserinfo(this._parts);return n.substring(0,n.length-1)}return e[e.length-1]!=="@"&&(e+="@"),s.parseUserinfo(e,this._parts),this.build(!t),this},o.resource=function(e,t){var n;return e===undefined?this.path()+this.search()+this.hash():(n=s.parse(e),this._parts.path=n.path,this._parts.query=n.query,this._parts.fragment=n.fragment,this.build(!t),this)},o.subdomain=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e===undefined){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,n)||""}var r=this._parts.hostname.length-this.domain().length,i=this._parts.hostname.substring(0,r),o=new RegExp("^"+a(i));return e&&e.charAt(e.length-1)!=="."&&(e+="."),e&&s.ensureValidHostname(e),this._parts.hostname=this._parts.hostname.replace(o,e),this.build(!t),this},o.domain=function(e,t){if(this._parts.urn)return e===undefined?"":this;typeof e=="boolean"&&(t=e,e=undefined);if(e===undefined){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.match(/\./g);if(n&&n.length<2)return this._parts.hostname;var r=this._parts.hostname.length-this.tld(t).length-1;return r=this._parts.hostname.lastIndexOf(".",r-1)+1,this._parts.hostname.substring(r)||""}if(!e)throw new TypeError("cannot set domain empty");s.ensureValidHostname(e);if(!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var i=new RegExp(a(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(i,e)}return this.build(!t),this},o.tld=function(e,t){if(this._parts.urn)return e===undefined?"":this;typeof e=="boolean"&&(t=e,e=undefined);if(e===undefined){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.lastIndexOf("."),i=this._parts.hostname.substring(r+1);return t!==!0&&n&&n.list[i.toLowerCase()]?n.get(this._parts.hostname)||i:i}var s;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!n||!n.is(e))throw new TypeError("TLD '"+e+"' contains characters other than [A-Z0-9]");s=new RegExp(a(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(s,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");s=new RegExp(a(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(s,e)}return this.build(!t),this},o.directory=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e===undefined||e===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var n=this._parts.path.length-this.filename().length-1,r=this._parts.path.substring(0,n)||(this._parts.hostname?"/":"");return e?s.decodePath(r):r}var i=this._parts.path.length-this.filename().length,o=this._parts.path.substring(0,i),u=new RegExp("^"+a(o));return this.is("relative")||(e||(e="/"),e.charAt(0)!=="/"&&(e="/"+e)),e&&e.charAt(e.length-1)!=="/"&&(e+="/"),e=s.recodePath(e),this._parts.path=this._parts.path.replace(u,e),this.build(!t),this},o.filename=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e===undefined||e===!0){if(!this._parts.path||this._parts.path==="/")return"";var n=this._parts.path.lastIndexOf("/"),r=this._parts.path.substring(n+1);return e?s.decodePathSegment(r):r}var i=!1;e.charAt(0)==="/"&&(e=e.substring(1)),e.match(/\.?\//)&&(i=!0);var o=new RegExp(a(this.filename())+"$");return e=s.recodePath(e),this._parts.path=this._parts.path.replace(o,e),i?this.normalizePath(t):this.build(!t),this},o.suffix=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e===undefined||e===!0){if(!this._parts.path||this._parts.path==="/")return"";var n=this.filename(),r=n.lastIndexOf("."),i,o;return r===-1?"":(i=n.substring(r+1),o=/^[a-z0-9%]+$/i.test(i)?i:"",e?s.decodePathSegment(o):o)}e.charAt(0)==="."&&(e=e.substring(1));var u=this.suffix(),f;if(!u){if(!e)return this;this._parts.path+="."+s.recodePath(e)}else e?f=new RegExp(a(u)+"$"):f=new RegExp(a("."+u)+"$");return f&&(e=s.recodePath(e),this._parts.path=this._parts.path.replace(f,e)),this.build(!t),this},o.segment=function(e,t,n){var r=this._parts.urn?":":"/",i=this.path(),s=i.substring(0,1)==="/",o=i.split(r);e!==undefined&&typeof e!="number"&&(n=t,t=e,e=undefined);if(e!==undefined&&typeof e!="number")throw new Error("Bad segment '"+e+"', must be 0-based integer");s&&o.shift(),e<0&&(e=Math.max(o.length+e,0));if(t===undefined)return e===undefined?o:o[e];if(e===null||o[e]===undefined){if(l(t)){o=[];for(var u=0,a=t.length;u<a;u++){if(!t[u].length&&(!o.length||!o[o.length-1].length))continue;o.length&&!o[o.length-1].length&&o.pop(),o.push(t[u])}}else if(t||typeof t=="string")o[o.length-1]===""?o[o.length-1]=t:o.push(t)}else t||typeof t=="string"&&t.length?o[e]=t:o.splice(e,1);return s&&o.unshift(""),this.path(o.join(r),n)},o.segmentCoded=function(e,t,n){var r,i,o;typeof e!="number"&&(n=t,t=e,e=undefined);if(t===undefined){r=this.segment(e,t,n);if(!l(r))r=r!==undefined?s.decode(r):undefined;else for(i=0,o=r.length;i<o;i++)r[i]=s.decode(r[i]);return r}if(!l(t))t=typeof t=="string"?s.encode(t):t;else for(i=0,o=t.length;i<o;i++)t[i]=s.decode(t[i]);return this.segment(e,t,n)};var S=o.query;return o.query=function(e,t){if(e===!0)return s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof e=="function"){var n=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace),r=e.call(this,n);return this._parts.query=s.buildQuery(r||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return e!==undefined&&typeof e!="string"?(this._parts.query=s.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):S.call(this,e,t)},o.setQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof e=="object")for(var i in e)u.call(e,i)&&(r[i]=e[i]);else{if(typeof e!="string")throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");r[e]=t!==undefined?t:null}return this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof e!="string"&&(n=t),this.build(!n),this},o.addQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.addQuery(r,e,t===undefined?null:t),this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof e!="string"&&(n=t),this.build(!n),this},o.removeQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.removeQuery(r,e,t),this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof e!="string"&&(n=t),this.build(!n),this},o.hasQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.hasQuery(r,e,t,n)},o.setSearch=o.setQuery,o.addSearch=o.addQuery,o.removeSearch=o.removeQuery,o.hasSearch=o.hasQuery,o.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},o.normalizeProtocol=function(e){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},o.normalizeHostname=function(n){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!n)),this},o.normalizePort=function(e){return typeof this._parts.protocol=="string"&&this._parts.port===s.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},o.normalizePath=function(e){if(this._parts.urn)return this;if(!this._parts.path||this._parts.path==="/")return this;var t,n=this._parts.path,r,i;n.charAt(0)!=="/"&&(t=!0,n="/"+n),n=n.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/");for(;;){r=n.indexOf("/../");if(r===-1)break;if(r===0){n=n.substring(3);break}i=n.substring(0,r).lastIndexOf("/"),i===-1&&(i=r),n=n.substring(0,i)+n.substring(r+3)}return t&&this.is("relative")&&(n=n.substring(1)),n=s.recodePath(n),this._parts.path=n,this.build(!e),this},o.normalizePathname=o.normalizePath,o.normalizeQuery=function(e){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(s.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},o.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},o.normalizeSearch=o.normalizeQuery,o.normalizeHash=o.normalizeFragment,o.iso8859=function(){var e=s.encode,t=s.decode;return s.encode=escape,s.decode=decodeURIComponent,this.normalize(),s.encode=e,s.decode=t,this},o.unicode=function(){var e=s.encode,t=s.decode;return s.encode=v,s.decode=unescape,this.normalize(),s.encode=e,s.decode=t,this},o.readable=function(){var t=this.clone();t.username("").password("").normalize();var n="";t._parts.protocol&&(n+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(n+=e.toUnicode(t._parts.hostname),t._parts.port&&(n+=":"+t._parts.port)):n+=t.host()),t._parts.hostname&&t._parts.path&&t._parts.path.charAt(0)!=="/"&&(n+="/"),n+=t.path(!0);if(t._parts.query){var r="";for(var i=0,o=t._parts.query.split("&"),u=o.length;i<u;i++){var a=(o[i]||"").split("=");r+="&"+s.decodeQuery(a[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),a[1]!==undefined&&(r+="="+s.decodeQuery(a[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}n+="?"+r.substring(1)}return n+=s.decodeQuery(t.hash(),!0),n},o.absoluteTo=function(e){var t=this.clone(),n=["protocol","username","password","hostname","port"],r,i,o;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");e instanceof s||(e=new s(e)),t._parts.protocol||(t._parts.protocol=e._parts.protocol);if(this._parts.hostname)return t;for(i=0;o=n[i];i++)t._parts[o]=e._parts[o];n=["query","path"];for(i=0;o=n[i];i++)!t._parts[o]&&e._parts[o]&&(t._parts[o]=e._parts[o]);return t.path().charAt(0)!=="/"&&(r=e.directory(),t._parts.path=(r?r+"/":"")+t._parts.path,t.normalizePath()),t.build(),t},o.relativeTo=function(e){var t=this.clone().normalize(),n,r,i,o,u;if(t._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");e=(new s(e)).normalize(),n=t._parts,r=e._parts,o=t.path(),u=e.path();if(o.charAt(0)!=="/")throw new Error("URI is already relative");if(u.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");n.protocol===r.protocol&&(n.protocol=null);if(n.username!==r.username||n.password!==r.password)return t.build();if(n.protocol!==null||n.username!==null||n.password!==null)return t.build();if(n.hostname!==r.hostname||n.port!==r.port)return t.build();n.hostname=null,n.port=null;if(o===u)return n.path="",t.build();i=s.commonPath(t.path(),e.path());if(!i)return t.build();var a=r.path.substring(i.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return n.path=a+n.path.substring(i.length),t.build()},o.equals=function(e){var t=this.clone(),n=new s(e),r={},i={},o={},a,f,c;t.normalize(),n.normalize();if(t.toString()===n.toString())return!0;a=t.query(),f=n.query(),t.query(""),n.query("");if(t.toString()!==n.toString())return!1;if(a.length!==f.length)return!1;r=s.parseQuery(a,this._parts.escapeQuerySpace),i=s.parseQuery(f,this._parts.escapeQuerySpace);for(c in r)if(u.call(r,c)){if(!l(r[c])){if(r[c]!==i[c])return!1}else if(!p(r[c],i[c]))return!1;o[c]=!0}for(c in i)if(u.call(i,c)&&!o[c])return!1;return!0},o.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},o.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},s}),define("text",["module"],function(e){var t,n,r,i,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,a=typeof location!="undefined"&&location.href,f=a&&location.protocol&&location.protocol.replace(/\:/,""),l=a&&location.hostname,c=a&&(location.port||undefined),h=[],p=e.config&&e.config()||{};t={version:"2.0.6",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(u);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(r){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,p.isBuild&&(h[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}p.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),h=p.useXhr||t.useXhr;!a||h(u,f,l,c)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(h.hasOwnProperty(n)){var s=t.jsEscape(h[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(p.env==="node"||!p.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)};else if(p.env==="xhr"||!p.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);p.onXhr&&p.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),p.onXhrComplete&&p.onXhrComplete(s,e))},s.send(null)};else if(p.env==="rhino"||!p.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(p.env==="xpconnect"||!p.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,t){var n,s,o={},u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),s=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),s.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),o),s.close(),n.close(),t(o.value)}catch(a){throw new Error((u&&u.path||"")+": "+a)}};return t}),define("text!version.json",[],function(){return'{"readiumJs":{"sha":"ff2e43bd3f28cce407a0dbd262ddde73c5f14be2","tag":"Release-0.10-401-gff2e43b","clean":true},"readiumSharedJs":{"sha":"6065d32699ed12df18818da2dbba578a62d0e565","tag":"Release-0.10-488-g6065d32","clean":true}}'}),function(){console.debug||(console.debug=console.log),console.info||(console.info=console.log),console.warn||(console.warn=console.log),console.error||(console.error=console.log)}(),define("console_shim",function(){}),ReadiumSDK={version:function(){return"0.8.0"},Models:{Smil:{}},Views:{ORIENTATION_LANDSCAPE:"orientation_landscape",ORIENTATION_PORTRAIT:"orientation_portrait"},Collections:{},Routers:{},Helpers:{},Overrides:{},Events:{READER_INITIALIZED:"ReaderInitialized",PAGINATION_CHANGED:"PaginationChanged",SETTINGS_APPLIED:"SettingsApplied",FXL_VIEW_RESIZED:"FXLViewResized",READER_VIEW_CREATED:"ReaderViewCreated",READER_VIEW_DESTROYED:"ReaderViewDestroyed",CONTENT_DOCUMENT_LOAD_START:"ContentDocumentLoadStart",CONTENT_DOCUMENT_LOADED:"ContentDocumentLoaded",MEDIA_OVERLAY_STATUS_CHANGED:"MediaOverlayStatusChanged",MEDIA_OVERLAY_TTS_SPEAK:"MediaOverlayTTSSpeak",MEDIA_OVERLAY_TTS_STOP:"MediaOverlayTTSStop"},InternalEvents:{CURRENT_VIEW_PAGINATION_CHANGED:"CurrentViewPaginationChanged"}},navigator.epubReadingSystem={name:"",version:"0.0.0",layoutStyle:"paginated",hasFeature:function(e,t){return t&&t!=="1.0"?!1:e==="dom-manipulation"?!0:e==="layout-changes"?!0:e==="touch-events"?!1:e==="mouse-events"?!0:e==="keyboard-events"?!0:e==="spine-scripting"?!0:!1}},_.extend(ReadiumSDK,Backbone.Events),define("readiumSDK",["backbone"],function(e){return function(){var t,n;return t||e.readiumSDK}}(this)),function(e){var t=function(e){return parseInt(e,10)||0};e.each(["min","max"],function(n,r){e.fn[r+"Size"]=function(e){var n,i;return e?(e.width!==undefined&&this.css(r+"-width",e.width),e.height!==undefined&&this.css(r+"-height",e.height),this):(n=this.css(r+"-width"),i=this.css(r+"-height"),{width:r==="max"&&(n===undefined||n==="none"||t(n)===-1)&&Number.MAX_VALUE||t(n),height:r==="max"&&(i===undefined||i==="none"||t(i)===-1)&&Number.MAX_VALUE||t(i)})}}),e.fn.isVisible=function(){return this.is(":visible")},e.each(["border","margin","padding"],function(n,r){e.fn[r]=function(e){return e?(e.top!==undefined&&this.css(r+"-top"+(r==="border"?"-width":""),e.top),e.bottom!==undefined&&this.css(r+"-bottom"+(r==="border"?"-width":""),e.bottom),e.left!==undefined&&this.css(r+"-left"+(r==="border"?"-width":""),e.left),e.right!==undefined&&this.css(r+"-right"+(r==="border"?"-width":""),e.right),this):{top:t(this.css(r+"-top"+(r==="border"?"-width":""))),bottom:t(this.css(r+"-bottom"+(r==="border"?"-width":""))),left:t(this.css(r+"-left"+(r==="border"?"-width":""))),right:t(this.css(r+"-right"+(r==="border"?"-width":"")))}}})}(jQuery),define("jquerySizes",["jquery"],function(e){return function(){var t,n;return t||e.jquerySizes}}(this)),ReadiumSDK.Helpers.Rect=function(e,t,n,r){this.left=e,this.top=t,this.width=n,this.height=r,this.right=function(){return this.left+this.width},this.bottom=function(){return this.top+this.height},this.isOverlap=function(e,t){return t==undefined&&(t=0),!(e.right()<this.left+t||e.left>this.right()-t||e.bottom()<this.top+t||e.top>this.bottom()-t)}},ReadiumSDK.Helpers.Rect.fromElement=function(e){var t;_.isArray(e)||e instanceof jQuery?t=e[0]:t=e,t.nodeType===3&&(t=e.parent()[0]);var n=t.offsetLeft,r=t.offsetTop,i=t.offsetWidth,s=t.offsetHeight;while(t=t.offsetParent)n+=t.offsetLeft,r+=t.offsetTop;return new ReadiumSDK.Helpers.Rect(n,r,i,s)},ReadiumSDK.Helpers.UpdateHtmlFontSize=function(e,t){var n=t/100,r=e[0].ownerDocument.defaultView,i=$("p, div, span, h1, h2, h3, h4, h5, h6, li, blockquote, td, pre",e),s;for(var o=0;o<i.length;o++){var u=i[o],a=u.getAttribute("data-original-font-size");if(!a){var f=r.getComputedStyle(u),l=parseInt(f.fontSize);s=parseInt(f.lineHeight),u.setAttribute("data-original-font-size",l),s&&u.setAttribute("data-original-line-height",s)}}s=0;for(var o=0;o<i.length;o++){var u=i[o],a=u.getAttribute("data-original-font-size"),c=u.getAttribute("data-original-line-height"),l=Number(a);c?s=Number(c):s=0,u.style.fontSize=l*n+"px",s&&(u.style.lineHeight=s*n+"px")}e.css("font-size",t+"%")},ReadiumSDK.Helpers.ResolveContentRef=function(e,t){if(!t)return e;var n=t.split("/");n.pop();var r=e.split("/");while(n.length>0&&r[0]==="..")n.pop(),r.splice(0,1);var i=n.concat(r);return i.join("/")},ReadiumSDK.Helpers.EndsWith=function(e,t){return e.indexOf(t,e.length-t.length)!==-1},ReadiumSDK.Helpers.BeginsWith=function(e,t){return e.indexOf(t)===0},ReadiumSDK.Helpers.RemoveFromString=function(e,t){var n=e.indexOf(t);return n==-1?e:e.substring(0,n)+e.substring(n+t.length)},ReadiumSDK.Helpers.Margins=function(e,t,n){this.margin=e,this.border=t,this.padding=n,this.left=this.margin.left+this.border.left+this.padding.left,this.right=this.margin.right+this.border.right+this.padding.right,this.top=this.margin.top+this.border.top+this.padding.top,this.bottom=this.margin.bottom+this.border.bottom+this.padding.bottom,this.width=function(){return this.left+this.right},this.height=function(){return this.top+this.bottom}},ReadiumSDK.Helpers.triggerLayout=function(e){var t=e[0].contentDocument;if(!t)return;var n=undefined;try{n=t.styleSheets&&t.styleSheets.length?t.styleSheets[0]:undefined;if(!n){var r=t.createElement("style");t.head.appendChild(r),r.appendChild(t.createTextNode("")),n=r.sheet}n&&n.insertRule("body:first-child::before {content:'READIUM';color: red;font-weight: bold;}",n.cssRules.length)}catch(i){console.error(i)}try{var s=t.createElementNS("http://www.w3.org/1999/xhtml","style");s.appendChild(t.createTextNode("*{}")),t.body.appendChild(s),t.body.removeChild(s),n&&n.deleteRule(n.cssRules.length-1)}catch(i){console.error(i)}if(t.body)var o=t.body.offsetTop},ReadiumSDK.Helpers.deduceSyntheticSpread=function(e,t,n){if(!e||e.length==0)return 0;var r=t?t.getRenditionSpread():undefined;if(r===ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_NONE)return!1;if(n.syntheticSpread=="double")return!0;if(n.syntheticSpread=="single")return!1;if(!t)return 0;if(r===ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_BOTH)return!0;var i=ReadiumSDK.Helpers.getOrientation(e);if(r===ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_LANDSCAPE)return i===ReadiumSDK.Views.ORIENTATION_LANDSCAPE;if(r===ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_PORTRAIT)return i===ReadiumSDK.Views.ORIENTATION_PORTRAIT;if(!r||r===ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_AUTO){var s=i===ReadiumSDK.Views.ORIENTATION_LANDSCAPE;return s?1:0}return console.warn("ReadiumSDK.Helpers.deduceSyntheticSpread: spread properties?!"),0},ReadiumSDK.Helpers.Margins.fromElement=function(e){return new this(e.margin(),e.border(),e.padding())},ReadiumSDK.Helpers.Margins.empty=function(){return new this({left:0,right:0,top:0,bottom:0},{left:0,right:0,top:0,bottom:0},{left:0,right:0,top:0,bottom:0})},ReadiumSDK.Helpers.loadTemplate=function(e,t){return ReadiumSDK.Helpers.loadTemplate.cache[e]},ReadiumSDK.Helpers.loadTemplate.cache={fixed_book_frame:'<div id="fixed-book-frame" class="clearfix book-frame fixed-book-frame"></div>',single_page_frame:'<div><div id="scaler"><iframe scrolling="no" class="iframe-fixed"></iframe></div></div>',scrolled_book_frame:'<div id="reflowable-book-frame" class="clearfix book-frame reflowable-book-frame"><div id="scrolled-content-frame"></div></div>',reflowable_book_frame:'<div id="reflowable-book-frame" class="clearfix book-frame reflowable-book-frame"></div>',reflowable_book_page_frame:'<div id="reflowable-content-frame" class="reflowable-content-frame"><iframe scrolling="no" id="epubContentIframe"></iframe></div>'},ReadiumSDK.Helpers.setStyles=function(e,t){var n=e.length;if(!n)return;for(var r=0;r<n;r++){var i=e[r];i.selector?$(i.selector,t).css(i.declarations):t.css(i.declarations)}},ReadiumSDK.Helpers.isIframeAlive=function(e){var t=undefined,n=undefined;try{t=e.contentWindow,n=e.contentDocument}catch(r){return console.error(r),!1}return t&&n},ReadiumSDK.Helpers.getOrientation=function(e){var t=e.width(),n=e.height();return!t||!n?undefined:t>=n?ReadiumSDK.Views.ORIENTATION_LANDSCAPE:ReadiumSDK.Views.ORIENTATION_PORTRAIT},ReadiumSDK.Helpers.isRenditionSpreadPermittedForItem=function(e,t){var n=e.getRenditionSpread();return!n||n==ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_BOTH||n==ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_AUTO||n==ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_LANDSCAPE&&t==ReadiumSDK.Views.ORIENTATION_LANDSCAPE||n==ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_PORTRAIT&&t==ReadiumSDK.Views.ORIENTATION_PORTRAIT},ReadiumSDK.Helpers.CSSTransition=function(e,t){var n={};_.each(["","-webkit-","-moz-","-ms-"],function(e){n[e+"transition"]=e+t}),e.css(n)},ReadiumSDK.Helpers.CSSTransformString=function(e){var t=e.enable3D?!0:!1,n,r,i,s=e.origin;if(e.left||e.top){var o=e.left||0,u=e.top||0;n=t?"translate3D("+o+"px, "+u+"px, 0)":"translate("+o+"px, "+u+"px)"}e.scale&&(r=t?"scale3D("+e.scale+", "+e.scale+", 0)":"scale("+e.scale+")"),e.angle&&(i=t?"rotate3D(0,0,"+e.angle+"deg)":"rotate("+e.angle+"deg)");if(!(n||r||i))return{};var a=n&&r?n+" "+r:n?n:r;i&&(a=a+" "+i);var f={};return f.transform=a,f["transform-origin"]=s?s:t?"0 0 0":"0 0",f},ReadiumSDK.Helpers.extendedThrottle=function(e,t,n,r,i,s){r||(r=250),i||(i=r);var o=!0,u,a;return function(){var f=s||this,l=Date.now&&Date.now()||(new Date).getTime(),c=arguments;u&&l<u+r||(u=l,o?(e.apply(f,c),o=!1):t.apply(f,c)),clearTimeout(a),a=setTimeout(function(){u=l,o=!0,n.apply(f,c)},i)}},ReadiumSDK.Helpers.escapeJQuerySelector=function(e){if(!e)return undefined;var t=e.replace(/([;&,\.\+\*\~\?':"\!\^#$%@\[\]\(\)<=>\|\/\\{}`])/g,"\\$1");return t},define("helpers",["readiumSDK","jquerySizes"],function(e){return function(){var t,n;return t||e.helpers}}(this)),ReadiumSDK.Models.ViewerSettings=function(e){function n(e){var t=[],n=e.split(/[\s,;]+/);for(var r=0;r<n.length;r++){var i=n[r].trim();i!==""&&t.push(i)}return t}function r(e,n,r){n[e]!==undefined&&(r?t[e]=r(n[e]):t[e]=n[e])}var t=this;this.syntheticSpread="auto",this.fontSize=100,this.columnGap=20,this.mediaOverlaysPreservePlaybackWhenScroll=!1,this.mediaOverlaysSkipSkippables=!1,this.mediaOverlaysEscapeEscapables=!0,this.mediaOverlaysSkippables=[],this.mediaOverlaysEscapables=[],this.mediaOverlaysEnableClick=!0,this.mediaOverlaysRate=1,this.mediaOverlaysVolume=100,this.mediaOverlaysSynchronizationGranularity="",this.mediaOverlaysAutomaticPageTurn=!0,this.enableGPUHardwareAccelerationCSS3D=!1,this.pageTransition=-1,this.scroll="auto",this.update=function(e){r("columnGap",e),r("fontSize",e),r("mediaOverlaysPreservePlaybackWhenScroll",e),r("mediaOverlaysSkipSkippables",e),r("mediaOverlaysEscapeEscapables",e),r("mediaOverlaysSkippables",e,n),r("mediaOverlaysEscapables",e,n),r("mediaOverlaysEnableClick",e),r("mediaOverlaysRate",e),r("mediaOverlaysVolume",e),r("mediaOverlaysSynchronizationGranularity",e),r("mediaOverlaysAutomaticPageTurn",e),r("scroll",e),r("syntheticSpread",e),r("pageTransition",e),r("enableGPUHardwareAccelerationCSS3D",e)},this.update(e)},define("viewerSettings",["readiumSDK"],function(e){return function(){var t,n;return t||e.viewerSettings}}(this)),ReadiumSDK.Models.Style=function(e,t){this.selector=e,this.declarations=t,this.setDeclarations=function(e){for(var t in e)e.hasOwnProperty(t)&&(this.declarations[t]=e[t])}},define("style",["readiumSDK"],function(e){return function(){var t,n;return t||e.style}}(this)),ReadiumSDK.Collections.StyleCollection=function(){var e=[];this.clear=function(){e.length=0},this.findStyle=function(t){var n=e.length;for(var r=0;r<n;r++)if(e[r].selector===t)return e[r];return undefined},this.addStyle=function(t,n){var r=this.findStyle(t);return r?r.setDeclarations(n):(r=new ReadiumSDK.Models.Style(t,n),e.push(r)),r},this.removeStyle=function(t){var n=e.length;for(var r=0;r<n;r++)if(e[r].selector===t){e.splice(r,1);return}},this.getStyles=function(){return e},this.resetStyleValues=function(){var t=e.length;for(var n=0;n<t;n++){var r=e[n],i=r.declarations;for(var s in i)i.hasOwnProperty(s)&&(i[s]="")}}},define("styleCollection",["readiumSDK","style"],function(e){return function(){var t,n;return t||e.styleCollection}}(this)),ReadiumSDK.Models.SpineItem=function(e,t,n){function i(){if(!r.page_spread)return;r.page_spread!=ReadiumSDK.Models.SpineItem.SPREAD_LEFT&&r.page_spread!=ReadiumSDK.Models.SpineItem.SPREAD_RIGHT&&r.page_spread!=ReadiumSDK.Models.SpineItem.SPREAD_CENTER&&console.error(r.page_spread+" is not a recognized spread type")}function s(e,t){return r[e]?r[e]===t:r.spine.package[e]?r.spine.package[e]===t:!1}var r=this;this.idref=e.idref,this.href=e.href,this.linear=e.linear?e.linear.toLowerCase():e.linear,this.page_spread=e.page_spread,this.rendition_viewport=e.rendition_viewport,this.rendition_spread=e.rendition_spread,this.rendition_orientation=e.rendition_orientation,this.rendition_layout=e.rendition_layout,this.rendition_flow=e.rendition_flow,this.media_overlay_id=e.media_overlay_id,this.media_type=e.media_type,this.index=t,this.spine=n,i(),this.setSpread=function(e){this.page_spread=e,i()},this.isRenditionSpreadAllowed=function(){var e=r.getRenditionSpread();return!e||e!=ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_NONE},this.isLeftPage=function(){return r.page_spread==ReadiumSDK.Models.SpineItem.SPREAD_LEFT},this.isRightPage=function(){return r.page_spread==ReadiumSDK.Models.SpineItem.SPREAD_RIGHT},this.isCenterPage=function(){return r.page_spread==ReadiumSDK.Models.SpineItem.SPREAD_CENTER},this.isReflowable=function(){return!r.isFixedLayout()},this.isFixedLayout=function(){var e=r.getRenditionLayout();if(e){if(r.rendition_layout){if(r.rendition_layout===ReadiumSDK.Models.SpineItem.RENDITION_LAYOUT_PREPAGINATED)return!0;if(r.rendition_layout===ReadiumSDK.Models.SpineItem.RENDITION_LAYOUT_REFLOWABLE)return!1}return r.spine.package.isFixedLayout()}return r.media_type.indexOf("image/")>=0},this.getRenditionFlow=function(){return r.rendition_flow?r.rendition_flow:r.spine.package.rendition_flow},this.getRenditionViewport=function(){return r.rendition_viewport?r.rendition_viewport:r.spine.package.rendition_viewport},this.getRenditionSpread=function(){return r.rendition_spread?r.rendition_spread:r.spine.package.rendition_spread},this.getRenditionOrientation=function(){return r.rendition_orientation?r.rendition_orientation:r.spine.package.rendition_orientation},this.getRenditionLayout=function(){return r.rendition_layout?r.rendition_layout:r.spine.package.rendition_layout},this.isFlowScrolledContinuous=function(){return s("rendition_flow",ReadiumSDK.Models.SpineItem.RENDITION_FLOW_SCROLLED_CONTINUOUS)},this.isFlowScrolledDoc=function(){return s("rendition_flow",ReadiumSDK.Models.SpineItem.RENDITION_FLOW_SCROLLED_DOC)}},ReadiumSDK.Models.SpineItem.RENDITION_LAYOUT_REFLOWABLE="reflowable",ReadiumSDK.Models.SpineItem.RENDITION_LAYOUT_PREPAGINATED="pre-paginated",ReadiumSDK.Models.SpineItem.RENDITION_ORIENTATION_LANDSCAPE="landscape",ReadiumSDK.Models.SpineItem.RENDITION_ORIENTATION_PORTRAIT="portrait",ReadiumSDK.Models.SpineItem.RENDITION_ORIENTATION_AUTO="auto",ReadiumSDK.Models.SpineItem.SPREAD_LEFT="page-spread-left",ReadiumSDK.Models.SpineItem.SPREAD_RIGHT="page-spread-right",ReadiumSDK.Models.SpineItem.SPREAD_CENTER="page-spread-center",ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_NONE="none",ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_LANDSCAPE="landscape",ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_PORTRAIT="portrait",ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_BOTH="both",ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_AUTO="auto",ReadiumSDK.Models.SpineItem.RENDITION_FLOW_PAGINATED="paginated",ReadiumSDK.Models.SpineItem.RENDITION_FLOW_SCROLLED_CONTINUOUS="scrolled-continuous",ReadiumSDK.Models.SpineItem.RENDITION_FLOW_SCROLLED_DOC="scrolled-doc",ReadiumSDK.Models.SpineItem.RENDITION_FLOW_AUTO="auto",ReadiumSDK.Models.SpineItem.alternateSpread=function(e){return e===ReadiumSDK.Models.SpineItem.SPREAD_LEFT?ReadiumSDK.Models.SpineItem.SPREAD_RIGHT:e===ReadiumSDK.Models.SpineItem.SPREAD_RIGHT?ReadiumSDK.Models.SpineItem.SPREAD_LEFT:e},define("spineItem",["readiumSDK"],function(e){return function(){var t,n;return t||e.spineItem}}(this)),ReadiumSDK.Models.Spine=function(e,t){function i(e){return!r||e.linear!=="no"}function s(e){if(!u(e))return undefined;var t=n.items[e];return i(t)?t:s(t.index+1)}function o(e){if(!u(e))return undefined;var t=n.items[e];return i(t)?t:o(t.index-1)}function u(e){return e>=0&&e<n.items.length}function a(){var e=n.items.length,t=!1,r=n.isLeftToRight()?ReadiumSDK.Models.SpineItem.SPREAD_LEFT:ReadiumSDK.Models.SpineItem.SPREAD_RIGHT;for(var i=0;i<e;i++){var s=n.items[i];if(!s.page_spread){var o=s.isRenditionSpreadAllowed()?t?r:ReadiumSDK.Models.SpineItem.alternateSpread(r):ReadiumSDK.Models.SpineItem.SPREAD_CENTER;s.setSpread(o)}t=!s.isRenditionSpreadAllowed()||s.page_spread!=r}}var n=this;this.items=[],this.direction="ltr",this.package=e;var r=!1;this.handleLinear=function(e){r=e},this.isValidLinearItem=function(e){return u(e)?i(this.item(e)):undefined},this.prevItem=function(e){return o(e.index-1)},this.nextItem=function(e){return s(e.index+1)},this.getItemUrl=function(e){return n.package.resolveRelativeUrl(e.href)},this.first=function(){return s(0)},this.last=function(){return o(this.items.length-1)},this.isFirstItem=function(e){return n.first()===e},this.isLastItem=function(e){return n.last()===e},this.item=function(e){return u(e)?n.items[e]:undefined},this.isRightToLeft=function(){return n.direction=="rtl"},this.isLeftToRight=function(){return!n.isRightToLeft()},this.getItemById=function(e){var t=n.items.length;for(var r=0;r<t;r++)if(n.items[r].idref==e)return n.items[r];return undefined},this.getItemByHref=function(e){var t=n.items.length;for(var r=0;r<t;r++)if(n.items[r].href==e)return n.items[r];return undefined};if(t){t.direction&&(this.direction=t.direction);var f=t.items.length;for(var l=0;l<f;l++){var c=new ReadiumSDK.Models.SpineItem(t.items[l],l,this);this.items.push(c)}a()}},define("spine",["readiumSDK","spineItem"],function(e){return function(){var t,n;return t||e.spine}}(this)),ReadiumSDK.Models.Smil.SmilNode=function(e){this.parent=e,this.id="",this.getSmil=function(){var e=this;while(e.parent)e=e.parent;return e},this.hasAncestor=function(e){var t=this.parent;while(t){if(t==e)return!0;t=t.parent}return!1}},ReadiumSDK.Models.Smil.TimeContainerNode=function(e){this.parent=e,this.children=undefined,this.index=undefined,this.epubtype="",this.isEscapable=function(e){if(this.epubtype==="")return!1;var t=this.getSmil();if(!t.mo)return!1;var n=t.mo.escapables;e.length>0&&(n=e);for(var r=0;r<n.length;r++)if(this.epubtype.indexOf(n[r])>=0)return!0;return!1},this.isSkippable=function(e){if(this.epubtype==="")return!1;var t=this.getSmil();if(!t.mo)return!1;var n=t.mo.skippables;e.length>0&&(n=e);for(var r=0;r<n.length;r++)if(this.epubtype.indexOf(n[r])>=0)return!0;return!1}},ReadiumSDK.Models.Smil.TimeContainerNode.prototype=new ReadiumSDK.Models.Smil.SmilNode,ReadiumSDK.Models.Smil.MediaNode=function(e){this.parent=e,this.src=""},ReadiumSDK.Models.Smil.MediaNode.prototype=new ReadiumSDK.Models.Smil.SmilNode,ReadiumSDK.Models.Smil.SeqNode=function(e){this.parent=e,this.children=[],this.nodeType="seq",this.textref="",this.durationMilliseconds=function(){var e=this.getSmil(),t=0;for(var n=0;n<this.children.length;n++){var r=this.children[n];if(r.nodeType==="par"){if(!r.audio)continue;if(r.text&&(!r.text.manifestItemId||r.text.manifestItemId!=e.spineItemId))continue;var i=r.audio.clipDurationMilliseconds();t+=i}else r.nodeType==="seq"&&(t+=r.durationMilliseconds())}return t},this.clipOffset=function(e,t){var n=this.getSmil();for(var r=0;r<this.children.length;r++){var i=this.children[r];if(i.nodeType==="par"){if(i==t)return!0;if(!i.audio)continue;if(i.text&&(!i.text.manifestItemId||i.text.manifestItemId!=n.spineItemId))continue;var s=i.audio.clipDurationMilliseconds();e.offset+=s}else if(i.nodeType==="seq"){var o=i.clipOffset(e,t);if(o)return!0}}return!1},this.parallelAt=function(e){var t=this.getSmil(),n=0;for(var r=0;r<this.children.length;r++){var i=e-n,s=this.children[r];if(s.nodeType==="par"){if(!s.audio)continue;if(s.text&&(!s.text.manifestItemId||s.text.manifestItemId!=t.spineItemId))continue;var o=s.audio.clipDurationMilliseconds();if(o>0&&i<=o)return s;n+=o}else if(s.nodeType==="seq"){var u=s.parallelAt(i);if(u)return u;n+=s.durationMilliseconds()}}return undefined},this.nthParallel=function(e,t){for(var n=0;n<this.children.length;n++){var r=this.children[n];if(r.nodeType==="par"){t.count++;if(t.count==e)return r}else if(r.nodeType==="seq"){var i=r.nthParallel(e,t);if(i)return i}}return undefined}},ReadiumSDK.Models.Smil.SeqNode.prototype=new ReadiumSDK.Models.Smil.TimeContainerNode,ReadiumSDK.Models.Smil.ParNode=function(e){this.parent=e,this.children=[],this.nodeType="par",this.text=undefined,this.audio=undefined,this.element=undefined,this.getFirstSeqAncestorWithEpubType=function(e,t){if(!e)return undefined;var n=t?this:this.parent;while(n){if(n.epubtype&&n.epubtype.indexOf(e)>=0)return n;n=n.parent}return undefined}},ReadiumSDK.Models.Smil.ParNode.prototype=new ReadiumSDK.Models.Smil.TimeContainerNode,ReadiumSDK.Models.Smil.TextNode=function(e){this.parent=e,this.nodeType="text",this.srcFile="",this.srcFragmentId="",this.manifestItemId=undefined,this.updateMediaManifestItemId=function(){var e=this.getSmil();if(!e.href||!e.href.length)return;var t=this.srcFile?this.srcFile:this.src,n=ReadiumSDK.Helpers.ResolveContentRef(t,e.href),r=e.mo.package.resolveRelativeUrlMO(n);for(var i=0;i<e.mo.package.spine.items.length;i++){var s=e.mo.package.spine.items[i],o=e.mo.package.resolveRelativeUrl(s.href);if(o===r){this.manifestItemId=s.idref;return}}console.error("Cannot set the Media ManifestItemId? "+this.src+" && "+e.href)}},ReadiumSDK.Models.Smil.TextNode.prototype=new ReadiumSDK.Models.Smil.MediaNode,ReadiumSDK.Models.Smil.AudioNode=function(e){this.parent=e,this.nodeType="audio",this.clipBegin=0,this.MAX=1234567890.1,this.clipEnd=this.MAX,this.clipDurationMilliseconds=function(){var e=this.clipBegin*1e3,t=this.clipEnd*1e3;return this.clipEnd>=this.MAX||t<=e?0:t-e}},ReadiumSDK.Models.Smil.AudioNode.prototype=new ReadiumSDK.Models.Smil.MediaNode,ReadiumSDK.Models.SmilModel=function(){this.parent=undefined,this.children=[],this.id=undefined,this.href=undefined,this.duration=undefined,this.mo=undefined,this.parallelAt=function(e){return this.children[0].parallelAt(e)},this.nthParallel=function(e){var t={count:-1};return this.children[0].nthParallel(e,t)},this.clipOffset=function(e){var t={offset:0};return this.children[0].clipOffset(t,e)?t.offset:0},this.durationMilliseconds_Calculated=function(){return this.children[0].durationMilliseconds()};var e=[];this.hasSync=function(t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},this.addSync=function(t){if(!t)return;var n=t.split(" ");for(var r=0;r<n.length;r++){var i=n[r].trim();i.length>0&&!this.hasSync(i)&&e.push(i)}}},ReadiumSDK.Models.SmilModel.fromSmilDTO=function(e,t){t.DEBUG&&console.debug("Media Overlay DTO import...");var n=0,r=function(){var e="";for(var t=0;t<n;t++)e+="   ";return e},i=new ReadiumSDK.Models.SmilModel;i.id=e.id,i.spineItemId=e.spineItemId,i.href=e.href,i.smilVersion=e.smilVersion,i.duration=e.duration,i.duration&&i.duration.length&&i.duration.length>0&&(console.error("SMIL duration is string, parsing float... ("+i.duration+")"),i.duration=parseFloat(i.duration)),i.mo=t,i.mo.DEBUG&&(console.log("JS MO smilVersion="+i.smilVersion),console.log("JS MO id="+i.id),console.log("JS MO spineItemId="+i.spineItemId),console.log("JS MO href="+i.href),console.log("JS MO duration="+i.duration));var s=function(e,t,n,s){e in t?(e in n||console.debug("property "+e+" not declared in smil node "+n.nodeType),n[e]=t[e],i.mo.DEBUG&&console.log(r()+"JS MO: ["+e+"="+n[e]+"]")):s&&console.log("Required property "+e+" not found in smil node "+t.nodeType)},o=function(e,t){var o;if(e.nodeType=="seq")i.mo.DEBUG&&console.log(r()+"JS MO seq"),o=new ReadiumSDK.Models.Smil.SeqNode(t),s("textref",e,o,t&&t.parent?!0:!1),s("id",e,o),s("epubtype",e,o),o.epubtype&&o.getSmil().addSync(o.epubtype),n++,u(e,o),n--;else if(e.nodeType=="par"){i.mo.DEBUG&&console.log(r()+"JS MO par"),o=new ReadiumSDK.Models.Smil.ParNode(t),s("id",e,o),s("epubtype",e,o),o.epubtype&&o.getSmil().addSync(o.epubtype),n++,u(e,o),n--;for(var a=0,f=o.children.length;a<f;a++){var l=o.children[a];l.nodeType=="text"?o.text=l:l.nodeType=="audio"?o.audio=l:console.error("Unexpected smil node type: "+l.nodeType)}var c=!1;if(c||!o.audio){var h=new ReadiumSDK.Models.Smil.AudioNode(o);h.clipBegin=0,h.clipEnd=h.MAX,h.src=undefined,o.audio=h}}else if(e.nodeType=="text")i.mo.DEBUG&&console.log(r()+"JS MO text"),o=new ReadiumSDK.Models.Smil.TextNode(t),s("src",e,o,!0),s("srcFile",e,o,!0),s("srcFragmentId",e,o,!1),s("id",e,o),o.updateMediaManifestItemId();else{if(e.nodeType!="audio")return console.error("Unexpected smil node type: "+e.nodeType),undefined;i.mo.DEBUG&&console.log(r()+"JS MO audio"),o=new ReadiumSDK.Models.Smil.AudioNode(t),s("src",e,o,!0),s("id",e,o),s("clipBegin",e,o),o.clipBegin&&o.clipBegin.length&&o.clipBegin.length>0&&(console.error("SMIL clipBegin is string, parsing float... ("+o.clipBegin+")"),o.clipBegin=parseFloat(o.clipBegin)),o.clipBegin<0&&(i.mo.DEBUG&&console.log(r()+"JS MO clipBegin adjusted to ZERO"),o.clipBegin=0),s("clipEnd",e,o),o.clipEnd&&o.clipEnd.length&&o.clipEnd.length>0&&(console.error("SMIL clipEnd is string, parsing float... ("+o.clipEnd+")"),o.clipEnd=parseFloat(o.clipEnd)),o.clipEnd<=o.clipBegin&&(i.mo.DEBUG&&console.log(r()+"JS MO clipEnd adjusted to MAX"),o.clipEnd=o.MAX)}return o},u=function(e,t){var n=e.children.length;for(var r=0;r<n;r++){var i=o(e.children[r],t);i.index=r,t.children.push(i)}};return u(e,i),i},define("smilModel",["readiumSDK"],function(e){return function(){var t,n;return t||e.smilModel}}(this)),ReadiumSDK.Models.MediaOverlay=function(e){this.package=e,this.parallelAt=function(e){var t=0;for(var n=0;n<this.smil_models.length;n++){var r=this.smil_models[n],i=e-t,s=r.parallelAt(i);if(s)return s;t+=r.durationMilliseconds_Calculated()}return undefined},this.percentToPosition=function(e,t,n,r){if(e<0||e>100)e=0;var i=this.durationMilliseconds_Calculated(),s=i*(e/100);n.par=this.parallelAt(s);if(!n.par)return;var o=n.par.getSmil();if(!o)return;var u=0;for(var a=0;a<this.smil_models.length;a++){t.smilData=this.smil_models[a];if(t.smilData==o)break;u+=t.smilData.durationMilliseconds_Calculated()}r.milliseconds=s-(u+t.smilData.clipOffset(n.par))},this.durationMilliseconds_Calculated=function(){var e=0;for(var t=0;t<this.smil_models.length;t++){var n=this.smil_models[t];e+=n.durationMilliseconds_Calculated()}return e},this.smilAt=function(e){return e<0||e>=this.smil_models.length?undefined:this.smil_models[e]},this.positionToPercent=function(e,t,n){if(e>=this.smil_models.length)return-1;var r=0;for(var i=0;i<e;i++){var s=this.smil_models[i];r+=s.durationMilliseconds_Calculated()}var o=this.smil_models[e],u=o.nthParallel(t);if(!u)return-1;var a=r+o.clipOffset(u)+n,f=this.durationMilliseconds_Calculated(),l=a/f*100;return l},this.smil_models=[],this.skippables=[],this.escapables=[],this.duration=undefined,this.narrator=undefined,this.activeClass=undefined,this.playbackActiveClass=undefined,this.DEBUG=!1,this.getSmilBySpineItem=function(e){if(!e)return undefined;for(var t=0,n=this.smil_models.length;t<n;t++){var r=this.smil_models[t];if(r.spineItemId===e.idref)return e.media_overlay_id!==r.id&&console.error("SMIL INCORRECT ID?? "+e.media_overlay_id+" /// "+r.id),r}return undefined},this.getNextSmil=function(e){var t=this.smil_models.indexOf(e);return t==-1||t==this.smil_models.length-1?undefined:this.smil_models[t+1]},this.getPreviousSmil=function(e){var t=this.smil_models.indexOf(e);return t==-1||t==0?undefined:this.smil_models[t-1]}},ReadiumSDK.Models.MediaOverlay.fromDTO=function(e,t){var n=new ReadiumSDK.Models.MediaOverlay(t);if(!e)return console.debug("No Media Overlay."),n;console.debug("Media Overlay INIT..."),n.duration=e.duration,n.duration&&n.duration.length&&n.duration.length>0&&(console.error("SMIL total duration is string, parsing float... ("+n.duration+")"),n.duration=parseFloat(n.duration)),n.DEBUG&&console.debug("Media Overlay Duration (TOTAL): "+n.duration),n.narrator=e.narrator,n.DEBUG&&console.debug("Media Overlay Narrator: "+n.narrator),n.activeClass=e.activeClass,n.DEBUG&&console.debug("Media Overlay Active-Class: "+n.activeClass),n.playbackActiveClass=e.playbackActiveClass,n.DEBUG&&console.debug("Media Overlay Playback-Active-Class: "+n.playbackActiveClass);var r=e.smil_models.length;n.DEBUG&&console.debug("Media Overlay SMIL count: "+r);for(var i=0;i<r;i++){var s=ReadiumSDK.Models.SmilModel.fromSmilDTO(e.smil_models[i],n);n.smil_models.push(s),n.DEBUG&&console.debug("Media Overlay Duration (SPINE ITEM): "+s.duration)}r=e.skippables.length,n.DEBUG&&console.debug("Media Overlay SKIPPABLES count: "+r);for(var i=0;i<r;i++)n.skippables.push(e.skippables[i]);r=e.escapables.length,n.DEBUG&&console.debug("Media Overlay ESCAPABLES count: "+r);for(var i=0;i<r;i++)n.escapables.push(e.escapables[i]);return n},define("mediaOverlay",["readiumSDK","smilModel"],function(e){return function(){var t,n;return t||e.mediaOverlay}}(this)),ReadiumSDK.Models.Package=function(e){var t=this;this.spine=undefined,this.rootUrl=undefined,this.rootUrlMO=undefined,this.media_overlay=undefined,this.rendition_viewport=undefined,this.rendition_flow=undefined,this.rendition_layout=undefined,this.rendition_spread=undefined,this.rendition_orientation=undefined,this.resolveRelativeUrlMO=function(e){return t.rootUrlMO&&t.rootUrlMO.length>0?ReadiumSDK.Helpers.EndsWith(t.rootUrlMO,"/")?t.rootUrlMO+e:t.rootUrlMO+"/"+e:t.resolveRelativeUrl(e)},this.resolveRelativeUrl=function(e){return t.rootUrl?ReadiumSDK.Helpers.EndsWith(t.rootUrl,"/")?t.rootUrl+e:t.rootUrl+"/"+e:e},this.isFixedLayout=function(){return t.rendition_layout===ReadiumSDK.Models.SpineItem.RENDITION_LAYOUT_PREPAGINATED},this.isReflowable=function(){return!t.isFixedLayout()},e&&(this.rootUrl=e.rootUrl,this.rootUrlMO=e.rootUrlMO,this.rendition_viewport=e.rendition_viewport,this.rendition_layout=e.rendition_layout,this.rendition_flow=e.rendition_flow,this.rendition_orientation=e.rendition_orientation,this.rendition_spread=e.rendition_spread,this.spine=new ReadiumSDK.Models.Spine(this,e.spine),this.media_overlay=ReadiumSDK.Models.MediaOverlay.fromDTO(e.media_overlay,this))},define("package",["readiumSDK","spine","mediaOverlay"],function(e){return function(){var t,n;return t||e.package}}(this)),function(){var e=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,t=navigator.userAgent.toLowerCase().indexOf("android")>-1,n=e||t,r=!1,i=new Audio;r&&(i.addEventListener("load",function(){console.debug("0) load")}),i.addEventListener("loadstart",function(){console.debug("1) loadstart")}),i.addEventListener("durationchange",function(){console.debug("2) durationchange")}),i.addEventListener("loadedmetadata",function(){console.debug("3) loadedmetadata")}),i.addEventListener("loadeddata",function(){console.debug("4) loadeddata")}),i.addEventListener("progress",function(){console.debug("5) progress")}),i.addEventListener("canplay",function(){console.debug("6) canplay")}),i.addEventListener("canplaythrough",function(){console.debug("7) canplaythrough")}),i.addEventListener("play",function(){console.debug("8) play")}),i.addEventListener("pause",function(){console.debug("9) pause")}),i.addEventListener("ended",function(){console.debug("10) ended")}),i.addEventListener("seeked",function(){console.debug("X) seeked")}),i.addEventListener("timeupdate",function(){console.debug("Y) timeupdate")})),ReadiumSDK.Views.AudioPlayer=function(n,s,o,u,a){function d(){n({isPlaying:!0}),u()}function v(){a(),n({isPlaying:!1})}function m(){if(i.moSeeking){r&&console.debug("onEnded() skipped (still seeking...)");return}w(),o(),n({isPlaying:!1})}function b(){if(y)return;y=setInterval(function(){if(i.moSeeking){r&&console.debug("interval timer skipped (still seeking...)"),g++,g>1e3&&(g=0,w());return}var e=i.currentTime;s(e,1)},20)}function w(){y&&clearInterval(y),y=undefined}function k(e){$(i).off(C,k),r&&console.debug("onReadyToSeek #"+e.data.playId),L(e.data.seekBegin,e.data.playId,!0)}function L(e,t,n){r&&console.debug("playSeekCurrentTime() #"+t),e==0&&(e=.01);if(Math.abs(e-i.currentTime)<.3){r&&console.debug("playSeekCurrentTime() CONTINUE"),i.moSeeking=undefined,f.play();return}var s=n?O:M;r&&console.debug("playSeekCurrentTime() NEED SEEK, EV: "+s),f.pause(),$(i).on(s,{newCurrentTime:e,playId:t,isNewSrc:n},_);try{i.currentTime=e}catch(o){console.error(o.message),setTimeout(function(){try{i.currentTime=e}catch(t){console.error(t.message)}},5)}}function _(e){var t=e.data.isNewSrc?O:M,n=e.data.seekRetries==undefined;(n||e.data.seekRetries==A)&&$(i).off(t,_),r&&console.debug("onSeeked() #"+e.data.playId+" FIRST? "+n+" EV: "+t);var s=i.currentTime,o=Math.abs(e.data.newCurrentTime-s);if((n||e.data.seekRetries>=0)&&o>=1)r&&console.debug("onSeeked() time diff: "+e.data.newCurrentTime+" vs. "+s+" ("+o+")"),n&&(e.data.seekRetries=A,e.data.isNewSrc=!1),e.data.seekRetries--,r&&console.debug("onSeeked() FAIL => retry again (timeout)"),setTimeout(function(){_(e)},50),setTimeout(function(){try{i.pause(),setTimeout(function(){i.currentTime=e.data.newCurrentTime},0)}catch(t){console.error(t.message),setTimeout(function(){try{i.pause(),setTimeout(function(){i.currentTime=e.data.newCurrentTime},0)}catch(t){console.error(t.message)}},4)}},5);else{r&&(console.debug("onSeeked() STATE:"),console.debug(n),console.debug(e.data.seekRetries),console.debug(o));if(o>=1){r&&console.debug("onSeeked() ABORT, TRY AGAIN FROM SCRATCH!");var u=c,a=l,h=e.data.newCurrentTime;f.reset(),setTimeout(function(){f.playFile(u,a,h)},10);return}r&&console.debug("onSeeked() OKAY => play!"),e.data.seekRetries=undefined,f.play(),i.moSeeking=undefined}}var f=this,l=undefined,c=undefined;this.currentSmilSrc=function(){return c};var h=1;this.setRate=function(e){h=e,h<.5&&(h=.5),h>4&&(h=4),i.playbackRate=h},f.setRate(h),this.getRate=function(){return h};var p=100;this.setVolume=function(e){p=e,p<0&&(p=0),p>1&&(p=1),i.volume=p},f.setVolume(p),this.getVolume=function(){return p},this.play=function(){return r&&console.error("this.play()"),l?(b(),f.setVolume(p),f.setRate(h),i.play(),!0):!1},this.pause=function(){r&&console.error("this.pause()"),w(),i.pause()},i.addEventListener("play",d,!1),i.addEventListener("pause",v,!1),i.addEventListener("ended",m,!1);var g=0,y=undefined;this.isPlaying=function(){return y!==undefined},this.reset=function(){r&&console.error("this.reset()"),this.pause(),i.moSeeking=undefined,c=undefined,l=undefined,setTimeout(function(){i.setAttribute("src","")},1)},i.addEventListener("loadstart",function(){E=!0});var E=!1;this.touchInit=function(){return e?E?!1:(E=!0,i.setAttribute("src","touch/init/html5/audio.mp3"),i.load(),!0):!1};var S=0,x=0;this.playFile=function(e,n,s){S++,S>99999&&(S=0);var o=S;if(i.moSeeking){x++;if(x>A){x=0;return}r&&console.debug("this.playFile("+n+")"+" @"+s+" (POSTPONE, SEEKING...)"),setTimeout(function(){f.playFile(e,n,s)},20);return}i.moSeeking={},r&&console.debug("this.playFile("+n+")"+" @"+s+" #"+o);var u=!l||l!==n;if(!u){r&&console.debug("this.playFile() SAME SRC"),this.pause(),c=e,l=n,L(s,o,!1);return}r&&(console.debug("this.playFile() NEW SRC"),console.debug("_currentEpubSrc: "+l),console.debug("epubSrc: "+n)),this.reset(),i.moSeeking={},c=e,l=n,t||i.addEventListener("play",N,!1),$(i).on(C,{seekBegin:s,playId:o},k),setTimeout(function(){i.setAttribute("src",l),i.load(),t||T()},1)};var T=function(){r&&console.debug("playToForcePreload");var e=p;p=0,f.play(),p=e},N=function(){i.removeEventListener("play",N,!1),r&&console.debug("onPlayToForcePreload"),i.pause()},C=t?"canplaythrough":"canplay",A=10,O=e?"canplaythrough":"seeked",M=e?"timeupdate":"seeked"}}(),define("audioPlayer",["readiumSDK"],function(e){return function(){var t,n;return t||e.audioPlayer}}(this)),define("domReady",[],function(){function u(e){var t;for(t=0;t<e.length;t+=1)e[t](s)}function a(){var e=o;i&&e.length&&(o=[],u(e))}function f(){i||(i=!0,n&&clearInterval(n),a())}function c(e){return i?e(s):o.push(e),c}var e,t,n,r=typeof window!="undefined"&&window.document,i=!r,s=r?document:null,o=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1);else if(window.attachEvent){window.attachEvent("onload",f),t=document.createElement("div");try{e=window.frameElement===null}catch(l){}t.doScroll&&e&&window.external&&(n=setInterval(function(){try{t.doScroll(),f()}catch(e){}},30))}document.readyState==="complete"&&f()}return c.version="2.0.1",c.load=function(e,t,n,r){r.isBuild?n(null):c(n)},c}),function(e){function f(e,t){var i=typeof e[t];return i==r||i==n&&!!e[t]||i=="unknown"}function l(e,t){return typeof e[t]==n&&!!e[t]}function c(e,t){return typeof e[t]!=i}function h(e){return function(t,n){var r=n.length;while(r--)if(!e(t,n[r]))return!1;return!0}}function m(e){return e&&p(e,a)&&v(e,u)}function g(e){return l(e,"body")?e.body:e.getElementsByTagName("body")[0]}function w(e){l(window,"console")&&f(window.console,"log")&&window.console.log(e)}function E(e,t){t?window.alert(e):w(e)}function S(e){b.initialized=!0,b.supported=!1,E("Rangy is not supported on this page in your browser. Reason: "+e,b.config.alertOnFail)}function x(e){E("Rangy warning: "+e,b.config.alertOnWarn)}function C(e){return e.message||e.description||String(e)}function k(){if(b.initialized)return;var e,t=!1,n=!1;f(document,"createRange")&&(e=document.createRange(),p(e,o)&&v(e,s)&&(t=!0),e.detach());var r=g(document);if(!r||r.nodeName.toLowerCase()!="body"){S("No body element found");return}r&&f(r,"createTextRange")&&(e=r.createTextRange(),m(e)&&(n=!0));if(!t&&!n){S("Neither Range nor TextRange are available");return}b.initialized=!0,b.features={implementsDomRange:t,implementsTextRange:n};var i,u;for(var a in y)(i=y[a])instanceof O&&i.init(i,b);for(var l=0,c=N.length;l<c;++l)try{N[l](b)}catch(h){u="Rangy init listener threw an exception. Continuing. Detail: "+C(h),w(u)}}function A(e){e=e||window,k();for(var t=0,n=L.length;t<n;++t)L[t](e)}function O(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function M(e,t,n,r){var i=new O(t,n,function(e){if(!e.initialized){e.initialized=!0;try{r(b,e),e.supported=!0}catch(n){var i="Module '"+t+"' failed to load: "+C(n);w(i)}}});y[t]=i}function _(){}function D(){}var t=typeof e.define=="function"&&e.define.amd,n="object",r="function",i="undefined",s=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],o=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],u=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],a=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],p=h(f),d=h(l),v=h(c),y={},b={version:"1.3alpha.804",initialized:!1,supported:!0,util:{isHostMethod:f,isHostObject:l,isHostProperty:c,areHostMethods:p,areHostObjects:d,areHostProperties:v,isTextRange:m,getBody:g},features:{},modules:y,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};b.fail=S,b.warn=x,{}.hasOwnProperty?b.util.extend=function(e,t,n){var r,i;for(var s in t)t.hasOwnProperty(s)&&(r=e[s],i=t[s],n&&r!==null&&typeof r=="object"&&i!==null&&typeof i=="object"&&b.util.extend(r,i,!0),e[s]=i);return e}:S("hasOwnProperty not supported"),function(){var e=document.createElementNS("http://www.w3.org/1999/xhtml","div");e.appendChild(document.createElementNS("http://www.w3.org/1999/xhtml","span"));var t=[].slice,n;try{t.call(e.childNodes,0)[0].nodeType==1&&(n=function(e){return t.call(e,0)})}catch(r){}n||(n=function(e){var t=[];for(var n=0,r=e.length;n<r;++n)t[n]=e[n];return t}),b.util.toArray=n}();var T;f(document,"addEventListener")?T=function(e,t,n){e.addEventListener(t,n,!1)}:f(document,"attachEvent")?T=function(e,t,n){e.attachEvent("on"+t,n)}:S("Document does not have required addEventListener or attachEvent method"),b.util.addListener=T;var N=[];b.init=k,b.addInitListener=function(e){b.initialized?e(b):N.push(e)};var L=[];b.addCreateMissingNativeApiListener=function(e){L.push(e)},b.createMissingNativeApi=A,O.prototype={init:function(e){var t=this.dependencies||[];for(var n=0,r=t.length,i,s;n<r;++n){s=t[n],i=y[s];if(!i||!(i instanceof O))throw new Error("required module '"+s+"' not found");i.init();if(!i.supported)throw new Error("required module '"+s+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){b.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){b.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},b.createModule=function(e){var t,n;arguments.length==2?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]),M(!1,e,n,t)},b.createCoreModule=function(e,t,n){M(!0,e,t,n)},b.RangePrototype=_,b.rangePrototype=new _,b.selectionPrototype=new D;var P=!1,H=function(e){P||(P=!0,b.initialized||k())};if(typeof window==i){S("No window found");return}if(typeof document==i){S("No document found");return}f(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",H,!1),T(window,"load",H),e.rangy=b}(this),rangy.createCoreModule("DomUtil",[],function(e,t){function u(e){var t;return typeof e.namespaceURI==n||(t=e.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function a(e){var t=e.parentNode;return t.nodeType==1?t:null}function f(e){var t=0;while(e=e.previousSibling)++t;return t}function l(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function c(e,t){var n=[],r;for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(o(n,r))return r;return null}function h(e,t,n){var r=n?t:t.parentNode;while(r){if(r===e)return!0;r=r.parentNode}return!1}function p(e,t){return h(e,t,!0)}function d(e,t,n){var r,i=n?e:e.parentNode;while(i){r=i.parentNode;if(r===t)return i;i=r}return null}function v(e){var t=e.nodeType;return t==3||t==4||t==8}function m(e){if(!e)return!1;var t=e.nodeType;return t==3||t==8}function g(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function y(e,t,n){var r=e.cloneNode(!1);r.deleteData(0,t),e.deleteData(t,e.length-t),g(r,e);if(n)for(var i=0,s;s=n[i++];)s.node==e&&s.offset>t?(s.node=r,s.offset-=t):s.node==e.parentNode&&s.offset>f(e)&&++s.offset;return r}function b(e){if(e.nodeType==9)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return b(e.parentNode);throw t.createError("getDocument: no document found for node")}function w(e){var r=b(e);if(typeof r.defaultView!=n)return r.defaultView;if(typeof r.parentWindow!=n)return r.parentWindow;throw t.createError("Cannot get a window object for node")}function E(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function S(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function x(e){return e&&r.isHostMethod(e,"setTimeout")&&r.isHostObject(e,"document")}function T(e,t,n){var i;e?r.isHostProperty(e,"nodeType")?i=e.nodeType==1&&e.tagName.toLowerCase()=="iframe"?E(e):b(e):x(e)&&(i=e.document):i=document;if(!i)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return i}function N(e){var t;while(t=e.parentNode)e=t;return e}function C(e,n,r,i){var s,o,u,a,l;if(e==r)return n===i?0:n<i?-1:1;if(s=d(r,e,!0))return n<=f(s)?-1:1;if(s=d(e,r,!0))return f(s)<i?-1:1;o=c(e,r);if(!o)throw new Error("comparePoints error: nodes have no common ancestor");u=e===o?o:d(e,o,!0),a=r===o?o:d(r,o,!0);if(u===a)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");l=o.firstChild;while(l){if(l===u)return-1;if(l===a)return 1;l=l.nextSibling}}function L(e){try{return e.parentNode,!1}catch(t){return!0}}function A(e){if(!e)return"[No node]";if(k&&L(e))return"[Broken node]";if(v(e))return'"'+e.data+'"';if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+f(e)+"]["+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function O(e){var t=b(e).createDocumentFragment(),n;while(n=e.firstChild)t.appendChild(n);return t}function _(e){this.root=e,this._next=e}function D(e){return new _(e)}function P(e,t){this.node=e,this.offset=t}function H(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var n="undefined",r=e.util;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var i=document.createElementNS("http://www.w3.org/1999/xhtml","div");r.areHostMethods(i,["insertBefore","appendChild","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),r.isHostProperty(i,"innerHTML")||t.fail("Element is missing innerHTML property");var s=document.createTextNode("test");r.areHostMethods(s,["splitText","deleteData","insertData","appendData","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"])||!r.areHostProperties(s,["data"]))||t.fail("Incomplete Text Node implementation");var o=function(e,t){var n=e.length;while(n--)if(e[n]===t)return!0;return!1},k=!1;(function(){var t=document.createElementNS("http://www.w3.org/1999/xhtml","b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br>",k=L(n),e.features.crashyTextNodes=k})();var M;typeof window.getComputedStyle!=n?M=function(e,t){return w(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=n?M=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found"),_.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next,t,n;if(this._current){t=e.firstChild;if(t)this._next=t;else{n=null;while(e!==this.root&&!(n=e.nextSibling))e=e.parentNode;this._next=n}}return this._current},detach:function(){this._current=this._next=this.root=null}},P.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+A(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},H.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},H.prototype.toString=function(){return this.message},e.dom={arrayContains:o,isHtmlNamespace:u,parentElement:a,getNodeIndex:f,getNodeLength:l,getCommonAncestor:c,isAncestorOf:h,isOrIsAncestorOf:p,getClosestAncestorIn:d,isCharacterDataNode:v,isTextOrCommentNode:m,insertAfter:g,splitDataNode:y,getDocument:b,getWindow:w,getIframeWindow:S,getIframeDocument:E,getBody:r.getBody,isWindow:x,getContentDocument:T,getRootContainer:N,comparePoints:C,isBrokenNode:L,inspectNode:A,getComputedStyleProperty:M,fragmentFromNodeChildren:O,createIterator:D,DomPosition:P},e.DOMException=H}),rangy.createCoreModule("DomRange",["DomUtil"],function(e,t){function g(e,t){return e.nodeType!=3&&(a(e,t.startContainer)||a(e,t.endContainer))}function y(e){return e.document||f(e.startContainer)}function b(e){return new i(e.parentNode,u(e))}function w(e){return new i(e.parentNode,u(e)+1)}function E(e,t,r){var i=e.nodeType==11?e.firstChild:e;return o(t)?r==t.length?n.insertAfter(e,t):t.parentNode.insertBefore(e,r==0?t:c(t,r)):r>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[r]),i}function S(e,t,n){Q(e),Q(t);if(y(t)!=y(e))throw new s("WRONG_DOCUMENT_ERR");var r=l(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=l(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?r<=0&&i>=0:r<0&&i>0}function x(e){var t;for(var n,r=y(e.range).createDocumentFragment(),i;n=e.next();){t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(i=e.getSubtreeIterator(),n.appendChild(x(i)),i.detach(!0));if(n.nodeType==10)throw new s("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}function T(e,t,r){var i,s;r=r||{stop:!1};for(var o,u;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1){r.stop=!0;return}u=e.getSubtreeIterator(),T(u,t,r),u.detach(!0);if(r.stop)return}else{i=n.createIterator(o);while(s=i.next())if(t(s)===!1){r.stop=!0;return}}}function N(e){var t;while(e.next())e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),N(t),t.detach(!0)):e.remove()}function C(e){for(var t,n=y(e.range).createDocumentFragment(),r;t=e.next();){e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(C(r)),r.detach(!0)):e.remove();if(t.nodeType==10)throw new s("HIERARCHY_REQUEST_ERR");n.appendChild(t)}return n}function k(e,t,n){var r=!!t&&!!t.length,i,s=!!n;r&&(i=new RegExp("^("+t.join("|")+")$"));var u=[];return T(new A(e,!1),function(t){if(r&&!i.test(t.nodeType))return;if(s&&!n(t))return;var a=e.startContainer;if(t==a&&o(a)&&e.startOffset==a.length)return;var f=e.endContainer;if(t==f&&o(f)&&e.endOffset==0)return;u.push(t)}),u}function L(e){var t=typeof e.getName=="undefined"?"Range":e.getName();return"["+t+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function A(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&o(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===n&&!o(this.sc)?this.sc.childNodes[this.so]:h(this.sc,n,!0),this._last=this.ec===n&&!o(this.ec)?this.ec.childNodes[this.eo-1]:h(this.ec,n,!0))}}function O(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function B(e){return function(t,n){var r,i=n?t:t.parentNode;while(i){r=i.nodeType;if(d(e,r))return i;i=i.parentNode}return null}}function q(e,t){if(I(e,t))throw new O("INVALID_NODE_TYPE_ERR")}function R(e){if(!e.startContainer)throw new s("INVALID_STATE_ERR")}function U(e,t){if(!d(t,e.nodeType))throw new O("INVALID_NODE_TYPE_ERR")}function z(e,t){if(t<0||t>(o(e)?e.length:e.childNodes.length))throw new s("INDEX_SIZE_ERR")}function W(e,t){if(j(e,!0)!==j(t,!0))throw new s("WRONG_DOCUMENT_ERR")}function X(e){if(F(e,!0))throw new s("NO_MODIFICATION_ALLOWED_ERR")}function V(e,t){if(!e)throw new s(t)}function $(e){return m&&n.isBrokenNode(e)||!d(_,e.nodeType)&&!j(e,!0)}function J(e,t){return t<=(o(e)?e.length:e.childNodes.length)}function K(e){return!!e.startContainer&&!!e.endContainer&&!$(e.startContainer)&&!$(e.endContainer)&&J(e.startContainer,e.startOffset)&&J(e.endContainer,e.endOffset)}function Q(e){R(e);if(!K(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function tt(e,t){Q(e);var n=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,a=n===i;o(i)&&s>0&&s<i.length&&c(i,s,t),o(n)&&r>0&&r<n.length&&(n=c(n,r,t),a?(s-=r,i=n):i==n.parentNode&&s>=u(n)&&s++,r=0),e.setStartAndEnd(n,r,i,s)}function ct(e){e.START_TO_START=rt,e.START_TO_END=it,e.END_TO_END=st,e.END_TO_START=ot,e.NODE_BEFORE=ut,e.NODE_AFTER=at,e.NODE_BEFORE_AND_AFTER=ft,e.NODE_INSIDE=lt}function ht(e){ct(e),ct(e.prototype)}function pt(e,t){return function(){Q(this);var n=this.startContainer,r=this.startOffset,i=this.commonAncestorContainer,s=new A(this,!0),o,u;n!==i&&(o=h(n,i,!0),u=w(o),n=u.node,r=u.offset),T(s,X),s.reset();var a=e(s);return s.detach(),t(this,n,r,n,r),a}}function dt(t,n,i){function s(e,t){return function(n){R(this),U(n,M),U(v(n),_);var r=(e?b:w)(n);(t?a:f)(this,r.node,r.offset)}}function a(e,t,r){var i=e.endContainer,s=e.endOffset;if(t!==e.startContainer||r!==e.startOffset){if(v(t)!=v(i)||l(t,r,i,s)==1)i=t,s=r;n(e,t,r,i,s)}}function f(e,t,r){var i=e.startContainer,s=e.startOffset;if(t!==e.endContainer||r!==e.endOffset){if(v(t)!=v(i)||l(t,r,i,s)==-1)i=t,s=r;n(e,i,s,t,r)}}var c=function(){};c.prototype=e.rangePrototype,t.prototype=new c,r.extend(t.prototype,{setStart:function(e,t){R(this),q(e,!0),z(e,t),a(this,e,t)},setEnd:function(e,t){R(this),q(e,!0),z(e,t),f(this,e,t)},setStartAndEnd:function(){R(this);var e=arguments,t=e[0],r=e[1],i=t,s=r;switch(e.length){case 3:s=e[2];break;case 4:i=e[2],s=e[3]}n(this,t,r,i,s)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(e){Q(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){R(this),q(e,!0),n(this,e,0,e,p(e))},selectNode:function(e){R(this),q(e,!1),U(e,M);var t=b(e),r=w(e);n(this,t.node,t.offset,r.node,r.offset)},extractContents:pt(C,n),deleteContents:pt(N,n),canSurroundContents:function(){Q(this),X(this.startContainer),X(this.endContainer);var e=new A(this,!0),t=e._first&&g(e._first,this)||e._last&&g(e._last,this);return e.detach(),!t},detach:function(){i(this)},splitBoundaries:function(){tt(this)},splitBoundariesPreservingPositions:function(e){tt(this,e)},normalizeBoundaries:function(){Q(this);var e=this.startContainer,t=this.startOffset,r=this.endContainer,i=this.endOffset,s=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(r=e,i=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},a=function(n){var s=n.previousSibling;if(s&&s.nodeType==n.nodeType){e=n;var o=n.length;t=s.length,n.insertData(0,s.data),s.parentNode.removeChild(s);if(e==r)i+=t,r=e;else if(r==n.parentNode){var a=u(n);i==a?(r=n,i=o):i>a&&i--}}},f=!0;if(o(r))r.length==i&&s(r);else{if(i>0){var l=r.childNodes[i-1];l&&o(l)&&s(l)}f=!this.collapsed}if(f){if(o(e))t==0&&a(e);else if(t<e.childNodes.length){var c=e.childNodes[t];c&&o(c)&&a(c)}}else e=r,t=i;n(this,e,t,r,i)},collapseToPoint:function(e,t){R(this),q(e,!0),z(e,t),this.setStartAndEnd(e,t)}}),ht(t)}function vt(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:n.getCommonAncestor(e.startContainer,e.endContainer)}function mt(e,t,r,i,s){e.startContainer=t,e.startOffset=r,e.endContainer=i,e.endOffset=s,e.document=n.getDocument(t),vt(e)}function gt(e){R(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=e.document=null,e.collapsed=e.commonAncestorContainer=null}function yt(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,vt(this)}var n=e.dom,r=e.util,i=n.DomPosition,s=e.DOMException,o=n.isCharacterDataNode,u=n.getNodeIndex,a=n.isOrIsAncestorOf,f=n.getDocument,l=n.comparePoints,c=n.splitDataNode,h=n.getClosestAncestorIn,p=n.getNodeLength,d=n.arrayContains,v=n.getRootContainer,m=e.features.crashyTextNodes;A.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,o(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e=this._current,t,n;!o(e)||e!==this.sc&&e!==this.ec?e.parentNode&&e.parentNode.removeChild(e):(t=e===this.sc?this.so:0,n=e===this.ec?this.eo:e.length,t!=n&&e.deleteData(t,n-t))},isPartiallySelectedSubtree:function(){var e=this._current;return g(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new yt(y(this.range));var t=this._current,n=t,r=0,i=t,s=p(t);a(t,this.sc)&&(n=this.sc,r=this.so),a(t,this.ec)&&(i=this.ec,s=this.eo),mt(e,n,r,i,s)}return new A(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},O.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},O.prototype.toString=function(){return this.message};var M=[1,3,4,5,7,8,10],_=[2,9,11],D=[5,6,10,12],P=[1,3,4,5,7,8,10,11],H=[1,3,4,5,7,8],j=B([9,11]),F=B(D),I=B([6,10,12]),G=document.createElementNS("http://www.w3.org/1999/xhtml","style"),Y=!1;try{G.innerHTML="<b>x</b>",Y=G.firstChild.nodeType==3}catch(Z){}e.features.htmlParsingConforms=Y;var et=Y?function(e){var t=this.startContainer,r=f(t);if(!t)throw new s("INVALID_STATE_ERR");var i=null;return t.nodeType==1?i=t:o(t)&&(i=n.parentElement(t)),i===null||i.nodeName=="HTML"&&n.isHtmlNamespace(f(i).documentElement)&&n.isHtmlNamespace(i)?i=r.createElementNS("http://www.w3.org/1999/xhtml","body"):i=i.cloneNode(!1),i.innerHTML=e,n.fragmentFromNodeChildren(i)}:function(e){R(this);var t=y(this),r=t.createElementNS("http://www.w3.org/1999/xhtml","body");return r.innerHTML=e,n.fragmentFromNodeChildren(r)},nt=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],rt=0,it=1,st=2,ot=3,ut=0,at=1,ft=2,lt=3;r.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){Q(this),W(this.startContainer,t.startContainer);var n,r,i,s,o=e==ot||e==rt?"start":"end",u=e==it||e==rt?"start":"end";return n=this[o+"Container"],r=this[o+"Offset"],i=t[u+"Container"],s=t[u+"Offset"],l(n,r,i,s)},insertNode:function(e){Q(this),U(e,P),X(this.startContainer);if(a(e,this.startContainer))throw new s("HIERARCHY_REQUEST_ERR");var t=E(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){Q(this);var e,t;if(this.collapsed)return y(this).createDocumentFragment();if(this.startContainer===this.endContainer&&o(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=y(this).createDocumentFragment(),t.appendChild(e),t;var n=new A(this,!0);return e=x(n),n.detach(),e},canSurroundContents:function(){Q(this),X(this.startContainer),X(this.endContainer);var e=new A(this,!0),t=e._first&&g(e._first,this)||e._last&&g(e._last,this);return e.detach(),!t},surroundContents:function(e){U(e,H);if(!this.canSurroundContents())throw new O("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())while(e.lastChild)e.removeChild(e.lastChild);E(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){Q(this);var e=new yt(y(this)),t=nt.length,n;while(t--)n=nt[t],e[n]=this[n];return e},toString:function(){Q(this);var e=this.startContainer;if(e===this.endContainer&&o(e))return e.nodeType==3||e.nodeType==4?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new A(this,!0);return T(n,function(e){(e.nodeType==3||e.nodeType==4)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){Q(this);var t=e.parentNode,n=u(e);if(!t)throw new s("NOT_FOUND_ERR");var r=this.comparePoint(t,n),i=this.comparePoint(t,n+1);return r<0?i>0?ft:ut:i>0?at:lt},comparePoint:function(e,t){return Q(this),V(e,"HIERARCHY_REQUEST_ERR"),W(e,this.startContainer),l(e,t,this.startContainer,this.startOffset)<0?-1:l(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:et,toHtml:function(){Q(this);var e=this.commonAncestorContainer.parentNode.cloneNode(!1);return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){Q(this),V(e,"NOT_FOUND_ERR");if(f(e)!==y(this))return!1;var n=e.parentNode,r=u(e);V(n,"NOT_FOUND_ERR");var i=l(n,r,this.endContainer,this.endOffset),s=l(n,r+1,this.startContainer,this.startOffset);return t?i<=0&&s>=0:i<0&&s>0},isPointInRange:function(e,t){return Q(this),V(e,"HIERARCHY_REQUEST_ERR"),W(e,this.startContainer),l(e,t,this.startContainer,this.startOffset)>=0&&l(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return S(this,e,!1)},intersectsOrTouchesRange:function(e){return S(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=l(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=l(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return t==-1&&r.setStart(e.startContainer,e.startOffset),n==1&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return l(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1&&t.setStart(e.startContainer,e.startOffset),l(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1&&t.setEnd(e.endContainer,e.endOffset),t}throw new O("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==lt},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,p(e))<=0},containsRange:function(e){var t=this.intersection(e);return t!==null&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);var i=this.containsRange(t);return t.detach(),i}return this.containsNodeContents(e)},getNodes:function(e,t){return Q(this),k(this,e,t)},getDocument:function(){return y(this)},collapseBefore:function(e){R(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){R(this),this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var r=y(this),i=e.createRange(r);t=t||n.getBody(r),i.selectNodeContents(t);var s=this.intersection(i),o=0,u=0;return s&&(i.setEnd(s.startContainer,s.startOffset),o=i.toString().length,u=o+s.toString().length,i.detach()),{start:o,end:u,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);var r=[t],i,s=!1,o=!1,u,a,f;while(!o&&(i=r.pop()))if(i.nodeType==3)u=n+i.length,!s&&e.start>=n&&e.start<=u&&(this.setStart(i,e.start-n),s=!0),s&&e.end>=n&&e.end<=u&&(this.setEnd(i,e.end-n),o=!0),n=u;else{f=i.childNodes,a=f.length;while(a--)r.push(f[a])}},getName:function(){return"DomRange"},equals:function(e){return yt.rangesEqual(this,e)},isValid:function(){return K(this)},inspect:function(){return L(this)}}),dt(yt,mt,gt),r.extend(yt,{rangeProperties:nt,RangeIterator:A,copyComparisonConstants:ht,createPrototypeRange:dt,inspect:L,getRangeDocument:y,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=yt,e.RangeException=O}),rangy.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,r,i=e.dom,s=e.util,o=i.DomPosition,u=e.DomRange,a=i.getBody,f=i.getContentDocument,l=i.isCharacterDataNode;e.features.implementsDomRange&&function(){function l(e){var t=o.length,n;while(t--)n=o[t],e[n]=e.nativeRange[n];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function c(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!=n,o=e.endContainer!==r||e.endOffset!=i,u=!e.equals(e.nativeRange);if(s||o||u)e.setEnd(r,i),e.setStart(t,n)}function h(e){e.nativeRange.detach(),e.detached=!0;var t=o.length;while(t--)e[o[t]]=null}var r,o=u.rangeProperties,p;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,l(this)},u.createPrototypeRange(n,c,h),r=n.prototype,r.selectNode=function(e){this.nativeRange.selectNode(e),l(this)},r.cloneContents=function(){return this.nativeRange.cloneContents()},r.surroundContents=function(e){this.nativeRange.surroundContents(e),l(this)},r.collapse=function(e){this.nativeRange.collapse(e),l(this)},r.cloneRange=function(){return new n(this.nativeRange.cloneRange())},r.refresh=function(){l(this)},r.toString=function(){return this.nativeRange.toString()};var d=document.createTextNode("test");a(document).appendChild(d);var v=document.createRange();v.setStart(d,0),v.setEnd(d,0);try{v.setStart(d,1),r.setStart=function(e,t){this.nativeRange.setStart(e,t),l(this)},r.setEnd=function(e,t){this.nativeRange.setEnd(e,t),l(this)},p=function(e){return function(t){this.nativeRange[e](t),l(this)}}}catch(m){r.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}l(this)},r.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}l(this)},p=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}l(this)}}}r.setStartBefore=p("setStartBefore","setEndBefore"),r.setStartAfter=p("setStartAfter","setEndAfter"),r.setEndBefore=p("setEndBefore","setStartBefore"),r.setEndAfter=p("setEndAfter","setStartAfter"),r.selectNodeContents=function(e){this.setStartAndEnd(e,0,i.getNodeLength(e))},v.selectNodeContents(d),v.setEnd(d,3);var g=document.createRange();g.selectNodeContents(d),g.setEnd(d,4),g.setStart(d,2),v.compareBoundaryPoints(v.START_TO_END,g)==-1&&v.compareBoundaryPoints(v.END_TO_START,g)==1?r.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:r.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var y=document.createElementNS("http://www.w3.org/1999/xhtml","div");y.innerHTML="123";var b=y.firstChild,w=a(document);w.appendChild(y),v.setStart(b,1),v.setEnd(b,2),v.deleteContents(),b.data=="13"&&(r.deleteContents=function(){this.nativeRange.deleteContents(),l(this)},r.extractContents=function(){var e=this.nativeRange.extractContents();return l(this),e}),w.removeChild(y),w=null,s.isHostMethod(v,"createContextualFragment")&&(r.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),a(document).removeChild(d),v.detach(),g.detach(),r.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=f(e,t,"createNativeRange"),e.createRange()}}();if(e.features.implementsTextRange){var c=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();n=e.duplicate(),n.collapse(!1);var s=n.parentElement(),o=r==s?r:i.getCommonAncestor(r,s);return o==t?o:i.getCommonAncestor(t,o)},h=function(e){return e.compareEndPoints("StartToEnd",e)==0},p=function(e,t,n,r,s){var u=e.duplicate();u.collapse(n);var a=u.parentElement();i.isOrIsAncestorOf(t,a)||(a=t);if(!a.canHaveHTML){var f=new o(a.parentNode,i.getNodeIndex(a));return{boundaryPosition:f,nodeInfo:{nodeIndex:f.offset,containerElement:f.node}}}var c=i.getDocument(a).createElementNS("http://www.w3.org/1999/xhtml","span");c.parentNode&&c.parentNode.removeChild(c);var h,p=n?"StartToStart":"StartToEnd",d,v,m,g,y=s&&s.containerElement==a?s.nodeIndex:0,b=a.childNodes.length,w=b,E=w;for(;;){E==b?a.appendChild(c):a.insertBefore(c,a.childNodes[E]),u.moveToElementText(c),h=u.compareEndPoints(p,e);if(h==0||y==w)break;if(h==-1){if(w==y+1)break;y=E}else w=w==y+1?y:E;E=Math.floor((y+w)/2),a.removeChild(c)}g=c.nextSibling;if(h==-1&&g&&l(g)){u.setEndPoint(n?"EndToStart":"EndToEnd",e);var S;if(/[\r\n]/.test(g.data)){var x=u.duplicate(),T=x.text.replace(/\r\n/g,"\r").length;S=x.moveStart("character",T);while((h=x.compareEndPoints("StartToEnd",x))==-1)S++,x.moveStart("character",1)}else S=u.text.length;m=new o(g,S)}else d=(r||!n)&&c.previousSibling,v=(r||n)&&c.nextSibling,v&&l(v)?m=new o(v,0):d&&l(d)?m=new o(d,d.data.length):m=new o(a,i.getNodeIndex(c));return c.parentNode.removeChild(c),{boundaryPosition:m,nodeInfo:{nodeIndex:E,containerElement:a}}},d=function(e,t){var n,r,s=e.offset,o=i.getDocument(e.node),u,f,c=a(o).createTextRange(),h=l(e.node);return h?(n=e.node,r=n.parentNode):(f=e.node.childNodes,n=s<f.length?f[s]:null,r=e.node),u=o.createElementNS("http://www.w3.org/1999/xhtml","span"),u.innerHTML="&#feff;",n?r.insertBefore(u,n):r.appendChild(u),c.moveToElementText(u),c.collapse(!t),r.removeChild(u),h&&c[t?"moveStart":"moveEnd"]("character",s),c};r=function(e){this.textRange=e,this.refresh()},r.prototype=new u(document),r.prototype.refresh=function(){var e,t,n,r=c(this.textRange);h(this.textRange)?t=e=p(this.textRange,r,!0,!0).boundaryPosition:(n=p(this.textRange,r,!0,!1),e=n.boundaryPosition,t=p(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},r.prototype.getName=function(){return"WrappedTextRange"},u.copyComparisonConstants(r),r.rangeToTextRange=function(e){if(e.collapsed)return d(new o(e.startContainer,e.startOffset),!0);var t=d(new o(e.startContainer,e.startOffset),!0),n=d(new o(e.endContainer,e.endOffset),!1),r=a(u.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r},e.WrappedTextRange=r;if(!e.features.implementsDomRange||e.config.preferTextRange){var v=function(){return this}();typeof v.Range=="undefined"&&(v.Range=r),e.createNativeRange=function(e){return e=f(e,t,"createNativeRange"),a(e).createTextRange()},e.WrappedRange=r}}e.createRange=function(n){return n=f(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=f(e,t,"createRangyRange"),new u(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addCreateMissingNativeApiListener(function(t){var n=t.document;typeof n.createRange=="undefined"&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),rangy.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function y(e){return typeof e=="string"?/^backward(s)?$/i.test(e):!!e}function b(e,n){if(!e)return window;if(i.isWindow(e))return e;if(e instanceof J)return e.win;var r=i.getContentDocument(e,t,n);return i.getWindow(r)}function w(e){return b(e,"getWinSelection").getSelection()}function E(e){return b(e,"getDocSelection").document.selection}function S(e){var t=!1;return e.anchorNode&&(t=i.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1),t}function j(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function F(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function I(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function q(t){var n;return t instanceof u?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof a?n=t.nativeRange:p.implementsDomRange&&t instanceof i.getWindow(t.startContainer).Range&&(n=t),n}function R(e){if(!e.length||e[0].nodeType!=1)return!1;for(var t=1,n=e.length;t<n;++t)if(!i.isAncestorOf(e[0],e[t]))return!1;return!0}function U(e){var n=e.getNodes();if(!R(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function z(e){return!!e&&typeof e.text!="undefined"}function W(e,t){var n=new a(t);e._ranges=[n],j(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function X(t){t._ranges.length=0;if(t.docSelection.type=="None")I(t);else{var n=t.docSelection.createRange();if(z(n))W(t,n);else{t.rangeCount=n.length;var r,i=v(n.item(0));for(var s=0;s<t.rangeCount;++s)r=e.createRange(i),r.selectNode(n.item(s)),t._ranges.push(r);t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed,j(t,t._ranges[t.rangeCount-1],!1)}}}function V(e,n){var r=e.docSelection.createRange(),i=U(n),s=v(r.item(0)),o=m(s).createControlRange();for(var u=0,a=r.length;u<a;++u)o.add(r.item(u));try{o.add(i)}catch(f){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select(),X(e)}function J(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function K(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function G(e,t){var n=Q.length,r,i;while(n--){r=Q[n],i=r.selection;if(t=="deleteAll")K(i);else if(r.win==e)return t=="delete"?(Q.splice(n,1),!0):i}return t=="deleteAll"&&(Q.length=0),null}function et(e,n){var r=v(n[0].startContainer),i=m(r).createControlRange();for(var s=0,o,u=n.length;s<u;++s){o=U(n[s]);try{i.add(o)}catch(a){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),X(e)}function st(e,t){if(e.win.document!=v(t))throw new f("WRONG_DOCUMENT_ERR")}function ot(t){return function(n,r){var i;this.rangeCount?(i=this.getRangeAt(0),i["set"+(t?"Start":"End")](n,r)):(i=e.createRange(this.win.document),i.setStartAndEnd(n,r)),this.setSingleRange(i,this.isBackward())}}function ut(e){var t=[],n=new l(e.anchorNode,e.anchorOffset),r=new l(e.focusNode,e.focusOffset),i=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined")for(var s=0,o=e.rangeCount;s<o;++s)t[s]=u.inspect(e.getRangeAt(s));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.config.checkSelectionRanges=!0;var n="boolean",r="number",i=e.dom,s=e.util,o=s.isHostMethod,u=e.DomRange,a=e.WrappedRange,f=e.DOMException,l=i.DomPosition,c,h,p=e.features,d="Control",v=i.getDocument,m=i.getBody,g=u.rangesEqual,x=o(window,"getSelection"),T=s.isHostObject(document,"selection");p.implementsWinGetSelection=x,p.implementsDocSelection=T;var N=T&&(!x||e.config.preferTextRange);N?(c=E,e.isSelectionValid=function(e){var t=b(e,"isSelectionValid").document,n=t.selection;return n.type!="None"||v(n.createRange().parentElement())==t}):x?(c=w,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=c;var C=c(),k=e.createNativeRange(document),L=m(document),A=s.areHostProperties(C,["anchorNode","focusNode","anchorOffset","focusOffset"]);p.selectionHasAnchorAndFocus=A;var O=o(C,"extend");p.selectionHasExtend=O;var M=typeof C.rangeCount==r;p.selectionHasRangeCount=M;var _=!1,D=!0,P=O?function(t,n){var r=u.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.addRange(q(i)),t.extend(n.startContainer,n.startOffset)}:null;s.areHostMethods(C,["addRange","getRangeAt","removeAllRanges"])&&typeof C.rangeCount==r&&p.implementsDomRange&&function(){var t=window.getSelection();if(t){var n=t.rangeCount,r=n>1,i=[],s=S(t);for(var o=0;o<n;++o)i[o]=t.getRangeAt(o);var u=m(document),a=u.appendChild(document.createElementNS("http://www.w3.org/1999/xhtml","div"));a.contentEditable="false";var f=a.appendChild(document.createTextNode("   ")),l=document.createRange();l.setStart(f,1),l.collapse(!0),t.addRange(l),D=t.rangeCount==1,t.removeAllRanges();if(!r){var c=l.cloneRange();l.setStart(f,0),c.setEnd(f,3),c.setStart(f,2),t.addRange(l),t.addRange(c),_=t.rangeCount==2,c.detach()}u.removeChild(a),t.removeAllRanges(),l.detach();for(o=0;o<n;++o)o==0&&s?P?P(t,i[o]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because browser does not support Selection.extend"),t.addRange(i[o])):t.addRange(i[o])}}(),p.selectionSupportsMultipleRanges=_,p.collapsedNonEditableSelectionsSupported=D;var H=!1,B;L&&o(L,"createControlRange")&&(B=L.createControlRange(),s.areHostProperties(B,["item","add"])&&(H=!0)),p.implementsControlRange=H,A?h=function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:h=function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var $;o(C,"getRangeAt")?$=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:A&&($=function(t){var n=v(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),J.prototype=e.selectionPrototype;var Q=[],Y=function(e){if(e&&e instanceof J)return e.refresh(),e;e=b(e,"getNativeSelection");var t=G(e),n=c(e),r=T?E(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh()):(t=new J(n,r,e),Q.push({win:e,selection:t})),t};e.getSelection=Y,e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(i.getIframeWindow(n))};var Z=J.prototype;if(!N&&A&&s.areHostMethods(C,["removeAllRanges","addRange"])){Z.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),I(this)};var tt=function(e,t){P(e.nativeSelection,t),e.refresh()};M?Z.addRange=function(t,n){if(H&&T&&this.docSelection.type==d)V(this,t);else if(y(n)&&O)tt(this,t);else{var r;_?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(q(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==r+1){if(e.config.checkSelectionRanges){var i=$(this.nativeSelection,this.rangeCount-1);i&&!g(i,t)&&(t=new a(i))}this._ranges[this.rangeCount-1]=t,j(this,t,it(this.nativeSelection)),this.isCollapsed=h(this)}else this.refresh()}}:Z.addRange=function(e,t){y(t)&&O?tt(this,e):(this.nativeSelection.addRange(q(e)),this.refresh())},Z.setRanges=function(e){if(H&&e.length>1)et(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(o(C,"empty")&&o(k,"select")&&H&&N))return t.fail("No means of selecting a Range or TextRange was found"),!1;Z.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode)e=v(this.anchorNode);else if(this.docSelection.type==d){var t=this.docSelection.createRange();t.length&&(e=v(t.item(0)))}if(e){var n=m(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(r){}I(this)},Z.addRange=function(t){this.docSelection.type==d?V(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,j(this,t,!1))},Z.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?et(this,e):t&&this.addRange(e[0])}}Z.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new f("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var nt;if(N)nt=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=m(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==d?X(t):z(n)?W(t,n):I(t)};else if(o(C,"getRangeAt")&&typeof C.rangeCount==r)nt=function(t){if(H&&T&&t.docSelection.type==d)X(t);else{t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount;if(t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));j(t,t._ranges[t.rangeCount-1],it(t.nativeSelection)),t.isCollapsed=h(t)}else I(t)}};else{if(!A||typeof C.isCollapsed!=n||typeof k.collapsed!=n||!p.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;nt=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=$(n,0),e._ranges=[t],e.rangeCount=1,F(e),e.isCollapsed=h(e)):I(e)}}Z.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;nt(this);if(e){var i=t.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;while(i--)if(!g(t[i],this._ranges[i]))return!0;return!1}};var rt=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,i=n.length;r<i;++r)g(t,n[r])||e.addRange(n[r]);e.rangeCount||I(e)};H?Z.removeRange=function(e){if(this.docSelection.type==d){var t=this.docSelection.createRange(),n=U(e),r=v(t.item(0)),i=m(r).createControlRange(),s,o=!1;for(var u=0,a=t.length;u<a;++u)s=t.item(u),s!==n||o?i.add(t.item(u)):o=!0;i.select(),X(this)}else rt(this,e)}:Z.removeRange=function(e){rt(this,e)};var it;!N&&A&&p.implementsDomRange?(it=S,Z.isBackward=function(){return it(this)}):it=Z.isBackward=function(){return!1},Z.isBackwards=Z.isBackward,Z.toString=function(){var e=[];for(var t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},Z.collapse=function(t,n){st(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},Z.collapseToStart=function(){if(!this.rangeCount)throw new f("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},Z.collapseToEnd=function(){if(!this.rangeCount)throw new f("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},Z.selectAllChildren=function(t){st(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},Z.deleteFromDocument=function(){if(H&&T&&this.docSelection.type==d){var e=this.docSelection.createRange(),t;while(e.length)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,i=n.length;r<i;++r)n[r].deleteContents();this.addRange(n[i-1])}}},Z.eachRange=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(e(this.getRangeAt(n)))return t},Z.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},Z.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},Z.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(r){n.push(r[e].apply(r,t))}),n},Z.setStart=ot(!0),Z.setEnd=ot(!1),e.rangePrototype.select=function(e){Y(this.getDocument()).setSingleRange(this,e)},Z.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&t.length==1?this.addRange(t[0],"backward"):this.setRanges(t)},Z.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)},Z.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},Z.moveToBookmark=function(t){var n=[];for(var r=0,i,s;i=t.rangeBookmarks[r++];)s=e.createRange(this.win),s.moveToBookmark(i),n.push(s);t.backward?this.setSingleRange(n[0],"backward"):this.setRanges(n)},Z.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},Z.getName=function(){return"WrappedSelection"},Z.inspect=function(){return ut(this)},Z.detach=function(){G(this.win,"delete"),K(this)},J.detachAll=function(){G(null,"deleteAll")},J.inspect=ut,J.isDirectionBackward=y,e.Selection=J,e.selectionPrototype=Z,e.addCreateMissingNativeApiListener(function(e){typeof e.getSelection=="undefined"&&(e.getSelection=function(){return Y(e)}),e=null})}),define("rangy-core",["domReady"],function(e){return function(){var t,n;return n=function(e){var t=this.rangy;return e(function(){t.init()}),this.rangy},t=n.apply(e,arguments),t||e.rangy}}(this)),rangy.createModule("Highlighter",["ClassApplier"],function(e,t){function s(e,t){return e.characterRange.start-t.characterRange.start}function f(e,t){this.type=e,this.converterCreator=t}function l(e,t){a[e]=new f(e,t)}function c(e){var t=a[e];if(t instanceof f)return t.create();throw new Error("Highlighter type '"+e+"' is not valid")}function h(e,t){this.start=e,this.end=t}function d(e,t,n,r,i,s){i?(this.id=i,u=Math.max(u,i+1)):this.id=u++,this.characterRange=t,this.doc=e,this.classApplier=n,this.converter=r,this.containerElementId=s||null,this.applied=!1}function v(e,t){t=t||"textContent",this.doc=e||document,this.classAppliers={},this.highlights=[],this.converter=c(t)}var n=e.dom,r=n.arrayContains,i=n.getBody,o=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;n<r;++n)t(e[n])},u=1,a={};f.prototype.create=function(){var e=this.converterCreator();return e.type=this.type,e},e.registerHighlighterType=l,h.prototype={intersects:function(e){return this.start<e.end&&this.end>e.start},union:function(e){return new h(Math.min(this.start,e.start),Math.max(this.end,e.end))},intersection:function(e){return new h(Math.max(this.start,e.start),Math.min(this.end,e.end))},toString:function(){return"[CharacterRange("+this.start+", "+this.end+")]"}},h.fromCharacterRange=function(e){return new h(e.start,e.end)};var p={rangeToCharacterRange:function(e,t){var n=e.getBookmark(t);return new h(n.start,n.end)},characterRangeToRange:function(t,n,r){var i=e.createRange(t);return i.moveToBookmark({start:n.start,end:n.end,containerNode:r}),i},serializeSelection:function(e,t){var n=e.getAllRanges(),r=n.length,i=[],s=r==1&&e.isBackward();for(var o=0,u=n.length;o<u;++o)i[o]={characterRange:this.rangeToCharacterRange(n[o],t),backward:s};return i},restoreSelection:function(e,t,n){e.removeAllRanges();var r=e.win.document;for(var i=0,s=t.length,o,u,a;i<s;++i)u=t[i],a=u.characterRange,o=this.characterRangeToRange(r,u.characterRange,n),e.addRange(o,u.backward)}};l("textContent",function(){return p}),l("TextRange",function(){var t;return function(){if(!t){var n=e.modules.TextRange;if(!n)throw new Error("TextRange module is missing.");if(!n.supported)throw new Error("TextRange module is present but not supported.");t={rangeToCharacterRange:function(e,t){return h.fromCharacterRange(e.toCharacterRange(t))},characterRangeToRange:function(t,n,r){var i=e.createRange(t);return i.selectCharacters(r,n.start,n.end),i},serializeSelection:function(e,t){return e.saveCharacterRanges(t)},restoreSelection:function(e,t,n){e.restoreCharacterRanges(n,t)}}}return t}}()),d.prototype={getContainerElement:function(){return this.containerElementId?this.doc.getElementById(this.containerElementId):i(this.doc)},getRange:function(){return this.converter.characterRangeToRange(this.doc,this.characterRange,this.getContainerElement())},fromRange:function(e){this.characterRange=this.converter.rangeToCharacterRange(e,this.getContainerElement())},getText:function(){return this.getRange().toString()},containsElement:function(e){return this.getRange().containsNodeContents(e.firstChild)},unapply:function(){this.classApplier.undoToRange(this.getRange()),this.applied=!1},apply:function(){this.classApplier.applyToRange(this.getRange()),this.applied=!0},getHighlightElements:function(){return this.classApplier.getElementsWithClassIntersectingRange(this.getRange())},toString:function(){return"[Highlight(ID: "+this.id+", class: "+this.classApplier.cssClass+", character range: "+this.characterRange.start+" - "+this.characterRange.end+")]"}},v.prototype={addClassApplier:function(e){this.classAppliers[e.cssClass]=e},getHighlightForElement:function(e){var t=this.highlights;for(var n=0,r=t.length;n<r;++n)if(t[n].containsElement(e))return t[n];return null},removeHighlights:function(e){for(var t=0,n=this.highlights.length,i;t<n;++t)i=this.highlights[t],r(e,i)&&(i.unapply(),this.highlights.splice(t--,1))},removeAllHighlights:function(){this.removeHighlights(this.highlights)},getIntersectingHighlights:function(e){var t=[],n=this.highlights,i=this.converter;return o(e,function(e){o(n,function(n){e.intersectsRange(n.getRange())&&!r(t,n)&&t.push(n)})}),t},highlightCharacterRanges:function(t,n,r){var i,s,u,a=this.highlights,f=this.converter,l=this.doc,c=[],p=this.classAppliers[t];r=r||null;var v,m,g;r&&(v=this.doc.getElementById(r),v&&(m=e.createRange(this.doc),m.selectNodeContents(v),g=new h(0,m.toString().length),m.detach()));var y,b,w;for(i=0,s=n.length;i<s;++i){y=n[i],w=!1,g&&(y=y.intersection(g));for(u=0;u<a.length;++u)r==a[u].containerElementId&&(b=a[u].characterRange,b.intersects(y)&&(c.push(a[u]),a[u]=new d(l,b.union(y),p,f,null,r)));w||a.push(new d(l,y,p,f,null,r))}o(c,function(e){e.unapply()});var E=[];return o(a,function(e){e.applied||(e.apply(),E.push(e))}),E},highlightRanges:function(t,n,r){var s=[],u=this.converter,a=r?r.id:null,f;return r&&(f=e.createRange(r),f.selectNodeContents(r)),o(n,function(e){var t=r?f.intersection(e):e;s.push(u.rangeToCharacterRange(t,r||i(e.getDocument())))}),this.highlightCharacterRanges(s,n,a)},highlightSelection:function(t,n,r){var s=this.converter;n=n||e.getSelection();var u=this.classAppliers[t],a=n.win.document,f=r?a.getElementById(r):i(a);if(!u)throw new Error("No class applier found for class '"+t+"'");var l=s.serializeSelection(n,f),c=[];o(l,function(e){c.push(h.fromCharacterRange(e.characterRange))});var p=this.highlightCharacterRanges(t,c,r);return s.restoreSelection(n,l,f),p},unhighlightSelection:function(t){t=t||e.getSelection();var n=this.getIntersectingHighlights(t.getAllRanges());return this.removeHighlights(n),t.removeAllRanges(),n},getHighlightsInSelection:function(t){return t=t||e.getSelection(),this.getIntersectingHighlights(t.getAllRanges())},selectionOverlapsHighlight:function(e){return this.getHighlightsInSelection(e).length>0},serialize:function(e){var t=this.highlights;t.sort(s);var n=["type:"+this.converter.type];return o(t,function(t){var r=t.characterRange,i=[r.start,r.end,t.id,t.classApplier.cssClass,t.containerElementId];e&&e.serializeHighlightText&&i.push(t.getText()),n.push(i.join("$"))}),n.join("|")},deserialize:function(e){var t=e.split("|"),n=[],r=t[0],s,o,u,a=!1;if(!r||!(s=/^type:(\w+)$/.exec(r)))throw new Error("Serialized highlights are invalid.");o=s[1],o!=this.converter.type&&(u=c(o),a=!0),t.shift();var f,l,p,v,m;for(var g=t.length,y;g-->0;)y=t[g].split("$"),p=new h(+y[0],+y[1]),v=y[4]||null,m=v?this.doc.getElementById(v):i(this.doc),a&&(p=this.converter.rangeToCharacterRange(u.characterRangeToRange(this.doc,p,m),m)),f=this.classAppliers[y[3]],l=new d(this.doc,p,f,this.converter,parseInt(y[2]),v),l.apply(),n.push(l);this.highlights=n}},e.Highlighter=v,e.createHighlighter=function(e,t){return new v(e,t)}}),define("rangy-highlighter",["rangy-core"],function(e){return function(){var t,n;return t||e.rangy.modules.Highlighter}}(this)),rangy.createModule("ClassApplier",["WrappedSelection"],function(e,t){function o(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(n,e[n])===!1)return!1;return!0}function u(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function a(e,t){return e.className&&(new RegExp("(?:^|\\s)"+t+"(?:\\s|$)")).test(e.className)}function f(e,t){e.className?a(e,t)||(e.className+=" "+t):e.className=t}function c(e){return e.split(/\s+/).sort().join(" ")}function h(e){return c(e.className)}function p(e,t){return h(e)==h(t)}function d(e,t,n,r,i){var s=e.node,o=e.offset,u=s,a=o;s==r&&o>i&&++a,s==t&&(o==n||o==n+1)&&(u=r,a+=i-n),s==t&&o>n+1&&--a,e.node=u,e.offset=a}function v(e,t,n){e.node==t&&e.offset>n&&--e.offset}function m(e,t,r,i){r==-1&&(r=t.childNodes.length);var s=e.parentNode,o=n.getNodeIndex(e);for(var u=0,a;a=i[u++];)d(a,s,o,t,r);t.childNodes.length==r?t.appendChild(e):t.insertBefore(e,t.childNodes[r])}function g(e,t){var r=e.parentNode,i=n.getNodeIndex(e);for(var s=0,o;o=t[s++];)v(o,r,i);e.parentNode.removeChild(e)}function y(e,t,n,r,i){var s,o=[];while(s=e.firstChild)m(s,t,n++,i),o.push(s);return r&&e.parentNode.removeChild(e),o}function b(e,t){return y(e,e.parentNode,n.getNodeIndex(e),!0,t)}function w(e,t){var n=e.cloneRange();n.selectNodeContents(t);var r=n.intersection(e),i=r?r.toString():"";return n.detach(),i!=""}function E(e){var t=e.getNodes([3]),n=0,r;while((r=t[n])&&!w(e,r))++n;var i=t.length-1;while((r=t[i])&&!w(e,r))--i;return t.slice(n,i+1)}function S(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n=0,r=e.attributes.length,i,s,o;n<r;++n){i=e.attributes[n],o=i.name;if(o!="class"){s=t.attributes.getNamedItem(o);if(i===null!=(s===null))return!1;if(i.specified!=s.specified)return!1;if(i.specified&&i.nodeValue!==s.nodeValue)return!1}}return!0}function x(e,t){for(var n=0,r=e.attributes.length,s;n<r;++n){s=e.attributes[n].name;if((!t||!i(t,s))&&e.attributes[n].specified&&s!="class")return!0}return!1}function T(e,t){return o(t,function(t,n){if(typeof n=="object"){if(!T(e[t],n))return!1}else if(e[t]!==n)return!1}),!0}function k(e){var t;return e&&e.nodeType==1&&((t=e.parentNode)&&t.nodeType==9&&t.designMode=="on"||C(e)&&!C(e.parentNode))}function L(e){return(C(e)||e.nodeType!=1&&C(e.parentNode))&&!k(e)}function O(e){return e&&e.nodeType==1&&!A.test(N(e,"display"))}function _(e){if(e.data.length==0)return!0;if(M.test(e.data))return!1;var t=N(e.parentNode,"whiteSpace");switch(t){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1}return O(e.previousSibling)||O(e.nextSibling)}function D(e){var t=[],n,i;for(n=0;i=e[n++];)t.push(new r(i.startContainer,i.startOffset),new r(i.endContainer,i.endOffset));return t}function P(e,t){for(var n=0,r,i,s,o=e.length;n<o;++n)r=e[n],i=t[n*2],s=t[n*2+1],r.setStartAndEnd(i.node,i.offset,s.node,s.offset)}function H(e,t){return n.isCharacterDataNode(e)?t==0?!!e.previousSibling:t==e.length?!!e.nextSibling:!0:t>0&&t<e.childNodes.length}function B(e,r,i,s){var o,u,a=i==0;if(n.isAncestorOf(r,e))return e;if(n.isCharacterDataNode(r)){var f=n.getNodeIndex(r);if(i==0)i=f;else{if(i!=r.length)throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+i+" in "+r.data);i=f+1}r=r.parentNode}if(H(r,i)){o=r.cloneNode(!1),u=r.parentNode,o.id&&o.removeAttribute("id");var l,c=0;while(l=r.childNodes[i])m(l,o,c++,s);return m(o,u,n.getNodeIndex(r)+1,s),r==e?o:B(e,u,n.getNodeIndex(o),s)}if(e!=r){o=r.parentNode;var h=n.getNodeIndex(r);return a||h++,B(e,o,h,s)}return e}function j(e,t){return e.tagName==t.tagName&&p(e,t)&&S(e,t)&&N(e,"display")=="inline"&&N(t,"display")=="inline"}function F(e){var t=e?"nextSibling":"previousSibling";return function(n,r){var i=n.parentNode,s=n[t];if(s){if(s&&s.nodeType==3)return s}else if(r){s=i[t];if(s&&s.nodeType==1&&j(i,s)){var o=s[e?"firstChild":"lastChild"];if(o&&o.nodeType==3)return o}}return null}}function R(e){this.isElementMerge=e.nodeType==1,this.textNodes=[];var t=this.isElementMerge?e.lastChild:e;t&&(this.textNodes[0]=t)}function W(e,t,n){var r,i,s,a,f=this;f.cssClass=e;var l=null,c={};if(typeof t=="object"&&t!==null){n=t.tagNames,l=t.elementProperties,c=t.elementAttributes;for(i=0;a=U[i++];)t.hasOwnProperty(a)&&(f[a]=t[a]);r=t.normalize}else r=t;f.normalize=typeof r=="undefined"?!0:r,f.attrExceptions=[];var h=document.createElementNS("http://www.w3.org/1999/xhtml",f.elementTagName);f.elementProperties=f.copyPropertiesToElement(l,h,!0),o(c,function(e){f.attrExceptions.push(e)}),f.elementAttributes=c,f.elementSortedClassName=f.elementProperties.hasOwnProperty("className")?f.elementProperties.className:e,f.applyToAnyTagName=!1;var p=typeof n;if(p=="string")n=="*"?f.applyToAnyTagName=!0:f.tagNames=u(n.toLowerCase()).split(/\s*,\s*/);else if(p=="object"&&typeof n.length=="number"){f.tagNames=[];for(i=0,s=n.length;i<s;++i)n[i]=="*"?f.applyToAnyTagName=!0:f.tagNames.push(n[i].toLowerCase())}else f.tagNames=[f.elementTagName]}function X(e,t,n){return new W(e,t,n)}var n=e.dom,r=n.DomPosition,i=n.arrayContains,s="span",l=function(){function e(e,t,n){return t&&n?" ":""}return function(t,n){t.className&&(t.className=t.className.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),e))}}(),N=n.getComputedStyleProperty,C=function(){var e=document.createElementNS("http://www.w3.org/1999/xhtml","div");return typeof e.isContentEditable=="boolean"?function(e){return e&&e.nodeType==1&&e.isContentEditable}:function(e){return!e||e.nodeType!=1||e.contentEditable=="false"?!1:e.contentEditable=="true"||C(e.parentNode)}}(),A=/^inline(-block|-table)?$/i,M=/[^\r\n\t\f \u200B]/,I=F(!1),q=F(!0);R.prototype={doMerge:function(e){var t=this.textNodes,n=t[0];if(t.length>1){var r=[],i=0,s,o;for(var u=0,a=t.length,f,l;u<a;++u){s=t[u],o=s.parentNode;if(u>0){o.removeChild(s),o.hasChildNodes()||o.parentNode.removeChild(o);if(e)for(f=0;l=e[f++];)l.node==s&&(l.node=n,l.offset+=i)}r[u]=s.data,i+=s.data.length}n.data=r.join("")}return n.data},getLength:function(){var e=this.textNodes.length,t=0;while(e--)t+=this.textNodes[e].length;return t},toString:function(){var e=[];for(var t=0,n=this.textNodes.length;t<n;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}};var U=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],z={};W.prototype={elementTagName:s,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(e,t,n){var r,i,s={},o,u,a,l;for(var h in e)if(e.hasOwnProperty(h)){u=e[h],a=t[h];if(h=="className")f(t,u),f(t,this.cssClass),t[h]=c(t[h]),n&&(s[h]=t[h]);else if(h=="style"){i=a,n&&(s[h]=o={});for(r in e[h])i[r]=u[r],n&&(o[r]=i[r]);this.attrExceptions.push(h)}else t[h]=u,n&&(s[h]=t[h],l=z.hasOwnProperty(h)?z[h]:h,this.attrExceptions.push(l))}return n?s:""},copyAttributesToElement:function(e,t){for(var n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])},hasClass:function(e){return e.nodeType==1&&i(this.tagNames,e.tagName.toLowerCase())&&a(e,this.cssClass)},getSelfOrAncestorWithClass:function(e){while(e){if(this.hasClass(e))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||L(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&e.nodeType==3&&_(e)},postApply:function(e,t,n,r){var i=e[0],s=e[e.length-1],o=[],u,a=i,f=s,l=0,c=s.length,h,p;for(var d=0,v=e.length;d<v;++d)h=e[d],p=I(h,!r),p?(u||(u=new R(p),o.push(u)),u.textNodes.push(h),h===i&&(a=u.textNodes[0],l=a.length),h===s&&(f=u.textNodes[0],c=u.getLength())):u=null;var m=q(s,!r);m&&(u||(u=new R(s),o.push(u)),u.textNodes.push(m));if(o.length){for(d=0,v=o.length;d<v;++d)o[d].doMerge(n);t.setStartAndEnd(a,l,f,c)}},createContainer:function(e){var t=e.createElementNS("http://www.w3.org/1999/xhtml",this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,t,!1),this.copyAttributesToElement(this.elementAttributes,t),f(t,this.cssClass),this.onElementCreate&&this.onElementCreate(t,this),t},applyToTextNode:function(e,t){var r=e.parentNode;if(r.childNodes.length==1&&this.useExistingElements&&i(this.tagNames,r.tagName.toLowerCase())&&T(r,this.elementProperties))f(r,this.cssClass);else{var s=this.createContainer(n.getDocument(e));e.parentNode.insertBefore(s,e),s.appendChild(e)}},isRemovable:function(e){return e.tagName.toLowerCase()==this.elementTagName&&h(e)==this.elementSortedClassName&&T(e,this.elementProperties)&&!x(e,this.attrExceptions)&&this.isModifiable(e)},isEmptyContainer:function(e){var t=e.childNodes.length;return e.nodeType==1&&this.isRemovable(e)&&(t==0||t==1&&this.isEmptyContainer(e.firstChild))},removeEmptyContainers:function(e){var t=this,n=e.getNodes([1],function(e){return t.isEmptyContainer(e)}),r=[e],i=D(r);for(var s=0,o;o=n[s++];)g(o,i);P(r,i)},undoToTextNode:function(e,t,n,r){if(!t.containsNode(n)){var i=t.cloneRange();i.selectNode(n),i.isPointInRange(t.endContainer,t.endOffset)&&(B(n,t.endContainer,t.endOffset,r),t.setEndAfter(n)),i.isPointInRange(t.startContainer,t.startOffset)&&(n=B(n,t.startContainer,t.startOffset,r))}this.isRemovable(n)?b(n,r):l(n,this.cssClass)},applyToRange:function(e,t){t=t||[];var n=D(t||[]);e.splitBoundariesPreservingPositions(n),this.removeEmptyElements&&this.removeEmptyContainers(e);var r=E(e);if(r.length){for(var i=0,s;s=r[i++];)!this.isIgnorableWhiteSpaceNode(s)&&!this.getSelfOrAncestorWithClass(s)&&this.isModifiable(s)&&this.applyToTextNode(s,n);s=r[r.length-1],e.setStartAndEnd(r[0],0,s,s.length),this.normalize&&this.postApply(r,e,n,!1),P(t,n)}},applyToRanges:function(e){var t=e.length;while(t--)this.applyToRange(e[t],e);return e},applyToSelection:function(t){var n=e.getSelection(t);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(e,t){t=t||[];var n=D(t);e.splitBoundariesPreservingPositions(n),this.removeEmptyElements&&this.removeEmptyContainers(e,n);var r=E(e),i,s,o=r[r.length-1];if(r.length){for(var u=0,a=r.length;u<a;++u)i=r[u],s=this.getSelfOrAncestorWithClass(i),s&&this.isModifiable(i)&&this.undoToTextNode(i,e,s,n),e.setStartAndEnd(r[0],0,o,o.length);this.normalize&&this.postApply(r,e,n,!0),P(t,n)}},undoToRanges:function(e){var t=e.length;while(t--)this.undoToRange(e[t],e);return e},undoToSelection:function(t){var n=e.getSelection(t),r=e.getSelection(t).getAllRanges();this.undoToRanges(r),n.setRanges(r)},isAppliedToRange:function(e){if(e.collapsed||e.toString()=="")return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);var t=e.getNodes([3]);if(t.length)for(var n=0,r;r=t[n++];)if(!this.isIgnorableWhiteSpaceNode(r)&&w(e,r)&&this.isModifiable(r)&&!this.getSelfOrAncestorWithClass(r))return!1;return!0},isAppliedToRanges:function(e){var t=e.length;if(t==0)return!1;while(t--)if(!this.isAppliedToRange(e[t]))return!1;return!0},isAppliedToSelection:function(t){var n=e.getSelection(t);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},getElementsWithClassIntersectingRange:function(e){var t=[],n=this;return e.getNodes([3],function(e){var r=n.getSelfOrAncestorWithClass(e);r&&!i(t,r)&&t.push(r)}),t},detach:function(){}},W.util={hasClass:a,addClass:f,removeClass:l,hasSameClasses:p,replaceWithOwnChildren:b,elementsHaveSameNonClassAttributes:S,elementHasNonClassAttributes:x,splitNodeAt:B,isEditableElement:C,isEditingHost:k,isEditable:L},e.CssClassApplier=e.ClassApplier=W,e.createCssClassApplier=e.createClassApplier=X}),define("rangy-cssclassapplier",["rangy-core"],function(e){return function(){var t,n;return t||e.rangy.modules.ClassApplier}}(this)),rangy.createModule("TextRange",["WrappedSelection"],function(e,t){function w(e,t){function s(t,n,r){var s=e.slice(t,n),o={isWord:r,chars:s,toString:function(){return s.join("")}};for(var u=0,a=s.length;u<a;++u)s[u].token=o;i.push(o)}var n=e.join(""),r,i=[],o=0,u,a;while(r=t.wordRegex.exec(n)){u=r.index,a=u+r[0].length,u>o&&s(o,u,!1);if(t.includeTrailingSpace)while(h.test(e[a]))++a;s(u,a,!0),o=a}return o<e.length&&s(o,e.length,!1),i}function T(e,t){if(!e)return t;var n={};return u(n,t),u(n,e),n}function N(e){var t,n;return e?(t=e.language||d,n={},u(n,x[t]||x[d]),u(n,e),n):x[d]}function C(e){return T(e,E)}function k(e){return T(e,S)}function H(e,t){var n=_(e,"display",t),r=e.tagName.toLowerCase();return n=="block"&&D&&P.hasOwnProperty(r)?P[r]:n}function B(e){var t=U(e);for(var n=0,r=t.length;n<r;++n)if(t[n].nodeType==1&&H(t[n])=="none")return!0;return!1}function j(e){var t;return e.nodeType==3&&(t=e.parentNode)&&_(t,"visibility")=="hidden"}function F(e){return e&&(e.nodeType==1&&!/^(inline(-block|-table)?|none)$/.test(H(e))||e.nodeType==9||e.nodeType==11)}function I(e){var t=e.lastChild;return t?I(t):e}function q(e){return s.isCharacterDataNode(e)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(e.nodeName)}function R(e){var t=[];while(e.parentNode)t.unshift(e.parentNode),e=e.parentNode;return t}function U(e){return R(e).concat([e])}function z(e){while(e&&!e.nextSibling)e=e.parentNode;return e?e.nextSibling:null}function W(e,t){return!t&&e.hasChildNodes()?e.firstChild:z(e)}function X(e){var t=e.previousSibling;if(t){e=t;while(e.hasChildNodes())e=e.lastChild;return e}var n=e.parentNode;return n&&n.nodeType==1?n:null}function V(e){if(!e||e.nodeType!=3)return!1;var t=e.data;if(t==="")return!0;var n=e.parentNode;if(!n||n.nodeType!=1)return!1;var r=_(e.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(t)&&/^(normal|nowrap)$/.test(r)||/^[\t\r ]+$/.test(t)&&r=="pre-line"}function $(e){if(e.data==="")return!0;if(!V(e))return!1;var t=e.parentNode;return t?B(e)?!0:!1:!0}function J(e){var t=e.nodeType;return t==7||t==8||B(e)||/^(script|style)$/i.test(e.nodeName)||j(e)||$(e)}function K(e,t){var n=e.nodeType;return n==7||n==8||n==1&&H(e,t)=="none"}function Q(){this.store={}}function Z(e,t,n){return function(r){var i=this.cache;if(i.hasOwnProperty(e))return G++,i[e];Y++;var s=t.call(this,n?this[n]:this,r);return i[e]=s,s}}function et(e,t){this.node=e,this.session=t,this.cache=new Q,this.positions=new Q}function ct(e,t){this.offset=t,this.nodeWrapper=e,this.node=e.node,this.session=e.session,this.cache=new Q}function ht(){return"[Position("+s.inspectNode(this.node)+":"+this.offset+")]"}function mt(){return yt(),dt=new vt}function gt(){return dt||mt()}function yt(){dt&&dt.detach(),dt=null}function bt(e,n,r,i){function u(){var e=null,t=null;return n?(t=s,o||(s=s.previousVisible(),o=!s||r&&s.equals(r))):o||(t=s=s.nextVisible(),o=!s||r&&s.equals(r)),o&&(s=null),t}r&&(n?J(r.node)&&(r=e.previousVisible()):J(r.node)&&(r=r.nextVisible()));var s=e,o=!1,a,f=!1;return{next:function(){if(f)return f=!1,a;var e,t;while(e=u()){t=e.getCharacter(i);if(t)return a=e,e}return null},rewind:function(){if(!a)throw t.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");f=!0},dispose:function(){e=r=null}}}function Et(e,t,n){function o(e){var t,n,s=[],o=e?r:i,u=!1,a=!1;while(t=o.next()){n=t.character;if(c.test(n))a&&(a=!1,u=!0);else{if(u){o.rewind();break}a=!0}s.push(t)}return s}function p(e){var t=["["+e.length+"]"];for(var n=0;n<e.length;++n)t.push("(word: "+e[n]+", is word: "+e[n].isWord+")");return t}var r=bt(e,!1,null,t),i=bt(e,!0,null,t),s=n.tokenizer,u=o(!0),a=o(!1).reverse(),f=s(a.concat(u),n),l=u.length?f.slice(wt(f,u[0].token)):[],h=a.length?f.slice(0,wt(f,a.pop().token)+1):[];return{nextEndToken:function(){var e,t;while(l.length==1&&!(e=l[0]).isWord&&(t=o(!0)).length>0)l=s(e.chars.concat(t),n);return l.shift()},previousStartToken:function(){var e,t;while(h.length==1&&!(e=h[0]).isWord&&(t=o(!1)).length>0)h=s(t.reverse().concat(e.chars),n);return h.pop()},dispose:function(){r.dispose(),i.dispose(),l=h=null}}}function St(e,t,n,s,o){var u=0,a,f=e,l,c,h=Math.abs(n),p;if(n!==0){var d=n<0;switch(t){case r:l=bt(e,d,null,s);while((a=l.next())&&u<h)++u,f=a;c=a,l.dispose();break;case i:var v=Et(e,s,o),m=d?v.previousStartToken:v.nextEndToken;while((p=m())&&u<h)p.isWord&&(++u,f=d?p.chars[0]:p.chars[p.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+t+"' not implemented")}d?(f=f.previousVisible(),u=-u):f&&f.isLeadingSpace&&(t==i&&(l=bt(e,!1,null,s),c=l.next(),l.dispose()),c&&(f=c.previousVisible()))}return{position:f,unitsMoved:u}}function xt(e,t,n,r){var i=e.getRangeBoundaryPosition(t,!0),s=e.getRangeBoundaryPosition(t,!1),o=r?s:i,u=r?i:s;return bt(o,!!r,u,n)}function Tt(e,t,n){var r=[],i=xt(e,t,n),s;while(s=i.next())r.push(s);return i.dispose(),r}function Nt(t,n,r){var i=e.createRange(t.node);i.setStartAndEnd(t.node,t.offset,n.node,n.offset);var s=!i.expand("word",r);return i.detach(),s}function Ct(e,t,n,r,i){function g(e,t){var n=a[e].previousVisible(),r=a[t-1],s=!i.wholeWordsOnly||Nt(n,r,i.wordOptions);return{startPos:n,endPos:r,valid:s}}var s=v(i.direction),o=bt(e,s,e.session.getRangeBoundaryPosition(r,s),i),u="",a=[],f,l,c,h,p,d,m=null;while(f=o.next()){l=f.character,!n&&!i.caseSensitive&&(l=l.toLowerCase()),s?(a.unshift(f),u=l+u):(a.push(f),u+=l);if(n){p=t.exec(u);if(p)if(d){c=p.index,h=c+p[0].length;if(!s&&h<u.length||s&&c>0){m=g(c,h);break}}else d=!0}else if((c=u.indexOf(t))!=-1){m=g(c,c+t.length);break}}return d&&(m=g(c,h)),o.dispose(),m}function kt(e){return function(){var t=!!dt,n=gt(),r=[n].concat(o.toArray(arguments)),i=e.apply(this,r);return t||yt(),i}}function Lt(e,t){return kt(function(n,i,s,o){typeof s=="undefined"&&(s=i,i=r),o=T(o,A);var u=C(o.characterOptions),a=N(o.wordOptions),f=e;t&&(f=s>=0,this.collapse(!f));var l=St(n.getRangeBoundaryPosition(this,f),i,s,u,a),c=l.position;return this[f?"setStart":"setEnd"](c.node,c.offset),l.unitsMoved})}function At(e){return kt(function(t,n){n=C(n);var r,i=xt(t,this,n,!e),s=0;while((r=i.next())&&c.test(r.character))++s;i.dispose();var o=s>0;return o&&this[e?"moveStart":"moveEnd"]("character",e?s:-s,{characterOptions:n}),o})}function Ot(e){return kt(function(t,n){var r=!1;return this.changeEachRange(function(t){r=t[e](n)||r}),r})}var n="undefined",r="character",i="word",s=e.dom,o=e.util,u=o.extend,a=s.getBody,f=/^[ \t\f\r\n]+$/,l=/^[ \t\f\r]+$/,c=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,h=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,p=/^[\n-\r\u0085\u2028\u2029]$/,d="en",v=e.Selection.isDirectionBackward,m=!1,g=!1,y=!1,b=!0;(function(){var t=document.createElementNS("http://www.w3.org/1999/xhtml","div");t.contentEditable="true",t.innerHTML="<p>1 </p><p></p>";var n=a(document),r=t.firstChild,i=e.getSelection();n.appendChild(t),i.collapse(r.lastChild,2),i.setStart(r.firstChild,0),m=(""+i).length==1,t.innerHTML="1 <br>",i.collapse(t,2),i.setStart(t.firstChild,0),g=(""+i).length==1,t.innerHTML="1 <p>1</p>",i.collapse(t,2),i.setStart(t.firstChild,0),y=(""+i).length==1,n.removeChild(t),i.removeAllRanges()})();var E={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0},S={includeBlockContentTrailingSpace:!b,includeSpaceBeforeBr:!g,includeSpaceBeforeBlock:!y,includePreLineTrailingSpace:!0},x={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:w}},L={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},A={wordOptions:null,characterOptions:null},O={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},M={wordOptions:null,characterOptions:null,direction:"forward"},_=s.getComputedStyleProperty,D;(function(){var e=document.createElementNS("http://www.w3.org/1999/xhtml","table"),t=a(document);t.appendChild(e),D=_(e,"display")=="block",t.removeChild(e)})(),e.features.tableCssDisplayBlock=D;var P={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};Q.prototype={get:function(e){return this.store.hasOwnProperty(e)?this.store[e]:null},set:function(e,t){return this.store[e]=t}};var G=0,Y=0,tt={getPosition:function(e){var t=this.positions;return t.get(e)||t.set(e,new ct(this,e))},toString:function(){return"[NodeWrapper("+s.inspectNode(this.node)+")]"}};et.prototype=tt;var nt="EMPTY",rt="NON_SPACE",it="UNCOLLAPSIBLE_SPACE",st="COLLAPSIBLE_SPACE",ot="TRAILING_SPACE_BEFORE_BLOCK",ut="TRAILING_SPACE_IN_BLOCK",at="TRAILING_SPACE_BEFORE_BR",ft="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",lt="TRAILING_LINE_BREAK_AFTER_BR";u(tt,{isCharacterDataNode:Z("isCharacterDataNode",s.isCharacterDataNode,"node"),getNodeIndex:Z("nodeIndex",s.getNodeIndex,"node"),getLength:Z("nodeLength",s.getNodeLength,"node"),containsPositions:Z("containsPositions",q,"node"),isWhitespace:Z("isWhitespace",V,"node"),isCollapsedWhitespace:Z("isCollapsedWhitespace",$,"node"),getComputedDisplay:Z("computedDisplay",H,"node"),isCollapsed:Z("collapsed",J,"node"),isIgnored:Z("ignored",K,"node"),next:Z("nextPos",W,"node"),previous:Z("previous",X,"node"),getTextNodeInfo:Z("textNodeInfo",function(e){var t=null,n=!1,r=_(e.parentNode,"whiteSpace"),i=r=="pre-line";if(i)t=l,n=!0;else if(r=="normal"||r=="nowrap")t=f,n=!0;return{node:e,text:e.data,spaceRegex:t,collapseSpaces:n,preLine:i}},"node"),hasInnerText:Z("hasInnerText",function(e,t){var n=this.session,r=n.getPosition(e.parentNode,this.getNodeIndex()+1),i=n.getPosition(e,0),s=t?r:i,o=t?i:r;while(s!==o){s.prepopulateChar();if(s.isDefinitelyNonEmpty())return!0;s=t?s.previousVisible():s.nextVisible()}return!1},"node"),isRenderedBlock:Z("isRenderedBlock",function(e){var t=e.getElementsByTagName("br");for(var n=0,r=t.length;n<r;++n)if(!J(t[n]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:Z("trailingSpace",function(e){if(e.tagName.toLowerCase()=="br")return"";switch(this.getComputedDisplay()){case"inline":var t=e.lastChild;while(t){if(!K(t))return t.nodeType==1?this.session.getNodeWrapper(t).getTrailingSpace():"";t=t.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"	";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:Z("leadingSpace",function(e){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});var pt={character:"",characterType:nt,isBr:!1,prepopulateChar:function(){var e=this;if(!e.prepopulatedChar){var t=e.node,n=e.offset,r="",i=nt,s=!1;if(n>0)if(t.nodeType==3){var o=t.data,u=o.charAt(n-1),a=e.nodeWrapper.getTextNodeInfo(),f=a.spaceRegex;a.collapseSpaces?f.test(u)?n>1&&f.test(o.charAt(n-2))||(a.preLine&&o.charAt(n)==="\n"?(r=" ",i=ft):(r=" ",i=st)):(r=u,i=rt,s=!0):(r=u,i=it,s=!0)}else{var l=t.childNodes[n-1];l&&l.nodeType==1&&!J(l)&&(l.tagName.toLowerCase()=="br"?(r="\n",e.isBr=!0,i=st,s=!1):e.checkForTrailingSpace=!0);if(!r){var c=t.childNodes[n];c&&c.nodeType==1&&!J(c)&&(e.checkForLeadingSpace=!0)}}e.prepopulatedChar=!0,e.character=r,e.characterType=i,e.isCharInvariant=s}},isDefinitelyNonEmpty:function(){var e=this.characterType;return e==rt||e==it},resolveLeadingAndTrailingSpaces:function(){this.prepopulatedChar||this.prepopulateChar();if(this.checkForTrailingSpace){var e=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();e&&(this.isTrailingSpace=!0,this.character=e,this.characterType=st),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var t=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();t&&(this.isLeadingSpace=!0,this.character=t,this.characterType=st),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(e){var t=this,n;while(t=t.previousVisible()){n=t.getCharacter(e);if(n!=="")return t}return null},getCharacter:function(e){function f(){return u||(o=a.getPrecedingUncollapsedPosition(e),u=!0),o}this.resolveLeadingAndTrailingSpaces();if(this.isCharInvariant)return this.character;var t=["character",e.includeSpaceBeforeBr,e.includeBlockContentTrailingSpace,e.includePreLineTrailingSpace].join("_"),n=this.cache.get(t);if(n!==null)return n;var r="",i=this.characterType==st,s,o,u=!1,a=this;if(i){if(this.character!=" "||!!f()&&!o.isTrailingSpace&&o.character!="\n")if(this.character=="\n"&&this.isLeadingSpace)f()&&o.character!="\n"&&(r="\n");else{s=this.nextUncollapsed();if(s){s.isBr?this.type=at:s.isTrailingSpace&&s.character=="\n"?this.type=ut:s.isLeadingSpace&&s.character=="\n"&&(this.type=ot);if(s.character==="\n"){if(this.type!=at||!!e.includeSpaceBeforeBr)if(this.type!=ot||!!e.includeSpaceBeforeBlock)if(this.type!=ut||!s.isTrailingSpace||!!e.includeBlockContentTrailingSpace)if(this.type!=ft||s.type!=rt||!!e.includePreLineTrailingSpace)this.character==="\n"?s.isTrailingSpace?this.isTrailingSpace||this.isBr&&(s.type=lt,f()&&o.isLeadingSpace&&o.character=="\n"&&(s.character="")):r="\n":this.character===" "&&(r=" ")}else r=this.character}}}else this.character==="\n"&&(!(s=this.nextUncollapsed())||s.isTrailingSpace);return this.cache.set(t,r),r},equals:function(e){return!!e&&this.node===e.node&&this.offset===e.offset},inspect:ht,toString:function(){return this.character}};ct.prototype=pt,u(pt,{next:Z("nextPos",function(e){var t=e.nodeWrapper,n=e.node,r=e.offset,i=t.session;if(!n)return null;var s,o,u;return r==t.getLength()?(s=n.parentNode,o=s?t.getNodeIndex()+1:0):t.isCharacterDataNode()?(s=n,o=r+1):(u=n.childNodes[r],i.getNodeWrapper(u).containsPositions()?(s=u,o=0):(s=n,o=r+1)),s?i.getPosition(s,o):null}),previous:Z("previous",function(e){var t=e.nodeWrapper,n=e.node,r=e.offset,i=t.session,o,u,a;return r==0?(o=n.parentNode,u=o?t.getNodeIndex():0):t.isCharacterDataNode()?(o=n,u=r-1):(a=n.childNodes[r-1],i.getNodeWrapper(a).containsPositions()?(o=a,u=s.getNodeLength(a)):(o=n,u=r-1)),o?i.getPosition(o,u):null}),nextVisible:Z("nextVisible",function(e){var t=e.next();if(!t)return null;var n=t.nodeWrapper,r=t.node,i=t;return n.isCollapsed()&&(i=n.session.getPosition(r.parentNode,n.getNodeIndex()+1)),i}),nextUncollapsed:Z("nextUncollapsed",function(e){var t=e;while(t=t.nextVisible()){t.resolveLeadingAndTrailingSpaces();if(t.character!=="")return t}return null}),previousVisible:Z("previousVisible",function(e){var t=e.previous();if(!t)return null;var n=t.nodeWrapper,r=t.node,i=t;return n.isCollapsed()&&(i=n.session.getPosition(r.parentNode,n.getNodeIndex())),i})});var dt=null,vt=function(){function e(e){var t=new Q;return{get:function(n){var r=t.get(n[e]);if(r)for(var i=0,s;s=r[i++];)if(s.node===n)return s;return null},set:function(n){var r=n.node[e],i=t.get(r)||t.set(r,[]);i.push(n)}}}function n(){this.initCaches()}var t=o.isHostProperty(document.documentElement,"uniqueID");return n.prototype={initCaches:function(){this.elementCache=t?function(){var e=new Q;return{get:function(t){return e.get(t.uniqueID)},set:function(t){e.set(t.node.uniqueID,t)}}}():e("tagName"),this.textNodeCache=e("data"),this.otherNodeCache=e("nodeName")},getNodeWrapper:function(e){var t;switch(e.nodeType){case 1:t=this.elementCache;break;case 3:t=this.textNodeCache;break;default:t=this.otherNodeCache}var n=t.get(e);return n||(n=new et(e,this),t.set(n)),n},getPosition:function(e,t){return this.getNodeWrapper(e).getPosition(t)},getRangeBoundaryPosition:function(e,t){var n=t?"start":"end";return this.getPosition(e[n+"Container"],e[n+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},n}();u(s,{nextNode:W,previousNode:X});var wt=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=0,r=e.length;n<r;++n)if(e[n]===t)return n;return-1};u(e.rangePrototype,{moveStart:Lt(!0,!1),moveEnd:Lt(!1,!1),move:Lt(!0,!0),trimStart:At(!0),trimEnd:At(!1),trim:kt(function(e,t){var n=this.trimStart(t),r=this.trimEnd(t);return n||r}),expand:kt(function(e,t,n){var s=!1;n=T(n,O);var o=C(n.characterOptions);t||(t=r);if(t==i){var u=N(n.wordOptions),a=e.getRangeBoundaryPosition(this,!0),f=e.getRangeBoundaryPosition(this,!1),l=Et(a,o,u),c=l.nextEndToken(),h=c.chars[0].previousVisible(),p,d;if(this.collapsed)p=c;else{var v=Et(f,o,u);p=v.previousStartToken()}return d=p.chars[p.chars.length-1],h.equals(a)||(this.setStart(h.node,h.offset),s=!0),d&&!d.equals(f)&&(this.setEnd(d.node,d.offset),s=!0),n.trim&&(n.trimStart&&(s=this.trimStart(o)||s),n.trimEnd&&(s=this.trimEnd(o)||s)),s}return this.moveEnd(r,1,n)}),text:kt(function(e,t){return this.collapsed?"":Tt(e,this,C(t)).join("")}),selectCharacters:kt(function(e,t,n,r,i){var s={characterOptions:i};t||(t=a(this.getDocument())),this.selectNodeContents(t),this.collapse(!0),this.moveStart("character",n,s),this.collapse(!0),this.moveEnd("character",r-n,s)}),toCharacterRange:kt(function(e,t,n){t||(t=a(this.getDocument()));var r=t.parentNode,i=s.getNodeIndex(t),o=s.comparePoints(this.startContainer,this.endContainer,r,i)==-1,u=this.cloneRange(),f,l;return o?(u.setStartAndEnd(this.startContainer,this.startOffset,r,i),f=-u.text(n).length):(u.setStartAndEnd(r,i,this.startContainer,this.startOffset),f=u.text(n).length),l=f+this.text(n).length,{start:f,end:l}}),findText:kt(function(t,n,r){r=T(r,L),r.wholeWordsOnly&&(r.wordOptions=N(r.wordOptions),r.wordOptions.includeTrailingSpace=!1);var i=v(r.direction),s=r.withinRange;s||(s=e.createRange(),s.selectNodeContents(this.getDocument()));var o=n,u=!1;typeof o=="string"?r.caseSensitive||(o=o.toLowerCase()):u=!0;var a=t.getRangeBoundaryPosition(this,!i),f=s.comparePoint(a.node,a.offset);f===-1?a=t.getRangeBoundaryPosition(s,!0):f===1&&(a=t.getRangeBoundaryPosition(s,!1));var l=a,c=!1,h;for(;;){h=Ct(l,o,u,s,r);if(h){if(h.valid)return this.setStartAndEnd(h.startPos.node,h.startPos.offset,h.endPos.node,h.endPos.offset),!0;l=i?h.startPos:h.endPos}else{if(!r.wrap||!!c)return!1;s=s.cloneRange(),l=t.getRangeBoundaryPosition(s,!i),s.setBoundary(a.node,a.offset,i),c=!0}}}),pasteHtml:function(e){this.deleteContents();if(e){var t=this.createContextualFragment(e),n=t.lastChild;this.insertNode(t),this.collapseAfter(n)}}}),u(e.selectionPrototype,{expand:kt(function(e,t,n){this.changeEachRange(function(e){e.expand(t,n)})}),move:kt(function(e,t,n,r){var i=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var s=this.getRangeAt(0);r||(r={}),r.characterOptions=k(r.characterOptions),i=s.move(t,n,r),this.setSingleRange(s)}return i}),trimStart:Ot("trimStart"),trimEnd:Ot("trimEnd"),trim:Ot("trim"),selectCharacters:kt(function(t,n,r,i,s,o){var u=e.createRange(n);u.selectCharacters(n,r,i,o),this.setSingleRange(u,s)}),saveCharacterRanges:kt(function(e,t,n){var r=this.getAllRanges(),i=r.length,s=[],o=i==1&&this.isBackward();for(var u=0,a=r.length;u<a;++u)s[u]={characterRange:r[u].toCharacterRange(t,n),backward:o,characterOptions:n};return s}),restoreCharacterRanges:kt(function(t,n,r){this.removeAllRanges();for(var i=0,s=r.length,o,u,a;i<s;++i)u=r[i],a=u.characterRange,o=e.createRange(n),o.selectCharacters(n,a.start,a.end,u.characterOptions),this.addRange(o,u.backward)}),text:kt(function(e,t){var n=[];for(var r=0,i=this.rangeCount;r<i;++r)n[r]=this.getRangeAt(r).text(t);return n.join("")})}),e.innerText=function(t,n){var r=e.createRange(t);r.selectNodeContents(t);var i=r.text(n);return r.detach(),i},e.createWordIterator=function(e,t,n){var r=gt();n=T(n,M);var i=C(n.characterOptions),s=N(n.wordOptions),o=r.getPosition(e,t),u=Et(o,i,s),a=v(n.direction);return{next:function(){return a?u.previousStartToken():u.nextEndToken()},dispose:function(){u.dispose(),this.next=function(){}}}},e.noMutation=function(e){var t=gt();e(t),yt()},e.noMutation.createEntryPointFunction=kt,e.textRange={isBlockNode:F,isCollapsedWhitespaceNode:$,createPosition:kt(function(e,t,n){return e.getPosition(t,n)})}}),define("rangy-textrange",["rangy-core"],function(e){return function(){var t,n;return t||e.rangy.modules.TextRange}}(this)),rangy.createModule("Position",["WrappedSelection"],function(e,t){function f(e){var t=0,r=0;if(typeof e.pageXOffset==n&&typeof e.pageYOffset==n)t=e.pageXOffset,r=e.pageYOffset;else{var i=e.document,s=i.documentElement,u=i.compatMode,a=typeof u=="string"&&u.indexOf("CSS")>=0&&s?s:o.getBody(i);if(a&&typeof a.scrollLeft==n&&typeof a.scrollTop==n)try{t=a.scrollLeft,r=a.scrollTop}catch(f){}}return{x:t,y:r}}function l(e,t){t=t.toLowerCase();while(e){if(e.nodeType==1&&e.tagName.toLowerCase()==t)return e;e=e.parentNode}return null}function c(e,t,n,r){this.top=e,this.right=t,this.bottom=n,this.left=r,this.width=t-r,this.height=n-e}function h(e,t,n){return new c(e.top+n,e.right+t,e.bottom+n,e.left+t)}function p(e,t){var r=0,i=0,s=t.documentElement,u=o.getBody(t),a=s.clientWidth===0&&typeof u.clientTop==n?u:s,f=a.clientLeft,l=a.clientTop;return f&&(r=-f),l&&(i=-l),h(e,r,i)}function d(e){var t=[],n=[],r=[],i=[];for(var s=0,o=e.length,u;s<o;++s)u=e[s],u&&(t.push(u.top),n.push(u.bottom),r.push(u.left),i.push(u.right));return new c(Math.min.apply(Math,t),Math.max.apply(Math,i),Math.max.apply(Math,n),Math.min.apply(Math,r))}function v(t,n,r){var i=o.getBody(t).createTextRange();i.moveToPoint(n,r);var s=new e.WrappedTextRange(i);return new a(s.startContainer,s.startOffset)}function m(e,t,n){var r=e.caretPositionFromPoint(t,n);return new a(r.offsetNode,r.offset)}function g(e,t,n){var r=e.caretRangeFromPoint(t,n);return new a(r.startContainer,r.startOffset)}function y(e){var t=(e.nativeRange||e).getClientRects();return t.length>0?t[t.length-1]:null}function b(e,t,n){return console.log("pointIsInOrAboveRect",e,t,Math.floor(n.top),Math.floor(n.right),Math.floor(n.bottom),Math.floor(n.left)),t<n.bottom&&e>=n.left&&e<=n.right}function w(t,n,r,i){var s=t.elementFromPoint(n,r);console.log("elementFromPoint is ",s);var u=e.createRange(t);u.selectNodeContents(s),u.collapse(!0);var f=s.firstChild,l,c,h;if(!f)f=s.parentNode,l=o.getNodeIndex(s),i||++l;else{e:while(f){console.log(f);if(f.nodeType==3)for(l=0,h=f.length;l<=h;++l){u.setEnd(f,l),c=y(u);if(c&&b(n,r,c)){c.right-n>n-c.left&&--l;break e}}else{u.setEndAfter(f),c=y(u);if(c&&b(n,r,c)){l=o.getNodeIndex(f),f=s.parentNode,i||++l;break}}f=f.nextSibling}f||(f=s,l=s.childNodes.length)}return new a(f,l)}function E(n){if(e.features.implementsTextRange)return v;if(typeof n.caretPositionFromPoint!=r)return m;if(typeof n.caretRangeFromPoint!=r)return g;if(typeof n.elementFromPoint!=r&&C)return w;throw t.createError("createCaretPositionFromPointGetter(): Browser does not provide a recognised method to create a selection from pixel coordinates")}function S(n,r,i,s,u){u=o.getContentDocument(u,t,"createRangeFromPoints");var a=E(u),f=a(u,n,r,!1),l=a(u,i,s,!0);console.log(f.node,f.offset,l.node,l.offset);var c=e.createRange(u);return c.setStartAndEnd(f.node,f.offset,l.node,l.offset),c}function x(e,t,n,r,i){var s,o,u,a,f=r<t||t==r&&n<e;f?(s=n,o=r,u=e,a=t):(s=e,o=t,u=n,a=r);var l=rangy.getSelection(i),c=S(s,o,u,a,i);return l.setSingleRange(c),l}function B(e,t){return e.compareBoundaryPoints(t.START_TO_START,t)}function j(e){return function(){var t="getBounding"+(e?"Document":"Client")+"Rect",n=[];for(var r=0,i=null,s;r<this.rangeCount;++r)n.push(this.getRangeAt(r)[t]());return d(n)}}function F(e,t){return function(){if(this.rangeCount==0)return null;var n=t?"Document":"Client",r=this.getAllRanges();return r.length>1&&r.sort(B),e?r[0]["getStart"+n+"Pos"]():r[r.length-1]["getEnd"+n+"Pos"]()}}var n="number",r="undefined",i=e.WrappedRange,s=e.WrappedTextRange,o=e.dom,u=e.util,a=o.DomPosition,T=document.createElementNS("http://www.w3.org/1999/xhtml","span"),N=u.isHostMethod(T,"getBoundingClientRect");T=null;var C=!1,k=!1;if(e.features.implementsDomRange){var L=e.createNativeRange();C=u.isHostMethod(L,"getClientRects"),k=u.isHostMethod(L,"getBoundingClientRect"),L.detach()}u.extend(e.features,{rangeSupportsGetBoundingClientRect:k,rangeSupportsGetClientRects:C,elementSupportsGetBoundingClientRect:N});var A=function(e){return function(){var t=this.cloneRange();t.collapse(e);var n=t.getBoundingClientRect();return{x:n[e?"left":"right"],y:n[e?"top":"bottom"]}}},O=e.rangePrototype;if(e.features.implementsTextRange&&N)O.getBoundingClientRect=function(){var e=s.rangeToTextRange(this),t=this.getNodes([1],function(e){return/^t[dh]$/i.test(e.tagName)}),n,r=[];if(t.length>0){var i=l(this.startContainer,"table");for(var u=0,a,f,c,h,v;a=t[u];++u){c=l(a,"table");if(!i||c!=i)h=this.cloneRange(),i&&h.setStartAfter(i),h.setEndBefore(c),r.push(s.rangeToTextRange(h).getBoundingClientRect());this.containsNode(a)?r.push(a.getBoundingClientRect()):(f=e.duplicate(),f.moveToElementText(a),f.compareEndPoints("StartToStart",e)==-1?f.setEndPoint("StartToStart",e):f.compareEndPoints("EndToEnd",e)==1&&f.setEndPoint("EndToEnd",e),r.push(f.getBoundingClientRect())),i=c}var m=l(this.endContainer,"table");!m&&i&&(h=this.cloneRange(),h.setStartAfter(i),r.push(s.rangeToTextRange(h).getBoundingClientRect())),n=d(r)}else n=e.getBoundingClientRect();return p(n,o.getDocument(this.startContainer))};else if(e.features.implementsDomRange){var M=function(e){return e instanceof i?e:new i(e)};if(k){O.getBoundingClientRect=function(){var e=M(this).nativeRange,t=e.getBoundingClientRect()||e.getClientRects()[0];return p(t,o.getDocument(this.startContainer))};if(C){var _=function(e,t){var n=e.childNodes};A=function(e){return function(){var n,r=M(this).nativeRange,i=r.getClientRects();if(i.length==0&&N){e,console.log(r,r.getClientRects(),r.getBoundingClientRect());if(this.collapsed&&this.startContainer.nodeType==1&&this.startOffset<this.startContainer.childNodes.length){var s=this.startContainer.childNodes[this.startOffset];s.getClientRects&&console.log(s,s.getClientRects(),this.startContainer.getClientRects())}}if(i.length>0)return e?(n=i[0],{x:n.left,y:n.top}):(n=i[i.length-1],{x:n.right,y:n.bottom});throw t.createError("Cannot get position for range "+this.inspect())}}}}else{var D=N?function(e){return p(e.getBoundingClientRect(),o.getDocument(e))}:function(e){var t=0,n=0,r=e,i=e.offsetWidth,s=e.offsetHeight;while(r)t+=r.offsetLeft,n+=r.offsetTop,r=r.offsetParent;return p(new c(n,t+i,n+s,t),o.getDocument(e))},P=function(e){var t;e.splitBoundaries();var n=document.createElementNS("http://www.w3.org/1999/xhtml","span");if(e.collapsed)e.insertNode(n),t=D(n),n.parentNode.removeChild(n);else{var r=e.cloneRange();r.collapse(!0),r.insertNode(n);var i=D(n);n.parentNode.removeChild(n),r.collapseToPoint(e.endContainer,e.endOffset),r.insertNode(n);var s=D(n);n.parentNode.removeChild(n);var o=[i,s],u=e.getNodes([1],function(t){return e.containsNode(t)});for(var a=0,f=u.length;a<f;++a)o.push(D(u[a]));t=d(o)}return e.normalizeBoundaries(),t};O.getBoundingClientRect=function(e){return P(M(e))}}function H(e){return function(){var t=this["get"+(e?"Start":"End")+"ClientPos"](),n=f(o.getWindow(this.startContainer));return{x:t.x+n.x,y:t.y+n.y}}}}u.extend(O,{getBoundingDocumentRect:function(){var e=f(o.getWindow(this.startContainer));return h(this.getBoundingClientRect(),e.x,e.y)},getStartClientPos:A(!0),getEndClientPos:A(!1),getStartDocumentPos:H(!0),getEndDocumentPos:H(!1)}),u.extend(e.selectionPrototype,{getBoundingClientRect:j(!1),getBoundingDocumentRect:j(!0),getStartClientPos:F(!0,!1),getEndClientPos:F(!1,!1),getStartDocumentPos:F(!0,!0),getEndDocumentPos:F(!1,!0)}),e.positionFromPoint=function(e,n,r){return r=o.getContentDocument(r,t,"positionFromPoint"),E(r)(r,e,n)},e.createRangeFromPoints=S,e.moveSelectionToPoints=x}),define("rangy-position",["rangy-core"],function(e){return function(){var t,n;return t||e.rangy.modules.Position}}(this)),define("rangy",["rangy-core","rangy-highlighter","rangy-cssclassapplier","rangy-textrange","rangy-position"],function(e,t,n,r,i){return e}),ReadiumSDK.Views.MediaOverlayElementHighlighter=function(e){function d(e,n,r){if(p)try{if(p[0].ownerDocument===e[0].ownerDocument)return}catch(i){}$head=$("head",e[0].ownerDocument.documentElement),p=$("<style type='text/css'> </style>"),p.append("."+t+" {");var s="background-color: yellow !important; color: black !important; border-radius: 0.4em;",o=r;if(o){var u=!1;for(var a in o.declarations){if(!o.declarations.hasOwnProperty(a))continue;u=!0,p.append(a+": "+o.declarations[a]+"; ")}!u&&!n&&p.append(s)}else n||p.append(s);p.append("}"),p.appendTo($head)}this.includeParWhenAdjustingToSeqSyncGranularity=!0;var t="mo-active-default",n="mo-sub-sync",r=undefined;this.isElementHighlighted=function(e){return r&&e===r};var i=undefined;this.isCfiHighlighted=function(e){return i&&e===i};var s="",o="",u=e,a=typeof rangy!="undefined",f=undefined,l=undefined,c="MO_SPEAK",h=this,p=undefined;this.reDo=function(){p&&p.remove(),p=undefined;var e=r,t=i,n=s,u=o;r?(this.reset(),this.highlightElement(e,n,u)):i&&(this.reset(),this.highlightCfi(t,n,u))},this.highlightElement=function(e,a,f){if(!e||e===r)return;this.reset(),r=e,i=undefined,s=a,o=f;var l=this.adjustParToSeqSyncGranularity(r),c=l.element;o&&o!==""&&$(c.ownerDocument.documentElement).addClass(o);var h=$(c),p=s&&s!=="",v=u.userStyles().findStyle("."+t);d(h,p,v),v||!p?(p&&h.addClass(s),h.addClass(t)):h.addClass(s),(this.includeParWhenAdjustingToSeqSyncGranularity||r!==l)&&$(r.element).addClass(n)},this.highlightCfi=function(e,n,h){if(!e||e===i)return;this.reset(),r=undefined,i=e,s=n,o=h;var p=$(i.cfi.cfiTextParent),v=s&&s!=="",m=u.userStyles().findStyle("."+t);d(p,v,m);var g=m||!v?(v?s+" ":"")+t:s;if(a){var y=i.cfi.cfiTextParent.ownerDocument;l=rangy.createRange(y);var b="epubcfi("+i.cfi.partialStartCfi+")",w=EPUBcfi.getTextTerminusInfoWithPartialCFI(b,y,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),E="epubcfi("+i.cfi.partialEndCfi+")",S=EPUBcfi.getTextTerminusInfoWithPartialCFI(E,y,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]);l.setStartAndEnd(w.textNode[0],w.textOffset,S.textNode[0],S.textOffset),l.MO_createCssClassApplier=!0;if(!f||f.cssClass!==g)f=rangy.createCssClassApplier(g,{elementTagName:"span",elementProperties:{className:"mo-cfi-highlight"},ignoreWhiteSpace:!0,applyToEditableOnly:!1,normalize:!0},["span"]);f.applyToRange(l)}else try{var T=e.getSmil().spineItemId;u.addHighlight(T,e.cfi.partialRangeCfi,c,"highlight",undefined)}catch(N){console.error(N)}},this.reset=function(){if(i){var e=i.cfi.cfiTextParent.ownerDocument;if(a){if(f&&l.MO_createCssClassApplier)f.undoToRange(l);else{var h=undefined;while((h=e.getElementById(c))!==null){var p=h.textContent,d=e.createTextNode(p);h.parentNode.replaceChild(d,h),d.parentNode.normalize()}}l=undefined}else try{u.removeHighlight(c);var h=undefined;while((h=e.getElementById("start-"+c))!==null)console.log("toRemove START"),console.log(h),h.parentNode.removeChild(h);while((h=e.getElementById("end-"+c))!==null)console.log("toRemove END"),console.log(h),h.parentNode.removeChild(h)}catch(v){console.error(v)}i=undefined}if(r){var m=this.adjustParToSeqSyncGranularity(r),g=m.element;(this.includeParWhenAdjustingToSeqSyncGranularity||r!==m)&&$(r.element).removeClass(n),o&&o!==""&&$(g.ownerDocument.documentElement).removeClass(o),s&&s!==""&&$(g).removeClass(s),$(g).removeClass(t),r=undefined}s="",o=""},this.adjustParToSeqSyncGranularity=function(e){if(!e)return undefined;var t=u.viewerSettings().mediaOverlaysSynchronizationGranularity;if(t&&t.length>0){var n=e.element||(e.cfi?e.cfi.cfiTextParent:undefined);if(!n)return console.error("adjustParToSeqSyncGranularity !element ???"),e;var r=e.getFirstSeqAncestorWithEpubType(t,this.includeParWhenAdjustingToSeqSyncGranularity);if(r&&r.element)return r}return e}},define("mediaOverlayElementHighlighter",["readiumSDK","rangy"],function(e){return function(){var t,n;return t||e.mediaOverlayElementHighlighter}}(this)),ReadiumSDK.Views.MediaOverlayPlayer=function(e,t){function g(e){var t=e.getSmil();!n||n.smil!=t?n=new ReadiumSDK.Models.SmilIterator(t):n.reset(),n.goToPar(e);if(!n.currentPar){console.error("playPar !_smilIterator.currentPar");return}E()}function w(){p.resetBlankPage(),b=setTimeout(function(){if(!b)return;p.resetBlankPage();if(!n||!n.currentPar){p.reset();return}T=0,C(n.currentPar.audio.clipEnd+.1,2)},2e3),t({isPlaying:!0})}function E(){j=!1;if(!n||!n.currentPar){console.error("playCurrentPar !_smilIterator || !_smilIterator.currentPar ???");return}if(!n.smil.id){r.reset(),p.resetTTS(),p.resetEmbedded(),setTimeout(function(){w()},100);return}if(!n.currentPar.audio.src){y=0,r.reset();var e=n.currentPar.element;if(e){T=0;var i=e.nodeName?e.nodeName.toLowerCase():undefined;i==="audio"||i==="video"?(p.resetTTS(),p.resetBlankPage(),l&&p.resetEmbedded(),l=e,l.pause(),l.currentTime=0,l.play(),$(l).on("ended",p.onEmbeddedEnd),f=!0,setTimeout(function(){t({isPlaying:!0})},80)):(p.resetEmbedded(),p.resetBlankPage(),s=e.textContent,!s||s==""?s=undefined:O(s))}var o=n.currentPar.cfi;if(o){T=0,p.resetEmbedded(),p.resetBlankPage(),d.reset();var u=o.cfiTextParent.ownerDocument,a="epubcfi("+o.partialStartCfi+")",h=EPUBcfi.getTextTerminusInfoWithPartialCFI(a,u,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),v="epubcfi("+o.partialEndCfi+")",m=EPUBcfi.getTextTerminusInfoWithPartialCFI(v,u,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]);if(rangy){var g=rangy.createRange(u);g.setStartAndEnd(h.textNode[0],h.textOffset,m.textNode[0],m.textOffset),s=g.toString()}else s=undefined;!s||s==""?s=undefined:O(s)}}else{p.resetTTS(),p.resetEmbedded(),p.resetBlankPage();var b=n.currentPar.audio.clipEnd-n.currentPar.audio.clipBegin;if(b<=0||y>b)console.error("### MO XXX PAR OFFSET: "+y+" / "+b),y=0;var E=ReadiumSDK.Helpers.ResolveContentRef(n.currentPar.audio.src,n.smil.href),S=c.resolveRelativeUrlMO(E),x=n.currentPar.audio.clipBegin+y;r.playFile(n.currentPar.audio.src,S,x)}y=0,B()}function S(t){p.pause();var r=t?c.media_overlay.getNextSmil(n.smil):c.media_overlay.getPreviousSmil(n.smil);if(r){n=new ReadiumSDK.Models.SmilIterator(r);if(n.currentPar){if(!t)while(!n.isLast())n.next();e.openContentUrl(n.currentPar.text.src,n.smil.href,p)}}else console.log("No more SMIL"),p.reset()}function C(e,t,i){T=e,x=!1;if(!n||!n.currentPar)return;var s=n.currentPar,o=n.currentPar.audio;if(e>N&&e<=o.clipEnd)return;x=!0;var u=r.isPlaying();u&&t===6&&console.debug("from userNav _audioPlayer.isPlaying() ???");var a=e>o.clipEnd,f=!I&&t!==6&&a,l=n&&n.smil&&n.smil.spineItemId?n.smil.spineItemId:m&&m.spineItem&&m.spineItem.idref?m.spineItem.idref:undefined;if(f&&l&&m&&m.paginationInfo&&m.paginationInfo.openPages&&m.paginationInfo.openPages.length>1){var c=0,v=m.paginationInfo.openPages[c];l===v.idref&&(f=!1)}a?n.next():n.previous();if(!n.currentPar){f?(F=!0,p.reset()):S(a);return}if(!n.currentPar.audio){p.pause();return}if(h.mediaOverlaysSkipSkippables){var g=!1,y=n.currentPar;while(y){if(y.isSkippable&&y.isSkippable(h.mediaOverlaysSkippables)){g=!0;break}y=y.parent}if(g){console.log("MO SKIP: "+y.epubtype),p.pause();var b=a?n.currentPar.audio.clipEnd+.1:N-1;C(b,t,!0);return}}if(!u&&(n.currentPar.element||n.currentPar.cfi&&n.currentPar.cfi.cfiTextParent)){var w=d.adjustParToSeqSyncGranularity(n.currentPar);if(w&&w!==n.currentPar){var k=d.adjustParToSeqSyncGranularity(s);if(k&&(k===w||!a)){if(k===w){do a?n.next():n.previous();while(n.currentPar&&n.currentPar.hasAncestor(k));if(!n.currentPar){f?(F=!0,p.reset()):S(a);return}}if(!a){var L=d.adjustParToSeqSyncGranularity(n.currentPar);if(L&&L!==n.currentPar){var A=n.currentPar,O=undefined;do O=n.currentPar,n.previous();while(n.currentPar&&n.currentPar.hasAncestor(L));n.currentPar?(n.next(),n.currentPar.hasAncestor(L)||console.error("adjustParToSeqSyncGranularity !_smilIterator.currentPar.hasAncestor(landed) ???")):(n.reset(),n.currentPar!==O&&console.error("adjustParToSeqSyncGranularity _smilIterator.currentPar !=== innerPar???")),n.currentPar||(console.error("adjustParToSeqSyncGranularity !_smilIterator.currentPar ?????"),n.goToPar(A))}}}}}if(r.isPlaying()&&n.currentPar.audio.src&&n.currentPar.audio.src==r.currentSmilSrc()&&e>=n.currentPar.audio.clipBegin&&e<=n.currentPar.audio.clipEnd){B();return}E()}function A(e){if(L&&L[0].ownerDocument===e[0].ownerDocument)return;var t=".tts_on{background-color:red;color:white;} .tts_off{}";$head=$("head",e[0].ownerDocument.documentElement),L=$("<style type='text/css'> </style>").appendTo($head),L.append(t)}function D(){P();var e=function(){if(!n||!n.currentPar)return;var e=n.smil;if(!e.mo)return;var r=T-n.currentPar.audio.clipBegin;if(r<=0)return;var i=e.mo.smil_models.indexOf(e),s=new ReadiumSDK.Models.SmilIterator(e),o=-1;while(s.currentPar){o++;if(s.currentPar==n.currentPar)break;s.next()}t({playPosition:r,smilIndex:i,parIndex:o})};setTimeout(e,500),_=setInterval(e,1500)}function P(){T=0,_!==undefined&&clearInterval(_),_=undefined}function H(){P();if(x){x=!1;return}if(!n||!n.currentPar){p.reset();return}C(n.currentPar.audio.clipEnd+.1,5)}function B(){if(!n)return;if(!n.currentPar)return;if(n.currentPar.text.srcFragmentId&&n.currentPar.text.srcFragmentId.length>0){if(n.currentPar.element){d.isElementHighlighted(n.currentPar)||(d.highlightElement(n.currentPar,c.media_overlay.activeClass,c.media_overlay.playbackActiveClass),j||e.insureElementVisibility(n.currentPar.getSmil().spineItemId,n.currentPar.element,p));return}if(n.currentPar.cfi){d.isCfiHighlighted(n.currentPar)||(d.highlightCfi(n.currentPar,c.media_overlay.activeClass,c.media_overlay.playbackActiveClass),j||e.insureElementVisibility(n.currentPar.getSmil().spineItemId,n.currentPar.cfi.cfiTextParent,p));return}}if(n.currentPar.element)return;var t=n.currentPar.text.src,r=n.smil.href;n=undefined,e.openContentUrl(t,r,p)}var n=undefined,r=new ReadiumSDK.Views.AudioPlayer(t,C,H,D,P),i=!1,s=undefined,o=typeof window.speechSynthesis!="undefined"&&speechSynthesis!=null,u=undefined,a=!1,f=!1,l=undefined;this.isPlaying=function(){return r.isPlaying()||i||f||b};var c=e.package(),h=e.viewerSettings(),p=this,d=new ReadiumSDK.Views.MediaOverlayElementHighlighter(e);e.on(ReadiumSDK.Events.READER_VIEW_DESTROYED,function(){p.reset()}),this.applyStyles=function(){d.reDo()},this.onSettingsApplied=function(){r.setRate(h.mediaOverlaysRate),r.setVolume(h.mediaOverlaysVolume/100)},p.onSettingsApplied(),e.on(ReadiumSDK.Events.SETTINGS_APPLIED,this.onSettingsApplied,this);var v=!1;this.onDocLoadStart=function(){var e=p.isPlaying();e&&(v=!0,p.pause())};var m=undefined;this.onPageChanged=function(t){m=t;var r=F;F=!1;var i=v;v=!1;if(!t){p.reset();return}var s=undefined,o=!1,u="/99!",a="epubcfi";if(t.elementId||t.initiator==p){var f=e.getLoadedSpineItems(),l=e.spine().isRightToLeft();for(var c=l?f.length-1:0;l&&c>=0||!l&&c<f.length;c+=l?-1:1){var h=f[c];if(t.spineItem&&t.spineItem!=h)continue;if(t.elementId&&t.elementId.indexOf(a)===0){d.reset();var b=t.elementId.substr(a.length+1,t.elementId.length-a.length-2);b.indexOf(u)===0&&(b=b.substr(u.length,b.length-u.length));var w=b.split(",");if(w&&w.length===3)try{var S=w[0]+w[1],x=e.getElementByCfi(h,S,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]);s=x&&x.length>0?x[0]:undefined;if(s){s.nodeType===Node.TEXT_NODE&&(s=s.parentNode);break}}catch(T){console.error(T)}else try{var x=e.getElementByCfi(h,b,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]);s=x&&x.length>0?x[0]:undefined;if(s){s.nodeType===Node.TEXT_NODE&&(s=s.parentNode);break}}catch(T){console.error(T)}}if(!s){if(t.initiator==p&&!t.elementId){var x=e.getElement(h,"body");s=x&&x.length>0?x[0]:undefined}else{var x=e.getElementById(h,t.elementId);s=x&&x.length>0?x[0]:undefined}if(s)break}}s||console.error("paginationData.elementId BUT !element: "+t.elementId)}var N=p.isPlaying()||i;if(!n||!n.currentPar){if(t.initiator!==p){y=0,p.reset();if(t.elementId&&s){if(N||r)t.elementIdResolved=s,p.toggleMediaOverlayRefresh(t)}else(N||r)&&p.toggleMediaOverlay();return}if(!s){console.error("!element: "+t.elementId),y=0;return}var C=$(s).data("mediaOverlayData");if(!C){console.error("!moData: "+t.elementId),y=0;return}var k=C.par?C.par:C.pars[0];if(C.pars)for(var L=0;L<C.pars.length;L++){var A=C.pars[L];if(t.elementId===A.cfi.smilTextSrcCfi){k=A;break}}g(k);return}var O=!n.currentPar.element&&!n.currentPar.cfi;O&&console.error("!! _smilIterator.currentPar.element ??");if(t.initiator==p){var M=t.elementId&&t.elementId!==n.currentPar.text.srcFragmentId;M&&console.error("!! paginationData.elementId !== _smilIterator.currentPar.text.srcFragmentId");if(M||O){y=0;return}N?B():E()}else{if(!N&&!r){p.reset();return}!t.elementId;if(t.elementId&&!s)return;t.elementId&&(t.elementIdResolved=s),p.toggleMediaOverlayRefresh(t)}};var y=0,b=undefined,x=!1,T=0,N=-999;this.touchInit=function(){var e=r.touchInit();e&&o&&O("o",0)};var k=function(e){var t=["p","div","pagenum","td","table","li","ul","ol"],n=[",",";",".","-","??","??","?","!"],r=['"',"'","??","??","??","??"],i=function(e,t){if(e.word.length<=0)return;var n=e.text.length;t.spanMap[n]=e.counter,e.text+=e.word,e.markup+=e.html.substring(0,e.wordStart)+'<span class="tts_off" id="tts_'+e.counter+'">'+e.html.substring(e.wordStart,e.wordEnd)+"</span>"+e.html.substring(e.wordEnd,e.html.length),e.word="",e.html="",e.wordStart=-1,e.wordEnd=-1,e.counter++},s={element:e,innerHTML_tts:"",spanMap:{},text:"",lastCharIndex:undefined};s.element.innerHTML_original=e.innerHTML;var o={inTag:!1,counter:0,wordStart:-1,wordEnd:-1,text:"",markup:"",word:"",html:""},u=s.element.innerHTML_original.length,a=0;while(a<=u){if(o.inTag){o.html+=s.element.innerHTML_original[a];if(s.element.innerHTML_original[a]==">"){o.inTag=!1;var f=o.html.match(/<\/(.*?)>$/);f&&t.indexOf(f[1])>-1&&(i(o,s),o.text+=" ")}}else a==u||s.element.innerHTML_original[a].match(/\s/)?(i(o,s),a<u&&(o.text+=s.element.innerHTML_original[a],o.markup+=s.element.innerHTML_original[a])):n.indexOf(s.element.innerHTML_original[a])>-1?(i(o,s),o.wordStart=o.html.length,o.wordEnd=o.html.length+1,o.word+=s.element.innerHTML_original[a],o.html+=s.element.innerHTML_original[a],i(o,s)):s.element.innerHTML_original[a]=="<"?(o.inTag=!0,o.html+=s.element.innerHTML_original[a]):(o.word.length==0&&(o.wordStart=o.html.length),o.wordEnd=o.html.length+1,o.word+=s.element.innerHTML_original[a],o.html+=s.element.innerHTML_original[a]);a++}return s.text=o.text,s.innerHTML_tts=o.markup,s.element.innerHTML=s.innerHTML_tts,s},L=undefined,O=function(f,l){var c=undefined,h=n&&n.currentPar?n.currentPar:undefined,d=h?h.element:undefined,v=h?h.cfi:undefined;if(!l||l>0){setTimeout(function(){t({isPlaying:!0})},80),i=!0;if(a&&d){var m=$(d);A(m),d.innerHTML_original&&(d.innerHTML=d.innerHTML_original,d.innerHTML_original=undefined),c=k(d)}}if(!o){e.trigger(ReadiumSDK.Events.MEDIA_OVERLAY_TTS_SPEAK,{tts:f});return}if(!f&&window.speechSynthesis.paused){window.speechSynthesis.resume();return}var g=f||s;if(g){u&&(a&&(u.onend&&u.onend({forceSkipEnd:!0,target:u}),u.tokenData=undefined,u.onboundary=undefined),u.onend=undefined,u.onerror=undefined,u=undefined),console.debug("paused: "+window.speechSynthesis.paused),console.debug("speaking: "+window.speechSynthesis.speaking),console.debug("pending: "+window.speechSynthesis.pending);function y(e){e||window.speechSynthesis.pending?(console.debug("TTS cancel before speak"),window.speechSynthesis.cancel(),setTimeout(function(){y(!1)},5)):b()}y(!0);function b(){u=new SpeechSynthesisUtterance,a&&c&&(u.tokenData=c,u.onboundary=function(e){if(!u)return;console.debug("TTS boundary: "+e.name+" / "+e.charIndex);var t=e.target.tokenData;if(!t||!t.spanMap.hasOwnProperty(e.charIndex))return;[].forEach.call(t.element.querySelectorAll(".tts_on"),function(e){console.debug("TTS OFF "+e.id),e.className="tts_off"});var n="tts_"+t.spanMap[e.charIndex];console.debug("TTS charIndex ID: "+n);var i=t.element.querySelector("#"+n);i&&(console.debug("TTS ON"),i.className="tts_on"),t.lastCharIndex=e.charIndex}),u.onend=function(e){if(!u)return;console.debug("TTS ended");if(a){var t=e.target.tokenData,n=!e.forceSkipEnd&&u===e.target&&(!t||t.element.innerHTML_original);t&&(t.element.innerHTML_original?t.element.innerHTML=t.element.innerHTML_original:[].forEach.call(t.element.querySelectorAll(".tts_on"),function(e){console.debug("TTS OFF (end)"+e.id),e.className="tts_off"}),t.element.innerHTML_original=undefined),n?p.onTTSEnd():console.debug("TTS end SKIPPED")}else p.onTTSEnd()},u.onerror=function(e){if(!u)return;console.error("TTS error"),console.debug(u.text),console.debug(window.speechSynthesis.paused),console.debug(window.speechSynthesis.pending),console.debug(window.speechSynthesis.speaking);if(a){var t=e.target.tokenData;t&&(t.element.innerHTML_original?t.element.innerHTML=t.element.innerHTML_original:[].forEach.call(t.element.ownerDocument.querySelectorAll(".tts_on"),function(e){console.debug("TTS OFF (error)"+e.id),e.className="tts_off"}),t.element.innerHTML_original=undefined)}};var e=l||r.getVolume();u.volume=e,u.rate=r.getRate(),u.pitch=1,u.text=g,window.speechSynthesis.speak(u),window.speechSynthesis.paused&&(console.debug("TTS resume"),window.speechSynthesis.resume())}}},M=function(){t({isPlaying:!1}),i=!1;if(!o){e.trigger(ReadiumSDK.Events.MEDIA_OVERLAY_TTS_STOP,undefined);return}window.speechSynthesis.pause()},_=undefined;this.onEmbeddedEnd=function(){T=0,f=!1;if(!n||!n.currentPar){p.reset();return}C(n.currentPar.audio.clipEnd+.1,3)},this.onTTSEnd=function(){T=0,i=!1;if(!n||!n.currentPar){p.reset();return}C(n.currentPar.audio.clipEnd+.1,4)},this.escape=function(){if(!n||!n.currentPar){this.toggleMediaOverlay();return}if(!p.isPlaying()){p.play();return}if(h.mediaOverlaysEscapeEscapables){var e=n.currentPar;while(e){if(e.isEscapable&&e.isEscapable(h.mediaOverlaysEscapables)){do n.next();while(n.currentPar&&n.currentPar.hasAncestor(e));if(!n.currentPar){S(!0);return}E();return}e=e.parent}}this.nextMediaOverlay(!0)},this.playUserPar=function(e){p.isPlaying()&&p.pause();if(e.element||e.cfi&&e.cfi.cfiTextParent){var t=d.adjustParToSeqSyncGranularity(e);if(t&&t!==e){var n=function(e){if(e.nodeType&&e.nodeType==="par")return e;if(!e.children||e.children.length<=0)return undefined;for(var t=0;t<e.children.length;t++){var r=e.children[t],i=n(r);if(i)return i}},r=n(t);r&&(e=r)}}g(e)},this.resetTTS=function(){s=undefined,M()},this.resetBlankPage=function(){if(b){var e=b;b=undefined,clearTimeout(e)}b=undefined,t({isPlaying:!1})},this.resetEmbedded=function(){l&&($(l).off("ended",p.onEmbeddedEnd),l.pause()),l=undefined,t({isPlaying:!1}),f=!1},this.reset=function(){y=0,r.reset(),p.resetTTS(),p.resetEmbedded(),p.resetBlankPage(),d.reset(),n=undefined,x=!1},this.play=function(){if(n&&n.smil&&!n.smil.id){w();return}if(l)f=!0,l.play(),t({isPlaying:!0});else if(s)O(undefined);else if(!r.play()){console.log("Audio player was dead, reactivating..."),this.reset(),this.toggleMediaOverlay();return}B()},this.pause=function(){j=!1,b?this.resetBlankPage():f?(f=!1,l&&l.pause(),t({isPlaying:!1})):i?M():r.pause(),d.reset()},this.isMediaOverlayAvailable=function(){var t=e.getFirstVisibleMediaOverlayElement();return typeof t!="undefined"},this.nextOrPreviousMediaOverlay=function(e){if(p.isPlaying())p.pause();else if(n&&n.currentPar){p.play();return}if(!n){this.toggleMediaOverlay();return}var t=e?N-1:n.currentPar.audio.clipEnd+.1;C(t,6)},this.nextMediaOverlay=function(){this.nextOrPreviousMediaOverlay(!1)},this.previousMediaOverlay=function(){this.nextOrPreviousMediaOverlay(!0)},this.mediaOverlaysOpenContentUrl=function(t,r,i){y=i,n=undefined,e.openContentUrl(t,r,p)},this.toggleMediaOverlay=function(){if(p.isPlaying()){p.pause();return}if(n){p.play();return}this.toggleMediaOverlayRefresh(undefined)};var j=!1;this.toggleMediaOverlayRefresh=function(t){var r=e.getLoadedSpineItems(),i=e.spine().isRightToLeft(),s=undefined,o=p.isPlaying();if(o&&n){var u=t.initiator&&t.initiator instanceof ReadiumSDK.Views.ScrollView;if(u&&h.mediaOverlaysPreservePlaybackWhenScroll){j=!0;return}s=n.currentPar,p.pause()}j=!1;var a=t&&t.elementIdResolved?t.elementIdResolved:undefined,f=t&&t.elementId?t.elementId:undefined;if(!a){f&&console.error("[WARN] id did not resolve to element?");for(var l=i?r.length-1:0;i&&l>=0||!i&&l<r.length;l+=i?-1:1){var c=r[l];if(!c){console.error("spineItems[i] is undefined??");continue}if(t&&t.spineItem&&t.spineItem!=c)continue;if(f){var d=e.getElementById(c,f);a=d&&d.length>0?d[0]:undefined}else if(c.isFixedLayout()&&t&&t.paginationInfo&&t.paginationInfo.openPages){var v=0;if(t.paginationInfo.openPages[v]&&t.paginationInfo.openPages[v].idref&&t.paginationInfo.openPages[v].idref===c.idref){var d=e.getElement(c,"body");a=d&&d.length>0?d[0]:undefined}}if(a)break}}a||(a=e.getFirstVisibleMediaOverlayElement());if(!a){p.reset();return}var m=$(a).data("mediaOverlayData");if(!m){var g=!1,y=function(e){if(!e)return!1;for(var t=0;t<e.length;t++){a===e[t]&&(g=!0);if(g){var n=$(e[t]).data("mediaOverlayData");if(n)return m=n,!0}var r=y(e[t].children);if(r)return!0}return!1},b=a;while(b&&b.nodeName.toLowerCase()!=="body")b=b.parentNode;if(!b){p.reset();return}y([b])}if(!m){p.reset();return}var w=m.par?m.par:m.pars[0],S=w.getSmil();!n||n.smil!=S?n=new ReadiumSDK.Models.SmilIterator(S):n.reset(),n.goToPar(w),!n.currentPar&&f&&(n.reset(),n.findTextId(f));if(!n.currentPar){p.reset();return}o&&s&&s===n.currentPar?p.play():E()},this.isPlayingCfi=function(){return n&&n.currentPar&&n.currentPar.cfi};var F=!1,I=!0;this.setAutomaticNextSmil=function(e){I=e}},define("mediaOverlayPlayer",["readiumSDK","mediaOverlay","audioPlayer","mediaOverlayElementHighlighter","rangy"],function(e){return function(){var t,n;return t||e.mediaOverlayPlayer}}(this)),ReadiumSDK.Models.PageOpenRequest=function(e,t){this.spineItem=e,this.spineItemPageIndex=undefined,this.elementId=undefined,this.elementCfi=undefined,this.firstPage=!1,this.lastPage=!1,this.initiator=t,this.reset=function(){this.spineItemPageIndex=undefined,this.elementId=undefined,this.elementCfi=undefined,this.firstPage=!1,this.lastPage=!1},this.setFirstPage=function(){this.reset(),this.firstPage=!0},this.setLastPage=function(){this.reset(),this.lastPage=!0},this.setPageIndex=function(e){this.reset(),this.spineItemPageIndex=e},this.setElementId=function(e){this.reset(),this.elementId=e},this.setElementCfi=function(e){this.reset(),this.elementCfi=e}},define("pageOpenRequest",["readiumSDK"],function(e){return function(){var t,n;return t||e.pageOpenRequest}}(this)),function(e){var t={};t.Parser=function(){function e(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var t={parse:function(t,n){function a(e,t,n){var r=e,i=n-e.length;for(var s=0;s<i;s++)r=t+r;return r}function f(e){var t=e.charCodeAt(0),n,r;return t<=255?(n="x",r=2):(n="u",r=4),"\\"+n+a(t.toString(16).toUpperCase(),"0",r)}function l(e){if(i<o)return;i>o&&(o=i,u=[]),u.push(e)}function c(){var e,n,r,o,u;return o=i,u=i,t.substr(i,8)==="epubcfi("?(e="epubcfi(",i+=8):(e=null,s===0&&l('"epubcfi("')),e!==null?(n=h(),n===null&&(n=p()),n!==null?(t.charCodeAt(i)===41?(r=")",i++):(r=null,s===0&&l('")"')),r!==null?e=[e,n,r]:(e=null,i=u)):(e=null,i=u)):(e=null,i=u),e!==null&&(e=function(e,t){return{type:"CFIAST",cfiString:t}}(o,e[1])),e===null&&(i=o),e}function h(){var e,n,r,o,u,a,f,c;return f=i,c=i,e=v(),e!==null?(n=d(),n!==null?(t.charCodeAt(i)===44?(r=",",i++):(r=null,s===0&&l('","')),r!==null?(o=d(),o!==null?(t.charCodeAt(i)===44?(u=",",i++):(u=null,s===0&&l('","')),u!==null?(a=d(),a!==null?e=[e,n,r,o,u,a]:(e=null,i=c)):(e=null,i=c)):(e=null,i=c)):(e=null,i=c)):(e=null,i=c)):(e=null,i=c),e!==null&&(e=function(e,t,n,r,i){return{type:"range",path:t,localPath:n,range1:r,range2:i}}(f,e[0],e[1],e[3],e[5])),e===null&&(i=f),e}function p(){var e,t,n,r;return n=i,r=i,e=v(),e!==null?(t=d(),t!==null?e=[e,t]:(e=null,i=r)):(e=null,i=r),e!==null&&(e=function(e,t,n){return{type:"path",path:t,localPath:n}}(n,e[0],e[1])),e===null&&(i=n),e}function d(){var e,t,n,r;n=i,r=i,t=v(),t===null&&(t=m());if(t!==null){e=[];while(t!==null)e.push(t),t=v(),t===null&&(t=m())}else e=null;return e!==null?(t=g(),t=t!==null?t:"",t!==null?e=[e,t]:(e=null,i=r)):(e=null,i=r),e!==null&&(e=function(e,t,n){return{steps:t,termStep:n}}(n,e[0],e[1])),e===null&&(i=n),e}function v(){var e,n,r,o,u,a,f,c;return a=i,f=i,t.charCodeAt(i)===47?(e="/",i++):(e=null,s===0&&l('"/"')),e!==null?(n=C(),n!==null?(c=i,t.charCodeAt(i)===91?(r="[",i++):(r=null,s===0&&l('"["')),r!==null?(o=y(),o!==null?(t.charCodeAt(i)===93?(u="]",i++):(u=null,s===0&&l('"]"')),u!==null?r=[r,o,u]:(r=null,i=c)):(r=null,i=c)):(r=null,i=c),r=r!==null?r:"",r!==null?e=[e,n,r]:(e=null,i=f)):(e=null,i=f)):(e=null,i=f),e!==null&&(e=function(e,t,n){return{type:"indexStep",stepLength:t,idAssertion:n[1]}}(a,e[1],e[2])),e===null&&(i=a),e}function m(){var e,n,r,o,u,a,f,c;return a=i,f=i,t.substr(i,2)==="!/"?(e="!/",i+=2):(e=null,s===0&&l('"!/"')),e!==null?(n=C(),n!==null?(c=i,t.charCodeAt(i)===91?(r="[",i++):(r=null,s===0&&l('"["')),r!==null?(o=y(),o!==null?(t.charCodeAt(i)===93?(u="]",i++):(u=null,s===0&&l('"]"')),u!==null?r=[r,o,u]:(r=null,i=c)):(r=null,i=c)):(r=null,i=c),r=r!==null?r:"",r!==null?e=[e,n,r]:(e=null,i=f)):(e=null,i=f)):(e=null,i=f),e!==null&&(e=function(e,t,n){return{type:"indirectionStep",stepLength:t,idAssertion:n[1]}}(a,e[1],e[2])),e===null&&(i=a),e}function g(){var e,n,r,o,u,a,f,c;return a=i,f=i,t.charCodeAt(i)===58?(e=":",i++):(e=null,s===0&&l('":"')),e!==null?(n=C(),n!==null?(c=i,t.charCodeAt(i)===91?(r="[",i++):(r=null,s===0&&l('"["')),r!==null?(o=b(),o!==null?(t.charCodeAt(i)===93?(u="]",i++):(u=null,s===0&&l('"]"')),u!==null?r=[r,o,u]:(r=null,i=c)):(r=null,i=c)):(r=null,i=c),r=r!==null?r:"",r!==null?e=[e,n,r]:(e=null,i=f)):(e=null,i=f)):(e=null,i=f),e!==null&&(e=function(e,t,n){return{type:"textTerminus",offsetValue:t,textAssertion:n[1]}}(a,e[1],e[2])),e===null&&(i=a),e}function y(){var e,t;return t=i,e=x(),e!==null&&(e=function(e,t){return t}(t,e)),e===null&&(i=t),e}function b(){var e,t,n,r;return n=i,r=i,e=E(),e=e!==null?e:"",e!==null?(t=w(),t=t!==null?t:"",t!==null?e=[e,t]:(e=null,i=r)):(e=null,i=r),e!==null&&(e=function(e,t,n){return{type:"textLocationAssertion",csv:t,parameter:n}}(n,e[0],e[1])),e===null&&(i=n),e}function w(){var e,n,r,o,u,a;return u=i,a=i,t.charCodeAt(i)===59?(e=";",i++):(e=null,s===0&&l('";"')),e!==null?(n=S(),n!==null?(t.charCodeAt(i)===61?(r="=",i++):(r=null,s===0&&l('"="')),r!==null?(o=S(),o!==null?e=[e,n,r,o]:(e=null,i=a)):(e=null,i=a)):(e=null,i=a)):(e=null,i=a),e!==null&&(e=function(e,t,n){return{type:"parameter",LHSValue:t,RHSValue:n}}(u,e[1],e[3])),e===null&&(i=u),e}function E(){var e,n,r,o,u;return o=i,u=i,e=x(),e=e!==null?e:"",e!==null?(t.charCodeAt(i)===44?(n=",",i++):(n=null,s===0&&l('","')),n!==null?(r=x(),r=r!==null?r:"",r!==null?e=[e,n,r]:(e=null,i=u)):(e=null,i=u)):(e=null,i=u),e!==null&&(e=function(e,t,n){return{type:"csv",preAssertion:t,postAssertion:n}}(o,e[0],e[2])),e===null&&(i=o),e}function S(){var e,t,n;n=i,t=T(),t===null&&(t=H());if(t!==null){e=[];while(t!==null)e.push(t),t=T(),t===null&&(t=H())}else e=null;return e!==null&&(e=function(e,t){return t.join("")}(n,e)),e===null&&(i=n),e}function x(){var e,t,n;n=i,t=T(),t===null&&(t=H(),t===null&&(t=k()));if(t!==null){e=[];while(t!==null)e.push(t),t=T(),t===null&&(t=H(),t===null&&(t=k()))}else e=null;return e!==null&&(e=function(e,t){return t.join("")}(n,e)),e===null&&(i=n),e}function T(){var e,t,n,r;return n=i,r=i,e=L(),e!==null?(t=L(),t!==null?e=[e,t]:(e=null,i=r)):(e=null,i=r),e===null&&(r=i,e=L(),e!==null?(t=O(),t!==null?e=[e,t]:(e=null,i=r)):(e=null,i=r),e===null&&(r=i,e=L(),e!==null?(t=M(),t!==null?e=[e,t]:(e=null,i=r)):(e=null,i=r),e===null&&(r=i,e=L(),e!==null?(t=_(),t!==null?e=[e,t]:(e=null,i=r)):(e=null,i=r),e===null&&(r=i,e=L(),e!==null?(t=D(),t!==null?e=[e,t]:(e=null,i=r)):(e=null,i=r),e===null&&(r=i,e=L(),e!==null?(t=P(),t!==null?e=[e,t]:(e=null,i=r)):(e=null,i=r)))))),e!==null&&(e=function(e,t){return t[1]}(n,e)),e===null&&(i=n),e}function N(){var e,n,r,o,u,a,f;u=i,a=i,f=i,/^[1-9]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,s===0&&l("[1-9]"));if(e!==null){/^[0-9]/.test(t.charAt(i))?(r=t.charAt(i),i++):(r=null,s===0&&l("[0-9]"));if(r!==null){n=[];while(r!==null)n.push(r),/^[0-9]/.test(t.charAt(i))?(r=t.charAt(i),i++):(r=null,s===0&&l("[0-9]"))}else n=null;n!==null?e=[e,n]:(e=null,i=f)}else e=null,i=f;if(e!==null){t.charCodeAt(i)===46?(n=".",i++):(n=null,s===0&&l('"."'));if(n!==null){f=i,r=[],/^[0-9]/.test(t.charAt(i))?(o=t.charAt(i),i++):(o=null,s===0&&l("[0-9]"));while(o!==null)r.push(o),/^[0-9]/.test(t.charAt(i))?(o=t.charAt(i),i++):(o=null,s===0&&l("[0-9]"));r!==null?(/^[1-9]/.test(t.charAt(i))?(o=t.charAt(i),i++):(o=null,s===0&&l("[1-9]")),o!==null?r=[r,o]:(r=null,i=f)):(r=null,i=f),r!==null?e=[e,n,r]:(e=null,i=a)}else e=null,i=a}else e=null,i=a;return e!==null&&(e=function(e,t,n){return t.join("")+"."+n.join("")}(u,e[0],e[2])),e===null&&(i=u),e}function C(){var e,n,r,o,u;o=i,t.charCodeAt(i)===48?(e="0",i++):(e=null,s===0&&l('"0"'));if(e===null){u=i,/^[1-9]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,s===0&&l("[1-9]"));if(e!==null){n=[],/^[0-9]/.test(t.charAt(i))?(r=t.charAt(i),i++):(r=null,s===0&&l("[0-9]"));while(r!==null)n.push(r),/^[0-9]/.test(t.charAt(i))?(r=t.charAt(i),i++):(r=null,s===0&&l("[0-9]"));n!==null?e=[e,n]:(e=null,i=u)}else e=null,i=u}return e!==null&&(e=function(e,t){return t==="0"?"0":t[0].concat(t[1].join(""))}(o,e)),e===null&&(i=o),e}function k(){var e,n;return n=i,t.charCodeAt(i)===32?(e=" ",i++):(e=null,s===0&&l('" "')),e!==null&&(e=function(e){return" "}(n)),e===null&&(i=n),e}function L(){var e,n;return n=i,t.charCodeAt(i)===94?(e="^",i++):(e=null,s===0&&l('"^"')),e!==null&&(e=function(e){return"^"}(n)),e===null&&(i=n),e}function A(){var e,n;return n=i,t.charCodeAt(i)===34?(e='"',i++):(e=null,s===0&&l('"\\""')),e!==null&&(e=function(e){return'"'}(n)),e===null&&(i=n),e}function O(){var e,n;return n=i,t.charCodeAt(i)===91?(e="[",i++):(e=null,s===0&&l('"["')),e===null&&(t.charCodeAt(i)===93?(e="]",i++):(e=null,s===0&&l('"]"'))),e!==null&&(e=function(e,t){return t}(n,e)),e===null&&(i=n),e}function M(){var e,n;return n=i,t.charCodeAt(i)===40?(e="(",i++):(e=null,s===0&&l('"("')),e===null&&(t.charCodeAt(i)===41?(e=")",i++):(e=null,s===0&&l('")"'))),e!==null&&(e=function(e,t){return t}(n,e)),e===null&&(i=n),e}function _(){var e,n;return n=i,t.charCodeAt(i)===44?(e=",",i++):(e=null,s===0&&l('","')),e!==null&&(e=function(e){return","}(n)),e===null&&(i=n),e}function D(){var e,n;return n=i,t.charCodeAt(i)===59?(e=";",i++):(e=null,s===0&&l('";"')),e!==null&&(e=function(e){return";"}(n)),e===null&&(i=n),e}function P(){var e,n;return n=i,t.charCodeAt(i)===61?(e="=",i++):(e=null,s===0&&l('"="')),e!==null&&(e=function(e){return"="}(n)),e===null&&(i=n),e}function H(){var e,n;return n=i,/^[a-z]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,s===0&&l("[a-z]")),e===null&&(/^[A-Z]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,s===0&&l("[A-Z]")),e===null&&(/^[0-9]/.test(t.charAt(i))?(e=t.charAt(i),i++):(e=null,s===0&&l("[0-9]")),e===null&&(t.charCodeAt(i)===45?(e="-",i++):(e=null,s===0&&l('"-"')),e===null&&(t.charCodeAt(i)===95?(e="_",i++):(e=null,s===0&&l('"_"')),e===null&&(t.charCodeAt(i)===46?(e=".",i++):(e=null,s===0&&l('"."'))))))),e!==null&&(e=function(e,t){return t}(n,e)),e===null&&(i=n),e}function B(e){e.sort();var t=null,n=[];for(var r=0;r<e.length;r++)e[r]!==t&&(n.push(e[r]),t=e[r]);return n}function j(){var e=1,n=1,r=!1;for(var s=0;s<Math.max(i,o);s++){var u=t.charAt(s);u==="\n"?(r||e++,n=1,r=!1):u==="\r"||u==="\u2028"||u==="\u2029"?(e++,n=1,r=!0):(n++,r=!1)}return{line:e,column:n}}var r={fragment:c,range:h,path:p,local_path:d,indexStep:v,indirectionStep:m,terminus:g,idAssertion:y,textLocationAssertion:b,parameter:w,csv:E,valueNoSpace:S,value:x,escapedSpecialChars:T,number:N,integer:C,space:k,circumflex:L,doubleQuote:A,squareBracket:O,parentheses:M,comma:_,semicolon:D,equal:P,character:H};if(n!==undefined){if(r[n]===undefined)throw new Error("Invalid rule name: "+e(n)+".")}else n="fragment";var i=0,s=0,o=0,u=[],F=r[n]();if(F===null||i!==t.length){var I=Math.max(i,o),q=I<t.length?t.charAt(I):null,R=j();throw new this.SyntaxError(B(u),q,I,R.line,R.column)}return F},toSource:function(){return this._source}};return t.SyntaxError=function(t,n,r,i,s){function o(t,n){var r,i;switch(t.length){case 0:r="end of input";break;case 1:r=t[0];break;default:r=t.slice(0,t.length-1).join(", ")+" or "+t[t.length-1]}return i=n?e(n):"end of input","Expected "+r+" but "+i+" found."}this.name="SyntaxError",this.expected=t,this.found=n,this.message=o(t,n),this.offset=r,this.line=i,this.column=s},t.SyntaxError.prototype=Error.prototype,t}(),t.CFIInstructions={getNextNode:function(e,t,n,r,i){var s;return e%2==0?s=this.elementNodeStep(e,t,n,r,i):s=this.inferTargetTextNode(e,t,n,r,i),s},followIndirectionStep:function(e,n,r,i,s){var o=this,u,a,f,l;if(n===undefined||!n.is("iframe"))throw t.NodeTypeError(n,"expected an iframe element");if(n.is("iframe"))return u=n.contents(),a=this.applyBlacklist(u.children(),r,i,s),f=$(a[0]),l=this.getNextNode(e,f,r,i,s),l},textTermination:function(e,n,r){var i;if(e===undefined)throw t.NodeTypeError(e,"expected a terminating node, or node list");if(e.length===0)throw t.TerminusError("Text","Text offset:"+n,"no nodes found for termination condition");return i=this.injectCFIMarkerIntoText(e,n,r),i},targetIdMatchesIdAssertion:function(e,t){return e.attr("id")===t?!0:!1},elementNodeStep:function(e,n,r,i,s){var o,u,a,f=e/2-1;u=this.applyBlacklist(n.children(),r,i,s),a=u.length;if(this.indexOutOfRange(f,a))throw t.OutOfRangeError(f,a-1,"");return o=$(u[f]),o},retrieveItemRefHref:function(e,t){return $("#"+e.attr("idref"),t).attr("href")},indexOutOfRange:function(e,t){return e>t-1?!0:!1},injectCFIMarkerIntoText:function(e,n,r){var i,s,o=0,u,a,f,l;for(i=0;i<=e.length;i++)if(e[i].nodeType===3){currNodeMaxIndex=e[i].nodeValue.length+o,u=n-o;if(currNodeMaxIndex>n)return a=e[i].nodeValue,e[i].nodeValue=a.slice(0,u),f=$(r).insertAfter(e.eq(i)),l=$(document.createTextNode(a.slice(u,a.length))),$(l).insertAfter(f),f;if(currNodeMaxIndex==n)return f=$(r).insertAfter(e.eq(i)),f;o=currNodeMaxIndex}throw t.TerminusError("Text","Text offset:"+n,"The offset exceeded the length of the text")},inferTargetTextNode:function(e,n,r,i,s){var o,u,a,f,l,c;o=this.applyBlacklist(n.contents(),r,i,s),a=(parseInt(e)+1)/2-1,u=0,c=!1,l=o.filter(function(){if(u!==a)return this.nodeType===Node.TEXT_NODE?c=!0:c&&this.nodeType!==Node.TEXT_NODE&&this!==o.lastChild&&(u++,c=!1),!1;if(this.nodeType===Node.TEXT_NODE)return c=!0,!0;if(c&&this.nodeType!==Node.TEXT_NODE)return u++,c=!1,!1});if(l.length===0)throw t.OutOfRangeError(logicalTargetTextNodeIndex,u,"Index out of range");return l},applyBlacklist:function(e,t,n,r){var i;return i=e.filter(function(){var e=$(this),i=!0;return t&&$.each(t,function(t,n){if(e.hasClass(n))return i=!1,!1}),n&&$.each(n,function(t,n){if(e.is(n))return i=!1,!1}),r&&$.each(r,function(t,n){if(e.attr("id")===n)return i=!1,!1}),i}),i}},t.Interpreter={getContentDocHref:function(e,n,r,i,s){var o=$(n),u=decodeURI(e),a=t.Parser.parse(u);if(!a||a.type!=="CFIAST")throw t.NodeTypeError(a,"expected CFI AST root node");var f=$($("package",o)[0]),l=this.interpretIndexStepNode(a.cfiString.path,f,r,i,s);return foundHref=this.searchLocalPathForHref(l,o,a.cfiString.localPath,r,i,s),foundHref?foundHref:undefined},injectElement:function(e,n,r,i,s,o){var u=decodeURI(e),a=t.Parser.parse(u),f,l,c;return l=this.getFirstIndirectionStepNum(a),f=a.cfiString.localPath.steps[l],f.type="indexStep",c=this.interpretLocalPath(a.cfiString.localPath,l,$("html",n),i,s,o),c=this.interpretTextTerminusNode(a.cfiString.localPath.termStep,c,r),c},injectRangeElements:function(e,n,r,i,s,o,u){var a=decodeURI(e),f=t.Parser.parse(a),l,c,h,p,d;return c=this.getFirstIndirectionStepNum(f),l=f.cfiString.localPath.steps[c],l.type="indexStep",h=this.interpretLocalPath(f.cfiString.localPath,c,$("html",n),s,o,u),p=this.interpretLocalPath(f.cfiString.range1,0,h,s,o,u),p=this.interpretTextTerminusNode(f.cfiString.range1.termStep,p,r),d=this.interpretLocalPath(f.cfiString.range2,0,h,s,o,u),d=this.interpretTextTerminusNode(f.cfiString.range2.termStep,d,i),{startElement:p[0],endElement:d[0]}},getTargetElement:function(e,n,r,i,s){var o=decodeURI(e),u=t.Parser.parse(o),a,f,l;return f=this.getFirstIndirectionStepNum(u),a=u.cfiString.localPath.steps[f],a.type="indexStep",l=this.interpretLocalPath(u.cfiString.localPath,f,$("html",n),r,i,s),l},getRangeTargetElements:function(e,n,r,i,s){var o=decodeURI(e),u=t.Parser.parse(o),a,f,l,c,h;return f=this.getFirstIndirectionStepNum(u),a=u.cfiString.localPath.steps[f],a.type="indexStep",l=this.interpretLocalPath(u.cfiString.localPath,f,$("html",n),r,i,s),c=this.interpretLocalPath(u.cfiString.range1,0,l,r,i,s),h=this.interpretLocalPath(u.cfiString.range2,0,l,r,i,s),{startElement:c[0],endElement:h[0]}},getTargetElementWithPartialCFI:function(e,n,r,i,s){var o=decodeURI(e),u=t.Parser.parse(o),a,f=this.interpretIndexStepNode(u.cfiString.path,$("html",n),r,i,s);return f=this.interpretLocalPath(u.cfiString.localPath,0,f,r,i,s),f},getTextTerminusInfoWithPartialCFI:function(e,n,r,i,s){var o=decodeURI(e),u=t.Parser.parse(o),a,f,l=this.interpretIndexStepNode(u.cfiString.path,$("html",n),r,i,s);return l=this.interpretLocalPath(u.cfiString.localPath,0,l,r,i,s),f=parseInt(u.cfiString.localPath.termStep.offsetValue),{textNode:l,textOffset:f}},getFirstIndirectionStepNum:function(e){var t=0;for(t;t<=e.cfiString.localPath.steps.length-1;t++){nextStepNode=e.cfiString.localPath.steps[t];if(nextStepNode.type==="indirectionStep")return t}},interpretLocalPath:function(e,t,n,r,i,s){var o=t,u;for(o;o<=e.steps.length-1;o++)u=e.steps[o],u.type==="indexStep"?n=this.interpretIndexStepNode(u,n,r,i,s):u.type==="indirectionStep"&&(n=this.interpretIndirectionStepNode(u,n,r,i,s));return n},interpretIndexStepNode:function(e,n,r,i,s){if(e===undefined||e.type!=="indexStep")throw t.NodeTypeError(e,"expected index step node");var o=t.CFIInstructions.getNextNode(e.stepLength,n,r,i,s);if(e.idAssertion&&!t.CFIInstructions.targetIdMatchesIdAssertion(o,e.idAssertion))throw t.CFIAssertionError(e.idAssertion,o.attr("id"),"Id assertion failed");return o},interpretIndirectionStepNode:function(e,n,r,i,s){if(e===undefined||e.type!=="indirectionStep")throw t.NodeTypeError(e,"expected indirection step node");var o=t.CFIInstructions.followIndirectionStep(e.stepLength,n,r,i);if(e.idAssertion&&!t.CFIInstructions.targetIdMatchesIdAssertion(o,e.idAssertion))throw t.CFIAssertionError(e.idAssertion,o.attr("id"),"Id assertion failed");return o},interpretTextTerminusNode:function(e,n,r){if(e===undefined||e.type!=="textTerminus")throw t.NodeTypeError(e,"expected text terminus node");var i=t.CFIInstructions.textTermination(n,e.offsetValue,r);return i},searchLocalPathForHref:function(e,n,r,i,s,o){var u=0,a;for(u=0;u<=r.steps.length-1;u++){a=r.steps[u],a.type==="indexStep"?e=this.interpretIndexStepNode(a,e,i,s,o):a.type==="indirectionStep"&&(e=this.interpretIndirectionStepNode(a,e,i,s,o));if(e.is("itemref"))return t.CFIInstructions.retrieveItemRefHref(e,n)}return undefined}},t.NodeTypeError=function(e,t){function n(){this.node=e}return n.prototype=new Error(t),n.constructor=n,new n},t.OutOfRangeError=function(e,t,n){function r(){this.targetIndex=e,this.maxIndex=t}return r.prototype=new Error(n),r.constructor=r(),new r},t.TerminusError=function(e,t,n){function r(){this.terminusType=e,this.terminusCondition=t}return r.prototype=new Error(n),r.constructor=r(),new r},t.CFIAssertionError=function(e,t,n){function r(){this.expectedAssertion=e,this.targetElementAssertion=t}return r.prototype=new Error(n),r.constructor=r(),new r},t.Generator={generateCharOffsetRangeComponent:function(e,t,n,r,i,s,o){var u,a,f,l,c,h,p;return this.validateStartTextNode(e),this.validateStartTextNode(n),$(e).parent()[0]===$(n).parent()[0]?(f=this.createCFITextNodeStep($(e),t,i,s,o),c=this.createCFITextNodeStep($(n),r,i,s,o),p=this.createCFIElementSteps($(e).parent(),"html",i,s,o),p.substring(1,p.length)+","+f+","+c):(u=document.createRange(),u.setStart(e,t),u.setEnd(n,r),a=u.commonAncestorContainer,f=this.createCFITextNodeStep($(e),t,i,s,o),l=this.createCFIElementSteps($(e).parent(),a,i,s,o)+f,c=this.createCFITextNodeStep($(n),r,i,s,o),h=this.createCFIElementSteps($(n).parent(),a,i,s,o)+c,p=this.createCFIElementSteps($(a),"html",i,s,o),p.substring(1,p.length)+","+l+","+h)},generateElementRangeComponent:function(e,t,n,r,i){var s,o,u,a,f;this.validateStartElement(e),this.validateStartElement(t);if(e===t)throw new Error("Start and end element cannot be the same for a CFI range");return s=document.createRange(),s.setStart(e),s.setEnd(t),o=s.commonAncestorContainer,u=this.createCFIElementSteps($(e),o,n,r,i),a=this.createCFIElementSteps($(t),o,n,r,i),f=this.createCFIElementSteps($(o),"html",n,r,i),f.substring(1,f.length)+","+u+","+a},generateCharacterOffsetCFIComponent:function(e,t,n,r,i){var s,o,u,a;return this.validateStartTextNode(e,t),s=this.createCFITextNodeStep($(e),t,n,r,i),o=this.createCFIElementSteps($(e).parent(),"html",n,r,i)+s,o.substring(1,o.length)},generateElementCFIComponent:function(e,t,n,r){var i,s,o;return this.validateStartElement(e),i=this.createCFIElementSteps($(e),"html",t,n,r),i.substring(1,i.length)},generatePackageDocumentCFIComponent:function(e,t,n,r,i){return this.validateContentDocumentName(e),this.validatePackageDocument(t,e),$itemRefStartNode=$("itemref[idref='"+e+"']",$(t)),packageDocCFIComponent=this.createCFIElementSteps($itemRefStartNode,"package",n,r,i),packageDocCFIComponent+"!"},generatePackageDocumentCFIComponentWithSpineIndex:function(e,t,n,r,i){return $itemRefStartNode=$($("spine",t).children()[e]),packageDocCFIComponent=this.createCFIElementSteps($itemRefStartNode,"package",n,r,i),packageDocCFIComponent+"!"},generateCompleteCFI:function(e,t){return"epubcfi("+e+t+")"},validateStartTextNode:function(e,n){if(!e)throw new t.NodeTypeError(e,"Cannot generate a character offset from a starting point that is not a text node");if(e.nodeType!=3)throw new t.NodeTypeError(e,"Cannot generate a character offset from a starting point that is not a text node");if(n<0)throw new t.OutOfRangeError(n,0,"Character offset cannot be less than 0");if(n>e.nodeValue.length)throw new t.OutOfRangeError(n,e.nodeValue.length-1,"character offset cannot be greater than the length of the text node")},validateStartElement:function(e){if(!e)throw new t.NodeTypeError(e,"CFI target element is undefined");if(!e.nodeType||e.nodeType!==1)throw new t.NodeTypeError(e,"CFI target element is not an HTML element")},validateContentDocumentName:function(e){if(!e)throw new Error("The idref for the content document, as found in the spine, must be supplied")},validatePackageDocument:function(e,t){if(!e)throw new Error("A package document must be supplied to generate a CFI");if($($("itemref[idref='"+t+"']",e)[0]).length===0)throw new Error("The idref of the content document could not be found in the spine")},createCFITextNodeStep:function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d;o=e.parent(),u=t.CFIInstructions.applyBlacklist(o.contents(),r,i,s);var v,m,g=0,y=0,b=0;return $.each(u,function(t){if(this.nodeType===Node.TEXT_NODE){if(this===e[0])return v?(f=m,b=y):f=g,!1;v=!0,y+=this.length,m===undefined&&(m=g,g+=1)}else v=!1,m=undefined,y=0}),a=f*2+1,"/"+a+":"+(b+n)},createCFIElementSteps:function(e,n,r,i,s){var o,u,a,f,l,c;return o=t.CFIInstructions.applyBlacklist(e.parent().children(),r,i,s),$.each(o,function(t,n){if(this===e[0])return a=t,!1}),f=(a+1)*2,e.attr("id")?c="/"+f+"["+e.attr("id")+"]":c="/"+f,u=e.parent(),u.is(n)||e.is(n)?n==="html"?"!"+c:c:this.createCFIElementSteps(u,n,r,i,s)+c}};var n=t.Interpreter,r=t.Generator,i=t.CFIInstructions;if(e.EPUBcfi)throw new Error("The EPUB cfi library has already been defined");e.EPUBcfi=t;var s=t.CFIInstructions,o=t.Parser,u=t.OutOfRangeError,a=t.Interpreter,f=t.NodeTypeError,l=t.OutOfRangeError,c=t.TerminusError,h=t.CFIAssertionError;e.EPUBcfi=t={getContentDocHref:function(e,t){return n.getContentDocHref(e,t)},injectElement:function(e,t,r,i,s,o){return n.injectElement(e,t,r,i,s,o)},getTargetElement:function(e,t,r,i,s){return n.getTargetElement(e,t,r,i,s)},getTargetElementWithPartialCFI:function(e,t,r,i,s){return n.getTargetElementWithPartialCFI(e,t,r,i,s)},getTextTerminusInfoWithPartialCFI:function(e,t,r,i,s){return n.getTextTerminusInfoWithPartialCFI(e,t,r,i,s)},generateCharacterOffsetCFIComponent:function(e,t,n,i,s){return r.generateCharacterOffsetCFIComponent(e,t,n,i,s)},generateElementCFIComponent:function(e,t,n,i){return r.generateElementCFIComponent(e,t,n,i)},generatePackageDocumentCFIComponent:function(e,t,n,i,s){return r.generatePackageDocumentCFIComponent(e,t,n,i,s)},generatePackageDocumentCFIComponentWithSpineIndex:function(e,t,n,i,s){return r.generatePackageDocumentCFIComponentWithSpineIndex(e,t,n,i,s)},generateCompleteCFI:function(e,t){return r.generateCompleteCFI(e,t)},injectElementAtOffset:function(e,t,n){return i.injectCFIMarkerIntoText(e,t,n)},injectRangeElements:function(e,t,r,i,s,o,u){return n.injectRangeElements(e,t,r,i,s,o,u)},getRangeTargetElements:function(e,t,r,i,s){return n.getRangeTargetElements(e,t,r,i,s)},generateCharOffsetRangeComponent:function(e,t,n,i,s,o,u){return r.generateCharOffsetRangeComponent(e,t,n,i,s,o,u)},generateElementRangeComponent:function(e,t,n,i,s){return r.generateElementRangeComponent(e,t,n,i,s)}},t.CFIInstructions=s,t.Parser=o,t.OutOfRangeError=u,t.Interpreter=a,t.Generator=r,t.NodeTypeError=f,t.OutOfRangeError=l,t.TerminusError=c,t.CFIAssertionError=h}(typeof window=="undefined"?this:window),define("epubCfi",function(){}),ReadiumSDK.Views.CfiNavigationLogic=function(e,t,n){function i(){return n.paginationInfo&&!!n.paginationInfo.rightToLeft}function s(){return n.paginationInfo&&!!n.paginationInfo.isVerticalWritingMode}function o(e,t,n){return n?e.top>=0&&e.top<t.height:e.left>=0&&e.left<t.width}function u(){return!n.paginationInfo||s()?t.width():n.paginationInfo.columnWidth+n.paginationInfo.columnGap}function a(){return s()?{top:n.paginationInfo?n.paginationInfo.pageOffset:0}:{left:(n.paginationInfo?n.paginationInfo.pageOffset:0)*(i()?-1:1)}}function f(e,t,n){var r=ReadiumSDK.Helpers.Rect.fromElement(e);_.isNaN(r.left)&&(r=new ReadiumSDK.Helpers.Rect(e.position().top,e.position().left,0,0));var i=t.top||0,s=r.bottom()>i,o=t.bottom!==undefined?r.top<t.bottom:!0,u=0;if(s&&o)return n?(r.top<=i&&(u=Math.ceil(100*(i-r.top)/r.height)),100-u):100;return 0}function l(e,n,r){var a=p(e),f=a.clientRectangles;if(f.length===0)return null;var l=i(),c=s(),d=u(),v={width:t.width(),height:t.height()};f.length===1&&m(f[0],v,d,l,c,!0);var g=0;for(var y=0,b=f.length;y<b;++y)if(o(f[y],v,c)){g=r?h(f,y):100;break}return g}function c(e,r){var o=a(),f=p(e,o),l=f.clientRectangles;if(l.length===0)return null;var c=i(),h=s(),d=u(),v=t.height(),y=t.width();r&&g(l,r,v,d,c,h);var b=_.first(l);l.length===1&&m(b,{height:v,width:y},d,c,h);var w;if(h){var E=b.top;w=Math.floor(E/v)}else{var S=b.left;c&&(S=d*(n.paginationInfo?n.paginationInfo.visibleColumnCount:1)-S),w=Math.floor(S/d)}return w<0?w=0:w>=(n.paginationInfo?n.paginationInfo.columnCount:1)&&(w=n.paginationInfo?n.paginationInfo.columnCount-1:0),w}function h(e,t){var n=0,r=0;return e.length>1?_.each(e,function(e,i){n+=e.height,i>=t&&(r+=e.height)}):(n=e[0].height,r=e[0].height-Math.max(0,-e[0].top)),r===n?100:Math.floor(100*r/n)}function p(e,t){t=t||{};var n=t.left||0,r=t.top||0,i=d(e[0].getBoundingClientRect(),n,r),s=[],o=e[0].getClientRects();for(var u=0,a=o.length;u<a;++u)o[u].height>0&&s.push(d(o[u],n,r));if(s.length===0){e=e.next();if(e.length)return p(e,t)}return{wrapperRectangle:i,clientRectangles:s}}function d(e,t,n){var r={left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.right-e.left,height:e.bottom-e.top};return v(r,t,n),r}function v(e,t,n){e.left+=t,e.right+=t,e.top+=n,e.bottom+=n}function m(e,t,n,r,i,s){if(i)return;r&&(n*=-1);while(e.top<0)v(e,-n,t.height);if(s)while(e.bottom>=t.height){if(o(e,t,i))break;v(e,n,-t.height)}}function g(e,t,n,r,i,s){if(s)return;var o=_.reduce(e,function(e,t){return e+t.height},0),u=o*t/100;if(e.length>1){var a=0;do{a+=e[0].height;if(a>u)break;e.shift()}while(e.length>1)}else{i&&(r*=-1);while(e[0].bottom>=n)v(e[0],r,-n);e[0].top+=u,e[0].height-=u}}function y(e,n,r,i){var s=t[0].contentDocument,o="epubcfi("+e+")",u=EPUBcfi.getTargetElementWithPartialCFI(o,s,n,r,i);return!u||u.length==0?(console.log("Can't find element for CFI: "+e),undefined):u}function b(e){var t={cfi:"",x:0,y:0},n=e.indexOf("@");if(n!=-1){var r=e.substring(n+1),i=r.indexOf(":");i!=-1?(t.x=parseInt(r.substr(0,i)),t.y=parseInt(r.substr(i+1))):console.log("Unexpected terminating step format"),t.cfi=e.substring(0,n)}else t.cfi=e;return t}function w(e){if(e.nodeType===Node.TEXT_NODE){var t=e.nodeValue.replace(/\n/g,"");return t=t.replace(/ /g,""),t.length>0}return!1}n=n||{},this.getRootElement=function(){return t[0].contentDocument.documentElement};var r=n.rectangleBased?l:f;this.findFirstVisibleElement=function(e){typeof e!="object"&&(e={top:e});var t,n=null,i=0;return t=$("body",this.getRootElement()).find(":not(iframe)").contents().filter(function(){return w(this)||this.nodeName.toLowerCase()==="img"}),$.each(t,function(){var t;this.nodeType===Node.TEXT_NODE?t=$(this).parent():t=$(this);var s=r(t,e,!0);return s?(n=t,i=100-s,!1):!0}),{$element:n,percentY:i}},this.getFirstVisibleElementCfi=function(e){var t=this.findFirstVisibleElement(e);if(!t.$element)return console.log("Could not generate CFI no visible element on page"),undefined;var n=EPUBcfi.Generator.generateElementCFIComponent(t.$element[0]);return n[0]=="!"&&(n=n.substring(1)),n+"@0:"+t.percentY},this.getPageForElementCfi=function(e,t,n,r){var i=b(e),s=y(i.cfi,t,n,r);return s?this.getPageForPointOnElement(s,i.x,i.y):-1},this.getElementByCfi=function(e,t,n,r){var i=b(e);return y(i.cfi,t,n,r)},this.getPageForElement=function(e){return this.getPageForPointOnElement(e,0,0)},this.getPageForPointOnElement=function(t,r,i){var s;if(n.rectangleBased)return s=c(t,i),s===null?(console.warn("Impossible to locate a hidden element: ",t),0):s;var o=this.getVerticalOffsetForPointOnElement(t,r,i);return Math.floor(o/e.height())},this.getVerticalOffsetForElement=function(e){return this.getVerticalOffsetForPointOnElement(e,0,0)},this.getVerticalOffsetForPointOnElement=function(e,t,n){var r=ReadiumSDK.Helpers.Rect.fromElement(e);return Math.ceil(r.top+n*r.height/100)},this.getElementById=function(e){var n=t[0].contentDocument,r=$(n.getElementById(e));return r.length==0?undefined:r},this.getPageForElementId=function(e){var t=this.getElementById(e);return t?this.getPageForElement(t):-1},this.getFirstVisibleMediaOverlayElement=function(e){function s(t){if(!t||!t.length)return undefined;for(var n=0,o=t.length;n<o;n++){var u=t[n];if(!u)continue;var a=$(u);if(a.data("mediaOverlayData")){var f=r.getElementVisibility(a,e);if(f){i||(i=u);if(f==100)return u}}else{var l=s(u.children);if(l)return l}}return undefined}var t=this.getRootElement();if(!t)return undefined;var n=$("body",t);if(!n||!n.length||!n[0])return undefined;var r=this,i=undefined,o=s([n[0]]);return o||(o=i),o},this.getElementVisibility=function(e,t){return r(e,t,!0)},this.isElementVisible=r,this.getAllVisibleElementsWithSelector=function(e,t){var n=$(e,this.getRootElement()).filter(function(e){return!0}),r=[];$.each(n,function(){r.push($(this))});var i=this.getVisibleElements(r,t);return i},this.getVisibleElements=function(e,t){var n=[];return $.each(e,function(){var e=this,i=r(e,t,!0);if(i){var s=e;return n.push({element:s[0],percentVisible:i}),!0}return i===null?!0:n.length===0}),n},this.getVisibleTextElements=function(e){var t=this.getTextElements($("body",this.getRootElement()));return this.getVisibleElements(t,e)},this.getMediaOverlayElements=function(e){function n(e){if(e==undefined)return;for(var r=0,i=e.length;r<i;r++){var s=$(e[r]);s.data("mediaOverlayData")?t.push(s):n(s[0].children)}}var t=[];return n([e[0]]),t},this.getTextElements=function(e){var t=[];return e.find(":not(iframe)").contents().each(function(){w(this)&&t.push($(this).parent())}),t},this.getElement=function(e){var t=$(e,this.getRootElement());return t.length>0?t:undefined}},define("cfiNavigationLogic",["readiumSDK","epubCfi"],function(e){return function(){var t,n;return t||e.cfiNavigationLogic}}(this)),ReadiumSDK.Views.OnePageView=function(e,t,n,r){function b(e){if(e){p=!0;var t=u[0].contentDocument;s=$("html",t);if(!s||s.length==0)s=$("svg",t);g&&i.applyBookStyles(),T(),m.onIFrameLoad()}}function E(){if(!g)return;s&&w&&ReadiumSDK.Helpers.UpdateHtmlFontSize(s,w.fontSize)}function x(){if(!u||!u.length)return 0;if(ReadiumSDK.Helpers.isIframeAlive(u[0])){var e=u[0].contentWindow,t=u[0].contentDocument,n=Math.round(parseFloat(e.getComputedStyle(t.documentElement).height));return n}if(s){console.error("getContentDocHeight ??");var r=s.height();return r}return 0}function T(){y.width=0,y.height=0;var e=undefined,t=u[0].contentDocument,n=$("meta[name=viewport]",t).attr("content");n||(n=$("meta[name=viewbox]",t).attr("content")),n&&(e=N(n));if(!e){var r=$(t).find("svg");if(r.length>0){var i=undefined,s=undefined,o=r[0].getAttribute("width");if(o)try{i=parseInt(o,10)}catch(f){}var l=r[0].getAttribute("height");if(l)try{s=parseInt(l,10)}catch(f){}i&&s&&(e={width:i,height:s})}}!e&&a&&(n=a.getRenditionViewport(),n&&(e=N(n),e&&console.log("Viewport: using rendition:viewport dimensions")));if(!e){var c=$(t).find("img");if(c.length>0){e={width:c.width(),height:c.height()};var p=a&&a.media_type&&a.media_type.length&&a.media_type.indexOf("image/")==0;p||console.warn("Viewport: using img dimensions!")}else{c=$(t).find("image");if(c.length>0){var i=undefined,s=undefined,o=c[0].getAttribute("width");if(o)try{i=parseInt(o,10)}catch(f){}var l=c[0].getAttribute("height");if(l)try{s=parseInt(l,10)}catch(f){}i&&s&&(e={width:i,height:s},console.warn("Viewport: using image dimensions!"))}}}e||(i=h.width(),s=h.height(),e={width:i,height:s},console.warn("Viewport: using browser / e-reader viewport dimensions!")),e&&(y.width=e.width,y.height=e.height)}function N(e){var t=e.replace(/\s/g,"").split(","),n={};for(var r=0;r<t.length;r++){var i=t[r].split("=");i.length==2&&(n[i[0]]=i[1])}var s=Number.NaN,o=Number.NaN;return n.width&&(s=parseInt(n.width)),n.height&&(o=parseInt(n.height)),!isNaN(s)&&!isNaN(o)?{width:s,height:o}:undefined}_.extend(this,Backbone.Events);var i=this,s,o,u,a,f=e.spine,l=e.iframeLoader,c=e.bookStyles,h=e.$viewport,p=!1,d,v=function(e){var n=function(e,t){this.begin=e,this.end=t},r=new n(function(e,t,n,r,i,s,o){r.css("opacity","0")},function(e,t,n,r,i,s,o){r.css("transform","none"),ReadiumSDK.Helpers.CSSTransition(r,"opacity 150ms ease-out"),r.css("opacity","1")}),s=new n(function(e,t,n,r,i,s,o){r.css("opacity","0");var u=Math.ceil(i*e),a=u*.8*(o===2?1:-1),f=ReadiumSDK.Helpers.CSSTransformString({left:Math.round(a),origin:"50% 50% 0",enable3D:c});r.css(f)},function(e,t,n,r,i,s,o){r.css("opacity","1"),ReadiumSDK.Helpers.CSSTransition(r,"transform 150ms ease-out"),r.css("transform","none")}),o=new n(function(e,t,n,r,i,s,o){r.css("opacity","0");var u=Math.ceil(i*e),a=u*1.7*(o===2?1:-1),f=ReadiumSDK.Helpers.CSSTransformString({left:Math.round(a),angle:(o===2?-1:1)*30,origin:"50% 50% 0",enable3D:c});r.css(f)},function(e,t,n,r,i,s,o){r.css("opacity","1"),ReadiumSDK.Helpers.CSSTransition(r,"transform 300ms ease-in-out"),r.css("transform","none")}),u=new n(function(e,n,r,i,s,o,u){i.css("opacity","0");var a=!1,f=!1,l=!1;for(var h=0;h<t.length;h++){var p=t[h].toLowerCase();if(p.indexOf("left")>=0){a=!0;break}if(p.indexOf("right")>=0){l=!0;break}if(p.indexOf("center")>=0){f=!0;break}}var d=Math.ceil(s*e),v=d*.5*(a||f&&u===1?1:-1),m=ReadiumSDK.Helpers.CSSTransformString({scale:.2,left:Math.round(v),angle:(a||f&&u===1?1:-1)*30,origin:"50% 50% 0",enable3D:c});i.css(m)},function(e,t,n,r,i,s,o){r.css("opacity","1"),ReadiumSDK.Helpers.CSSTransition(r,"transform 400ms ease-out"),r.css("transform","none")}),a=[];a.push(r),a.push(s),a.push(o),a.push(u);var f=e.disablePageTransitions||!1,l=-1,c=(new ReadiumSDK.Models.ViewerSettings({})).enableGPUHardwareAccelerationCSS3D,h=undefined;this.updateOptions=function(e){h=e;var t=h;if(!t||typeof t.enableGPUHardwareAccelerationCSS3D=="undefined")t=new ReadiumSDK.Models.ViewerSettings({});t.enableGPUHardwareAccelerationCSS3D&&(c=!0),e.pageTransition!==null&&typeof e.pageTransition!="undefined"&&(l=e.pageTransition)},this.updateOptions(e);var p=0,d=!1,v=!1;this.updatePageSwitchDir=function(e,t){if(v)return;p=e,d=t},this.onIFrameLoad=function(){v=!0},this.transformContentImmediate_BEGIN=function(e,t,n,r){var s=d||v;v=!1;if(f||l===-1)return;ReadiumSDK.Helpers.CSSTransition(e,"all 0 ease 0");if(!s)return;var o=l>=0&&l<a.length?a[l]:undefined;p===0||!o?e.css("opacity","0"):o.begin(t,n,r,e,i.meta_width(),i.meta_height(),p)},this.transformContentImmediate_END=function(e,t,n,r){if(f||l===-1){e.css("transform","none");return}setTimeout(function(){var s=l>=0&&l<a.length?a[l]:undefined;p===0||!s?(e.css("transform","none"),ReadiumSDK.Helpers.CSSTransition(e,"opacity 250ms linear"),e.css("opacity","1")):s.end(t,n,r,e,i.meta_width(),i.meta_height(),p)},10)}},m=new v(e),g=n||!1,y={width:0,height:0};this.element=function(){return o},this.meta_height=function(){return y.height},this.meta_width=function(){return y.width},this.isDisplaying=function(){return p},this.render=function(){var e=ReadiumSDK.Helpers.loadTemplate("single_page_frame",{});o=$(e),d=$("#scaler",o),ReadiumSDK.Helpers.CSSTransition(o,"all 0 ease 0"),o.css("transform","none");var n=r.viewerSettings();if(!n||typeof n.enableGPUHardwareAccelerationCSS3D=="undefined")n=new ReadiumSDK.Models.ViewerSettings({});n.enableGPUHardwareAccelerationCSS3D&&o.css("transform","translateZ(0)"),o.css("height","100%"),o.css("width","100%");for(var i=0,s=t.length;i<s;i++)o.addClass(t[i]);return u=$("iframe",o),this},this.decorateIframe=function(){if(!u||!u.length)return;u.css("border-bottom","1px dashed silver"),u.css("border-top","1px dashed silver")},this.remove=function(){p=!1,a=undefined,o.remove()},this.clear=function(){p=!1,u[0].src=""},this.currentSpineItem=function(){return a};var w=undefined;this.setViewSettings=function(e){w=e,g&&i.applyBookStyles(),T(),m.updateOptions(e)},this.applyBookStyles=function(){if(!g)return;s&&(ReadiumSDK.Helpers.setStyles(c.getStyles(),s),E())},this.scaleToWidth=function(e){if(y.width<=0)return;var t=e/y.width;i.transformContentImmediate(t,0,0)},this.resizeIFrameToContent=function(){var e=x();i.setHeight(e),i.showIFrame()},this.setHeight=function(e){d.css("height",e+"px"),o.css("height",e+"px")};var S=!0;this.showIFrame=function(){u.css("visibility","visible");if(S){u.css("transform","none");var e=!1,t=w;if(!t||typeof t.enableGPUHardwareAccelerationCSS3D=="undefined")t=new ReadiumSDK.Models.ViewerSettings({});t.enableGPUHardwareAccelerationCSS3D&&(e=!0,u.css("transform","translateZ(0)"))}else u.css({left:"0px",top:"0px"})},this.hideIFrame=function(){u.css("visibility","hidden");if(S){var e=!1,t=w;if(!t||typeof t.enableGPUHardwareAccelerationCSS3D=="undefined")t=new ReadiumSDK.Models.ViewerSettings({});t.enableGPUHardwareAccelerationCSS3D&&(e=!0);var n=ReadiumSDK.Helpers.CSSTransformString({left:"10000",top:"10000",enable3D:e});u.css(n)}else u.css({left:"10000px",top:"10000px"})},this.updatePageSwitchDir=function(e,t){m.updatePageSwitchDir(e,t)},this.transformContentImmediate=function(e,t,n){var u=Math.ceil(y.width*e),a=Math.floor(y.height*e);m.transformContentImmediate_BEGIN(o,e,t,n),o.css("left",t+"px"),o.css("top",n+"px"),o.css("width",u+"px"),o.css("height",a+"px");if(!s)return;var f=!1,l=w;if(!l||typeof l.enableGPUHardwareAccelerationCSS3D=="undefined")l=new ReadiumSDK.Models.ViewerSettings({});l.enableGPUHardwareAccelerationCSS3D&&(f=!0);if(r.needsFixedLayoutScalerWorkAround()){var c=ReadiumSDK.Helpers.CSSTransformString({scale:e,enable3D:f});s.css(c);var h=ReadiumSDK.Helpers.CSSTransformString({scale:1,enable3D:f});h.width=y.width,h.height=y.height,d.css(h)}else{var p=ReadiumSDK.Helpers.CSSTransformString({scale:e,enable3D:f});p.width=y.width,p.height=y.height,d.css(p)}s.css("opacity","0.999"),i.showIFrame(),setTimeout(function(){s.css("opacity","1")},0),m.transformContentImmediate_END(o,e,t,n)},this.getCalculatedPageHeight=function(){return o.height()},this.transformContent=_.bind(_.debounce(this.transformContentImmediate,50),i),this.loadSpineItem=function(e,t,n){if(a!=e){a=e;var r=f.package.resolveRelativeUrl(e.href);i.hideIFrame(),i.trigger(ReadiumSDK.Views.OnePageView.SPINE_ITEM_OPEN_START,u,a),l.loadIframe(u[0],r,function(r){if(r&&t){var i=function(){t(r,u,a,!0,n)};ReadiumSDK.Helpers.isIframeAlive(u[0])?(b(r),i()):(console.error("onIFrameLoad !! doc && win + TIMEOUT"),console.debug(e.href),b(r),setTimeout(i,500))}else b(r)},i,{spineItem:a})}else t&&t(!0,u,a,!1,n)},this.getFirstVisibleElementCfi=function(){var e=new ReadiumSDK.Views.CfiNavigationLogic(o,u);return e.getFirstVisibleElementCfi(0)},this.getNavigator=function(){return new ReadiumSDK.Views.CfiNavigationLogic(o,u)},this.getElementByCfi=function(e,t,n,r,i){if(e!=a)return console.error("spine item is not loaded"),undefined;var s=new ReadiumSDK.Views.CfiNavigationLogic(o,u);return s.getElementByCfi(t,n,r,i)},this.getElementById=function(e,t){if(e!=a)return console.error("spine item is not loaded"),undefined;var n=new ReadiumSDK.Views.CfiNavigationLogic(o,u);return n.getElementById(t)},this.getElement=function(e,t){if(e!=a)return console.error("spine item is not loaded"),undefined;var n=new ReadiumSDK.Views.CfiNavigationLogic(o,u);return n.getElement(t)},this.getFirstVisibleMediaOverlayElement=function(){var e=new ReadiumSDK.Views.CfiNavigationLogic(o,u);return e.getFirstVisibleMediaOverlayElement({top:0,bottom:u.height()})},this.offset=function(){return u?u.offset():undefined}},ReadiumSDK.Views.OnePageView.SPINE_ITEM_OPEN_START="SpineItemOpenStart",define("onePageView",["readiumSDK","cfiNavigationLogic"],function(e){return function(){var t,n;return t||e.onePageView}}(this)),ReadiumSDK.Models.CurrentPagesInfo=function(e,t){function i(e){var t=n.openPages[e].spineItemPageIndex+1;if(r!=undefined){var i=0,s=r.defaultSpineItemTotalPageCounts;for(var u=0;u<s.length;u++){if(s[u].idref&&s[u].idref==n.openPages[e].idref)break;s[u].defaultSpineItemPageCount&&(i+=s[u].defaultSpineItemPageCount)}var a=o(n.openPages[e].viewPortArea);a>1?t+=Math.ceil(i/a):t+=Math.floor(i/a)}return t}function s(){return n.openPages.length>0}function o(e){return e/u()}function u(){var e=r.defaultViewPortSize;return e.height*e.width}function a(){n.openPages.sort(function(e,t){return e.spineItemIndex!=t.spineItemIndex?e.spineItemIndex-t.spineItemIndex:e.pageIndex-t.pageIndex})}var n=this,r=JSON.parse(localStorage.getItem("defaultPagination"));this.isRightToLeft=e.isRightToLeft(),this.isFixedLayout=t,this.openPages=[],this.addOpenPage=function(e,t,n,r,i){this.openPages.push({spineItemPageIndex:e,spineItemPageCount:t,idref:n,spineItemIndex:r,viewPortArea:i}),a()},this.canGoLeft=function(){return this.isRightToLeft?this.canGoNext():this.canGoPrev()},this.canGoRight=function(){return this.isRightToLeft?this.canGoPrev():this.canGoNext()},this.canGoNext=function(){if(this.openPages.length==0)return!1;var t=this.openPages[this.openPages.length-1];return t.spineItemIndex<e.last().index||t.spineItemPageIndex<t.spineItemPageCount-1},this.canGoPrev=function(){return this.openPages.length==0?!1:e.first().index<this.firstOpenPage().spineItemIndex||0<this.firstOpenPage().spineItemPageIndex},this.firstOpenPage=function(){return this.openPages.length==0?undefined:this.openPages[0]},this.getPageNumbers=function(){var e=[];for(var t in this.openPages){var n=this.isFixedLayout?this.openPages[t].spineItemIndex+1:i(t);e.push(n)}return e.join("-")},this.getPageCount=function(){return s()?this.isFixedLayout?e.items.length:n.firstOpenPage().spineItemPageCount:0},this.getTotalPageCount=function(){if(this.isFixedLayout)return e.items.length;var t=n.firstOpenPage();if(r!=undefined)return Math.round(r.totalPageCount/o(t.viewPortArea))}},define("currentPagesInfo",["readiumSDK"],function(e){return function(){var t,n;return t||e.currentPagesInfo}}(this)),ReadiumSDK.Models.Spread=function(e,t){function i(){n.leftItem=undefined,n.rightItem=undefined,n.centerItem=undefined}function s(e,t){t==ReadiumSDK.Models.Spread.POSITION_LEFT?n.leftItem=e:t==ReadiumSDK.Models.Spread.POSITION_RIGHT?n.rightItem=e:(t!=ReadiumSDK.Models.Spread.POSITION_CENTER&&console.error("Unrecognized position value"),n.centerItem=e)}function o(e){return r?e.isLeftPage()?ReadiumSDK.Models.Spread.POSITION_LEFT:e.isRightPage()?ReadiumSDK.Models.Spread.POSITION_RIGHT:ReadiumSDK.Models.Spread.POSITION_CENTER:ReadiumSDK.Models.Spread.POSITION_CENTER}function u(e){return e.isLeftPage()?n.spine.isRightToLeft()?n.spine.prevItem(e):n.spine.nextItem(e):e.isRightPage()?n.spine.isRightToLeft()?n.spine.nextItem(e):n.spine.prevItem(e):undefined}var n=this;this.spine=e,this.leftItem=undefined,this.rightItem=undefined,this.centerItem=undefined;var r=t;this.setSyntheticSpread=function(e){r=e},this.isSyntheticSpread=function(){return r},this.openFirst=function(){this.spine.items.length==0?i():this.openItem(this.spine.first())},this.openLast=function(){this.spine.items.length==0?i():this.openItem(this.spine.last())},this.openItem=function(e){i();var t=o(e);s(e,t);if(t!=ReadiumSDK.Models.Spread.POSITION_CENTER&&this.spine.isValidLinearItem(e.index)){var n=u(e);if(n){var r=o(n);r!=t&&r!=ReadiumSDK.Models.Spread.POSITION_CENTER&&!n.isReflowable()&&n.isRenditionSpreadAllowed()&&s(n,r)}}},this.openNext=function(){var e=this.validItems();if(e.length==0)this.openFirst();else{var t=this.spine.nextItem(e[e.length-1]);t&&this.openItem(t)}},this.openPrev=function(){var e=this.validItems();if(e.length==0)this.openLast();else{var t=this.spine.prevItem(e[0]);t&&this.openItem(t)}},this.validItems=function(){var e=[];return this.leftItem&&e.push(this.leftItem),this.rightItem&&e.push(this.rightItem),this.centerItem&&e.push(this.centerItem),e.sort(function(e,t){return e.index-t.index}),e}},ReadiumSDK.Models.Spread.POSITION_LEFT="left",ReadiumSDK.Models.Spread.POSITION_RIGHT="right",ReadiumSDK.Models.Spread.POSITION_CENTER="center",define("fixedPageSpread",["readiumSDK"],function(e){return function(){var t,n;return t||e.fixedPageSpread}}(this)),ReadiumSDK.Models.BookmarkData=function(e,t){this.idref=e,this.contentCFI=t,this.toString=function(){return JSON.stringify(this)}},define("bookmarkData",["readiumSDK"],function(e){return function(){var t,n;return t||e.bookmarkData}}(this)),ReadiumSDK.Views.FixedView=function(e,t){function E(r){var i=new ReadiumSDK.Views.OnePageView(e,[r],!1,t);return i.on(ReadiumSDK.Views.OnePageView.SPINE_ITEM_OPEN_START,function(e,t){n.trigger(ReadiumSDK.Events.CONTENT_DOCUMENT_LOAD_START,e,t)}),i}function S(){var e=m.validItems();return e[0]}function x(e,t){if(b){w={initiator:e,paginationRequest:t};return}b=!0;var r={isElementAdded:!1},i=N([{pageView:h,spineItem:m.leftItem,context:r},{pageView:p,spineItem:m.rightItem,context:r},{pageView:d,spineItem:m.centerItem,context:r}]);$.when.apply($,i).done(function(){b=!1;if(w){var i=w.initiator,s=w.paginationRequest;w=undefined,x(i,s)}else r.isElementAdded&&n.applyStyles(),t?C(e,t.spineItem,t.elementId):C(e)})}function N(e){var t=[];for(var n=0;n<e.length;n++){var r=P(e[n].pageView,e[n].spineItem,e[n].context);t.push(r)}return t}function C(e,t,r){M(),A(),n.trigger(ReadiumSDK.InternalEvents.CURRENT_VIEW_PAGINATION_CHANGED,{paginationInfo:n.getPaginationInfo(),initiator:e,spineItem:t,elementId:r})}function k(e,t){var n=new ReadiumSDK.Models.Spread(s,t);return n.openItem(e),m.leftItem!=n.leftItem||m.rightItem!=n.rightItem||m.centerItem!=n.centerItem}function L(){if(!y||!g)return!1;var e=i.width(),t=i.height();return e&&t}function A(e){T(0,!1);if(!L())return;var t=i.width(),s=i.height(),o=h.isDisplaying()?ReadiumSDK.Helpers.Margins.fromElement(h.element()):ReadiumSDK.Helpers.Margins.empty(),u=p.isDisplaying()?ReadiumSDK.Helpers.Margins.fromElement(p.element()):ReadiumSDK.Helpers.Margins.empty(),l=d.isDisplaying()?ReadiumSDK.Helpers.Margins.fromElement(d.element()):ReadiumSDK.Helpers.Margins.empty(),c=O(o,u,l),v={width:t-g.width(),height:s-g.height()},m={width:v.width-c.width(),height:v.height-c.height()};if(v.width<=0||v.height<=0)return;var b=m.width/y.width,w=m.height/y.height;i.css("overflow","auto");var E;a.style=="fit-width"?E=b:a.style=="fit-height"?E=w:a.style=="user"?E=a.scale:(E=Math.min(b,w),i.css("overflow","hidden")),f=E;var S={width:y.width*E,height:y.height*E},x={width:S.width+c.width(),height:S.height+c.height()},N={width:x.width+g.width(),height:x.height+g.height()},C=Math.floor((t-N.width)/2),k=Math.floor((s-N.height)/2);C<0&&(C=0),k<0&&(k=0),r.css("left",C+"px"),r.css("top",k+"px"),r.css("width",x.width+"px"),r.css("height",x.height+"px");var A=g.padding.left,M=g.padding.top,_=e?"transformContentImmediate":"transformContent";h.isDisplaying()&&h[_](E,A,M),p.isDisplaying()&&(A+=y.separatorPosition*E,h.isDisplaying()&&(A+=o.left),p[_](E,A,M)),d.isDisplaying()&&d[_](E,A,M),n.trigger(ReadiumSDK.Events.FXL_VIEW_RESIZED)}function O(e,t,n){var r={left:Math.max(e.margin.left,t.margin.left,n.margin.left),right:Math.max(e.margin.right,t.margin.right,n.margin.right),top:Math.max(e.margin.top,t.margin.top,n.margin.top),bottom:Math.max(e.margin.bottom,t.margin.bottom,n.margin.bottom)},i={left:Math.max(e.border.left,t.border.left,n.border.left),right:Math.max(e.border.right,t.border.right,n.border.right),top:Math.max(e.border.top,t.border.top,n.border.top),bottom:Math.max(e.border.bottom,t.border.bottom,n.border.bottom)},s={left:Math.max(e.padding.left,t.padding.left,n.padding.left),right:Math.max(e.padding.right,t.padding.right,n.padding.right),top:Math.max(e.padding.top,t.padding.top,n.padding.top),bottom:Math.max(e.padding.bottom,t.padding.bottom,n.padding.bottom)};return new ReadiumSDK.Helpers.Margins(r,i,s)}function M(){y={},d.isDisplaying()?(y.width=d.meta_width(),y.height=d.meta_height(),y.separatorPosition=0):h.isDisplaying()&&p.isDisplaying()?h.meta_height()==p.meta_height()?(y.width=h.meta_width()+p.meta_width(),y.height=h.meta_height(),y.separatorPosition=h.meta_width()):(y.width=h.meta_width()+p.meta_width()*(h.meta_height()/p.meta_height()),y.height=h.meta_height(),y.separatorPosition=h.meta_width()):h.isDisplaying()?(y.width=h.meta_width()*2,y.height=h.meta_height(),y.separatorPosition=h.meta_width()):p.isDisplaying()?(y.width=p.meta_width()*2,y.height=p.meta_height(),y.separatorPosition=p.meta_width()):y=undefined}function D(){g=ReadiumSDK.Helpers.Margins.fromElement(r)}function P(e,t,i){var s=$.Deferred();return t?(e.isDisplaying()||(r.append(e.render().element()),i.isElementAdded=!0),e.loadSpineItem(t,function(t,r,i,o,u){t&&o&&((!e.meta_height()||!e.meta_width())&&console.error("Invalid document "+i.href+": viewport is not specified!"),n.trigger(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,r,i)),s.resolve()},i)):(e.isDisplaying()&&e.remove(),s.resolve()),s.promise()}function H(){var e=[];s.isLeftToRight()?e=[h,d,p]:e=[p,d,h];var t=[];for(var n=0,r=e.length;n<r;n++)e[n].isDisplaying()&&t.push(e[n]);return t}_.extend(this,Backbone.Events);var n=this,r,i=e.$viewport,s=e.spine,o=e.userStyles,u=e.bookStyles,a=e.zoom||{style:"default"},f,l=e.iframeLoader,c=undefined,h=E("fixed-page-frame-left"),p=E("fixed-page-frame-right"),d=E("fixed-page-frame-center"),v=[];v.push(h),v.push(p),v.push(d);var m=new ReadiumSDK.Models.Spread(s,!1),g,y,b=!1,w=!1;this.isReflowable=function(){return!1},this.setZoom=function(e){a=e,A(!1)},this.render=function(){var e=ReadiumSDK.Helpers.loadTemplate("fixed_book_frame",{});return r=$(e),ReadiumSDK.Helpers.CSSTransition(r,"all 0 ease 0"),r.css("overflow","hidden"),i.append(r),n.applyStyles(),this},this.remove=function(){r.remove()},this.setViewSettings=function(e){c=e,m.setSyntheticSpread(ReadiumSDK.Helpers.deduceSyntheticSpread(i,S(),c)==1);var t=H();for(var n=0,r=t.length;n<r;n++)t[n].setViewSettings(e)};var T=function(e,t){h&&h.updatePageSwitchDir(e,t),p&&p.updatePageSwitchDir(e,t),d&&d.updatePageSwitchDir(e,t)};this.applyStyles=function(){ReadiumSDK.Helpers.setStyles(o.getStyles(),r.parent()),D(),M(),A()},this.applyBookStyles=function(){var e=H();for(var t=0,n=e.length;t<n;t++)e[t].applyBookStyles()},this.onViewportResize=function(){var e=S();if(!e)return;var t=ReadiumSDK.Helpers.deduceSyntheticSpread(i,e,c)==1;if(k(e,t)){m.setSyntheticSpread(t);var r=new ReadiumSDK.Models.PageOpenRequest(e,n);n.openPage(r)}else A(!0)},this.getViewScale=function(){return f},this.openPage=function(e,t){if(!e.spineItem)return;var n=m.leftItem,r=m.rightItem,s=m.centerItem,o=ReadiumSDK.Helpers.deduceSyntheticSpread(i,e.spineItem,c)==1;m.setSyntheticSpread(o),m.openItem(e.spineItem);var u=n!==m.leftItem||r!==m.rightItem||s!==m.centerItem;if(t===null||typeof t=="undefined")t=0;T(t===0?0:m.spine.isRightToLeft()?t===1?2:1:t,u),x(e.initiator,e)},this.openPagePrev=function(e){m.openPrev(),T(m.spine.isRightToLeft()?2:1,!0),x(e,undefined)},this.openPageNext=function(e){m.openNext(),T(m.spine.isRightToLeft()?1:2,!0),x(e,undefined)},this.getPaginationInfo=function(){var e=new ReadiumSDK.Models.CurrentPagesInfo(s,!0),t=[m.leftItem,m.rightItem,m.centerItem];for(var n=0;n<t.length;n++){var r=t[n];r&&e.addOpenPage(0,1,r.idref,r.index)}return e},this.bookmarkCurrentPage=function(){var e=H();if(e.length>0){var t=e[0].currentSpineItem().idref,n=e[0].getFirstVisibleElementCfi();return n==undefined&&(n=""),new ReadiumSDK.Models.BookmarkData(t,n)}return new ReadiumSDK.Models.BookmarkData("","")},this.getLoadedSpineItems=function(){return m.validItems()},this.getElement=function(e,t){var n=H();for(var r=0,i=n.length;r<i;r++){var s=n[r];if(s.currentSpineItem()==e)return s.getElement(e,t)}return console.error("spine item is not loaded"),undefined},this.getElementById=function(e,t){var n=H();for(var r=0,i=n.length;r<i;r++){var s=n[r];if(s.currentSpineItem()==e)return s.getElementById(e,t)}return console.error("spine item is not loaded"),undefined},this.getElementByCfi=function(e,t,n,r,i){var s=H();for(var o=0,u=s.length;o<u;o++){var a=s[o];if(a.currentSpineItem()==e)return a.getElementByCfi(e,t,n,r,i)}return console.error("spine item is not loaded"),undefined},this.getFirstVisibleMediaOverlayElement=function(){var e=H();for(var t=0,n=e.length;t<n;t++){var r=e[t].getFirstVisibleMediaOverlayElement();if(r)return r}return undefined},this.insureElementVisibility=function(e,t,n){}},define("fixedView",["readiumSDK","onePageView","currentPagesInfo","fixedPageSpread","bookmarkData"],function(e){return function(){var t,n;return t||e.fixedView}}(this)),ReadiumSDK.Views.ReflowableView=function(e,t){function T(e){h.css("left",e.left+"px"),h.css("top",e.top+"px"),h.css("right",e.right+"px"),h.css("bottom",e.bottom+"px")}function C(){h&&h.remove();var e=ReadiumSDK.Helpers.loadTemplate("reflowable_book_page_frame",{}),t=$(e);t=d.append(t),h=$("#reflowable-content-frame",t),v=$("#epubContentIframe",t),v.css("left",""),v.css("right",""),v.css("position","relative"),v.css("overflow","hidden"),p=new ReadiumSDK.Views.CfiNavigationLogic(h,v,{rectangleBased:!0,paginationInfo:x})}function k(e){if(a!=e){C(),x.pageOffset=0,x.currentSpreadIndex=0,a=e,f=!0;var t=i.package.resolveRelativeUrl(e.href);n.trigger(ReadiumSDK.Events.CONTENT_DOCUMENT_LOAD_START,v,e),v.css("opacity","0.01"),u.loadIframe(v[0],t,O,n,{spineItem:e})}}function L(){m&&ReadiumSDK.Helpers.UpdateHtmlFontSize(m,c)}function A(){m&&m.css("column-gap",x.columnGap+"px")}function O(e){f=!1;if(l&&l.spineItem!=a){k(l.spineItem);return}if(!e){v.css("opacity","1"),l=undefined;return}n.trigger(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,v,a);var t=v[0].contentDocument;m=$("html",t),g=$("body",m),y=!1,b=!0,w=undefined;var r=v[0].contentDocument.defaultView||v[0].contentWindow,s=r.getComputedStyle(g[0],null);if(s){b=s.direction==="ltr";var o=undefined;s.getPropertyValue?o=s.getPropertyValue("-webkit-writing-mode")||s.getPropertyValue("-moz-writing-mode")||s.getPropertyValue("-ms-writing-mode")||s.getPropertyValue("-o-writing-mode")||s.getPropertyValue("-epub-writing-mode")||s.getPropertyValue("writing-mode"):o=s.webkitWritingMode||s.mozWritingMode||s.msWritingMode||s.oWritingMode||s.epubWritingMode||s.writingMode;if(o){w=o.indexOf("-lr")>=0;if(o.indexOf("vertical")>=0||o.indexOf("tb-")>=0||o.indexOf("bt-")>=0)y=!0}}b&&(g[0].getAttribute("dir")==="rtl"||m[0].getAttribute("dir")==="rtl")&&(b=!1),!i.isLeftToRight()&&b&&!y&&(g[0].setAttribute("dir","rtl"),b=!1,w=!1),x.isVerticalWritingMode=y,j(),v.css("opacity","1"),P(),m.css("height",S.height+"px"),m.css("position","relative"),m.css("margin","0"),m.css("padding","0"),m.css("column-axis",y?"vertical":"horizontal"),n.applyBookStyles(),q(),L(),A(),n.applyStyles()}function M(){if(!l)return;var e=l;l=undefined,n.openPage(e)}function D(){var e=-x.pageOffset+"px";if(y)m.css("top",e);else{var t=b||w;m.css("left",t?e:""),m.css("right",t?"":e)}F()}function P(){var e=h.width(),t=h.height();return S.width!==e||S.height!==t?(S.width=e,S.height=t,!0):!1}function H(e,t,r){x.pageOffset=(x.columnWidth+x.columnGap)*x.visibleColumnCount*x.currentSpreadIndex,D(),n.trigger(ReadiumSDK.InternalEvents.CURRENT_VIEW_PAGINATION_CHANGED,{paginationInfo:n.getPaginationInfo(),initiator:e,spineItem:t,elementId:r})}function B(){var e=550,t=400,s=ReadiumSDK.Helpers.deduceSyntheticSpread(r,a,N),o=s===!1||s===!0;s===0&&(s=1),x.visibleColumnCount=s?2:1,y&&(e*=2,s=!1,o=!0,x.visibleColumnCount=1);if(!m)return;j();var u=parseInt(r.css("border-left-width")),f=parseInt(r.css("border-right-width")),c=x.columnGap/2;c=Math.max(0,c-u);var h=x.columnGap/2;h=Math.max(0,h-f);var p=0;if(N.fontSize){var b=N.fontSize*.8/100;e=Math.floor(e*b),t=Math.floor(t*b)}var w=r.width(),E=w-u-f-c-h;s&&(E=(E-x.columnGap)*.5),E>e?p=Math.floor((E-e)*(s?1:.5)):!o&&E<t&&s&&(s=!1,x.visibleColumnCount=1,E=w-u-f-c-h,E>e&&(p=Math.floor((E-e)*.5))),d.css({left:p+c+"px",right:p+h+"px"}),P(),v.css("width",S.width+"px"),v.css("height",S.height+"px"),m.css("height",S.height+"px"),m.css("min-height",S.height+"px"),m.css("max-height",S.height+"px"),m.css("margin",0),m.css("padding",0),m.css("border",0),g.css("margin",0),g.css("padding",0);var T=0;try{T=parseInt(g.css("padding-top"))+parseInt(g.css("border-top-width"))+parseInt(g.css("border-bottom-width"))}catch(C){}g.css("min-height","50%"),g.css("max-height",S.height-T+"px"),x.rightToLeft=i.isRightToLeft(),x.columnWidth=Math.round(((y?S.height:S.width)-x.columnGap*(x.visibleColumnCount-1))/x.visibleColumnCount),m.css("width",(y?S.width:x.columnWidth)+"px"),m.css("column-width",x.columnWidth+"px"),m.css({left:"0",right:"0",top:"0"}),ReadiumSDK.Helpers.triggerLayout(v),x.columnCount=((y?m[0].scrollHeight:m[0].scrollWidth)+x.columnGap)/(x.columnWidth+x.columnGap),x.columnCount=Math.round(x.columnCount);var k=(x.columnCount-1)*x.columnGap,L=((y?m[0].scrollHeight:m[0].scrollWidth)-k)/x.columnCount;L=Math.round(L),L>x.columnWidth&&(console.debug("ADJUST COLUMN"),console.log(x.columnWidth),console.log(L),x.columnWidth=L),x.spreadCount=Math.ceil(x.columnCount/x.visibleColumnCount),x.currentSpreadIndex>=x.spreadCount&&(x.currentSpreadIndex=x.spreadCount-1),l?M():H(n)}function j(){if(E!=-1)return;E=m.css("opacity"),m.css("opacity","0")}function F(){E!=-1&&m.css("opacity",E),E=-1}function I(){var e=[],t=x.currentSpreadIndex*x.visibleColumnCount;for(var n=0;n<x.visibleColumnCount&&t+n<x.columnCount;n++)e.push(t+n);return e}function q(){if(!m)return;var e,t,n;$("img, svg",m).each(function(){e=$(this),e.css("max-width","98%"),e.css("max-height","98%"),e.css("height")||e.css("height","auto"),e.css("width")||e.css("width","auto")})}function R(){var e=Math.round(x.pageOffset/(x.columnWidth+x.columnGap)),t=e*h.height(),n=t+x.visibleColumnCount*h.height();return{top:t,bottom:n}}_.extend(this,Backbone.Events);var n=this,r=e.$viewport,i=e.spine,s=e.userStyles,o=e.bookStyles,u=e.iframeLoader,a,f=!1,l,c=100,h,p,d,v,m,g,y,b,w,E=-1,S={width:undefined,height:undefined},x={visibleColumnCount:2,columnGap:20,spreadCount:0,currentSpreadIndex:0,columnWidth:undefined,pageOffset:0,columnCount:0};this.render=function(){var e=ReadiumSDK.Helpers.loadTemplate("reflowable_book_frame",{});d=$(e),r.append(d);var i=t.viewerSettings();if(!i||typeof i.enableGPUHardwareAccelerationCSS3D=="undefined")i=new ReadiumSDK.Models.ViewerSettings({});return i.enableGPUHardwareAccelerationCSS3D&&d.css("transform","translateZ(0)"),C(),n},this.remove=function(){d.remove()},this.isReflowable=function(){return!0},this.onViewportResize=function(){P()&&B()};var N=undefined;this.setViewSettings=function(e){N=e,x.columnGap=e.columnGap,c=e.fontSize,L(),A(),P(),B()},this.applyStyles=function(){ReadiumSDK.Helpers.setStyles(s.getStyles(),d.parent());var e=ReadiumSDK.Helpers.Margins.fromElement(d);T(e.padding),P(),B()},this.applyBookStyles=function(){m&&ReadiumSDK.Helpers.setStyles(o.getStyles(),m)},this.openPage=function(e){if(f){l=e;return}if(e.spineItem&&e.spineItem!=a){l=e,k(e.spineItem);return}var t=undefined;if(e.spineItemPageIndex!==undefined)t=e.spineItemPageIndex;else if(e.elementId)t=p.getPageForElementId(e.elementId);else if(e.elementCfi)try{t=p.getPageForElementCfi(e.elementCfi,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"])}catch(n){t=0,console.error(n)}else e.firstPage?t=0:e.lastPage?t=x.columnCount-1:(console.debug("No criteria in pageRequest"),t=0);t>=0&&t<x.columnCount?(x.currentSpreadIndex=Math.floor(t/x.visibleColumnCount),H(e.initiator,e.spineItem,e.elementId)):console.log("Illegal pageIndex value: ",t,"column count is ",x.columnCount)},this.openPagePrev=function(e){if(!a)return;if(x.currentSpreadIndex>0)x.currentSpreadIndex--,H(e);else{var t=i.prevItem(a,!0);if(t){var r=new ReadiumSDK.Models.PageOpenRequest(t,e);r.setLastPage(),n.openPage(r)}}},this.openPageNext=function(e){if(!a)return;if(x.currentSpreadIndex<x.spreadCount-1)x.currentSpreadIndex++,H(e);else{var t=i.nextItem(a,!0);if(t){var r=new ReadiumSDK.Models.PageOpenRequest(t,e);r.setFirstPage(),n.openPage(r)}}},this.getFirstVisibleElementCfi=function(){var e=R();return p.getFirstVisibleElementCfi(e)},this.getPaginationInfo=function(){var e=new ReadiumSDK.Models.CurrentPagesInfo(i,!1);if(!a)return e;var t=I(),n=S.height*S.width;for(var r=0,s=t.length;r<s;r++)e.addOpenPage(t[r],x.columnCount,a.idref,a.index,n);return e},this.bookmarkCurrentPage=function(){return a?new ReadiumSDK.Models.BookmarkData(a.idref,n.getFirstVisibleElementCfi()):new ReadiumSDK.Models.BookmarkData("","")},this.getLoadedSpineItems=function(){return[a]},this.getElementByCfi=function(e,t,n,r,i){return e!=a?(console.error("spine item is not loaded"),undefined):p.getElementByCfi(t,n,r,i)},this.getElementById=function(e,t){return e!=a?(console.error("spine item is not loaded"),undefined):p.getElementById(t)},this.getElement=function(e,t){return e!=a?(console.error("spine item is not loaded"),undefined):p.getElement(t)},this.getFirstVisibleMediaOverlayElement=function(){var e=R();return p.getFirstVisibleMediaOverlayElement(e)},this.insureElementVisibility=function(e,t,r){var i=$(t);if(p.isElementVisible(i,R()))return;var s=p.getPageForElement(i);if(s==-1)return;var o=new ReadiumSDK.Models.PageOpenRequest(a,r);o.setPageIndex(s);var u=t.id;u||(u=t.getAttribute("id")),u&&o.setElementId(u),n.openPage(o)},this.getViewPortSize=function(){return S}},define("reflowableView",["readiumSDK","cfiNavigationLogic","bookmarkData"],function(e){return function(){var t,n;return t||e.reflowableView}}(this)),ReadiumSDK.Models.SmilIterator=function(e){function t(e,n,r){for(var i=e,s=n.children.length;i>=0&&i<s;i+=r?-1:1){var o=n.children[i];if(o.nodeType=="par")return o;o=t(r?o.children.length-1:0,o,r);if(o)return o}return n.parent?t(n.index+(r?-1:1),n.parent,r):undefined}this.smil=e,this.currentPar=undefined,this.reset=function(){this.currentPar=t(0,this.smil,!1)},this.findTextId=function(e){if(!this.currentPar){console.debug("Par iterator is out of range");return}if(!e)return!1;while(this.currentPar){if(this.currentPar.element){if(e===this.currentPar.text.srcFragmentId)return!0;var t=this.currentPar.element.parentNode;while(t){if(t.id&&t.id==e)return!0;t=t.parentNode}var n=$("#"+ReadiumSDK.Helpers.escapeJQuerySelector(e),this.currentPar.element);if(n&&n.length&&n[0])return!0}this.next()}return!1},this.next=function(){if(!this.currentPar){console.debug("Par iterator is out of range");return}this.currentPar=t(this.currentPar.index+1,this.currentPar.parent,!1)},this.previous=function(){if(!this.currentPar){console.debug("Par iterator is out of range");return}this.currentPar=t(this.currentPar.index-1,this.currentPar.parent,!0)},this.isLast=function(){if(!this.currentPar){console.debug("Par iterator is out of range");return}return t(this.currentPar.index+1,this.currentPar.parent,!1)?!1:!0},this.goToPar=function(e){while(this.currentPar){if(this.currentPar==e)break;this.next()}},this.reset()},define("smilIterator",["readiumSDK"],function(e){return function(){var t,n;return t||e.smilIterator}}(this)),ReadiumSDK.Views.MediaOverlayDataInjector=function(e,t){this.attachMediaOverlayData=function(n,r,i){var s=n[0].contentDocument.documentElement;if(!r.media_overlay_id&&e.smil_models.length===0)return;var o=$("body",s);if(o.length==0)console.error("! BODY ???");else{var u=o.data("mediaOverlayClick");if(u)console.error("[WARN] already mediaOverlayClick");else{o.data("mediaOverlayClick",{ping:"pong"});var a="ontouchstart"in document.documentElement?"touchstart":"click";o.bind(a,function(e){var n=$(this)[0];n=e.target;if(!n)return t.touchInit(),!0;var r=undefined,s=n,o=!1;s.nodeName.toLowerCase()==="a"&&(o=!0);while(!(r=$(s).data("mediaOverlayData"))){s.nodeName.toLowerCase()==="a"&&(o=!0),s=s.parentNode;if(!s)break}if(r&&(r.par||r.pars)){s!==n;if(!i.mediaOverlaysEnableClick)return console.log("MO CLICK DISABLED"),t.touchInit(),!0;if(o)return console.log("MO CLICKED LINK"),t.touchInit(),!0;var u=r.par?r.par:r.pars[0];if(r.pars&&typeof rangy!="undefined"){var a=!1;t.isPlayingCfi()&&(a=!0,t.pause());try{var f=rangy.positionFromPoint(e.pageX,e.pageY,n.ownerDocument);u=undefined;for(var l=0;l<r.pars.length;l++){var c=r.pars[l],h="epubcfi("+c.cfi.partialStartCfi+")",p=EPUBcfi.getTextTerminusInfoWithPartialCFI(h,n.ownerDocument,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),d="epubcfi("+c.cfi.partialEndCfi+")",v=EPUBcfi.getTextTerminusInfoWithPartialCFI(d,n.ownerDocument,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),m=rangy.createRange(n.ownerDocument);m.setStartAndEnd(p.textNode[0],p.textOffset,v.textNode[0],v.textOffset);if(m.isPointInRange(f.node,f.offset)){u=c;break}}}catch(g){console.error(g)}if(!u)return a&&t.toggleMediaOverlay(),!0}return s&&s!=n&&s.nodeName.toLowerCase()==="body"&&u&&!u.getSmil().id?(t.touchInit(),!0):(t.playUserPar(u),!0)}var y=$(n).attr("ibooks:readaloud");y||(y=$(n).attr("epub:readaloud"));if(y){console.debug("MO readaloud attr: "+y);var b=t.isPlaying();if(y==="start"&&!b||y==="stop"&&b||y==="startstop")return t.toggleMediaOverlay(),!0}return t.touchInit(),!0})}}var f=e.getSmilBySpineItem(r);if(!f){console.error("NO SMIL?? "+r.idref+" /// "+r.media_overlay_id);return}var l=function(e){if(!e)return;if(e.nodeType&&e.nodeType==="seq"&&e.textref){var t=e.textref.split("#"),i=t[0],s=t.length===2?t[1]:"";if(i&&s){var o=ReadiumSDK.Helpers.ResolveContentRef(i,f.href),u=o===r.href;u&&(e.element=n[0].contentDocument.getElementById(s),e.element||console.error("seq.textref !element? "+e.textref))}}if(e.children&&e.children.length)for(var a=0;a<e.children.length;a++){var c=e.children[a];l(c)}};l(f);var c=new ReadiumSDK.Models.SmilIterator(f),h="/99!",p="epubcfi";while(c.currentPar){c.currentPar.element=undefined,c.currentPar.cfi=undefined;var d=ReadiumSDK.Helpers.ResolveContentRef(c.currentPar.text.srcFile,c.smil.href),v=d===r.href;if(v){var m=!c.currentPar.text.srcFragmentId||c.currentPar.text.srcFragmentId.length==0,g=c.currentPar.text.srcFragmentId.indexOf(p)==0?undefined:c.currentPar.text.srcFragmentId,y=undefined,b=!1;if(!m&&!g)if(c.currentPar.text.srcFragmentId.indexOf(p)===0){var w=c.currentPar.text.srcFragmentId.substr(p.length+1,c.currentPar.text.srcFragmentId.length-p.length-2);w.indexOf(h)===0&&(w=w.substr(h.length,w.length-h.length));var E=w.split(",");if(E&&E.length===3)try{var S=E[0]+E[1],x="epubcfi("+S+")",T=EPUBcfi.getTextTerminusInfoWithPartialCFI(x,n[0].contentDocument,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),N=E[0]+E[2],C="epubcfi("+N+")",k=EPUBcfi.getTextTerminusInfoWithPartialCFI(C,n[0].contentDocument,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),L=T.textNode[0].parentNode;c.currentPar.cfi={smilTextSrcCfi:c.currentPar.text.srcFragmentId,partialRangeCfi:w,partialStartCfi:S,partialEndCfi:N,cfiTextParent:L},b=!0,y=$(L);var A=y.data("mediaOverlayData");if(!A)A={pars:[c.currentPar]},y.data("mediaOverlayData",A);else{A.par&&(console.error("[WARN] non-CFI MO DATA already exists!"),A.par=undefined);var O=!1;if(A.pars)for(var M=0;M<A.pars.length;M++){var _=A.pars[M];_===c.currentPar&&(O=!0,console.error("[WARN] mediaOverlayData CFI PAR already registered!"))}else A.pars=[];O||A.pars.push(c.currentPar)}}catch(D){console.error(D)}else try{var P="epubcfi("+w+")";y=EPUBcfi.getTargetElementWithPartialCFI(P,n[0].contentDocument,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"])}catch(D){console.error(D)}}else console.error("SMIL text@src CFI fragment identifier scheme not supported: "+c.currentPar.text.srcFragmentId);else m?y=o:y=$(n[0].contentDocument.getElementById(g));if(y&&y.length>0){if(!b){c.currentPar.element&&c.currentPar.element!==y[0]&&console.error("DIFFERENT ELEMENTS??! "+c.currentPar.text.srcFragmentId+" /// "+c.currentPar.element.id);var H=y[0].nodeName?y[0].nodeName.toLowerCase():undefined;(H==="audio"||H==="video")&&y.attr("preload","auto"),c.currentPar.element=y[0];var A=y.data("mediaOverlayData");A&&(console.error("[WARN] MO DATA already exists."),A.par&&A.par!==c.currentPar&&console.error("DIFFERENT PARS??!")),y.data("mediaOverlayData",{par:c.currentPar})}}else console.error("!! CANNOT FIND ELEMENT: "+c.currentPar.text.srcFragmentId+" == "+c.currentPar.text.srcFile+" /// "+r.href)}c.next()}}},define("mediaOvelayDataInjector",["readiumSDK","mediaOverlay","mediaOverlayPlayer","smilModel","spineItem","smilIterator","rangy"],function(e){return function(){var t,n;return t||e.mediaOvelayDataInjector}}(this)),ReadiumSDK.Views.InternalLinksSupport=function(e){function n(e){var t=e.indexOf("("),n=e.indexOf("!"),r=e.indexOf(")");return n==-1?undefined:(r==-1&&(r=e.length),{spineItemCfi:e.substring(t+1,n),elementCfi:e.substring(n+1,r)})}function r(t,n){var r=e.package().resolveRelativeUrl(n.href),i=t.absoluteTo(r);return i}function i(i,o){var u=r(i,o);if(!u){console.error("Unable to resolve "+i.href());return}var a=i.fragment(),f=u.toString();f=ReadiumSDK.Helpers.RemoveFromString(f,"#"+a),s(f,function(r){if(!r)return;var i=new window.DOMParser,s=i.parseFromString(r,"text/xml"),o=n(a);if(!o){console.warn("Unable to split cfi:"+a);return}var u=EPUBcfi.Interpreter.getContentDocHref("epubcfi("+o.spineItemCfi+")",s);if(u){var f=e.spine().getItemByHref(u);f?e.openSpineItemElementCfi(f.idref,o.elementCfi,t):console.warn("Unable to find spineItem with href="+u)}else console.warn("Unable to find document ref from "+a+" cfi")})}function s(e,t){$.ajax({isLocal:e.indexOf("http")===0?!1:!0,url:e,dataType:"text",async:!0,success:function(e){t(e)},error:function(n,r,i){console.error("Error when AJAX fetching "+e),console.error(r),console.error(i),t()}})}function o(e){var t=e.filename();return t&&ReadiumSDK.Helpers.EndsWith(t,".opf")}function u(n,r){var i=n.filename(),s;if(i){var o=new URI(n,r.href),u=decodeURIComponent(o.pathname()),a=e.spine().getItemByHref(u);if(!a){console.error("spine item with href="+u+" not found");return}s=a.idref}else s=r.idref;var f=n.fragment();e.openSpineItemElementId(s,f,t)}var t=this;this.processLinkElements=function(e,t){var n=e[0].contentDocument;$("a",n).click(function(e){var n;e.currentTarget.attributes["xlink:href"]?n=e.currentTarget.attributes["xlink:href"].value:n=e.currentTarget.attributes.href.value;var r=!1,s=new URI(n),a=s.is("relative");a?o(s)?(i(s,t),r=!0):(u(s,t),r=!0):(window.open(n,"_blank"),r=!0),r&&(e.preventDefault(),e.stopPropagation())})}},define("internalLinksSupport",["readiumSDK","URIjs"],function(e){return function(){var t,n;return t||e.internalLinksSupport}}(this)),ReadiumSDK.Views.IFrameLoader=function(){var e=this,t={};this.addIFrameEventListener=function(e,n,r){t[e]==undefined&&(t[e]=[]),t[e].push({callback:n,context:r})},this.updateIframeEvents=function(e){_.each(t,function(t,n){for(var r=0,i=t.length;r<i;r++)$(e.contentWindow).off(n),$(e.contentWindow).on(n,t[r].callback,t[r].context)})},this.loadIframe=function(t,n,r,i,s){t.setAttribute("data-baseUri",t.baseURI),t.setAttribute("data-src",n);var o=(new URI(n)).absoluteTo(t.baseURI).toString();e._loadIframeWithUri(t,s,o,function(){var e=t.contentDocument||t.contentWindow.document;$("svg",e).load(function(){console.log("loaded")}),r.call(i,!0,s)})},this._loadIframeWithUri=function(t,n,r,i){t.onload=function(){e.updateIframeEvents(t);var n=t.contentWindow.MathJax;if(n){var r=_.once(i);try{n.Hub.Queue(r)}catch(s){console.error("MathJax fail!"),i()}}else i()},t.setAttribute("src",r)}},define("iframeLoader",["readiumSDK"],function(e){return function(){var t,n;return t||e.iframeLoader}}(this));var EpubAnnotationsModule=function(e,t,n){var r={};r.TextLineInferrer=Backbone.Model.extend({initialize:function(e,t){},inferLines:function(e){var t=[],n=e.length,r=0,i,s,o;for(var u=0;u<=n-1;u++){s=e[u],o=!1;for(var a=0;a<=r-1;a++){i=t[a];if(this.includeRectInLine(i,s.top,s.left,s.width,s.height)){this.expandLine(i,s.left,s.top,s.width,s.height),o=!0;break}}if(o)continue;t.push(this.createNewLine(s.left,s.top,s.width,s.height)),r+=1}return t},includeRectInLine:function(e,t,n,r,i){return this.rectIsWithinLineVertically(t,i,e.maxTop,e.maxBottom)&&this.rectIsWithinLineHorizontally(n,r,e.left,e.width,e.avgHeight)?!0:!1},rectIsWithinLineVertically:function(e,t,n,r){var i=e+t,s=r-n,o=s*.75/2,u=t*.75/2;return e+=u,i-=u,n+=o,r-=o,e===n&&i===r?!0:e<n&&i<r&&i>n?!0:e>n&&i>r&&e<r?!0:e>n&&i<r?!0:e<n&&i>r?!0:!1},rectIsWithinLineHorizontally:function(e,t,n,r,i){var s=2*i,o=e+t,u=e+r;return n-o>s?!1:e-u>s?!1:!0},createNewLine:function(e,t,n,r){var i=t+r;return{left:e,startTop:t,width:n,avgHeight:r,maxTop:t,maxBottom:i,numRects:1}},expandLine:function(e,t,n,r,i){var s=e.left+e.width,o=t+r,u=n+i,a=e.numRects+1,f=e.avgHeight*e.numRects,l=(f+i)/a;return e.avgHeight=l,e.numRects=a,e=this.expandLineVertically(e,n,u),e=this.expandLineHorizontally(e,t,o),e},expandLineVertically:function(e,t,n){return t<e.maxTop&&(e.maxTop=t),n>e.maxBottom&&(e.maxBottom=n),e},expandLineHorizontally:function(e,t,n){var r=e.left<=t?e.left:t,i=e.left+e.width,s=i>=n?i:n,o=s-r;return e.left=r,e.width=o,e}}),r.Highlight=Backbone.Model.extend({defaults:{isVisible:!1},initialize:function(e,t){}}),r.HighlightGroup=Backbone.Model.extend({defaults:function(){return{selectedNodes:[],highlightViews:[]}},initialize:function(e,t){this.set("scale",e.scale),this.constructHighlightViews()},highlightGroupCallback:function(e){var t=this;if(e.type==="click"){t.get("bbPageSetView").trigger("annotationClicked","highlight",t.get("CFI"),t.get("id"),e);return}if(e.type==="contextmenu"){t.get("bbPageSetView").trigger("annotationRightClicked","highlight",t.get("CFI"),t.get("id"),e);return}_.each(this.get("highlightViews"),function(t){e.type==="mouseenter"?t.setHoverHighlight():e.type==="mouseleave"&&t.setBaseHighlight()})},constructHighlightViews:function(){var e=this,t=[],n,i;_.each(this.get("selectedNodes"),function(e,n){var r,i=document.createRange();i.selectNodeContents(e),r=i.getClientRects(),_.each(r,function(e){t.push(e)})}),n=new r.TextLineInferrer,i=n.inferLines(t);var s=this.get("scale");_.each(i,function(t,n){var i=t.startTop/s,o=t.left/s,u=t.avgHeight/s,a=t.width/s,f=new r.HighlightView({CFI:e.get("CFI"),top:i+e.get("offsetTopAddition"),left:o+e.get("offsetLeftAddition"),height:u,width:a,styles:e.get("styles"),highlightGroupCallback:e.highlightGroupCallback,callbackContext:e});e.get("highlightViews").push(f)})},resetHighlights:function(e,t,n){t&&this.set({offsetTopAddition:t}),n&&this.set({offsetLeftAddition:n}),this.destroyCurrentHighlights(),this.constructHighlightViews(),this.renderHighlights(e)},destroyCurrentHighlights:function(){_.each(this.get("highlightViews"),function(e){e.remove(),e.off()}),this.get("highlightViews").length=0},renderHighlights:function(e){_.each(this.get("highlightViews"),function(t,n){$(e).append(t.render())})},toInfo:function(){return{id:this.get("id"),type:"highlight",CFI:this.get("CFI")}},setStyles:function(e){var t=this.get("highlightViews");this.set({styles:e}),_.each(t,function(t,n){t.setStyles(e)})}}),r.Underline=Backbone.Model.extend({defaults:{isVisible:!1},initialize:function(e,t){}}),r.UnderlineGroup=Backbone.Model.extend({defaults:function(){return{selectedNodes:[],underlineViews:[]}},initialize:function(e,t){this.constructUnderlineViews()},underlineGroupCallback:function(e){var t=this;if(e.type==="click"){t.get("bbPageSetView").trigger("annotationClicked","underline",t.get("CFI"),t.get("id"),e);return}_.each(this.get("underlineViews"),function(t){e.type==="mouseenter"?t.setHoverUnderline():e.type==="mouseleave"&&t.setBaseUnderline()})},constructUnderlineViews:function(){var e=this,t=[],n,i;_.each(this.get("selectedNodes"),function(e,n){var r,i=document.createRange();i.selectNodeContents(e),r=i.getClientRects(),_.each(r,function(e){t.push(e)})}),n=new r.TextLineInferrer,i=n.inferLines(t),_.each(i,function(t,n){var i=t.startTop,s=t.left,o=t.avgHeight,u=t.width,a=new r.UnderlineView({CFI:e.get("CFI"),top:i+e.get("offsetTopAddition"),left:s+e.get("offsetLeftAddition"),height:o,width:u,styles:e.get("styles"),underlineGroupCallback:e.underlineGroupCallback,callbackContext:e});e.get("underlineViews").push(a)})},resetUnderlines:function(e,t,n){t&&this.set({offsetTopAddition:t}),n&&this.set({offsetLeftAddition:n}),this.destroyCurrentUnderlines(),this.constructUnderlineViews(),this.renderUnderlines(e)},destroyCurrentUnderlines:function(){_.each(this.get("underlineViews"),function(e){e.remove(),e.off()}),this.get("underlineViews").length=0},renderUnderlines:function(e){_.each(this.get("underlineViews"),function(t,n){$(e).append(t.render())})},toInfo:function(){return{id:this.get("id"),type:"underline",CFI:this.get("CFI")}},setStyles:function(e){var t=this.get("underlineViews");this.set({styles:e}),_.each(t,function(t,n){t.setStyles(e)})}}),r.Bookmark=Backbone.Model.extend({defaults:{isVisible:!1,bookmarkCenteringAdjustment:15,bookmarkTopAdjustment:45},initialize:function(e,t){},getAbsoluteTop:function(){var e=$(this.get("targetElement")).offset().top,t=this.get("offsetTopAddition")+e-this.get("bookmarkTopAdjustment");return t},getAbsoluteLeft:function(){var e=$(this.get("targetElement")).offset().left,t=this.get("offsetLeftAddition")+e-this.get("bookmarkCenteringAdjustment");return t},toInfo:function(){return{id:this.get("id"),type:"bookmark",CFI:this.get("CFI")}}}),r.ReflowableAnnotations=Backbone.Model.extend({initialize:function(e,t){this.epubCFI=EPUBcfi,this.annotations=new r.Annotations({offsetTopAddition:0,offsetLeftAddition:0,readerBoundElement:$("html",this.get("contentDocumentDOM"))[0],scale:0,bbPageSetView:this.get("bbPageSetView")});var n=this.get("annotationCSSUrl");n&&this.injectAnnotationCSS(n);var i=$(this.get("contentDocumentDOM")),s=this;i.on("mouseup",function(e){var t=s.getCurrentSelectionRange();if(t===undefined)return;t.startOffset-t.endOffset&&s.annotations.get("bbPageSetView").trigger("textSelectionEvent",e)})},redraw:function(){var e=-this.getPaginationLeftOffset();this.annotations.redrawAnnotations(0,e)},removeHighlight:function(e){return this.annotations.removeHighlight(e)},addHighlight:function(e,t,n,r){var i,s,o,u,a,f,l=this.getRangeStartMarker(e,t),c=this.getRangeEndMarker(e,t),h=$(this.get("contentDocumentDOM")),p=$("html",h).css("-webkit-transform"),d=(new WebKitCSSMatrix(p)).a;this.set("scale",d);try{return i=this.epubCFI.injectRangeElements(e,this.get("contentDocumentDOM"),l,c,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),o=i.startElement.nextSibling?i.startElement.nextSibling:i.startElement,u=i.endElement.previousSibling?i.endElement.previousSibling:i.endElement,s=document.createRange(),s.setStart(o,0),s.setEnd(u,u.length),selectionInfo=this.getSelectionInfo(s),f=-this.getPaginationLeftOffset(),n==="highlight"?(this.annotations.set("scale",this.get("scale")),this.annotations.addHighlight(e,selectionInfo.selectedElements,t,0,f,i.startElement,i.endElement,r)):n==="underline"&&this.annotations.addUnderline(e,selectionInfo.selectedElements,t,0,f,r),{CFI:e,selectedElements:selectionInfo.selectedElements}}catch(v){console.log(v.message)}},addBookmark:function(e,t,n){var r,i=this.getBookmarkMarker(e,t),s,o;try{return s=this.epubCFI.injectElement(e,this.get("contentDocumentDOM"),i,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),o=-this.getPaginationLeftOffset(),this.annotations.addBookmark(e,s[0],t,0,o,n),{CFI:e,selectedElements:s[0]}}catch(u){console.log(u.message)}},addImageAnnotation:function(e,t){var n,r=this.getBookmarkMarker(e,t),i;try{return i=this.epubCFI.getTargetElement(e,this.get("contentDocumentDOM"),["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),this.annotations.addImageAnnotation(e,i[0],t),{CFI:e,selectedElements:i[0]}}catch(s){console.log(s.message)}},getCurrentSelectionCFI:function(){var e=this.getCurrentSelectionRange(),t;return e&&(selectionInfo=this.getSelectionInfo(e),t=selectionInfo.CFI),t},getCurrentSelectionOffsetCFI:function(){var e=this.getCurrentSelectionRange(),t;return e&&(t=this.generateCharOffsetCFI(e)),t},addSelectionHighlight:function(e,t,n){var r="/99!",i,s,o,u=this.getCurrentSelectionRange(),a;if(u)return o=this.getSelectionInfo(u),i=o.CFI,s="epubcfi("+r+i+")",t==="highlight"?a=this.addHighlight(s,e,t,n):t==="underline"&&(a=this.addHighlight(s,e,t,n)),a.CFI=i,a;throw new Error("Nothing selected")},addSelectionBookmark:function(e,t){var n="/99!",r,i,s=this.getCurrentSelectionRange(),o;if(s)return r=this.generateCharOffsetCFI(s),i="epubcfi("+n+r+")",o=this.addBookmark(i,e,t),o.CFI=r,o;throw new Error("Nothing selected")},addSelectionImageAnnotation:function(e){var t="/99!",n,r,i,s=this.getCurrentSelectionRange(),o,u;if(s)return i=this.getSelectionInfo(s,["img"]),u=i.selectedElements[0],n=this.epubCFI.generateElementCFIComponent(u,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),r="epubcfi("+t+n+")",o=this.addImageAnnotation(r,e),o.CFI=n,o;throw new Error("Nothing selected")},updateAnnotationView:function(e,t){var n=this.annotations.updateAnnotationView(e,t);return n},getSelectionInfo:function(e,t){var n=this.generateRangeCFI(e),r={startElementFound:!1,endElementFound:!1},i=[];if(!t)var t=["text"];return this.findSelectedElements(e.commonAncestorContainer,e.startContainer,e.endContainer,r,i,t),{CFI:n,selectedElements:i}},generateRangeCFI:function(e){var t=e.startContainer,n=e.endContainer,r,i,s;if(t.nodeType===Node.TEXT_NODE&&n.nodeType===Node.TEXT_NODE)return r=e.startOffset,i=e.endOffset,s=this.epubCFI.generateCharOffsetRangeComponent(t,r,n,i,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),s;throw new Error("Selection start and end must be text nodes")},generateCharOffsetCFI:function(e){var t=e.startContainer,n=e.startOffset,r;return t.nodeType===Node.TEXT_NODE&&(r=this.epubCFI.generateCharacterOffsetCFIComponent(t,n,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"])),r},findSelectedElements:function(e,t,n,r,i,s){e===t&&(r.startElementFound=!0),r.startElementFound===!0&&this.addElement(e,i,s);if(e===n){r.endElementFound=!0;return}if(e.firstChild){this.findSelectedElements(e.firstChild,t,n,r,i,s);if(r.endElementFound)return}if(e.nextSibling){this.findSelectedElements(e.nextSibling,t,n,r,i,s);if(r.endElementFound)return}},addElement:function(e,t,n){_.each(n,function(n){n==="text"?e.nodeType===Node.TEXT_NODE&&t.push(e):$(e).is(n)&&t.push(e)})},getCurrentSelectionRange:function(){var e,t=this.get("contentDocumentDOM");return t.getSelection?(e=t.getSelection(),e&&e.rangeCount&&e.anchorOffset!==e.focusOffset?e.getRangeAt(0):undefined):t.selection?t.selection.createRange():undefined},getPaginationLeftOffset:function(){var e=$("html",this.get("contentDocumentDOM")),t=e.css("left"),n=parseInt(t.replace("px",""));return n},getBookmarkMarker:function(e,t){return"<span class='bookmark-marker cfi-marker' id='"+t+"' data-cfi='"+e+"'></span>"},getRangeStartMarker:function(e,t){return"<span class='range-start-marker cfi-marker' id='start-"+t+"' data-cfi='"+e+"'></span>"},getRangeEndMarker:function(e,t){return"<span class='range-end-marker cfi-marker' id='end-"+t+"' data-cfi='"+e+"'></span>"},injectAnnotationCSS:function(e){var t=$("head",this.get("contentDocumentDOM"));t.append($("<link/>",{rel:"stylesheet",href:e,type:"text/css"}))}}),r.Annotations=Backbone.Model.extend({defaults:function(){return{bookmarkViews:[],highlights:[],markers:{},underlines:[],imageAnnotations:[],annotationHash:{},offsetTopAddition:0,offsetLeftAddition:0,readerBoundElement:undefined}},initialize:function(e,t){},remove:function(){var e=this;_.each(this.get("highlights"),function(e){e.remove()})},redrawAnnotations:function(e,t){var n=this;_.each(this.get("highlights"),function(r){r.resetHighlights(n.get("readerBoundElement"),e,t)}),_.each(this.get("bookmarkViews"),function(n){n.resetBookmark(e,t)}),_.each(this.get("underlines"),function(r){r.resetUnderlines(n.get("readerBoundElement"),e,t)})},getBookmark:function(e){var t=this.get("annotationHash")[e];return t?t.bookmark.toInfo():undefined},getHighlight:function(e){var t=this.get("annotationHash")[e];return t?t.toInfo():undefined},getUnderline:function(e){var t=this.get("annotationHash")[e];return t?t.toInfo():undefined},getBookmarks:function(){var e=[];return _.each(this.get("bookmarkViews"),function(t){e.push(t.bookmark.toInfo())}),e},getHighlights:function(){var e=[];return _.each(this.get("highlights"),function(t){e.push(t.toInfo())}),e},getUnderlines:function(){var e=[];return _.each(this.get("underlines"),function(t){e.push(t.toInfo())}),e},getImageAnnotations:function(){var e=[];return _.each(this.get("imageAnnotations"),function(t){e.push(t.toInfo())}),e},addBookmark:function(e,t,n,i,s,o){i||(i=this.get("offsetTopAddition")),s||(s=this.get("offsetLeftAddition")),n=n.toString(),this.validateAnnotationId(n);var u=new r.BookmarkView({CFI:e,targetElement:t,offsetTopAddition:i,offsetLeftAddition:s,id:n.toString(),bbPageSetView:this.get("bbPageSetView"),type:o});this.get("annotationHash")[n]=u,this.get("bookmarkViews").push(u),$(this.get("readerBoundElement")).append(u.render())},removeHighlight:function(e){var t=this.get("annotationHash"),n=this.get("highlights"),r=this.get("markers");if(!r[e])return;var i=r[e].startMarker,s=r[e].endMarker;i.parentNode.removeChild(i),s.parentNode.removeChild(s),delete r[e],delete t[e],n=_.reject(n,function(t){return t.id==e?(t.destroyCurrentHighlights(),!0):!1}),this.set("highlights",n)},addHighlight:function(e,t,n,i,s,o,u,a){i||(i=this.get("offsetTopAddition")),s||(s=this.get("offsetLeftAddition")),n=n.toString(),this.validateAnnotationId(n);var f=new r.HighlightGroup({CFI:e,selectedNodes:t,offsetTopAddition:i,offsetLeftAddition:s,styles:a,id:n,bbPageSetView:this.get("bbPageSetView"),scale:this.get("scale")});this.get("annotationHash")[n]=f,this.get("highlights").push(f),this.get("markers")[n]={startMarker:o,endMarker:u},f.renderHighlights(this.get("readerBoundElement"))},addUnderline:function(e,t,n,i,s,o){i||(i=this.get("offsetTopAddition")),s||(s=this.get("offsetLeftAddition")),n=n.toString(),this.validateAnnotationId(n);var u=new r.UnderlineGroup({CFI:e,selectedNodes:t,offsetTopAddition:i,offsetLeftAddition:s,styles:o,id:n,bbPageSetView:this.get("bbPageSetView")});this.get("annotationHash")[n]=u,this.get("underlines").push(u),u.renderUnderlines(this.get("readerBoundElement"))},addImageAnnotation:function(e,t,n){n=n.toString(),this.validateAnnotationId(n);var i=new r.ImageAnnotation({CFI:e,imageNode:t,id:n,bbPageSetView:this.get("bbPageSetView")});this.get("annotationHash")[n]=i,this.get("imageAnnotations").push(i),i.render()},updateAnnotationView:function(e,t){var n=this.get("annotationHash")[e];return n.setStyles(t),n},validateAnnotationId:function(e){if(this.get("annotationHash")[e])throw new Error("That annotation id already exists; annotation not added")}}),r.BookmarkView=Backbone.View.extend({el:"<div></div>",events:{mouseenter:"setHoverBookmark",mouseleave:"setBaseBookmark",click:"clickHandler"},initialize:function(e){this.bookmark=new r.Bookmark({CFI:e.CFI,targetElement:e.targetElement,offsetTopAddition:e.offsetTopAddition,offsetLeftAddition:e.offsetLeftAddition,id:e.id,bbPageSetView:e.bbPageSetView,type:e.type})},resetBookmark:function(e,t){e&&this.bookmark.set({offsetTopAddition:e}),t&&this.bookmark.set({offsetLeftAddition:t}),this.setCSS()},render:function(){return this.setCSS(),this.el},setCSS:function(){var e,t;this.bookmark.get("type")==="comment"?(e=this.bookmark.getAbsoluteTop(),t=this.bookmark.getAbsoluteLeft(),this.$el.css({top:e+"px",left:t+"px",width:"50px",height:"50px",position:"absolute"}),this.$el.addClass("comment")):this.$el.addClass("bookmark")},setHoverBookmark:function(e){e.stopPropagation(),this.$el.hasClass("comment")&&(this.$el.removeClass("comment"),this.$el.addClass("hover-comment"))},setBaseBookmark:function(e){e.stopPropagation(),this.$el.hasClass("hover-comment")&&(this.$el.removeClass("hover-comment"),this.$el.addClass("comment"))},clickHandler:function(e){e.stopPropagation();var t;this.bookmark.get("type")==="comment"?t="comment":t="bookmark",this.bookmark.get("bbPageSetView").trigger("annotationClicked",t,this.bookmark.get("CFI"),this.bookmark.get("id"),this.$el.css("top"),this.$el.css("left"),e)}}),r.HighlightView=Backbone.View.extend({el:"<div class='highlight'></div>",events:{mouseenter:"highlightEvent",mouseleave:"highlightEvent",click:"highlightEvent",contextmenu:"highlightEvent"},initialize:function(e){this.highlight=new r.Highlight({CFI:e.CFI,top:e.top,left:e.left,height:e.height,width:e.width,styles:e.styles,highlightGroupCallback:e.highlightGroupCallback,callbackContext:e.callbackContext})},render:function(){return this.setCSS(),this.el},resetPosition:function(e,t,n,r){this.highlight.set({top:e,left:t,height:n,width:r}),this.setCSS()},setStyles:function(e){this.highlight.set({styles:e}),this.render()},setCSS:function(){var e=this.highlight.get("styles")||{};this.$el.css({top:this.highlight.get("top")+"px",left:this.highlight.get("left")+"px",height:this.highlight.get("height")+"px",width:this.highlight.get("width")+"px","background-color":e.fill_color||"normal"})},setBaseHighlight:function(){this.$el.addClass("highlight"),this.$el.removeClass("hover-highlight")},setHoverHighlight:function(){this.$el.addClass("hover-highlight"),this.$el.removeClass("highlight")},highlightEvent:function(e){e.stopPropagation();var t=this.highlight.get("highlightGroupCallback"),n=this.highlight.get("callbackContext");n.highlightGroupCallback(e)}}),r.UnderlineView=Backbone.View.extend({el:"<div class='underline-range'>              <div class='transparent-part'></div>              <div class='underline-part'></div>           </div>",events:{mouseenter:"underlineEvent",mouseleave:"underlineEvent",click:"underlineEvent"},initialize:function(e){this.underline=new r.Underline({CFI:e.CFI,top:e.top,left:e.left,height:e.height,width:e.width,styles:e.styles,underlineGroupCallback:e.underlineGroupCallback,callbackContext:e.callbackContext}),this.$transparentElement=$(".transparent-part",this.$el),this.$underlineElement=$(".underline-part",this.$el)},render:function(){return this.setCSS(),this.el},resetPosition:function(e,t,n,r){this.underline.set({top:e,left:t,height:n,width:r}),this.setCSS()},setStyles:function(e){this.underline.set({styles:e}),this.render()},setCSS:function(){var e=this.underline.get("styles")||{};this.$el.css({top:this.underline.get("top")+"px",left:this.underline.get("left")+"px",height:this.underline.get("height")+"px",width:this.underline.get("width")+"px"}),this.$underlineElement.css({"background-color":e.fill_color||"normal"}),this.$underlineElement.addClass("underline")},underlineEvent:function(e){e.stopPropagation();var t=this.underline.get("underlineGroupCallback"),n=this.underline.get("callbackContext");n.underlineGroupCallback(e)},setBaseUnderline:function(){this.$underlineElement.addClass("underline"),this.$underlineElement.removeClass("hover-underline")},setHoverUnderline:function(){this.$underlineElement.addClass("hover-underline"),this.$underlineElement.removeClass("underline")}}),r.ImageAnnotation=Backbone.Model.extend({initialize:function(e,t){var n=this,r=$(this.get("imageNode"));r.on("mouseenter",function(){n.setMouseenterBorder()}),r.on("mouseleave",function(){n.setMouseleaveBorder()}),r.on("click",function(){n.get("bbPageSetView").trigger("annotationClicked","image",n.get("CFI"),n.get("id"),event)})},render:function(){this.setCSS()},setCSS:function(){$(this.get("imageNode")).css({border:"5px solid rgb(255, 0, 0)",border:"5px solid rgba(255, 0, 0, 0.2)","-webkit-background-clip":"padding-box","background-clip":"padding-box"})},setMouseenterBorder:function(){$(this.get("imageNode")).css({border:"5px solid rgba(255, 0, 0, 0.4)"})},setMouseleaveBorder:function(){$(this.get("imageNode")).css({border:"5px solid rgba(255, 0, 0, 0.2)"})}});var i=new r.ReflowableAnnotations({contentDocumentDOM:e,bbPageSetView:t,annotationCSSUrl:n});return{addSelectionHighlight:function(e,t,n){return i.addSelectionHighlight(e,t,n)},addSelectionBookmark:function(e,t){return i.addSelectionBookmark(e,t)},addSelectionImageAnnotation:function(e){return i.addSelectionImageAnnotation(e)},addHighlight:function(e,t,n,r){return i.addHighlight(e,t,n,r)},addBookmark:function(e,t,n){return i.addBookmark(e,t,n)},addImageAnnotation:function(e,t){return i.addImageAnnotation(e,t)},updateAnnotationView:function(e,t){return i.updateAnnotationView(e,t)},redraw:function(){return i.redraw()},getBookmark:function(e){return i.annotations.getBookmark(e)},getBookmarks:function(){return i.annotations.getBookmarks()},getHighlight:function(e){return i.annotations.getHighlight(e)},getHighlights:function(){return i.annotations.getHighlights()},getUnderline:function(e){return i.annotations.getUnderline(e)},getUnderlines:function(){return i.annotations.getUnderlines()},getImageAnnotation:function(){},getImageAnnotations:function(){},removeAnnotation:function(e){return i.remove(e)},getCurrentSelectionCFI:function(){return i.getCurrentSelectionCFI()},getCurrentSelectionOffsetCFI:function(){return i.getCurrentSelectionOffsetCFI()},removeHighlight:function(e){return i.removeHighlight(e)}}};define("annotations_module",["epubCfi"],function(e){return function(){var t,n;return t||e.annotations_module}}(this)),ReadiumSDK.Views.AnnotationsManager=function(e,t){function u(e){var t=new RegExp("^.*!"),n=e.replace(t,""),r=n.substring(0,n.length-1);return r}var n=this,r={},i={},s=e,o=t.annotationCSSUrl;o||console.warn("WARNING! Annotations CSS not supplied. Highlighting is not going to work."),_.extend(n,Backbone.Events),this.on("all",function(e){var t=Array.prototype.slice.call(arguments),o="annotationClicked";if(t.length&&t[0]===o)for(var a in r){var f=t[4],l=t[3],c=t[2],h=t[1];if(r[a].getHighlight(l)){var p=i[a].idref,d=u(c);t=[o,h,p,d,l,f]}}n.trigger.apply(s,t)}),this.attachAnnotations=function(e,t){var s=e[0].contentDocument;r[t.index]=new EpubAnnotationsModule(s,n,o),i[t.index]=t;for(var u in r)Math.abs(u-u.index)>3&&delete r[u]},this.getCurrentSelectionCfi=function(){for(var e in r){var t=r[e],n=t.getCurrentSelectionCFI();if(n)return{idref:i[e].idref,cfi:n}}return undefined},this.addSelectionHighlight=function(e,t){for(spine in r){var n=r[spine];if(n.getCurrentSelectionCFI()){var s=n.addSelectionHighlight(e,t);return s.idref=i[spine].idref,s}}return undefined},this.addHighlight=function(e,t,n,s,o){for(var a in r)if(i[a].idref===e){var f="epubcfi(/99!"+t+")",l=r[a],c=l.addHighlight(f,n,s,o);return c.idref=e,c.CFI=u(c.CFI),c}return undefined},this.removeHighlight=function(e){var t=undefined;for(var n in r){var i=r[n];t=i.removeHighlight(e)}return t}},define("annotationsManager",["epubCfi","annotations_module"],function(e){return function(){var t,n;return t||e.annotationsManager}}(this)),ReadiumSDK.Models.Trigger=function(e){var t=$(e);this.action=t.attr("action"),this.ref=t.attr("ref"),this.event=t.attr("ev:event"),this.observer=t.attr("ev:observer"),this.ref=t.attr("ref")},ReadiumSDK.Models.Trigger.register=function(e){$("trigger",e).each(function(){var t=new ReadiumSDK.Models.Trigger(this);t.subscribe(e)})},ReadiumSDK.Models.Trigger.prototype.subscribe=function(e){var t="#"+this.observer,n=this;$(t,e).on(this.event,function(){n.execute(e)})},ReadiumSDK.Models.Trigger.prototype.execute=function(e){var t=$("#"+ReadiumSDK.Helpers.escapeJQuerySelector(this.ref),e);switch(this.action){case"show":t.css("visibility","visible");break;case"hide":t.css("visibility","hidden");break;case"play":t[0].currentTime=0,t[0].play();break;case"pause":t[0].pause();break;case"resume":t[0].play();break;case"mute":t[0].muted=!0;break;case"unmute":t[0].muted=!1;break;default:console.log("do not no how to handle trigger "+this.action)}},define("triggers",["readiumSDK"],function(e){return function(){var t,n;return t||e.triggers}}(this)),ReadiumSDK.Views.ScrollView=function(e,t,n){function y(e,t){if(d){e();return}var n=F();if(!n){e();return}var r=et(0),i=Z(n);if(r.top-i.bottom>s){var o=X();M(n),T(o-(i.bottom-i.top),undefined),t("updateLoadedViewsTop 1"),y(e,t)}else r.top-i.top<s?k(n,function(n){n?(t("updateLoadedViewsTop 2"),y(e,t)):e()}):e()}function b(e,t){if(d){e();return}var n=I();if(!n){e();return}var r=et(0),i=Z(n);i.top-r.bottom>s?(M(n),t("updateLoadedViewsBottom 1"),b(e,t)):i.bottom-r.bottom<s?A(n,function(n){t("updateLoadedViewsBottom 2"),n?b(e,t):e()}):e()}function w(e){if(!t)return;var n=undefined;if(r&&e){var i=e.offset();i&&(n=i.top)}var s=function(t){if(r){if(!n)return;var i=undefined,s=e.offset();s&&(i=s.top);if(!i)return;var o=i-n;Math.abs(o)>1&&console.debug("@@@@@@@@@@@@@@@ SCROLL ADJUST ("+t+") "+o+" -- "+e.currentSpineItem().href)}};v=!0,b(function(){y(function(){setTimeout(function(){v=!1},o+100)},s)},s)}function S(e){var t=n.viewerSettings();t.mediaOverlaysPreservePlaybackWhenScroll||!E&&n.isMediaOverlayAvailable()&&(E=n.isPlayingMediaOverlay(),E&&n.pauseMediaOverlay())}function x(e){if(!v&&!m&&!g){w(),W(u);var t=n.viewerSettings();t.mediaOverlaysPreservePlaybackWhenScroll||E&&setTimeout(function(){n.playMediaOverlay(),E=!1},100)}}function T(e,t){h[0].scrollTop=e,t&&W(t.initiator,t.spineItem,t.elementId)}function N(e){var t=X(),n=Z(e);L(e);var i=Z(e),s=i.bottom-i.top,o=n.bottom-n.top,u=s-o;Math.abs(u)>0&&(r&&console.debug("IMMEDIATE SCROLL ADJUST: "+e.currentSpineItem().href+" == "+u),T(t+u))}function C(e,t,n,i,s,o,u,a){if(!ReadiumSDK.Helpers.isIframeAlive(n)){r&&console.log("reachStableContentHeight ! win && doc (iFrame disposed?)"),a&&a(!1);return}var f=10,l=300,c=n.contentWindow,h=n.contentDocument,p=parseInt(Math.round(parseFloat(c.getComputedStyle(h.documentElement).height))),d=p;e===0?N(t):L(t);var v=function(s){r&&s!==f&&console.log("tryAgainFunc - "+s+": "+i+"  <"+d+" -- "+p+">"),s--;if(s<0){r&&console.error("tryAgainFunc abort: "+i),a&&a(!0);return}setTimeout(function(){try{if(!ReadiumSDK.Helpers.isIframeAlive(n)){r&&console.log("tryAgainFunc ! win && doc (iFrame disposed?)"),a&&a(!1);return}var o=n.contentWindow,f=n.contentDocument,l=parseInt(Math.round(parseFloat(window.getComputedStyle(n).height))),c=parseInt(Math.round(parseFloat(o.getComputedStyle(f.documentElement).height)));if(p!==c){p=c,v(s);return}var h=l-c;if(Math.abs(h)>4){r&&(console.log("$$$ IFRAME HEIGHT ADJUST: "+i+"  ["+h+"]<"+d+" -- "+p+">"),console.log(u)),e===0?N(t):L(t);if(!ReadiumSDK.Helpers.isIframeAlive(n)){r&&console.log("tryAgainFunc ! win && doc (iFrame disposed?)"),a&&a(!1);return}var o=n.contentWindow,f=n.contentDocument,m=parseInt(Math.round(parseFloat(o.getComputedStyle(f.documentElement).height))),g=parseInt(Math.round(parseFloat(window.getComputedStyle(n).height))),y=g-m;if(Math.abs(y)>4){r&&(console.error("## IFRAME HEIGHT ADJUST: "+i+"  ["+y+"]<"+d+" -- "+p+">"),console.log(u)),v(s);return}r&&console.log(">> IFRAME HEIGHT ADJUSTED OKAY: "+i+"  ["+h+"]<"+d+" -- "+p+">")}}catch(b){console.error(b),a&&a(!1);return}a&&a(!0)},l)};v(f)}function k(e,t){var n=f.prevItem(e.currentSpineItem(),!0);if(!n){t(!1);return}var r=H(!0),i=I();r.element().insertAfter(i.element()),r.loadSpineItem(n,function(i,s,o,u,a){if(i){L(r);var f=Z(r);M(r);var l=X(),c=H(),h=f.bottom-f.top;c.setHeight(h),c.element().insertBefore(e.element()),l+=h,T(l,undefined),c.loadSpineItem(n,function(e,r,i,s,o){if(e){var u=function(n){q(c,e,r,i,s,o),t(n)};C(0,c,r[0],i.href,i.isFixedLayout(),i.isFixedLayout()?c.meta_width():0,"addToTopOf",u)}else console.error("Unable to open 2 "+n.href),M(c),t(!1)})}else console.error("Unable to open 1 "+n.href),M(r),t(!1)})}function L(e){e.currentSpineItem().isFixedLayout()?e.scaleToWidth(h.width()):e.resizeIFrameToContent()}function A(e,t){var n=f.nextItem(e.currentSpineItem(),!0);if(!n){t(!1);return}var r=X(),i=H();i.element().insertAfter(e.element()),i.loadSpineItem(n,function(e,r,s,o,u){if(e){var a=function(n){q(i,e,r,s,o,u),t(n)};C(2,i,r[0],s.href,s.isFixedLayout(),s.isFixedLayout()?i.meta_width():0,"addToBottomOf",a)}else console.error("Unable to load "+n.href),t(!1)})}function O(){var e=[];j(function(t){e.push(t)},!1);for(var t=0,n=e.length;t<n;t++)M(e[t])}function M(e){e.element().remove()}function D(e){h.css("left",e.left),h.css("top",e.top),h.css("right",e.right),h.css("bottom",e.bottom)}function H(r){e.disablePageTransitions=!0;var i=new ReadiumSDK.Views.OnePageView(e,["content-doc-frame"],!0,n);return i.render(),P&&i.setViewSettings(P),r||i.element().data("pageView",i),t&&i.decorateIframe(),i}function B(e,t){var n=undefined;return j(function(t){return t.currentSpineItem()==e?(n=t,!1):!0},t),n}function j(e,t){var n=h.children(),r=n.length,i=t?function(e){return e-1}:function(e){return e+1},s=t?function(e){return e>=0}:function(e){return e<r},o=t?r-1:0;for(var u=o;s(u);u=i(u)){var a=n.eq(u),f=a.data("pageView");if(f&&e(f)===!1)return}}function F(){var e=undefined;return j(function(t){return e=t,!1},!1),e}function I(){var e=undefined;return j(function(t){return e=t,!1},!0),e}function q(e,t,n,r,i,s){t&&i&&u.trigger(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,n,r)}function R(e,t){O();var n=X(),r=H();h.append(r.element()),r.loadSpineItem(e,function(e,n,i,s,o){if(e){var u=function(u){q(r,e,n,i,s,o),t(r)};C(1,r,n[0],i.href,i.isFixedLayout(),i.isFixedLayout()?r.meta_width():0,"openPage",u)}else console.error("Unable to load "+i.href),M(r),r=undefined;t(r)})}function U(e,t){var n=0,r,i,s,u;if(t.scrollTop!==undefined)n=t.scrollTop;else if(t.spineItemPageIndex!==undefined){var a;r=z(),t.spineItemPageIndex<0?a=0:t.spineItemPageIndex>=r?a=r-1:a=t.spineItemPageIndex,n=a*J()}else if(e&&t.elementId){u=Z(e),s=e.getNavigator(),i=s.getElementById(t.elementId);if(!i||!i.length){console.warn("Element id="+t.elementId+" not found!");return}if(rt(e,i,60)){W(t.initiator,t.spineItem,t.elementId);return}n=s.getVerticalOffsetForElement(i)+u.top}else if(e&&t.elementCfi){u=Z(e),s=e.getNavigator(),i=s.getElementByCfi(t.elementCfi);if(!i||!i.length){console.warn("Element cfi="+t.elementCfi+" not found!");return}if(rt(e,i,60)){W(t.initiator,t.spineItem,t.elementId);return}n=s.getVerticalOffsetForElement(i)+u.top}else if(t.firstPage)n=0;else if(t.lastPage){r=z();if(r===0)return;n=K()-J()-5}else e?(u=Z(e),n=u.top):n=0;X()!=n?(m=!0,T(n,t),setTimeout(function(){m=!1},o+100)):W(t.initiator,t.spineItem,t.elementId)}function z(){return Math.ceil(K()/J())}function W(e,t,n){u.trigger(ReadiumSDK.InternalEvents.CURRENT_VIEW_PAGINATION_CHANGED,{paginationInfo:u.getPaginationInfo(),initiator:e,spineItem:t,elementId:n})}function X(){return h[0].scrollTop}function V(){return K()-(X()+J())}function J(){return h.height()}function K(){return h[0].scrollHeight}function Q(){var e=[],t=et(-i);return j(function(n){if(Y(n,t))e.push(n);else if(e.length>0)return!1;return!0},!1),e}function G(){var e=Q();return e[0]}function Y(e,t){var n=Z(e);return nt(tt(n,t))>0}function Z(e){var t={top:0,bottom:0};return t.top=e.element().position().top+X(),t.bottom=t.top+e.getCalculatedPageHeight(),t}function et(e){e!==0&&!e&&(e=0);var t={top:X()-e,bottom:X()+J()+e};return t.top<0&&(t.top=0),t.bottom>K()&&(t.bottom=K()),t}function tt(e,t){return{top:Math.max(e.top,t.top),bottom:Math.min(e.bottom,t.bottom)}}function nt(e){return e.bottom<e.top?0:e.bottom-e.top}function rt(e,t,n){var r=st(e,t);return it(r,n)}function it(e,t){var n=et(),r=Math.min(nt(n),nt(e));r===0&&(r=5);var i=tt(n,e),s=nt(i)/r*100;return s>=t}function st(e,t){var n=Z(e),r={top:0,bottom:0};return r.top=t.offset().top+n.top,r.bottom=r.top+t.height(),r}var r=!1;_.extend(this,Backbone.Events);var i=5,s=2e3,o=300,u=this,a=e.$viewport,f=e.spine,l=e.userStyles,c,h,p,d=!1,v=!1,m=!1,g=!1;this.isContinuousScroll=function(){return t},this.render=function(){var e=ReadiumSDK.Helpers.loadTemplate("scrolled_book_frame",{});p=$(e),a.append(p),h=$("#scrolled-content-frame",p),h.css("overflow",""),h.css("overflow-y","auto"),h.css("overflow-x","hidden"),h.css("-webkit-overflow-scrolling","touch"),h.css("width","100%"),h.css("height","100%"),h.css("position","relative");var t=n.viewerSettings();if(!t||typeof t.enableGPUHardwareAccelerationCSS3D=="undefined")t=new ReadiumSDK.Models.ViewerSettings({});t.enableGPUHardwareAccelerationCSS3D&&h.css("transform","translateZ(0)"),u.applyStyles();var r=_.debounce(x,o);return h.on("scroll",function(e){r(e),S()}),u};var E=!1;this.remove=function(){p.remove()},this.onViewportResize=function(){if(!h)return;j(function(e){L(e)},!1),W(u),w()};var P=undefined;this.setViewSettings=function(e){P=e,j(function(t){t.setViewSettings(e)},!1)},this.applyStyles=function(){ReadiumSDK.Helpers.setStyles(l.getStyles(),p.parent());var e=ReadiumSDK.Helpers.Margins.fromElement(p);D(e.padding)},this.applyBookStyles=function(){j(function(e){e.applyBookStyles()},!1)},this.openPage=function(e){d=!0;var t=function(e,t){c=undefined,U(e,t),d=!1,w(e)};if(e.spineItem){var n=B(e.spineItem);n?t(n,e):(c=e,g=!0,R(e.spineItem,function(n){setTimeout(function(){g=!1},o+100),n&&c?n.currentSpineItem()===c.spineItem?t(n,c):u.openPage(c):W(e.initiator,e.spineItem,e.elementId)}))}else t(undefined,e)},this.openPageNext=function(e){var t;V()>0&&(t=new ReadiumSDK.Models.PageOpenRequest(undefined,e),t.scrollTop=X()+Math.min(V(),J()-i),U(undefined,t))},this.openPagePrev=function(e){var t;X()>0&&(t=new ReadiumSDK.Models.PageOpenRequest(undefined,e),t.scrollTop=X()-(J()-i),t.scrollTop<0&&(t.scrollTop=0),U(undefined,t))},this.getFirstVisibleElementCfi=function(){var e=G();return e?e.getNavigator().getFirstVisibleElementCfi(X()):undefined},this.getPaginationInfo=function(){var e,t,n,r,i,s,o,u,a=et(),l=a.bottom-a.top,c=new ReadiumSDK.Models.CurrentPagesInfo(f,!1),h=Q();for(var p=0,d=h.length;p<d;p++)n=h[p],e=n.currentSpineItem(),r=Z(n),i=Math.max(a.top-r.top,0),s=Math.max(r.bottom-a.bottom,0),o=Math.ceil(i/l),u=Math.ceil(s/l),t=o+u+1,c.addOpenPage(o,t,e.idref,e.index);return c},this.bookmarkCurrentPage=function(){var e=G();return e?new ReadiumSDK.Models.BookmarkData(e.currentSpineItem().idref,u.getFirstVisibleElementCfi()):new ReadiumSDK.Models.BookmarkData("","")},this.getLoadedSpineItems=function(){var e=[];return j(function(t){e.push(t.currentSpineItem())},!1),e},this.getElement=function(e,t){var n=undefined;return j(function(r){return r.currentSpineItem()==e?(n=r.getNavigator().getElement(t),!1):!0},!1),n},this.getElementByCfi=function(e,t,n,r,i){var s=undefined;return j(function(o){return o.currentSpineItem()==e?(s=o.getElementByCfi(e,t,n,r,i),!1):!0},!1),s?s:(console.error("spine item is not loaded"),undefined)},this.getElementById=function(e,t){var n=undefined;return j(function(r){return r.currentSpineItem()==e?(n=r.getNavigator().getElementById(t),!1):!0},!1),n?n:(console.error("spine item is not loaded"),undefined)},this.getFirstVisibleMediaOverlayElement=function(){var e=et(),t=undefined,n={top:0,bottom:0},r,i=!1;return j(function(s){r=Z(s),n.top=Math.max(r.top,e.top)-r.top,n.bottom=Math.min(r.bottom,e.bottom)-r.top;if(nt(n)>0){i=!0,t=s.getNavigator().getFirstVisibleMediaOverlayElement(n);if(t)return!1}else if(i)return!1;return!0},!1),t},this.insureElementVisibility=function(e,t,n){var r=undefined;j(function(t){return t.currentSpineItem().idref===e?(r=t,!1):!0},!1);if(!r){console.warn("Page for element "+t+" not found");return}var i=$(t),s=st(r,i);if(!it(s,60)){var o=f.getItemById(e),a=new ReadiumSDK.Models.PageOpenRequest(o,n);a.scrollTop=s.top,u.openPage(a)}}},define("scrollView",["readiumSDK","cfiNavigationLogic","bookmarkData","triggers","onePageView"],function(e){return function(){var t,n;return t||e.scrollView}}(this)),ReadiumSDK.Models.Switches=function(){},ReadiumSDK.Models.Switches.apply=function(e){function t(e){var t=e.attributes["required-namespace"];if(!t)return console.log("Encountered a case statement with no required-namespace"),!1;var n=["http://www.w3.org/1998/Math/MathML"];return _.include(n,t)}$("switch",e).each(function(){var e=!1;$("case",this).each(function(){!e&&t(this)?e=!0:$(this).remove()}),e&&$("default",this).remove()})},define("switches",["readiumSDK"],function(e){return function(){var t,n;return t||e.switches}}(this)),ReadiumSDK.Views.ReaderView=function(e){function v(e){return s.scroll=="scroll-doc"?ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_DOC:s.scroll=="scroll-continuous"?ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_CONTINUOUS:e.isFixedLayout()?ReadiumSDK.Views.ReaderView.VIEW_TYPE_FIXED:e.isFlowScrolledDoc()?ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_DOC:e.isFlowScrolledContinuous()?ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_CONTINUOUS:ReadiumSDK.Views.ReaderView.VIEW_TYPE_COLUMNIZED}function m(e,r){var d=v(e);if(n){if(t.getCurrentViewType()==d){r(!1);return}g()}var m={$viewport:h,spine:i,userStyles:o,bookStyles:u,iframeLoader:c};n=t.createViewForType(d,m),t.trigger(ReadiumSDK.Events.READER_VIEW_CREATED,d),n.on(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,function(e,n){if(!ReadiumSDK.Helpers.isIframeAlive(e[0]))return;l.attachMediaOverlayData(e,n,s),a.processLinkElements(e,n),p.attachAnnotations(e,n);var r=e[0].contentDocument;ReadiumSDK.Models.Trigger.register(r),ReadiumSDK.Models.Switches.apply(r),t.trigger(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,e,n)}),n.on(ReadiumSDK.Events.CONTENT_DOCUMENT_LOAD_START,function(e,n){t.trigger(ReadiumSDK.Events.CONTENT_DOCUMENT_LOAD_START,e,n)}),n.on(ReadiumSDK.InternalEvents.CURRENT_VIEW_PAGINATION_CHANGED,function(e){f.onPageChanged(e),t.trigger(ReadiumSDK.Events.PAGINATION_CHANGED,e)}),n.on(ReadiumSDK.Events.FXL_VIEW_RESIZED,function(){t.trigger(ReadiumSDK.Events.FXL_VIEW_RESIZED)}),n.render(),n.setViewSettings(s),setTimeout(function(){r(!0)},50)}function g(){if(!n)return;t.trigger(ReadiumSDK.Events.READER_VIEW_DESTROYED),n.off(ReadiumSDK.InternalEvents.CURRENT_VIEW_PAGINATION_CHANGED),n.remove(),n=undefined}function y(e){t.trigger(ReadiumSDK.Events.MEDIA_OVERLAY_STATUS_CHANGED,e)}function b(e){if(!e)return console.log("idref parameter value missing!"),undefined;var t=i.getItemById(e);return t?t:(console.log("Spine item with id "+e+" not found!"),undefined)}function w(e,t){m(e.spineItem,function(r){r||n.setViewSettings(s),n.openPage(e,t)})}function E(e){ReadiumSDK.Helpers.setStyles(o.getStyles(),h),f&&f.applyStyles();if(e)return;n&&n.applyStyles()}function T(){S=null,x=!1,n&&(n.isReflowable&&n.isReflowable()&&(x=t.isPlayingMediaOverlay(),x&&t.pauseMediaOverlay()),S=n.bookmarkCurrentPage())}function N(){n&&t.handleViewportResize(S)}function C(){N(),x&&t.playMediaOverlay()}_.extend(this,Backbone.Events);var t=this,n=undefined,r=undefined,i=undefined,s=new ReadiumSDK.Models.ViewerSettings({}),o=new ReadiumSDK.Collections.StyleCollection,u=new ReadiumSDK.Collections.StyleCollection,a=new ReadiumSDK.Views.InternalLinksSupport(this),f,l,c,h,p=new ReadiumSDK.Views.AnnotationsManager(t,e),d=ReadiumSDK.Helpers.extendedThrottle(T,N,C,250,1e3,t);$(window).on("resize.ReadiumSDK.readerView",d),e.el instanceof $?(h=e.el,console.log("** EL is a jQuery selector:"+e.el.attr("id"))):(h=$(e.el),console.log("** EL is a string:"+h.attr("id"))),e.iframeLoader?c=e.iframeLoader:c=new ReadiumSDK.Views.IFrameLoader({mathJaxUrl:e.mathJaxUrl}),_needsFixedLayoutScalerWorkAround=e.needsFixedLayoutScalerWorkAround,this.needsFixedLayoutScalerWorkAround=function(){return _needsFixedLayoutScalerWorkAround},this.createViewForType=function(e,n){var r;h.css("overflow","hidden");switch(e){case ReadiumSDK.Views.ReaderView.VIEW_TYPE_FIXED:h.css("overflow","auto"),r=new ReadiumSDK.Views.FixedView(n,t);break;case ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_DOC:r=new ReadiumSDK.Views.ScrollView(n,!1,t);break;case ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_CONTINUOUS:r=new ReadiumSDK.Views.ScrollView(n,!0,t);break;default:r=new ReadiumSDK.Views.ReflowableView(n,t)}return r},this.getCurrentViewType=function(){return n?n instanceof ReadiumSDK.Views.ReflowableView?ReadiumSDK.Views.ReaderView.VIEW_TYPE_COLUMNIZED:n instanceof ReadiumSDK.Views.FixedView?ReadiumSDK.Views.ReaderView.VIEW_TYPE_FIXED:n instanceof ReadiumSDK.Views.ScrollView?n.isContinuousScroll()?ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_CONTINUOUS:ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_DOC:(console.error("Unrecognized view type"),undefined):undefined},this.getLoadedSpineItems=function(){return n?n.getLoadedSpineItems():[]},this.viewerSettings=function(){return s},this.package=function(){return r},this.spine=function(){return i},this.userStyles=function(){return o},this.openBook=function(e,n){var o=e.package?e.package:e;r=new ReadiumSDK.Models.Package(o),i=r.spine,i.handleLinear(!0),n&&n(i),f&&f.reset(),f=new ReadiumSDK.Views.MediaOverlayPlayer(t,$.proxy(y,t)),f.setAutomaticNextSmil(s.mediaOverlaysAutomaticPageTurn?!0:!1),l=new ReadiumSDK.Views.MediaOverlayDataInjector(r.media_overlay,f),g(),e.settings&&t.updateSettings(e.settings),e.styles&&t.setStyles(e.styles);var u=undefined;e.openPageRequest&&(e.openPageRequest.idref||e.openPageRequest.contentRefUrl&&e.openPageRequest.sourceFileHref?u=e.openPageRequest:console.log("Invalid page request data: idref required!"));var a=!1;if(u){u=e.openPageRequest;try{u.idref?u.spineItemPageIndex?a=!t.openSpineItemPage(u.idref,u.spineItemPageIndex,t):u.elementCfi?a=!t.openSpineItemElementCfi(u.idref,u.elementCfi,t):a=!t.openSpineItemPage(u.idref,0,t):a=!t.openContentUrl(u.contentRefUrl,u.sourceFileHref,t)}catch(c){console.error("openPageRequest fail: fallback to first page!"),console.log(c),a=!0}}else a=!0;if(a){var h=i.first();if(h){var p=new ReadiumSDK.Models.PageOpenRequest(h,t);p.setFirstPage(),w(p,0)}}},this.openPageLeft=function(){r.spine.isLeftToRight()?t.openPagePrev():t.openPageNext()},this.openPageRight=function(){r.spine.isLeftToRight()?t.openPageNext():t.openPagePrev()},this.isCurrentViewFixedLayout=function(){return n instanceof ReadiumSDK.Views.FixedView},this.setZoom=function(e){t.isCurrentViewFixedLayout()&&n.setZoom(e)},this.getViewScale=function(){return t.isCurrentViewFixedLayout()?100*n.getViewScale():100},this.updateSettings=function(e){s.update(e),f&&f.setAutomaticNextSmil(s.mediaOverlaysAutomaticPageTurn?!0:!1);if(n&&!e.doNotUpdateView){var r=n.bookmarkCurrentPage();if(r&&r.idref){var o=!1;n.isReflowable&&n.isReflowable()&&(o=t.isPlayingMediaOverlay(),o&&t.pauseMediaOverlay());var u=i.getItemById(r.idref);m(u,function(e){e||n.setViewSettings(s),t.openSpineItemElementCfi(r.idref,r.contentCFI,t),o&&t.playMediaOverlay(),t.trigger(ReadiumSDK.Events.SETTINGS_APPLIED);return})}}t.trigger(ReadiumSDK.Events.SETTINGS_APPLIED)},this.openPageNext=function(){if(t.getCurrentViewType()===ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_CONTINUOUS){n.openPageNext(t);return}var e=n.getPaginationInfo();if(e.openPages.length==0)return;var r=e.openPages[e.openPages.length-1];if(r.spineItemPageIndex<r.spineItemPageCount-1){n.openPageNext(t);return}var s=i.getItemById(r.idref),o=i.nextItem(s);if(!o)return;var u=new ReadiumSDK.Models.PageOpenRequest(o,t);u.setFirstPage(),w(u,2)},this.openPagePrev=function(){if(t.getCurrentViewType()===ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_CONTINUOUS){n.openPagePrev(t);return}var e=n.getPaginationInfo();if(e.openPages.length==0)return;var r=e.openPages[0];if(r.spineItemPageIndex>0){n.openPagePrev(t);return}var s=i.getItemById(r.idref),o=i.prevItem(s);if(!o)return;var u=new ReadiumSDK.Models.PageOpenRequest(o,t);u.setLastPage(),w(u,1)},this.openSpineItemElementCfi=function(e,t,n){var r=b(e);if(!r)return!1;var i=new ReadiumSDK.Models.PageOpenRequest(r,n);return t&&i.setElementCfi(t),w(i,0),!0},this.openPageIndex=function(e,t){if(!n)return!1;var s,o=i.items[e];if(!o)return!1;if(r.isFixedLayout()){var o=i.items[e];if(!o)return!1;s=new ReadiumSDK.Models.PageOpenRequest(o,t),s.setPageIndex(0)}else{var u=this.getLoadedSpineItems();u.length>0&&(s=new ReadiumSDK.Models.PageOpenRequest(u[0],t),s.setPageIndex(e))}return w(s,0),!0},this.openSpineItemPage=function(e,t,n){var r=b(e);if(!r)return!1;var i=new ReadiumSDK.Models.PageOpenRequest(r,n);return t&&i.setPageIndex(t),w(i,0),!0},this.setStyles=function(e,t){var n=e.length;for(var r=0;r<n;r++)e[r].declarations?o.addStyle(e[r].selector,e[r].declarations):o.removeStyle(e[r].selector);E(t)},this.setBookStyles=function(e){var t=e.length;for(var r=0;r<t;r++)u.addStyle(e[r].selector,e[r].declarations);n&&n.applyBookStyles()},this.getElement=function(e,t){return n?n.getElement(e,t):undefined},this.getElementById=function(e,t){return n?n.getElementById(e,t):undefined},this.getElementByCfi=function(e,t,r,i,s){return n?n.getElementByCfi(e,t,r,i,s):undefined},this.mediaOverlaysOpenContentUrl=function(e,t,n){f.mediaOverlaysOpenContentUrl(e,t,n)},this.openContentUrl=function(e,n,r){var s=ReadiumSDK.Helpers.ResolveContentRef(e,n),o=s.indexOf("#"),u,a;o>=0?(u=s.substr(0,o),a=s.substr(o+1)):(u=s,a=undefined);var f=i.getItemByHref(u);if(!f){console.warn("spineItem "+u+" not found");var l=decodeURIComponent(u);f=i.getItemByHref(l);if(!f)return console.warn("decoded spineItem "+l+" missing as well"),!1}return t.openSpineItemElementId(f.idref,a,r)},this.openSpineItemElementId=function(e,t,n){var r=i.getItemById(e);if(!r)return!1;var s=new ReadiumSDK.Models.PageOpenRequest(r,n);return t&&s.setElementId(t),w(s,0),!0},this.bookmarkCurrentPage=function(){return JSON.stringify(n.bookmarkCurrentPage())},this.clearStyles=function(){o.resetStyleValues(),E(),o.clear()},this.clearBookStyles=function(){n&&(u.resetStyleValues(),n.applyBookStyles()),u.clear()},this.isMediaOverlayAvailable=function(){return f?f.isMediaOverlayAvailable():!1},this.toggleMediaOverlay=function(){f.toggleMediaOverlay()},this.nextMediaOverlay=function(){f.nextMediaOverlay()},this.previousMediaOverlay=function(){f.previousMediaOverlay()},this.escapeMediaOverlay=function(){f.escape()},this.ttsEndedMediaOverlay=function(){f.onTTSEnd()},this.pauseMediaOverlay=function(){f.pause()},this.playMediaOverlay=function(){f.play()},this.isPlayingMediaOverlay=function(){return f.isPlaying()},this.getFirstVisibleMediaOverlayElement=function(){return n?n.getFirstVisibleMediaOverlayElement():undefined},this.insureElementVisibility=function(e,t,r){n&&n.insureElementVisibility(e,t,r)};var S=null,x=!1;this.handleViewportResize=function(e){if(!n)return;var r=e||n.bookmarkCurrentPage();if(n.isReflowable&&n.isReflowable()&&r&&r.idref){var s=i.getItemById(r.idref);m(s,function(e){t.openSpineItemElementCfi(r.idref,r.contentCFI,t);return})}else n.onViewportResize()},this.triggerPaginationChangedEvent=function(){t.trigger(ReadiumSDK.Events.PAGINATION_CHANGED,{paginationInfo:n.getPaginationInfo()})},this.getCurrentSelectionCfi=function(){return p.getCurrentSelectionCfi()},this.addHighlight=function(e,t,n,r,i){return p.addHighlight(e,t,n,r,i)},this.addSelectionHighlight=function(e,t){return p.addSelectionHighlight(e,t)},this.removeHighlight=function(e){return p.removeHighlight(e)},this.addIFrameEventListener=function(e,t,n){c.addIFrameEventListener(e,t,n)},this.getViewPortSize=function(){return n.getViewPortSize()};var k=function(){var e={},n=!1,r=undefined;this.setCallback_PlayPause=function(e){r=e};var i=undefined;this.setCallback_IsAvailable=function(e){i=e},this.playPause=function(e){s(e)};var s=function(t){r&&r(t);try{var n=undefined;for(var i in e){if(!e.hasOwnProperty(i))continue;var s=e[i];if(!s||!s.active)continue;n&&console.error("More than one active iframe?? (pagination)"),n=s.$iframe;if(!n)continue;var o=$("audio",n[0].contentDocument);$.each(o,function(){var e=this.getAttribute("epub:type")||this.getAttribute("type");return e?e.indexOf("ibooks:soundtrack")<0&&e.indexOf("media:soundtrack")<0&&e.indexOf("media:background")<0?!0:(t&&this.play?this.play():this.pause&&this.pause(),!0):!0})}}catch(u){console.error(u)}};this.setPlayState=function(e){n=e},t.on(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,function(t,n){try{n&&n.idref&&t&&t[0]&&(e[n.idref]={$iframe:t,href:n.href})}catch(r){console.error(r)}}),t.on(ReadiumSDK.Events.PAGINATION_CHANGED,function(t){var r=!1;try{for(var o in e){if(!e.hasOwnProperty(o))continue;var u=t.spineItem&&t.spineItem.idref===o,a=!1;if(t.paginationInfo&&t.paginationInfo.openPages.length){var f=!0;for(var l=0;l<t.paginationInfo.openPages.length;l++)t.paginationInfo.openPages[l].idref===o?a=!0:f=!1;!u&&f&&(u=!0)}if(u||a){var c=e[o];if(!c)continue;e[o].active=u;var h=c.$iframe,p=c.href,d=$("audio",h[0].contentDocument);$.each(d,function(){var e=this.getAttribute("epub:type")||this.getAttribute("type");return e?e.indexOf("ibooks:soundtrack")<0&&e.indexOf("media:soundtrack")<0&&e.indexOf("media:background")<0?!0:(this.setAttribute("loop","loop"),this.removeAttribute("autoplay"),u||this.pause&&this.pause(),r=!0,!0):!0});continue}e[o]&&(e[o].$iframe=undefined),e[o]=undefined}}catch(v){console.error(v)}i&&i(r),r?n?s(!0):s(!1):s(!1)}),t.on(ReadiumSDK.Events.MEDIA_OVERLAY_STATUS_CHANGED,function(r){if(!r.smilIndex)return;var i=t.package(),o=i.media_overlay.smilAt(r.smilIndex);if(!o||!o.spineItemId)return;var u=!1;for(var a in e){if(!e.hasOwnProperty(a))continue;var f=e[a];if(!f)continue;f.active&&a!==o.spineItemId&&(s(!1),f.active=!1,u=!0)}if(u){for(var a in e){if(!e.hasOwnProperty(a))continue;var f=e[a];if(!f)continue;f.active||a===o.spineItemId&&(f.active=!0)}n&&s(!0)}})};this.backgroundAudioTrackManager=new k},ReadiumSDK.Views.ReaderView.VIEW_TYPE_COLUMNIZED=1,ReadiumSDK.Views.ReaderView.VIEW_TYPE_FIXED=2,ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_DOC=3,ReadiumSDK.Views.ReaderView.VIEW_TYPE_SCROLLED_CONTINUOUS=4,define("readerView",["backbone","readiumSDK","helpers","viewerSettings","styleCollection","package","mediaOverlayPlayer","pageOpenRequest","fixedView","reflowableView","mediaOvelayDataInjector","internalLinksSupport","iframeLoader","annotationsManager","scrollView","URIjs","triggers","switches"],function(e){return function(){var t,n;return t||e.readerView}}(this)),define("epub-fetch/markup_parser",[],function(){var e=function(){var e=this;this.parseXml=function(t){return e.parseMarkup(t,"text/xml")},this.parseMarkup=function(e,t){var n=new window.DOMParser;return n.parseFromString(e,t)}};return e}),define("epub-fetch/discover_content_type",["require","module","jquery","backbone","URIjs"],function(e,t,n,r,i){var s=undefined,o=function(){var e=this;o.suffixContentTypeMap={css:"text/css",epub:"application/epub+zip",gif:"image/gif",html:"text/html",jpg:"image/jpeg",jpeg:"image/jpeg",ncx:"application/x-dtbncx+xml",opf:"application/oebps-package+xml",png:"image/png",svg:"image/svg+xml",xhtml:"application/xhtml+xml"},this.identifyContentTypeFromFileName=function(e){var t=i(e).suffix(),n="application/octet-stream";return typeof o.suffixContentTypeMap[t]!="undefined"&&(n=o.suffixContentTypeMap[t]),n},this.identifyContentType=function(t){var r=n.ajax({type:"HEAD",url:t,async:!1}).getResponseHeader("Content-Type");return r===null&&(r=e.identifyContentTypeFromFileName(t),console.log("guessed contentType ["+r+"] from URI ["+t+"]. Configuring the web server to provide the content type is recommended.")),r}};return s||(s=new o),s}),define("epub-fetch/plain_resource_fetcher",["require","module","jquery","URIjs","./discover_content_type"],function(e,t,n,r,i){var s=function(e,t){function u(e,t,n){var i=r.resolveURI(e);if(typeof e=="undefined")throw"Fetched file relative path is undefined!";var s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType="arraybuffer",s.onerror=n,s.onload=function(e){t(s.response)},s.send()}var r=this,s,o;this.initialize=function(n){e.getXmlFileDom("META-INF/container.xml",function(t){o=e.getRootFile(t),s=r.resolveURI(o),n()},function(e){console.error("unable to find package document: "+e),s=t,n()})},this.resolveURI=function(e){return t+"/"+e},this.getPackageUrl=function(){return s},this.fetchFileContentsText=function(e,t,i){var s=r.resolveURI(e);if(typeof s=="undefined")throw"Fetched file URL is undefined!";n.ajax({isLocal:s.indexOf("http")===0?!1:!0,url:s,dataType:"text",async:!0,success:function(e){t(e)},error:function(e,t,n){console.error("Error when AJAX fetching "+s),console.error(t),console.error(n),i(n)}})},this.fetchFileContentsBlob=function(t,n,r){var s=e.getDecryptionFunctionForRelativePath(t);if(s){var o=n;n=function(e){s(e,function(e){o(e)})}}u(t,function(e){var r=new Blob([e],{type:i.identifyContentTypeFromFileName(t)});n(r)},r)},this.getPackageDom=function(t,n){r.fetchFileContentsText(o,function(n){var r=e.markupParser.parseXml(n);t(r)},n)}};return s}),define("epub-fetch/zip_resource_fetcher",["require","module","jquery","URIjs","./discover_content_type"],function(e,t,n,r,i){var s=function(e,t,n){function o(e,r){s?e(s,r):(zip.workerScriptsPath=n,s=new zip.fs.FS,s.importHttpContent(t,!0,function(){e(s,r)},r))}function u(e,n,r){if(typeof e=="undefined")throw"Fetched file relative path is undefined!";o(function(r,i){var s=r.find(e);typeof s=="undefined"||s===null?i(new Error("Entry "+e+" not found in zip "+t)):s.directory?i(new Error("Entry "+e+" is a directory while a file has been expected")):n(s)},r)}var r=!1,s;this.getPackageUrl=function(){return t},this.fetchFileContentsText=function(e,t,n){u(e,function(e){e.getText(t,undefined,r)},n)},this.fetchFileContentsData64Uri=function(e,t,n){u(e,function(n){n.getData64URI(i.identifyContentTypeFromFileName(e),t,undefined,r)},n)},this.fetchFileContentsBlob=function(t,n,s){var o=e.getDecryptionFunctionForRelativePath(t);if(o){var a=n;n=function(e){o(e,function(e){a(e)})}}u(t,function(e){e.getBlob(i.identifyContentTypeFromFileName(t),n,undefined,r)},s)}};return s}),define("epub-fetch/content_document_fetcher",["require","module","jquery","underscore","URIjs","./discover_content_type"],function(e,t,n,r,i,s){var o=function(e,t,o,u){function v(e,t){var n=e.getElementsByTagName("base")[0];if(!n){n=e.createElement("base");var r=e.getElementsByTagName("head")[0];r.insertBefore(n,r.childNodes[0])}n.setAttribute("href",t)}function m(e){e&&(e.message&&console.error(e.message),e.stack&&console.error(e.stack)),console.error(e)}function g(e,t,r,o,u,a,c){function v(i){n(e).data("epubZipOrigHref",t),n(e).attr(r,i)}var h=(new i(t)).absoluteTo(f).toString(),p=d.getResourceURL(h);if(p)v(p);else{var m=n.Deferred();u.push(m),l.relativeToPackageFetchFileContents(h,o,function(t){var r=function(t){if(o==="text"){var r=s.identifyContentTypeFromFileName(h),i=n(e).attr("type");i&&(r=i),t=new Blob([t],{type:r})}var u=window.URL.createObjectURL(t);d.putResource(h,u,t),v(u),m.resolve()};c?c(t,h,r):r(t)},a)}}function y(e,t,s,o,u){var a=e[0],f=e.slice(2),c=r.find(f,function(e){return typeof e!="undefined"}),h=new i(c),p=h.scheme()==="";if(!p)return;var v=(new i(c)).absoluteTo(s).toString(),g=d.getResourceURL(v);if(g)o[a]={isStyleSheetResource:u,resourceObjectURL:g};else{var y=n.Deferred();t.push(y);var w=function(e){var t=window.URL.createObjectURL(e);o[a]={isStyleSheetResource:u,resourceObjectURL:t},d.putResource(v,t,e),y.resolve()},E=function(e){m(e),y.resolve()},S,x;u?(S="text",x=function(e){b(e,v,function(e){var t=new Blob([e],{type:"text/css"});w(t)})}):(S="blob",x=w),l.relativeToPackageFetchFileContents(v,S,x,E)}}function b(e,t,r){var i=/[Uu][Rr][Ll]\(\s*([']([^']+)[']|["]([^"]+)["]|([^)]+))\s*\)/g,s=/@[Ii][Mm][Pp][Oo][Rr][Tt]\s*('([^']+)'|"([^"]+)")/g,o={},u=[];[s,i].forEach(function(n){var r=n.exec(e);while(r!=null){var i=!1;n==s&&(i=!0),y(r,u,t,o,i),r=n.exec(e)}}),u.length>0?n.when.apply(n,u).done(function(){for(var t in o){var n=o[t],i;n.isStyleSheetResource?i='@import "'+n.resourceObjectURL+'"':i="url('"+n.resourceObjectURL+"')";var s=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),u=new RegExp(s,"g");e=e.replace(u,i,"g")}r(e)}):r(e)}function w(e,t,r,s,o,u){var a=n(e+"["+t.replace(":","\\:")+"]",p);a.each(function(e,a){var f=n(a).attr(t),l=new i(f);l.scheme()===""&&g(a,f,t,r,s,o,u)})}function E(e,t){w("img","src","blob",e,t),w("image","xlink:href","blob",e,t)}function S(e,t){w("audio","src","blob",e,t)}function x(e,t){w("video","src","blob",e,t),w("video","poster","blob",e,t)}function T(e,t){w("script","src","blob",e,t)}function N(e,t){w("iframe","src","blob",e,t)}function C(e,t){w("link","href","text",e,t,b)}function k(e,t){var r=n("style",p);r.each(function(t,r){var i=n.Deferred();e.push(i);var s=n(r).text();b(s,f,function(e){n(r).text(e),i.resolve()})})}var a=this,f=t.href,l=e,c,h=t.media_type,p,d=u;this.fetchContentDocumentAndResolveDom=function(e,t){l.relativeToPackageFetchFileContents(f,"text",function(n){c=n,a.resolveInternalPackageResources(e,t)},t)},this.resolveInternalPackageResources=function(e,t){p=l.markupParser.parseMarkup(c,h),v(p,o);var r=[];l.shouldFetchMediaAssetsProgrammatically()&&(E(r,t),S(r,t),x(r,t)),N(r,t),T(r,t),C(r,t),k(r,t),n.when.apply(n,r).done(function(){e(p)})}};return o}),define("epub-fetch/resource_cache",["underscore"],function(e){var t=function(t,n){function f(){return(new Date).getTime()}function l(){return window.performance&&window.performance.memory&&window.performance.memory.jsHeapSizeLimit?window.performance.memory.jsHeapSizeLimit:null}function c(){if(n)return n;var e=l();return e&&e/10>u?e/10:u}function h(e){if(typeof e.orderingByLastUseTimestampIdx!="undefined"){var t=e.orderingByLastUseTimestampIdx;s.splice(t,1);for(var n=t;n<s.length;n++){var r=s[n];r.orderingByLastUseTimestampIdx-1!=n&&console.error("algorithm incorrect: downshiftedEntry.orderingByLastUseTimestampIdx: "+r.orderingByLastUseTimestampIdx+", i: "+n),r.orderingByLastUseTimestampIdx=n}}}function p(t){h(t);var n=e.sortedIndex(s,t,"lastUseTimestamp");s.splice(n,0,t),t.orderingByLastUseTimestampIdx=n}function d(){return s.reduce(function(e,t){return e+(e.length>1?", ":"")+"["+t.absoluteHref+", pinned: "+t.pinned+", orderingByLastUseTimestampIdx: "+t.orderingByLastUseTimestampIdx+"]"},"")}var r=this,i={},s=[],o=0,u=1e8,a=c();this.getResourceURL=function(e){var t=null,n=i[e];return n&&(t=n.url,n.lastUseTimestamp=f(),p(n)),t},this.putResource=function(e,t,n){this.trimCache();var r=f(),s={url:t,absoluteHref:e,blob:n,blobSize:n.size,creationTimestamp:r,lastUseTimestamp:r,pinned:!0};i[e]=s,p(s),o+=n.size},this.evictResource=function(e){var n=i[e];n&&(t.URL.revokeObjectURL(n.url),o-=n.blobSize,h(n),delete i[e])},this.flushCache=function(){for(var e in i)this.evictResource(e);o!=0&&(console.error("cacheSize accounting error! cacheSize: "+o+", _resourcesHash:"),console.error(i)),s=[]},this.unPinResources=function(){for(var e in i){var t=i[e];t.pinned=!1}},this.trimCache=function(){if(o<a)return;console.log("Trimming cache. Current cache size: "+o);for(var e=0;e<s.length;e++){if(o<a)break;var t=s[e];if(!t.pinned){var n=t.absoluteHref;this.evictResource(n),e--}}console.log("Cache size after trimming: "+o)}};return t}),define("epub-fetch/encryption_handler",["require","module"],function(e,t){var n=function(e){function r(e,t){var n=new FileReader;n.onload=function(){var e=this.result;t(new Uint8Array(e))},n.readAsArrayBuffer(e)}function i(e,t,n,i){var s=e.slice(0,t);r(s,function(r){var s=n.length;for(var o=0;o<t;o++)r[o]=r[o]^n[o%s];var u=new Blob([r],{type:e.type}),a=e.slice(t),f=new Blob([u,a],{type:e.type});i(f)})}function s(t,n){var r=1040;i(t,r,e.uidHash,n)}function o(e){var t=/(urn:uuid:)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})/i,n=t.exec(e),r=n[2]+n[3]+n[4]+n[5]+n[6];(!r||r.length!=32)&&console.error("Bad UUID format for ID :"+e);var i=[];for(var s=0;s<16;s++){var o=r.substr(s*2,2),u=parseInt(o,16);i.push(u)}return i}function u(t,n){var r=o(e.uid),s=1024;i(t,s,r,n)}var t=this,n={"http://www.idpf.org/2008/embedding":s,"http://ns.adobe.com/pdf/enc#RC":u};this.isEncryptionSpecified=function(){return e&&e.encryptions},this.getEncryptionMethodForRelativePath=function(n){return t.isEncryptionSpecified()?e.encryptions[n]:undefined},this.getDecryptionFunctionForRelativePath=function(e){var r=t.getEncryptionMethodForRelativePath(e);return r&&n[r]?n[r]:undefined}};return n.CreateEncryptionData=function(e,t){var n={uid:e,uidHash:window.Crypto.SHA1(unescape(encodeURIComponent(e.trim())),{asBytes:!0}),encryptions:undefined},r=$("EncryptedData",t);return r.each(function(e,t){var r=$("EncryptionMethod",t).first().attr("Algorithm"),i=$("CipherReference",t);i.each(function(e,t){var i=$(t).attr("URI");console.log("Encryption/obfuscation algorithm "+r+" specified for "+i),n.encryptions||(n.encryptions={}),n.encryptions[i]=r})}),n},n}),define("epub-fetch/publication_fetcher",["require","module","jquery","URIjs","./markup_parser","./plain_resource_fetcher","./zip_resource_fetcher","./content_document_fetcher","./resource_cache","./encryption_handler"],function(e,t,n,r,i,s,o,u,a,f){var l=function(e,t,l,c){function w(e){e&&(e.message&&console.error(e.message),e.stack&&console.error(e.stack)),console.error(e)}function E(){var t=".epub";return e.indexOf(t,e.length-t.length)===-1}function S(n,r){if(n){console.log("using new PlainResourceFetcher"),d=new s(h,e),d.initialize(function(){r(d)});return}console.log("using new ZipResourceFetcher"),d=new o(h,e,t),r(d)}function x(e){h.getXmlFileDom("META-INF/encryption.xml",function(t,r){if(r)console.log(r),console.log("Document doesn't make use of encryption."),v=new f(undefined),e();else{var i=[],s=n("EncryptedData",t);s.each(function(e,t){var r=n("EncryptionMethod",t).first().attr("Algorithm");i.push({algorithm:r});var s=n("CipherReference",t);s.each(function(e,t){var s=n(t).attr("URI");console.log("Encryption/obfuscation algorithm "+r+" specified for "+s),i[s]=r})})}})}var h=this;h.contentTypePackageReadStrategyMap={"application/oebps-package+xml":"exploded","application/epub+zip":"zipped","application/zip":"zipped"};var p,d,v,m,g,y,b=new a(l,c);this.markupParser=new i,this.initialize=function(e){var t=E();p=!t,S(t,e)},this.shouldConstructDomProgrammatically=function(){return p},this.shouldFetchMediaAssetsProgrammatically=function(){return p&&!E()},this.getBookRoot=function(){return e},this.getJsLibRoot=function(){return t},this.flushCache=function(){b.flushCache()},this.getPackageUrl=function(){return d.getPackageUrl()},this.fetchContentDocument=function(e,t,n,r){b.unPinResources();var i=new u(h,e.spineItem,t,b);i.fetchContentDocumentAndResolveDom(n,function(e){w(e),r(e)})},this.getFileContentsFromPackage=function(e,t,n){d.fetchFileContentsText(e,function(e){t(e)},n)},this.getXmlFileDom=function(e,t,n){h.getFileContentsFromPackage(e,function(e){var n=h.markupParser.parseXml(e);t(n)},n)},this.getPackageFullPath=function(e,t){h.getXmlFileDom("META-INF/container.xml",function(t){var n=h.getRootFile(t);e(n)},t)},this.getRootFile=function(e){var t=n("rootfile",e),r=t.attr("full-path");return r},this.getPackageDom=function(e,t){g?e(g):y?y.done(e):(y=n.Deferred(),y.done(e),h.getPackageFullPath(function(e){m=e,h.getXmlFileDom(e,function(e){g=e,y.resolve(e),y=undefined})},t))},this.convertPathRelativeToPackageToRelativeToBase=function(e){return(new r(e)).absoluteTo(m).toString()},this.relativeToPackageFetchFileContents=function(e,t,n,r){r||(r=w);var i=decodeURIComponent(h.convertPathRelativeToPackageToRelativeToBase(e));i.charAt(0)==="/"&&(i=i.substr(1));var s=d.fetchFileContentsText;t==="blob"?s=d.fetchFileContentsBlob:t==="data64uri"&&(s=d.fetchFileContentsData64Uri),s.call(d,i,n,r)},this.getRelativeXmlFileDom=function(e,t,n){h.getXmlFileDom(h.convertPathRelativeToPackageToRelativeToBase(e),t,n)},this.setPackageMetadata=function(e,t){h.getXmlFileDom("META-INF/encryption.xml",function(n){var r=f.CreateEncryptionData(e.id,n);v=new f(r),v.isEncryptionSpecified()&&(p=!0),t()},function(e){console.log("Document doesn't make use of encryption."),v=new f(undefined),t()})},this.getDecryptionFunctionForRelativePath=function(e){return v.getDecryptionFunctionForRelativePath(e)}};return l}),define("epub-fetch",["epub-fetch/publication_fetcher"],function(e){return e}),define("epub-model/package_document",["require","module","jquery","underscore","backbone","URIjs"],function(e,t,n,r,i,s){var o=function(e,t,r,i,o){function a(){var e=c(),t=e.href,n=t.substr(t.lastIndexOf(".")+1);return n.trim().toLowerCase()==="ncx"}function f(e){var t=n("<ol></ol>");return n.each(e.children("navPoint"),function(e,r){l(n(r),t)}),t}function l(e,t){var r=e.children("navLabel").text().trim(),i=e.children("content").attr("src"),s=n('<li class="nav-elem"></li>').append(n("<a></a>",{href:i,text:r}));t.append(s);if(e.children("navPoint").length>0){var o=n("<li></li>"),u=n("<ol></ol>");n.each(e.children("navPoint"),function(e,t){u.append(l(n(t),u))}),o.append(u),t.append(o)}}function c(){var e=o.getNavItem();if(e)return e;var t=r.ncx;return t&&t.length>0?o.getManifestItemByIdref(t):null}var u;this.manifest=o,this.getSharedJsPackageData=function(){var t=e.substr(0,e.lastIndexOf("/"));return{rootUrl:t,rendition_viewport:r.rendition_viewport,rendition_layout:r.rendition_layout,rendition_orientation:r.rendition_orientation,rendition_flow:r.rendition_flow,rendition_spread:r.rendition_spread,media_overlay:r.media_overlay,spine:{direction:this.getPageProgressionDirection(),items:i}}},this.getSpineItem=function(e){var t=i[e];return t},this.setPageProgressionDirection=function(e){u=e},this.getPageProgressionDirection=function(){return u==="rtl"?"rtl":u==="default"?"default":"ltr"},this.spineLength=function(){return i.length},this.getMetadata=function(){return r},this.getToc=function(){var e=c();return e?e.href:null},this.getTocText=function(e){var n=this.getToc();t.relativeToPackageFetchFileContents(n,"text",function(t){e(t)},function(t){console.error("ERROR fetching TOC from ["+n+"]:"),console.error(t),e(undefined)})},this.getTocDom=function(e){this.getTocText(function(t){if(typeof t=="string"){var n=(new DOMParser).parseFromString(t,"text/xml");e(n)}else e(undefined)})},this.generateTocListDOM=function(t){var r=this;this.getTocDom(function(i){if(i)if(a()){var o;o=f(n("navMap",i)),t(o[0])}else{var u=(new s(e)).absoluteTo(document.URL),l=(new s(r.getToc())).absoluteTo(u),c=n(i).remove("base"),h=n("<base></base>");n(h).attr("href",l),n(i).find("head").append(h),t(i)}else t(undefined)})}};return o}),define("epub-model/smil_document_parser",["require","module","jquery","underscore"],function(e,t,n,r){var i=function(e,t){function s(e){return{id:"",href:"",spineItemId:e.idref,children:[{nodeType:"seq",textref:e.href,children:[{nodeType:"par",children:[{nodeType:"text",src:e.href,srcFile:e.href,srcFragmentId:""}]}]}]}}this.parse=function(r,i,s,o,u,a){var f=this;t.getRelativeXmlFileDom(i.href,function(t){var a=n("smil",t)[0];s.smilVersion=a.getAttribute("version"),s.children=f.getChildren(a),s.href=i.href,s.id=i.id,s.spineItemId=r.idref;var l=e.getMetadata().getMediaItemByRefinesId(i.id);l&&(s.duration=l.duration),u(o,s)},function(e){a(o,e)})};var r=function(e,t,n,r,i){var s=e.split(":"),o=s[s.length-1];o==="type"&&(o="epubtype"),t.getAttribute(e)!=undefined?n[o]=t.getAttribute(e):r&&(i!==undefined?n[o]=i:console.log("Required property "+e+" not found in smil node "+t.nodeName))};this.getChildren=function(e){var t=this,r=[];return n.each(e.childNodes,function(e,n){if(n.nodeType===1){var i=t.createItemFromElement(n);i&&r.push(i)}}),r},this.createItemFromElement=function(e){var t=this,n={};n.nodeType=e.nodeName;var s=!1;n.nodeType==="body"&&(s=!0,n.nodeType="seq");if(n.nodeType==="seq")r("epub:textref",e,n,!s),r("id",e,n),r("epub:type",e,n),n.children=t.getChildren(e);else if(n.nodeType==="par")r("id",e,n),r("epub:type",e,n),n.children=t.getChildren(e);else if(n.nodeType==="text"){r("src",e,n,!0);var o=n.src.split("#");n.srcFile=o[0],n.srcFragmentId=o.length===2?o[1]:"",r("id",e,n)}else{if(n.nodeType!=="audio")return undefined;r("src",e,n,!0),r("id",e,n),n.clipBegin=i.resolveClockValue(e.getAttribute("clipBegin")),n.clipEnd=i.resolveClockValue(e.getAttribute("clipEnd"))}return n},this.fillSmilData=function(t){var r=this;if(e.spineLength()<=0){t();return}var i=!0,o=[],u=[];for(var a=0;a<e.spineLength();a++){var f=e.getSpineItem(a);if(f.media_overlay_id){var l=e.manifest.getManifestItemByIdref(f.media_overlay_id);if(!l){console.error("Cannot find SMIL manifest item for spine/manifest item?! "+f.media_overlay_id);continue}var c=n.Deferred();c.media_overlay_id=f.media_overlay_id,u.push(c);var h={};o.push(h),r.parse(f,l,h,c,function(e,t){i=!1,e.resolve()},function(e,t){console.log("Error when parsing SMIL manifest item "+l.href+":"),console.log(t),e.resolve()})}else o.push(s(f))}n.when.apply(n,u).done(function(){e.getMetadata().setMoMap(o),i&&(console.log("No Media Overlays"),e.getMetadata().setMoMap([])),t()})}};return i.resolveClockValue=function(e){if(!e)return 0;var t=0,n=0,r=0;if(e.indexOf("min")!=-1)n=parseFloat(e.substr(0,e.indexOf("min")));else if(e.indexOf("ms")!=-1){var i=parseFloat(e.substr(0,e.indexOf("ms")));r=i/1e3}else if(e.indexOf("s")!=-1)r=parseFloat(e.substr(0,e.indexOf("s")));else if(e.indexOf("h")!=-1)t=parseFloat(e.substr(0,e.indexOf("h")));else{var s=e.split(":");r=parseFloat(s.pop()),s.length>0&&(n=parseFloat(s.pop()),s.length>0&&(t=parseFloat(s.pop())))}var o=t*3600+n*60+r;return o},i}),define("epub-model/metadata",["require","module","underscore"],function(e,t,n){var r=function(){var e=this,t={};this.eachMediaItem=function(t){return e.mediaItems&&n.each(e.mediaItems,t),this},this.getMediaItemByRefinesId=function(e){return t[e]},this.setMoMap=function(t){e.media_overlay.smil_models=t},this.eachMediaItem(function(e){var n=e.refines,r=n.indexOf("#");if(r>=0){var i=r+1,s=n.length-1;n=n.substr(i,s)}n=n.trim(),t[n]=e})};return r}),define("epub-model/manifest",["require","module","underscore"],function(e,t,n){var r=function(e){var t={},r;this.manifestLength=function(){return e.length},this.getManifestItemByIdref=function(e){return t[e]},this.each=function(t){return n.each(e,t),this},this.getNavItem=function(){return r},this.each(function(e){t[e.id]=e,e.properties&&e.properties.indexOf("nav")!==-1&&(r=e)})};return r}),define("epub-model/package_document_parser",["require","module","jquery","underscore","backbone","epub-fetch/markup_parser","URIjs","./package_document","./smil_document_parser","./metadata","./manifest"],function(e,t,n,r,i,s,o,u,a,f,l){var c=function(e,t){function h(e){e&&(e.message&&console.error(e.message),e.stack&&console.error(e.stack))}function p(e,n){var r=new a(e,t);r.fillSmilData(function(){n(e)})}function d(e){var r=n.Deferred();if(!e.rendition_layout){var i="/META-INF/com.apple.ibooks.display-options.xml";t.relativeToPackageFetchFileContents(i,"text",function(t){if(t){var i=new s,o=i.parseXml(t),u=n("option[name=fixed-layout]",o)[0];if(u){var a=n(u).text();a==="true"&&(e.rendition_layout="pre-paginated",console.log("using com.apple.ibooks.display-options.xml fixed-layout property"))}}r.resolve()},function(e){console.log("com.apple.ibooks.display-options.xml not found"),r.resolve()})}else r.resolve();return r.promise()}function v(e,t,i){var s,o=[];return s=n(m(e,"spine")).children(),n.each(s,function(e,s){var u=n(s),a=u.attr("idref")?u.attr("idref"):"",f=t.getManifestItemByIdref(a),l=u.attr("id"),c=undefined;r.each(i.rendition_viewports,function(e){if(e.refines==l)return c=e.viewport,!0});var h={rendition_viewport:c,idref:a,href:f.href,manifest_id:f.id,media_type:f.media_type,media_overlay_id:f.media_overlay_id,linear:u.attr("linear")?u.attr("linear"):"",properties:u.attr("properties")?u.attr("properties"):""},p=N(h.properties);r.extend(h,p),o.push(h)}),o}function m(e,t,n){var i=e.getElementsByTagNameNS("*",t);return n?r.find(i,n):i[0]}function g(e,t,n){var i=e.getElementsByTagNameNS("*",t);return r.filter(i,n)}function y(e,t,n){var r=m(e,t,n);return r?r.textContent:""}function b(e,t,n,r){var i=m(e,t,r);return i?i.getAttribute(n):""}function w(e,t){var n=m(e,"meta",function(e){return e.getAttribute("property")===t});return n?n.textContent:""}function E(e){var t=new f,n=m(e,"metadata"),i=m(e,"package"),s=m(e,"spine");t.author=y(n,"creator"),t.description=y(n,"description"),t.epub_version=i.getAttribute("version")?i.getAttribute("version"):"",t.id=y(n,"identifier"),t.language=y(n,"language"),t.modified_date=w(n,"dcterms:modified"),t.ncx=s.getAttribute("toc")?s.getAttribute("toc"):"",t.pubdate=y(n,"date"),t.publisher=y(n,"publisher"),t.rights=y(n,"rights"),t.title=y(n,"title"),t.rendition_orientation=w(n,"rendition:orientation"),t.rendition_layout=w(n,"rendition:layout"),t.rendition_spread=w(n,"rendition:spread"),t.rendition_flow=w(n,"rendition:flow"),t.rendition_viewport=y(n,"meta",function(e){return e.getAttribute("property")==="rendition:viewport"&&!e.hasAttribute("refines")});var o=[],u=g(n,"meta",function(e){return e.getAttribute("property")==="rendition:viewport"&&e.hasAttribute("refines")});r.each(u,function(e){var t=e.getAttribute("refines");if(t){var n=t.indexOf("#");if(n>=0){var r=n+1,i=t.length-1;t=t.substr(r,i)}t=t.trim()}var s={refines:t,viewport:e.textContent};o.push(s)}),t.rendition_viewports=o,t.mediaItems=[];var l=g(n,"meta",function(e){return e.getAttribute("property")==="media:duration"&&e.hasAttribute("refines")});return r.each(l,function(e){t.mediaItems.push({refines:e.getAttribute("refines"),duration:a.resolveClockValue(e.textContent)})}),t.media_overlay={duration:a.resolveClockValue(y(n,"meta",function(e){return e.getAttribute("property")==="media:duration"&&!e.hasAttribute("refines")})),narrator:w(n,"media:narrator"),activeClass:w(n,"media:active-class"),playbackActiveClass:w(n,"media:playback-active-class"),smil_models:[],skippables:["sidebar","practice","marginalia","annotation","help","note","footnote","rearnote","table","table-row","table-cell","list","list-item","pagebreak"],escapables:["sidebar","bibliography","toc","loi","appendix","landmarks","lot","index","colophon","epigraph","conclusion","afterword","warning","epilogue","foreword","introduction","prologue","preface","preamble","notice","errata","copyright-page","acknowledgments","other-credits","titlepage","imprimatur","contributors","halftitlepage","dedication","help","annotation","marginalia","practice","note","footnote","rearnote","footnotes","rearnotes","bridgehead","page-list","table","table-row","table-cell","list","list-item","glossary"]},t}function S(e){var t=n(m(e,"manifest")).children(),r=[];return n.each(t,function(e,t){var i=n(t),s=i.attr("href")?i.attr("href"):"",o={href:s,id:i.attr("id")?i.attr("id"):"",media_overlay_id:i.attr("media-overlay")?i.attr("media-overlay"):"",media_type:i.attr("media-type")?i.attr("media-type"):"",properties:i.attr("properties")?i.attr("properties"):""};r.push(o)}),r}function x(e){var t=n(m(e,"bindings")).children(),r=[];return n.each(t,function(e,t){var i=n(t),s={handler:i.attr("handler")?i.attr("handler"):"",media_type:i.attr("media-type")?i.attr("media-type"):""};r.push(s)}),r}function T(e){var t,i;t=m(e,"manifest"),i=n(m(t,"item",function(e){var t=e.getAttribute("properties");return t&&r.contains(t.split(" "),"cover-image")}));if(i.length===1&&i.attr("href"))return i.attr("href");var s=n(m(e,"meta",function(e){return e.getAttribute("name")==="cover"})),o=s.attr("content");if(s.length===1&&o){i=n(m(t,"item",function(e){return e.getAttribute("id")===o}));if(i.length===1&&i.attr("href"))return i.attr("href")}return i=n(m(t,"item",function(e){return e.getAttribute("id")==="cover"})),i.length===1&&i.attr("href")?i.attr("href"):null}function N(e){var t={},n=e.split(" ");for(var r=0;r<n.length;r++)n[r]==="rendition:orientation-landscape"&&(t.rendition_orientation="landscape"),n[r]==="rendition:orientation-portrait"&&(t.rendition_orientation="portrait"),n[r]==="rendition:orientation-auto"&&(t.rendition_orientation="auto"),n[r]==="rendition:spread-none"&&(t.rendition_spread="none"),n[r]==="rendition:spread-landscape"&&(t.rendition_spread="landscape"),n[r]==="rendition:spread-portrait"&&(t.rendition_spread="portrait"),n[r]==="rendition:spread-both"&&(t.rendition_spread="both"),n[r]==="rendition:spread-auto"&&(t.rendition_spread="auto"),n[r]==="rendition:flow-paginated"&&(t.rendition_flow="paginated"),n[r]==="rendition:flow-scrolled-continuous"&&(t.rendition_flow="scrolled-continuous"),n[r]==="rendition:flow-scrolled-doc"&&(t.rendition_flow="scrolled-doc"),n[r]==="rendition:flow-auto"&&(t.rendition_flow="auto"),n[r]==="rendition:page-spread-center"&&(t.page_spread="page-spread-center"),n[r]==="page-spread-left"&&(t.page_spread="page-spread-left"),n[r]==="page-spread-right"&&(t.page_spread="page-spread-right"),n[r]==="rendition:layout-reflowable"&&(t.fixed_flow=!1,t.rendition_layout="reflowable"),n[r]==="rendition:layout-pre-paginated"&&(t.fixed_flow=!0,t.rendition_layout="pre-paginated");return t}var i=t,o=n.Deferred(),c;t.getPackageDom(function(e){c=e,o.resolve(e)},h),this.parse=function(e){o.done(function(r){var s=E(r),o=r.getElementsByTagNameNS("*","spine")[0],a=b(r,"spine","page-progression-direction"),f=x(r),c=new l(S(r)),h=v(r,c,s),m=T(r);m&&(s.cover_href=m),n.when(d(s)).then(function(){i.setPackageMetadata(s,function(){var n=new u(t.getPackageUrl(),t,s,h,c);n.setPageProgressionDirection(a),p(n,e)})})})}};return c}),define("epub-fetch/iframe_zip_loader",["URIjs"],function(e){var t=function(t,n,r){function o(e,t){$.ajax({url:e,dataType:"html",async:!0,success:function(e){t(e)},error:function(n,r,i){console.error("Error when AJAX fetching "+e),console.error(r),console.error(i),t()}})}function u(e,t){o(e,function(n){if(!n){t();return}var i=e.split("/");i.pop();var s='<base href="'+i.join("/")+"/"+'"/>',o='<script type="text/javascript">('+a.toString()+")()</script>";r&&r.mathJaxUrl&&n.indexOf("<math")>=0&&(o+='<script type="text/javascript" src="'+r.mathJaxUrl+'"></script>');var u=n.replace(/(<head.*?>)/,"$1"+s+o);t(u)})}function a(){navigator.epubReadingSystem=window.parent.navigator.epubReadingSystem,window.parent=window.self,window.top=window.self}var i=new t.Views.IFrameLoader,s=this;this.addIFrameEventListener=function(e,t,n){i.addIFrameEventListener(e,t,n)},this.updateIframeEvents=function(e){i.updateIframeEvents(e)},this.loadIframe=function(t,r,i,o,a){var f=(new e(r)).absoluteTo(t.baseURI).search("").hash("").toString(),l=n().shouldConstructDomProgrammatically();l?n().fetchContentDocument(a,f,function(e){s._loadIframeWithDocument(t,a,e.documentElement.outerHTML,function(){i.call(o,!0,a)})},function(e){i.call(o,!1,a)}):u(f,function(e){e?s._loadIframeWithDocument(t,a,e,function(){i.call(o,!0,a)}):i.call(o,!1,a)})},this._loadIframeWithDocument=function(e,t,n,r){var i=window.navigator.userAgent.indexOf("Trident")>0;if(!i){var o="text/html";t.spineItem.media_type&&t.spineItem.media_type.length&&(o=t.spineItem.media_type);var u=window.URL.createObjectURL(new Blob([n],{type:o}))}else e.contentWindow.document.open(),e.contentWindow.document.write(n);e.onload=function(){s.updateIframeEvents(e);var t=e.contentWindow.MathJax;if(t){var n=_.once(r);t.Hub.Queue(n)}else r();i||window.URL.revokeObjectURL(u)},i?e.contentWindow.document.close():e.setAttribute("src",u)}};return t}),ReadiumSDK.Models.Pagination=function(e){function u(e){if(e.spineItem){var u=e.paginationInfo.firstOpenPage();if(u){var a=e.paginationInfo.getPageCount(),l=u.idref;o.defaultSpineItemTotalPageCounts.push({idref:l,defaultSpineItemPageCount:a}),s+=a}if(i){var c=r.nextItem(e.spineItem);if(c){i=!1;var h=c.idref;n.openSpineItemPage(h,0,n)}else o.defaultViewPortSize=n.getViewPortSize(),o.totalPageCount=s,localStorage.setItem("defaultPagination",JSON.stringify(o)),f(),$("#epub-reader-frame").children().slice(1).detach(),t.triggerPaginationChangedEvent()}}}function a(e,t){try{t&&t.idref&&e&&e[0]&&(i=!0)}catch(n){console.error(n)}}function f(){n.off(ReadiumSDK.Events.PAGINATION_CHANGED),n.off(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED)}var t=e,n=undefined,r=undefined,i=!0,s=0,o={defaultSpineItemTotalPageCounts:[],defaultViewPortSize:undefined,totalPageCount:0};this.storeDefaultPagination=function(e,t){localStorage.removeItem("defaultPagination"),n=new ReadiumSDK.Views.ReaderView(t),e.openPageRequest=undefined,n.openBook(e,function(e){r=e}),n.on(ReadiumSDK.Events.PAGINATION_CHANGED,u),n.on(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,a)}},define("pagination",["readiumSDK","readerView","currentPagesInfo"],function(e){return function(){var t,n;return t||e.pagination}}(this)),(typeof Crypto=="undefined"||!Crypto.util)&&function(){var e=window.Crypto={},t=e.util={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return t.rotl(e,8)&16711935|t.rotl(e,24)&4278255360;for(var n=0;n<e.length;n++)e[n]=t.endian(e[n]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(Math.random()*256));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=(e[n]&255)<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<e.length*32;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((e[n]&15).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){if(typeof btoa=="function")return btoa(n.bytesToString(e));for(var t=[],r=0;r<e.length;r+=3)for(var i=e[r]<<16|e[r+1]<<8|e[r+2],s=0;s<4;s++)r*8+s*6<=e.length*8?t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>>6*(3-s)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){if(typeof atob=="function")return n.stringToBytes(atob(e));for(var e=e.replace(/[^A-Z0-9+\/]/ig,""),t=[],r=0,i=0;r<e.length;i=++r%4)i!=0&&t.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<i*2|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(r))>>>6-i*2);return t}},e=e.charenc={};e.UTF8={stringToBytes:function(e){return n.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(n.bytesToString(e)))}};var n=e.Binary={stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n)&255);return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}}(),function(){var e=Crypto,t=e.util,n=e.charenc,r=n.UTF8,i=n.Binary,s=e.SHA1=function(e,n){var r=t.wordsToBytes(s._sha1(e));return n&&n.asBytes?r:n&&n.asString?i.bytesToString(r):t.bytesToHex(r)};s._sha1=function(e){e.constructor==String&&(e=r.stringToBytes(e));var n=t.bytesToWords(e),i=e.length*8,e=[],s=1732584193,o=-271733879,u=-1732584194,f=271733878,l=-1009589776;n[i>>5]|=128<<24-i%32,n[(i+64>>>9<<4)+15]=i;for(i=0;i<n.length;i+=16){for(var c=s,h=o,p=u,d=f,v=l,g=0;g<80;g++){if(g<16)e[g]=n[i+g];else{var y=e[g-3]^e[g-8]^e[g-14]^e[g-16];e[g]=y<<1|y>>>31}y=(s<<5|s>>>27)+l+(e[g]>>>0)+(g<20?(o&u|~o&f)+1518500249:g<40?(o^u^f)+1859775393:g<60?(o&u|o&f|u&f)-1894007588:(o^u^f)-899497514),l=f,f=u,u=o<<30|o>>>2,o=s,s=y}s+=c,o+=h,u+=p,f+=d,l+=v}return[s,o,u,f,l]},s._blocksize=16,s._digestsize=20}(),define("cryptoJs",function(){}),define("Readium",["require","text!version.json","console_shim","jquery","underscore","readerView","epub-fetch","epub-model/package_document_parser","epub-fetch/iframe_zip_loader","URIjs","pagination","cryptoJs"],function(e,t,n,r,i,s,o,u,a,f,l,c){window.URI=f;if("URL"in window==0){if("webkitURL"in window==0)throw Error("Browser does not support window.URL");window.URL=window.webkitURL}var h=function(e,t){var n=this,i,s=e.jsLibRoot;e.useSimpleLoader?t.iframeLoader=new ReadiumSDK.Views.IFrameLoader:t.iframeLoader=new a(ReadiumSDK,function(){return i},{mathJaxUrl:t.mathJaxUrl}),this.reader=new ReadiumSDK.Views.ReaderView(t),this.openPackageDocument=function(a,f,l){i&&i.flushCache();var c=null;e.cacheSizeEvictThreshold&&(c=e.cacheSizeEvictThreshold),i=new o(a,s,window,c),i.initialize(function(){var s=new u(a,i);s.parse(function(s){var o=e.openBookOptions||{},u=r.extend(s.getSharedJsPackageData(),o);l&&(u.openPageRequest=l),n.reader.openBook(u);if(u.rendition_layout==""){var a=new ReadiumSDK.Models.Pagination(n.reader);a.storeDefaultPagination(u,t),a=undefined}var c={packageDocumentUrl:i.getPackageUrl(),metadata:s.getMetadata()};f&&f(s,c)})})},this.closePackageDocument=function(){i&&i.flushCache()},ReadiumSDK.reader=this.reader,ReadiumSDK.trigger(ReadiumSDK.Events.READER_INITIALIZED,this.reader)};return h.version=JSON.parse(t),h}),define("versioning/Versioning",["text!viewer-version","Readium"],function(e,t){var n=JSON.parse(e),r={getVersioningInfo:function(e){var r={},i=t.version;r.viewer=n,r.viewer.dateTimeString=(new Date(n.timestamp)).toString(),r.readiumJs=i.readiumJs,r.readiumSharedJs=i.readiumSharedJs,e(r)}};return r}),define("EpubLibrary",["jquery","bootstrap","storage/StorageManager","storage/Settings","EpubLibraryManager","i18n/Strings","hgn!templates/library-navbar.html","hgn!templates/library-body.html","hgn!templates/empty-library.html","hgn!templates/library-item.html","hgn!templates/details-dialog.html","hgn!templates/about-dialog.html","hgn!templates/details-body.html","hgn!templates/add-epub-dialog.html","ReaderSettingsDialog","Dialogs","workers/Messages","analytics/Analytics","Keyboard","versioning/Versioning"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){function A(){var t=e(this),n=t.attr("data-package"),r=t.attr("data-root"),i=t.attr("data-root-dir"),s=t.attr("data-no-cover");k(n,r,i,s,"library")}var w=l({strings:s}),E,S,x=function(){var e=document.styleSheets[0],t=0,n;do e.cssRules?n=e.cssRules[t]:n=e.rules[t],n&&(n.selectorText.toLowerCase()==".library-item"?E=n:n.selectorText.toLowerCase()=="body:not(.list-view) .library-item .no-cover"&&(S=n)),t++;while(n)},T=function(){var e=2,t=3,n=4,r=0,i=0,s=1,o=window.innerWidth;o>=992?(i=o*(e/12)-30,r=1.33*i+60):o>=768?(i=o*(t/12)-30,r=1.33*i+60):(i=o*(n/12)-30,r=1.33*i+20),E.style.height=r+"px",s=i/300,S.style.width=i+"px",S.style.height=1.33*i+"px",S.style.fontSize=40*s+"px"},N=function(t){var n=h({data:t,strings:s});e(".details-dialog .modal-body").html(n),e(".details-dialog .delete").on("click",function(){e(".details-dialog").modal("hide");var n=function(){i.retrieveAvailableEpubs(L),v.closeModal()},r=s.i18n_are_you_sure+" '"+t.title+"'";v.showModalPrompt(s.delete_dlg_title,r,s.i18n_delete,s.i18n_cancel,function(){v.showModalProgress(s.delete_progress_title,""),v.updateProgress(100,m.PROGRESS_DELETING,t.title,!0),i.deleteEpubWithId(t.rootDir,n,C)})})},C=function(e){v.showError(e)};this.showMetadata=function(e,t){i.retrieveAvailableEpubs(function(n){var r=0;n.forEach(function(n){var i="images/covers/cover"+(r++%8+1)+".jpg";n.rootUrl==e&&(typeof n.rootDir=="undefined"&&(n.rootDir=n.coverHref),k(n.rootUrl+"/"+n.packagePath,n.rootUrl,n.rootDir,i,t))})})};var k=function(t,n,r,s,o){e(".details-dialog").remove(),e(".details-dialog").off("hidden.bs.modal"),e(".details-dialog").off("shown.bs.modal"),e("#app-container").append(w),e("#details-dialog").on("hidden.bs.modal",function(){y.scope(o),o=="library"&&setTimeout(function(){$this.focus()},50)}),e("#details-dialog").on("shown.bs.modal",function(){o=="library"&&(document.getElementById("details-button-div").hidden=!1,document.getElementById("details-button-div").setAttribute("aria-hidden",!1)),y.scope("details")}),e(".details-dialog").modal(),i.retrieveFullEpubDetails(t,n,r,s,N,C)},L=function(t){e("#app-container .library-items").remove(),e("#app-container").append(u({}));if(!t.length){e("#app-container .library-items").append(a({strings:s}));return}var n=0;t.forEach(function(t){var r="images/covers/cover"+(n++%8+1)+".jpg";e(".library-items").append(f({count:{n:n,tabindex:n*2+99},epub:t,strings:s,noCoverBackground:r}))}),e(".details").on("click",A)},O=function(t){var n=e(this).attr("data-book");return e(window).triggerHandler("readepub",[n]),!1},M=function(){v.closeModal(),v.reset(),e(".modal-backdrop").remove(),y.off("library"),y.off("settings"),e("#settings-dialog").off("hidden.bs.modal"),e("#settings-dialog").off("shown.bs.modal"),e("#about-dialog").off("hidden.bs.modal"),e("#about-dialog").off("shown.bs.modal"),e("#add-epub-dialog").off("hidden.bs.modal"),e("#add-epub-dialog").off("shown.bs.modal"),e(".details-dialog").off("hidden.bs.modal"),e(".details-dialog").off("shown.bs.modal"),e(window).off("resize"),e(document.body).off("click"),e(window).off("storageReady"),e("#app-container").attr("style","")},_=function(e,t,n){r.get("replaceByDefault",function(e){e==="true"?t():n()})},D=function(){v.closeModal(),i.retrieveAvailableEpubs(L)},P=function(t){var n=t.target.files[0];e("#add-epub-dialog").modal("hide"),v.showModalProgress(s.import_dlg_title,s.import_dlg_message),i.handleZippedEpub({file:n,overwrite:_,success:D,progress:v.updateProgress,error:C})},H=function(t){var n=t.target.files;e("#add-epub-dialog").modal("hide"),v.showModalProgress(s.import_dlg_title,s.import_dlg_message),i.handleDirectoryImport({files:n,overwrite:_,success:D,progress:v.updateProgress,error:C})},B=function(){var t=e("#url-upload").val();e("#add-epub-dialog").modal("hide"),v.showModalProgress(s.import_dlg_title,s.import_dlg_message),i.handleUrlImport({url:t,overwrite:_,success:D,progress:v.updateProgress,error:C})},j=function(){v.showModalProgress(s.migrate_dlg_title,s.migrate_dlg_message),i.handleMigration({success:function(){r.put("needsMigration",!1,e.noop),D()},progress:v.updateProgress,error:C})},F=function(){var t=function(){document.body.className.indexOf("list-view")>-1?(e(document.body).removeClass("list-view"),setTimeout(function(){e(".icon-list-view")[0].focus()},50)):(e(document.body).addClass("list-view"),setTimeout(function(){e(".icon-thumbnails")[0].focus()},50))};v.reset(),y.scope("library"),g.trackView("/library");var u=e("#app-container");u.empty(),d.initDialog(),u.append(p({canHandleUrl:i.canHandleUrl(),canHandleDirectory:i.canHandleDirectory(),strings:s})),b.getVersioningInfo(function(e){u.append(c({strings:s,viewer:e.viewer,readium:e.readiumJs,sharedJs:e.readiumSharedJs}))}),e("#about-dialog").on("hidden.bs.modal",function(){y.scope("library"),setTimeout(function(){e("#aboutButt1").focus()},50)}),e("#about-dialog").on("shown.bs.modal",function(){y.scope("about")}),e("#add-epub-dialog").on("hidden.bs.modal",function(){y.scope("library"),setTimeout(function(){e("#addbutt").focus()},50)}),e("#add-epub-dialog").on("shown.bs.modal",function(){y.scope("add"),e("#add-epub-dialog input").val(""),setTimeout(function(){e("#closeAddEpubCross")[0].focus()},1e3)}),e("#url-upload").on("keyup",function(){var t=e(this).val();t&&t.length?e("#add-epub-dialog .add-book").prop("disabled",!1):e("#add-epub-dialog .add-book").prop("disabled",!0)}),e(".add-book").on("click",B),e("nav").empty(),e("nav").attr("aria-label",s.i18n_toolbar),e("nav").append(o({strings:s,dialogs:v,keyboard:y})),e(".icon-list-view").on("click",t),e(".icon-thumbnails").on("click",t),x(),T(),n.initStorage(function(){i.retrieveAvailableEpubs(L)},C),y.on(y.ListViewThumbnailViewToggle,"library",t),y.on(y.ShowSettingsModal,"library",function(){e("#settings-dialog").modal("show")}),y.on(y.ShowSettingsModal,"library",function(){e("#settings-dialog").modal("show")}),y.on(y.AboutDialog,"library",function(){e("#about-dialog").modal("show")}),y.on(y.AddEpubDialog,"library",function(){e("#add-epub-dialog").modal("show")}),e(window).trigger("libraryUIReady"),e(window).on("resize",T);var a=function(){var t=e(document.body).height()-e("#app-container")[0].offsetTop;e("#app-container").height(t)};e(window).on("resize",a),e("#app-container").css("overflowY","auto"),a(),e(document.body).on("click",".read",O),e("#epub-upload").on("change",P),e("#dir-upload").on("change",H),document.title=s.i18n_readium_library,e("#settings-dialog").on("hidden.bs.modal",function(){y.scope("library"),setTimeout(function(){e("#settbutt1").focus()},50),e("#buttSave").removeAttr("accesskey"),e("#buttClose").removeAttr("accesskey")}),e("#settings-dialog").on("shown.bs.modal",function(){y.scope("settings"),e("#buttSave").attr("accesskey",y.accesskeys.SettingsModalSave),e("#buttClose").attr("accesskey",y.accesskeys.SettingsModalClose)}),r.get("needsMigration",function(e){e&&j()})},I=function(e){r.get("reader",function(t){y.applySettings(t),F(e)})};return window.setReplaceByDefault=function(e){r.put("replaceByDefault",String(e))},{loadUI:I,unloadUI:M}}),!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("spin",t):e.Spinner=t()}(this,function(){function e(e,t){var n,r=document.createElement(e||"div");for(n in t)r[n]=t[n];return r}function t(e){for(var t=1,n=arguments.length;n>t;t++)e.appendChild(arguments[t]);return e}function n(e,t,n,r){var i=["opacity",t,~~(100*e),n,r].join("-"),s=.01+n/r*100,o=Math.max(1-(1-e)/t*(100-s),e),u=l.substring(0,l.indexOf("Animation")).toLowerCase(),a=u&&"-"+u+"-"||"";return h[i]||(p.insertRule("@"+a+"keyframes "+i+"{0%{opacity:"+o+"}"+s+"%{opacity:"+e+"}"+(s+.01)+"%{opacity:1}"+(s+t)%100+"%{opacity:"+e+"}100%{opacity:"+o+"}}",p.cssRules.length),h[i]=1),i}function r(e,t){var n,r,i=e.style;for(t=t.charAt(0).toUpperCase()+t.slice(1),r=0;r<c.length;r++)if(n=c[r]+t,void 0!==i[n])return n;return void 0!==i[t]?t:void 0}function i(e,t){for(var n in t)e.style[r(e,n)||n]=t[n];return e}function s(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)void 0===e[r]&&(e[r]=n[r])}return e}function o(e){for(var t={x:e.offsetLeft,y:e.offsetTop};e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function u(e,t){return"string"==typeof e?e:e[t%e.length]}function a(e){return"undefined"==typeof this?new a(e):(this.opts=s(e||{},a.defaults,d),void 0)}function f(){function n(t,n){return e("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',n)}p.addRule(".spin-vml","behavior:url(#default#VML)"),a.prototype.lines=function(e,r){function s(){return i(n("group",{coordsize:l+" "+l,coordorigin:-f+" "+ -f}),{width:l,height:l})}function o(e,o,a){t(h,t(i(s(),{rotation:360/r.lines*e+"deg",left:~~o}),t(i(n("roundrect",{arcsize:r.corners}),{width:f,height:r.width,left:r.radius,top:-r.width>>1,filter:a}),n("fill",{color:u(r.color,e),opacity:r.opacity}),n("stroke",{opacity:0}))))}var a,f=r.length+r.width,l=2*f,c=2*-(r.width+r.length)+"px",h=i(s(),{position:"absolute",top:c,left:c});if(r.shadow)for(a=1;a<=r.lines;a++)o(a,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(a=1;a<=r.lines;a++)o(a);return t(e,h)},a.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}}var l,c=["webkit","Moz","ms","O"],h={},p=function(){var n=e("style",{type:"text/css"});return t(document.getElementsByTagName("head")[0],n),n.sheet||n.styleSheet}(),d={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};a.defaults={},s(a.prototype,{spin:function(t){this.stop();var n,r,s=this,u=s.opts,a=s.el=i(e(0,{className:u.className}),{position:u.position,width:0,zIndex:u.zIndex}),f=u.radius+u.length+u.width;if(t&&(t.insertBefore(a,t.firstChild||null),r=o(t),n=o(a),i(a,{left:("auto"==u.left?r.x-n.x+(t.offsetWidth>>1):parseInt(u.left,10)+f)+"px",top:("auto"==u.top?r.y-n.y+(t.offsetHeight>>1):parseInt(u.top,10)+f)+"px"})),a.setAttribute("role","progressbar"),s.lines(a,s.opts),!l){var c,h=0,p=(u.lines-1)*(1-u.direction)/2,d=u.fps,v=d/u.speed,m=(1-u.opacity)/(v*u.trail/100),y=v/u.lines;!function b(){h++;for(var e=0;e<u.lines;e++)c=Math.max(1-(h+(u.lines-e)*y)%v*m,u.opacity),s.opacity(a,e*u.direction+p,c,u);s.timeout=s.el&&setTimeout(b,~~(1e3/d))}()}return s},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(r,s){function o(t,n){return i(e(),{position:"absolute",width:s.length+s.width+"px",height:s.width+"px",background:t,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/s.lines*f+s.rotate)+"deg) translate("+s.radius+"px,0)",borderRadius:(s.corners*s.width>>1)+"px"})}for(var a,f=0,c=(s.lines-1)*(1-s.direction)/2;f<s.lines;f++)a=i(e(),{position:"absolute",top:1+~(s.width/2)+"px",transform:s.hwaccel?"translate3d(0,0,0)":"",opacity:s.opacity,animation:l&&n(s.opacity,s.trail,c+f*s.direction,s.lines)+" "+1/s.speed+"s linear infinite"}),s.shadow&&t(a,i(o("#000","0 0 4px #000"),{top:"2px"})),t(r,t(a,o(u(s.color,f),"0 0 1px rgba(0,0,0,.1)")));return r},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}});var v=i(e("group"),{behavior:"url(#default#VML)"});return!r(v,"transform")&&v.adj?f():l=r(v,"animation"),a}),define("Spinner",["spin"],function(e){var t={lines:17,length:0,width:10,radius:48,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:66,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"};return new e(t)}),define("hgn!templates/reader-navbar.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div class="btn-group navbar-left">'),r.b("\n"+n),r.b('        <!-- <button type="button" class="btn btn-default icon icon-show-hide"></button>  -->'),r.b("\n"+n),r.b('    <button id="aboutButt1" tabindex="1" type="button" class="btn icon-logo" data-toggle="modal" data-target="#about-dialog" title="'),r.b(r.v(r.d("strings.about",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.AboutDialog",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.about",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.AboutDialog",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.AboutDialog",e,t,0))),r.b('">'),r.b("\n"+n),r.b('        <span class="icon-readium" aria-hidden="true"></span>'),r.b("\n"+n),r.b("    </button>"),r.b("\n"),r.b("\n"+n),r.b('    <button id="buttShowToolBar" style="opacity:0;visibility:hidden;border:0;outline:0;padding:0;margin:0;width:1px;height=1px;" tabindex="-1" aria-hidden="true" type="button" title="access key '),r.b(r.v(r.d("keyboard.ToolbarShow",e,t,0))),r.b('" aria-label="access key '),r.b(r.v(r.d("keyboard.ToolbarShow",e,t,0))),r.b('" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.ToolbarShow",e,t,0))),r.b('"> </button>'),r.b("\n"),r.b("\n"+n),r.b('    <button id="buttHideToolBar" style="opacity:0;visibility:hidden;border:0;outline:0;padding:0;margin:0;width:0;height=0;" tabindex="-1" aria-hidden="true" type="button" title="access key '),r.b(r.v(r.d("keyboard.ToolbarHide",e,t,0))),r.b('" aria-label="access key '),r.b(r.v(r.d("keyboard.ToolbarHide",e,t,0))),r.b('" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.ToolbarHide",e,t,0))),r.b('"> </button>'),r.b("\n"),r.b("\n"+n),r.b('    <button id="buttNightTheme" style="opacity:0;visibility:hidden;border:0;outline:0;padding:0;margin:0;width:0;height=0;" tabindex="-1" aria-hidden="true" type="button" title="access key '),r.b(r.v(r.d("keyboard.NightTheme",e,t,0))),r.b('" aria-label="access key '),r.b(r.v(r.d("keyboard.NightTheme",e,t,0))),r.b('" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.NightTheme",e,t,0))),r.b('"> </button>'),r.b("\n"),r.b("\n"+n),r.b('    <button id="buttRatePlus" style="opacity:0;visibility:hidden;border:0;outline:0;padding:0;margin:0;width:0;height=0;" tabindex="-1" aria-hidden="true" type="button" title="access key '),r.b(r.v(r.d("keyboard.MediaOverlaysRateIncrease",e,t,0))),r.b('" aria-label="access key '),r.b(r.v(r.d("keyboard.MediaOverlaysRateIncrease",e,t,0))),r.b('" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.MediaOverlaysRateIncrease",e,t,0))),r.b('"> </button>'),r.b("\n"),r.b("\n"+n),r.b('    <button id="buttRateMinus" style="opacity:0;visibility:hidden;border:0;outline:0;padding:0;margin:0;width:0;height=0;" tabindex="-1" aria-hidden="true" type="button" title="access key '),r.b(r.v(r.d("keyboard.MediaOverlaysRateDecrease",e,t,0))),r.b('" aria-label="access key '),r.b(r.v(r.d("keyboard.MediaOverlaysRateDecrease",e,t,0))),r.b('" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.MediaOverlaysRateDecrease",e,t,0))),r.b('"> </button>'),r.b("\n"),r.b("\n"+n),r.b('    <button id="buttVolumePlus" style="opacity:0;visibility:hidden;border:0;outline:0;padding:0;margin:0;width:0;height=0;" tabindex="-1" aria-hidden="true" type="button" title="access key '),r.b(r.v(r.d("keyboard.MediaOverlaysVolumeIncrease",e,t,0))),r.b('" aria-label="access key '),r.b(r.v(r.d("keyboard.MediaOverlaysVolumeIncrease",e,t,0))),r.b('" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.MediaOverlaysVolumeIncrease",e,t,0))),r.b('"> </button>'),r.b("\n"),r.b("\n"+n),r.b('    <button id="buttVolumeMinus" style="opacity:0;visibility:hidden;border:0;outline:0;padding:0;margin:0;width:0;height=0;" tabindex="-1" aria-hidden="true" type="button" title="access key '),r.b(r.v(r.d("keyboard.MediaOverlaysVolumeDecrease",e,t,0))),r.b('" aria-label="access key '),r.b(r.v(r.d("keyboard.MediaOverlaysVolumeDecrease",e,t,0))),r.b('" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.MediaOverlaysVolumeDecrease",e,t,0))),r.b('"> </button>'),r.b("\n"),r.b("\n"+n),r.b("</div>"),r.b("\n"),r.b("\n"+n),r.b('<div class="navbar-middle">'),r.b("\n"+n),r.b('        <div id="pagination-numbering" class="pagination"></div>'),r.b("\n"+n),r.b('        <div id="pagination-in-percent" class="pagination"></div>'),r.b("\n"+n),r.b('        <!--<input  type="text" role="slider" id="pagination-in-percent-slider" value="" data-slider-min="0" data-slider-max="100" data-slider-step="1" data-slider-id="p-slider" data-slider-tooltip="hide" data-slider-handle="round" />-->'),r.b("\n"+n),r.b("</div>"),r.b("\n"+n),r.b('<div class="btn-group navbar-right">'),r.b("\n"),r.b("\n"+n),r.b('    <div id="backgroundAudioTrack-div">'),r.b("\n"),r.b("\n"+n),r.b('        <button tabindex="1" id="backgroundAudioTrack-button-play" type="button" class="btn icon-play-audio-background"  title="'),r.b(r.v(r.d("strings.i18n_audio_play_background",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.BackgroundAudioPlayPause",e,t,0))),r.b(']"  aria-label="'),r.b(r.v(r.d("strings.i18n_audio_play_background",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.BackgroundAudioPlayPause",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.BackgroundAudioPlayPause",e,t,0))),r.b('">'),r.b("\n"+n),r.b('            <span class="glyphicon glyphicon-music" aria-hidden="true"></span>'),r.b("\n"+n),r.b("        </button>"),r.b("\n"+n),r.b('        <button tabindex="1" id="backgroundAudioTrack-button-pause" type="button" class="btn icon-pause-audio-background"  title="'),r.b(r.v(r.d("strings.i18n_audio_pause_background",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.BackgroundAudioPlayPause",e,t,0))),r.b(']"  aria-label="'),r.b(r.v(r.d("strings.i18n_audio_pause_background",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.BackgroundAudioPlayPause",e,t,0))),r.b(']">'),r.b("\n"+n),r.b('            <span class="glyphicon glyphicon-volume-up" aria-hidden="true"></span>'),r.b("\n"+n),r.b("        </button>"),r.b("\n"),r.b("\n"+n),r.b("    </div>"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b("    <!--Audioplayer Controls START-->"),r.b("\n"+n),r.b('    <div id="audioplayer">'),r.b("\n"),r.b("\n"+n),r.b('        <button tabindex="1" id="btn-collapse-audio" type="button" class="btn icon-collapse-audio" title="'),r.b(r.v(r.d("strings.i18n_audio_collapse",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysAdvancedPanelShowHide",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_collapse",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysAdvancedPanelShowHide",e,t,0))),r.b(']">'),r.b("\n"+n),r.b('            <span class="glyphicon glyphicon-open" aria-hidden="true"></span>'),r.b("\n"+n),r.b("        </button>"),r.b("\n"),r.b("\n"+n),r.b('        <button tabindex="1" id="btn-expand-audio" type="button" class="btn icon-expand-audio" title="'),r.b(r.v(r.d("strings.i18n_audio_expand",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysAdvancedPanelShowHide",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_expand",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysAdvancedPanelShowHide",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.MediaOverlaysAdvancedPanelShowHide",e,t,0))),r.b('">'),r.b("\n"+n),r.b('            <span class="glyphicon glyphicon-save" aria-hidden="true"></span>'),r.b("\n"+n),r.b("        </button>"),r.b("\n"),r.b("\n"+n),r.b('        <button tabindex="1" id="btn-previous-audio" type="button" class="btn icon-previous-audio" title="'),r.b(r.v(r.d("strings.i18n_audio_previous",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysPrevious",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_previous",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysPrevious",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.MediaOverlaysPrevious",e,t,0))),r.b('">'),r.b("\n"+n),r.b('            <span class="glyphicon glyphicon-backward" aria-hidden="true"></span>'),r.b("\n"+n),r.b("        </button>"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b('        <button tabindex="1" id="btn-play-audio" type="button" class="btn icon-play-audio"  title="'),r.b(r.v(r.d("strings.i18n_audio_play",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysPlayPause",e,t,0))),r.b(']"  aria-label="'),r.b(r.v(r.d("strings.i18n_audio_play",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysPlayPause",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.MediaOverlaysPlayPause",e,t,0))),r.b('">'),r.b("\n"+n),r.b('            <span class="glyphicon glyphicon-play" aria-hidden="true"></span>'),r.b("\n"+n),r.b("        </button>"),r.b("\n"+n),r.b('        <button tabindex="1" id="btn-pause-audio" type="button" class="btn icon-pause-audio"  title="'),r.b(r.v(r.d("strings.i18n_audio_pause",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysPlayPause",e,t,0))),r.b(']"  aria-label="'),r.b(r.v(r.d("strings.i18n_audio_pause",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysPlayPause",e,t,0))),r.b(']">'),r.b("\n"+n),r.b('            <span class="glyphicon glyphicon-pause" aria-hidden="true"></span>'),r.b("\n"+n),r.b("        </button>"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b('        <button tabindex="1" id="btn-next-audio" type="button" class="btn icon-next-audio" title="'),r.b(r.v(r.d("strings.i18n_audio_next",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysNext",e,t,0))),r.b(']" arial-label="'),r.b(r.v(r.d("strings.i18n_audio_next",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysNext",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.MediaOverlaysNext",e,t,0))),r.b('">'),r.b("\n"+n),r.b('            <span class="glyphicon glyphicon-forward" aria-hidden="true"></span>'),r.b("\n"+n),r.b("        </button>"),r.b("\n"),r.b("\n"+n),r.b('        <div id="audioResponsive">'),r.b("\n"),r.b("\n"+n),r.b('        <button tabindex="1" id="btn-audio-volume-mute" type="button" class="btn icon-audio-volume-mute" title="'),r.b(r.v(r.d("strings.i18n_audio_mute",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysVolumeMuteToggle",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_mute",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysVolumeMuteToggle",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.MediaOverlaysVolumeMuteToggle",e,t,0))),r.b('">'),r.b("\n"+n),r.b('            <span class="glyphicon glyphicon-volume-up" aria-hidden="true"></span>'),r.b("\n"+n),r.b("        </button>"),r.b("\n"+n),r.b('        <button tabindex="1" id="btn-audio-volume-unmute" type="button" class="btn icon-audio-volume-unmute" title="'),r.b(r.v(r.d("strings.i18n_audio_unmute",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysVolumeMuteToggle",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_unmute",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysVolumeMuteToggle",e,t,0))),r.b(']">'),r.b("\n"+n),r.b('            <span class="glyphicon glyphicon-volume-off" aria-hidden="true"></span>'),r.b("\n"+n),r.b("        </button>"),r.b("\n"),r.b("\n"+n),r.b('        <input tabindex="1" id="volume-range-slider" type="range" role="slider" min="0" aria-value-min="0" aria-valuemin="0" max="100" aria-value-max="100" aria-valuemax="100" value="100" aria-valuenow="100" aria-value-now="100" aria-valuetext="100%" aria-value-text="100%" title="'),r.b(r.v(r.d("strings.i18n_audio_volume",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysVolumeDecrease",e,t,0))),r.b("] / ["),r.b(r.v(r.d("keyboard.MediaOverlaysVolumeIncrease",e,t,0))),r.b(']" arial-label="'),r.b(r.v(r.d("strings.i18n_audio_volume",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysVolumeDecrease",e,t,0))),r.b("] / ["),r.b(r.v(r.d("keyboard.MediaOverlaysVolumeIncrease",e,t,0))),r.b(']" />'),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b('        <button tabindex="1" tabindex="1" id="btn-touch-audio-enable" type="button" class="btn icon-touch-audio-enable" title="'),r.b(r.v(r.d("strings.i18n_audio_touch_enable",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_touch_enable",e,t,0))),r.b('" >'),r.b("\n"+n),r.b('            <span id="icon-touch-off-hand" class="glyphicon glyphicon-hand-up" aria-hidden="true"></span>'),r.b("\n"),r.b("\n"+n),r.b('            <span id="icon-touch-off" class="glyphicon glyphicon-remove" aria-hidden="true"></span>'),r.b("\n"+n),r.b("        </button>"),r.b("\n"),r.b("\n"+n),r.b('        <button tabindex="1" id="btn-touch-audio-disable" type="button" class="btn icon-touch-audio-disable" title="'),r.b(r.v(r.d("strings.i18n_audio_touch_disable",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_touch_disable",e,t,0))),r.b('" >'),r.b("\n"+n),r.b('            <span id="icon-touch-on-hand" class="glyphicon glyphicon-hand-up" aria-hidden="true"></span>'),r.b("\n"),r.b("\n"+n),r.b('            <span id="icon-touch-on" class="glyphicon glyphicon-ok" aria-hidden="true"></span>'),r.b("\n"+n),r.b("        </button>"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b("    </div>"),r.b("\n"),r.b("\n"+n),r.b('        <div id="audioExpanded" role="alert">'),r.b("\n"),r.b("\n"+n),r.b('            <input tabindex="1" id="time-range-slider" type="range" role="slider" min="0" aria-value-min="0" aria-valuemin="0" max="100" aria-value-max="100" aria-valuemax="100" value="0" aria-valuenow="0" aria-value-now="0" aria-valuetext="0%" aria-value-text="0%" data-value="0" title="'),r.b(r.v(r.d("strings.i18n_audio_time",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_time",e,t,0))),r.b('"  />'),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b('            <button tabindex="1" id="btn-audio-rate" type="button" class="btn icon-rate-audio" title="'),r.b(r.v(r.d("strings.i18n_audio_rate_reset",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysRateReset",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_rate_reset",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysRateReset",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.MediaOverlaysRateReset",e,t,0))),r.b('">'),r.b("\n"+n),r.b('                <span class="glyphicon glyphicon-play-circle" aria-hidden="true"></span>'),r.b("\n"+n),r.b("            </button>"),r.b("\n"),r.b("\n"+n),r.b('            <input tabindex="1" id="rate-range-slider" type="range" role="slider" min="0" aria-value-min="0" aria-valuemin="0" max="4" aria-value-max="4" aria-valuemax="4" value="1" aria-valuenow="1" aria-value-now="1" aria-valuetext="1x" aria-value-text="1x" step="0.5" title="'),r.b(r.v(r.d("strings.i18n_audio_rate",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysRateDecrease",e,t,0))),r.b("] / ["),r.b(r.v(r.d("keyboard.MediaOverlaysRateIncrease",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_rate",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysRateDecrease",e,t,0))),r.b("] / ["),r.b(r.v(r.d("keyboard.MediaOverlaysRateIncrease",e,t,0))),r.b(']" />'),r.b("\n"),r.b("\n"+n),r.b('            <span aria-hidden="true" tabindex="-1" id="rate-range-slider-label">1x</span>'),r.b("\n"),r.b("\n"+n),r.b('            <form action="" id="mo-sync-form">'),r.b("\n"+n),r.b('                <input tabindex="1" type="radio" name="mo-sync" value="default" id="mo-sync-default" class="mo-sync" checked="checked"  title="'),r.b(r.v(r.d("strings.i18n_audio_sync_default",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_audio_sync",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_sync_default",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_audio_sync",e,t,0))),r.b('"> </input>'),r.b("\n"+n),r.b('                <label tabindex="1" for="mo-sync-default" title="'),r.b(r.v(r.d("strings.i18n_audio_sync_default",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_audio_sync",e,t,0))),r.b('"><span aria-hidden="true">&#8855;</span></label>'),r.b("\n"),r.b("\n"+n),r.b('                <input tabindex="1" type="radio" name="mo-sync" value="word" id="mo-sync-word" class="mo-sync" title="'),r.b(r.v(r.d("strings.i18n_audio_sync_word",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_audio_sync",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_sync_word",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_audio_sync",e,t,0))),r.b('"> </input>'),r.b("\n"+n),r.b('                <label tabindex="1" for="mo-sync-word" title="'),r.b(r.v(r.d("strings.i18n_audio_sync_word",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_audio_sync",e,t,0))),r.b('"><span aria-hidden="true">'),r.b(r.v(r.d("strings.i18n_audio_sync_word",e,t,0))),r.b("</span></label>"),r.b("\n"),r.b("\n"+n),r.b('                <input tabindex="1" type="radio" name="mo-sync" value="sentence" id="mo-sync-sentence" class="mo-sync" title="'),r.b(r.v(r.d("strings.i18n_audio_sync_sentence",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_audio_sync",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_sync_sentence",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_audio_sync",e,t,0))),r.b('"> </input>'),r.b("\n"+n),r.b('                <label tabindex="1" for="mo-sync-sentence" title="'),r.b(r.v(r.d("strings.i18n_audio_sync_sentence",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_audio_sync",e,t,0))),r.b('"><span aria-hidden="true">'),r.b(r.v(r.d("strings.i18n_audio_sync_sentence",e,t,0))),r.b("</span></label>"),r.b("\n"),r.b("\n"+n),r.b('                <input tabindex="1" type="radio" name="mo-sync" value="paragraph" id="mo-sync-paragraph" class="mo-sync" title="'),r.b(r.v(r.d("strings.i18n_audio_sync_paragraph",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_audio_sync",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_sync_paragraph",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_audio_sync",e,t,0))),r.b('"> </input>'),r.b("\n"+n),r.b('                <label tabindex="1" for="mo-sync-paragraph" title="'),r.b(r.v(r.d("strings.i18n_audio_sync_paragraph",e,t,0))),r.b(" "),r.b(r.v(r.d("strings.i18n_audio_sync",e,t,0))),r.b('"><span aria-hidden="true">'),r.b(r.v(r.d("strings.i18n_audio_sync_paragraph",e,t,0))),r.b("</span></label>"),r.b("\n"+n),r.b("            </form>"),r.b("\n"),r.b("\n"+n),r.b('            <div id="audio-block">'),r.b("\n"),r.b("\n"+n),r.b('            <div id="mo-highlighters">'),r.b("\n"+n),r.b('                <button tabindex="1" id="mo-highlighter-0" type="button" class="btn btn-mo-highlighter" title="'),r.b(r.v(r.d("strings.i18n_audio_highlight",e,t,0))),r.b(": "),r.b(r.v(r.d("strings.i18n_audio_highlight_default",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_highlight",e,t,0))),r.b(": "),r.b(r.v(r.d("strings.i18n_audio_highlight_default",e,t,0))),r.b('" aria-selected="true" data-mohighlight="0" >'),r.b("\n"+n),r.b("                    "),r.b(r.v(r.d("strings.i18n_audio_highlight_default",e,t,0))),r.b("\n"+n),r.b("                </button>"),r.b("\n"+n),r.b('                <button tabindex="1" id="mo-highlighter-1" type="button" class="btn btn-mo-highlighter" title="'),r.b(r.v(r.d("strings.i18n_audio_highlight",e,t,0))),r.b(': #1" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_highlight",e,t,0))),r.b(': #1" data-mohighlight="1" >'),r.b("\n"),r.b("\n"+n),r.b("                </button>"),r.b("\n"+n),r.b('                <button tabindex="1" id="mo-highlighter-2" type="button" class="btn btn-mo-highlighter" title="'),r.b(r.v(r.d("strings.i18n_audio_highlight",e,t,0))),r.b(': #2" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_highlight",e,t,0))),r.b(': #2" data-mohighlight="2" >'),r.b("\n"),r.b("\n"+n),r.b("                </button>"),r.b("\n"+n),r.b('                <button tabindex="1" id="mo-highlighter-3" type="button" class="btn btn-mo-highlighter" title="'),r.b(r.v(r.d("strings.i18n_audio_highlight",e,t,0))),r.b(': #3" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_highlight",e,t,0))),r.b(': #3" data-mohighlight="3" >'),r.b("\n"),r.b("\n"+n),r.b("                </button>"),r.b("\n"+n),r.b('                <button tabindex="1" id="mo-highlighter-4" type="button" class="btn btn-mo-highlighter" title="'),r.b(r.v(r.d("strings.i18n_audio_highlight",e,t,0))),r.b(': #4" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_highlight",e,t,0))),r.b(': #4" data-mohighlight="4" >'),r.b("\n"),r.b("\n"+n),r.b("                </button>"),r.b("\n"+n),r.b('                <button tabindex="1" id="mo-highlighter-5" type="button" class="btn btn-mo-highlighter" title="'),r.b(r.v(r.d("strings.i18n_audio_highlight",e,t,0))),r.b(': #5" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_highlight",e,t,0))),r.b(': #5" data-mohighlight="5" >'),r.b("\n"),r.b("\n"+n),r.b("                </button>"),r.b("\n"+n),r.b('                <button tabindex="1" id="mo-highlighter-6" type="button" class="btn btn-mo-highlighter" title="'),r.b(r.v(r.d("strings.i18n_audio_highlight",e,t,0))),r.b(': #6" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_highlight",e,t,0))),r.b(': #6" data-mohighlight="6" >'),r.b("\n"),r.b("\n"+n),r.b("                </button>"),r.b("\n"+n),r.b("            </div>"),r.b("\n"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b('            <button tabindex="1" id="btn-playback-scroll-enable" type="button" class="btn icon-playback-scroll-enable" title="'),r.b(r.v(r.d("strings.i18n_playback_scroll_enable",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_playback_scroll_enable",e,t,0))),r.b('" >'),r.b("\n"+n),r.b('                <span id="icon-playback-scroll-off" class="glyphicon glyphicon-sort-by-attributes" aria-hidden="true"></span>'),r.b("\n"+n),r.b("            </button>"),r.b("\n"),r.b("\n"+n),r.b('            <button tabindex="1" id="btn-playback-scroll-disable" type="button" class="btn icon-playback-scroll-disable" title="'),r.b(r.v(r.d("strings.i18n_playback_scroll_disable",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_playback_scroll_disable",e,t,0))),r.b('" >'),r.b("\n"+n),r.b('                <span id="icon-playback-scroll-on" class="glyphicon glyphicon-sort" aria-hidden="true"></span>'),r.b("\n"+n),r.b("            </button>"),r.b("\n"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b('            <button tabindex="1" id="btn-auto-page-turn-enable" type="button" class="btn icon-auto-page-turn-enable" title="'),r.b(r.v(r.d("strings.i18n_auto_page_turn_enable",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_auto_page_turn_enable",e,t,0))),r.b('" >'),r.b("\n"+n),r.b('                <span id="icon-auto-page-turn-off" class="glyphicon glyphicon-sound-stereo" aria-hidden="true"></span>'),r.b("\n"+n),r.b("            </button>"),r.b("\n"),r.b("\n"+n),r.b('            <button tabindex="1" id="btn-auto-page-turn-disable" type="button" class="btn icon-auto-page-turn-disable" title="'),r.b(r.v(r.d("strings.i18n_auto_page_turn_disable",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_auto_page_turn_disable",e,t,0))),r.b('" >'),r.b("\n"+n),r.b('                <span id="icon-auto-page-turn-on" class="glyphicon glyphicon-sound-dolby" aria-hidden="true"></span>'),r.b("\n"+n),r.b("            </button>"),r.b("\n"),r.b("\n"+n),r.b('            <button tabindex="1" id="btn-skip-audio-enable" type="button" class="btn icon-skip-audio-enable" title="'),r.b(r.v(r.d("strings.i18n_audio_skip_enable",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_skip_enable",e,t,0))),r.b('" >'),r.b("\n"+n),r.b('                <span id="icon-skip-off" class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>'),r.b("\n"+n),r.b("            </button>"),r.b("\n"),r.b("\n"+n),r.b('            <button tabindex="1" id="btn-skip-audio-disable" type="button" class="btn icon-skip-audio-disable" title="'),r.b(r.v(r.d("strings.i18n_audio_skip_disable",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_skip_disable",e,t,0))),r.b('" >'),r.b("\n"+n),r.b('                <span id="icon-skip-on" class="glyphicon glyphicon-ok-circle" aria-hidden="true"></span>'),r.b("\n"+n),r.b("            </button>"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b('            <button tabindex="1" id="btn-esc-audio" type="button" class="btn icon-esc-audio" title="'),r.b(r.v(r.d("strings.i18n_audio_esc",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysEscape",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.i18n_audio_esc",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.MediaOverlaysEscape",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.MediaOverlaysEscape",e,t,0))),r.b('">'),r.b("\n"+n),r.b('                <span class="glyphicon glyphicon-eject" aria-hidden="true"></span>'),r.b("\n"+n),r.b("            </button>"),r.b("\n"),r.b("\n"+n),r.b("            </div>"),r.b("\n"),r.b("\n"+n),r.b('            <!-- div class="checkbox">'),r.b("\n"+n),r.b("              <label>"),r.b("\n"+n),r.b('                <input type="checkbox" value="false"> Skip'),r.b("\n"+n),r.b("              </label>"),r.b("\n"+n),r.b("            </div -->"),r.b("\n"+n),r.b("        </div>"),r.b("\n"+n),r.b("    </div>"),r.b("\n"+n),r.b("    <!--Audioplayer Controls END-->"),r.b("\n"),r.b("\n"),r.b("\n"),r.b("\n"+n),r.b('    <div class="zoom-wrapper dropdown" style="display:none">'),r.b("\n"+n),r.b('        <a tabindex="1" href="#" data-toggle="dropdown"><input tabindex="1" type="text" value="100%" disabled/><span class="caret"></span></a>'),r.b("\n"+n),r.b('        <ul id="zoom-menu" class="dropdown-menu" role="menu">'),r.b("\n"+n),r.b('            <li id="zoom-custom"><a href="#" tabindex="1">Custom <span class="glyphicon glyphicon-ok"></span></a></li>'),r.b("\n"+n),r.b('            <li id="zoom-fit-width"><a href="#" tabindex="1">Fit Width <span class="glyphicon glyphicon-ok"></span></a></li>'),r.b("\n"+n),r.b('            <li id="zoom-fit-screen" class="active-zoom"><a href="#" tabindex="1">Fit Screen <span class="glyphicon glyphicon-ok"></span></a></li>'),r.b("\n"+n),r.b("        </ul>"),r.b("\n"+n),r.b("    </div>"),r.b("\n"+n),r.b('    <button tabindex="1" type="button" class="btn icon-library" title="'),r.b(r.v(r.d("strings.view_library",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.SwitchToLibrary",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.view_library",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.SwitchToLibrary",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.SwitchToLibrary",e,t,0))),r.b('">'),r.b("\n"+n),r.b('        <span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span>'),r.b("\n"+n),r.b("    </button>"),r.b("\n"+n),r.b('    <button tabindex="1" type="button" class="btn icon-annotations" title="'),r.b(r.v(r.d("strings.highlight_selection",e,t,0))),r.b('" aria-label="'),r.b(r.v(r.d("strings.highlight_selection",e,t,0))),r.b('">'),r.b("\n"+n),r.b('        <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>'),r.b("\n"+n),r.b("    </button>"),r.b("\n"+n),r.b('    <button id="tocButt" tabindex="1" tabindex="1" type="button" class="btn icon-toc" title="'),r.b(r.v(r.d("strings.toc",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.TocShowHideToggle",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.toc",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.TocShowHideToggle",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.TocShowHideToggle",e,t,0))),r.b('">'),r.b("\n"+n),r.b('        <span class="glyphicon glyphicon-list" aria-hidden="true"></span>'),r.b("\n"+n),r.b("    </button>"),r.b("\n"+n),r.b('    <button id="settbutt1" tabindex="1" type="button" class="btn icon-settings" data-toggle="modal" data-target="#settings-dialog" title="'),r.b(r.v(r.d("strings.settings",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.ShowSettingsModal",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.settings",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.ShowSettingsModal",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.ShowSettingsModal",e,t,0))),r.b('">'),r.b("\n"+n),r.b('        <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>'),r.b("\n"+n),r.b("    </button>"),r.b("\n"),r.b("\n"+n),r.b('    <button tabindex="1" id="buttFullScreenToggle" type="button" class="btn icon-full-screen" title="'),r.b(r.v(r.d("strings.enter_fullscreen",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.FullScreenToggle",e,t,0))),r.b(']" aria-label="'),r.b(r.v(r.d("strings.enter_fullscreen",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.FullScreenToggle",e,t,0))),r.b(']" accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.FullScreenToggle",e,t,0))),r.b('">'),r.b("\n"+n),r.b('        <span class="glyphicon glyphicon-resize-full" aria-hidden="true"></span>'),r.b("\n"+n),r.b("    </button>"),r.b("\n"),r.b("\n"+n),r.b('    <!-- <button type="button" class="btn btn-default icon icon-bookmark"></button>-->'),r.b("\n"+n),r.b("</div>"),r.b("\n"),r.b("\n"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/reader-body.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div id="readium-toc-body"'),r.b("\n"+n),r.b('aria-label="'),r.b(r.v(r.d("strings.toc",e,t,0))),r.b('"'),r.b("\n"+n),r.b('role="navigation"'),r.b("\n"+n),r.b(">"),r.b("\n"+n),r.b("</div>"),r.b("\n"),r.b("\n"+n),r.b('<div id="reading-area" role="main">  '),r.b("\n"+n),r.b('  <div id="epub-reader-container">'),r.b("\n"+n),r.b('    <div id="epub-reader-frame">'),r.b("\n"+n),r.b("    </div>"),r.b("\n"+n),r.b("  </div>"),r.b("\n"+n),r.b("  "),r.b("\n"+n),r.b('  <div id="readium-page-btns" role="region" aria-label="'),r.b(r.v(r.d("strings.i18n_page_navigation",e,t,0))),r.b('">'),r.b("\n"+n),r.b("  <!-- page left/right buttons inserted here when EPUB is loaded (page progression direction) -->"),r.b("\n"+n),r.b("  </div>"),r.b("\n"+n),r.b("  "),r.b("\n"+n),r.b("</div>"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),define("hgn!templates/reader-body-page-btns.html",["hogan"],function(e){function n(){return t.render.apply(t,arguments)}var t=new e.Template({code:function(e,t,n){var r=this;return r.b(n=n||""),r.b("<!-- Left page -->"),r.b("\n"+n),r.b('<button tabindex="0" id="left-page-btn" class="page-switch-overlay-icon" type="button"'),r.b("\n"),r.b("\n"+n),r.s(r.f("pageProgressionDirectionIsRTL",e,t,1),e,t,0,141,393,"{{ }}")&&(r.rs(e,t,function(e,t,r){r.b('title="'),r.b(r.v(r.d("strings.i18n_page_next",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.PagePrevious",e,t,0))),r.b("] / ["),r.b(r.v(r.d("keyboard.PagePreviousAlt",e,t,0))),r.b(']"'),r.b("\n"),r.b("\n"+n),r.b('aria-label="'),r.b(r.v(r.d("strings.i18n_page_next",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.PagePrevious",e,t,0))),r.b("] / ["),r.b(r.v(r.d("keyboard.PagePreviousAlt",e,t,0))),r.b(']"'),r.b("\n"),r.b("\n"+n),r.b('accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.PagePreviousAlt",e,t,0))),r.b('"'),r.b("\n"+n)}),e.pop()),r.b("\n"+n),r.s(r.f("pageProgressionDirectionIsRTL",e,t,1),e,t,1,0,0,"")||(r.b('title="'),r.b(r.v(r.d("strings.i18n_page_previous",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.PagePrevious",e,t,0))),r.b("] / ["),r.b(r.v(r.d("keyboard.PagePreviousAlt",e,t,0))),r.b(']"'),r.b("\n"),r.b("\n"+n),r.b('aria-label="'),r.b(r.v(r.d("strings.i18n_page_previous",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.PagePrevious",e,t,0))),r.b("] / ["),r.b(r.v(r.d("keyboard.PagePreviousAlt",e,t,0))),r.b(']"'),r.b("\n"),r.b("\n"+n),r.b('accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.PagePreviousAlt",e,t,0))),r.b('"'),r.b("\n"+n)),r.b("\n"+n),r.b(">"),r.b("\n"+n),r.b('<!-- img aria-hidden="true" src="images/pagination1.svg" -->'),r.b("\n"+n),r.b('<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>'),r.b("\n"+n),r.b("</button>"),r.b("\n"+n),r.b("  "),r.b("\n"+n),r.b("<!-- Right page -->"),r.b("\n"+n),r.b('<button tabindex="0" id="right-page-btn" class="page-switch-overlay-icon" type="button"'),r.b("\n"),r.b("\n"+n),r.s(r.f("pageProgressionDirectionIsRTL",e,t,1),e,t,0,1052,1292,"{{ }}")&&(r.rs(e,t,function(e,t,r){r.b('title="'),r.b(r.v(r.d("strings.i18n_page_previous",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.PageNext",e,t,0))),r.b("] / ["),r.b(r.v(r.d("keyboard.PageNextAlt",e,t,0))),r.b(']"'),r.b("\n"),r.b("\n"+n),r.b('aria-label="'),r.b(r.v(r.d("strings.i18n_page_previous",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.PageNext",e,t,0))),r.b("] / ["),r.b(r.v(r.d("keyboard.PageNextAlt",e,t,0))),r.b(']"'),r.b("\n"),r.b("\n"+n),r.b('accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.PageNextAlt",e,t,0))),r.b('"'),r.b("\n"+n)}),e.pop()),r.b("\n"+n),r.s(r.f("pageProgressionDirectionIsRTL",e,t,1),e,t,1,0,0,"")||(r.b('title="'),r.b(r.v(r.d("strings.i18n_page_next",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.PageNext",e,t,0))),r.b("] / ["),r.b(r.v(r.d("keyboard.PageNextAlt",e,t,0))),r.b(']"'),r.b("\n"),r.b("\n"+n),r.b('aria-label="'),r.b(r.v(r.d("strings.i18n_page_next",e,t,0))),r.b(" ["),r.b(r.v(r.d("keyboard.PageNext",e,t,0))),r.b("] / ["),r.b(r.v(r.d("keyboard.PageNextAlt",e,t,0))),r.b(']"'),r.b("\n"),r.b("\n"+n),r.b('accesskey="'),r.b(r.v(r.d("keyboard.accesskeys.PageNextAlt",e,t,0))),r.b('"'),r.b("\n"+n)),r.b("\n"+n),r.b(">"),r.b("\n"+n),r.b('<!-- img aria-hidden="true" src="images/pagination1.svg" -->'),r.b("\n"+n),r.b('<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>'),r.b("\n"+n),r.b("</button>"),r.b("\n"),r.fl()},partials:{},subs:{}},"",e);return n.template=t,n}),function(){var e=typeof module!="undefined"&&module.exports,t=typeof Element!="undefined"&&"ALLOW_KEYBOARD_INPUT"in Element,n=function(){var e,t,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,i=n.length,s={};for(;r<i;r++){e=n[r];if(e&&e[1]in document){for(r=0,t=e.length;r<t;r++)s[n[0][r]]=e[r];return s}}return!1}(),r={request:function(e){var r=n.requestFullscreen;e=e||document.documentElement,/5\.1[\.\d]* Safari/.test(navigator.userAgent)?e[r]():e[r](t&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){document[n.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},onchange:function(){},onerror:function(){},raw:n};if(!n){e?module.exports=!1:window.screenfull=!1;return}Object.defineProperties(r,{isFullscreen:{get:function(){return!!document[n.fullscreenElement]}},element:{enumerable:!0,get:function(){return document[n.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!document[n.fullscreenEnabled]}}}),document.addEventListener(n.fullscreenchange,function(e){r.onchange.call(r,e)}),document.addEventListener(n.fullscreenerror,function(e){r.onerror.call(r,e)}),e?module.exports=r:window.screenfull=r}(),define("screenfull",function(e){return function(){var t,n;return t||e.screenfull}}(this)),define("EpubReaderMediaOverlays",["module","jquery","bootstrap","Readium","Spinner","storage/Settings","i18n/Strings","Dialogs","Keyboard"],function(e,t,n,r,i,s,o,u,a){var f=function(e){e.reader.on(ReadiumSDK.Events.PAGINATION_CHANGED,function(n){e.reader.isMediaOverlayAvailable()&&t("#audioplayer").show();if(!n.spineItem)return;var r=e.reader.package().media_overlay.getSmilBySpineItem(n.spineItem),i=!1,s=t("#mo-sync-word");!r||!r.hasSync("word")?s.attr("disabled","disabled"):(i=!0,s.removeAttr("disabled"));var o=t("#mo-sync-sentence");!r||!r.hasSync("sentence")?o.attr("disabled","disabled"):(i=!0,o.removeAttr("disabled"));var u=t("#mo-sync-paragraph");!r||!r.hasSync("paragraph")?u.attr("disabled","disabled"):(i=!0,u.removeAttr("disabled"));var a=t("#mo-sync-default");i?a.removeAttr("disabled"):a.attr("disabled","disabled")});var n=t("#audioplayer");s.get("reader",function(t){if(!t){t={};var r=e.reader.viewerSettings();t.mediaOverlaysSkipSkippables=r.mediaOverlaysSkipSkippables,t.mediaOverlaysAutomaticPageTurn=r.mediaOverlaysAutomaticPageTurn,t.mediaOverlaysEnableClick=r.mediaOverlaysEnableClick,t.mediaOverlaysPreservePlaybackWhenScroll=r.mediaOverlaysPreservePlaybackWhenScroll,s.put("reader",t)}t.mediaOverlaysSkipSkippables?(n.addClass("skip"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysSkipSkippables:!0})):(n.removeClass("skip"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysSkipSkippables:!1})),t.mediaOverlaysPreservePlaybackWhenScroll?(n.addClass("playScroll"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysPreservePlaybackWhenScroll:!0})):(n.removeClass("playScroll"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysPreservePlaybackWhenScroll:!1})),t.mediaOverlaysAutomaticPageTurn?(n.addClass("autoPageTurn"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysAutomaticPageTurn:!0})):(n.removeClass("autoPageTurn"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysAutomaticPageTurn:!1})),t.mediaOverlaysEnableClick?(n.removeClass("no-touch"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysEnableClick:!0})):(n.addClass("no-touch"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysEnableClick:!1}))});var r=t("#mo-sync-default");r.on("click",function(){var t=e.reader.isPlayingMediaOverlay();t&&e.reader.pauseMediaOverlay(),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysSynchronizationGranularity:""}),t&&e.reader.playMediaOverlay()});var i=t("#mo-sync-word");i.on("click",function(){var t=e.reader.isPlayingMediaOverlay();t&&e.reader.pauseMediaOverlay(),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysSynchronizationGranularity:"word"}),t&&e.reader.playMediaOverlay()});var o=t("#mo-sync-sentence");o.on("click",function(){var t=e.reader.isPlayingMediaOverlay();t&&e.reader.pauseMediaOverlay(),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysSynchronizationGranularity:"sentence"}),t&&e.reader.playMediaOverlay()});var u=t("#mo-sync-paragraph");u.on("click",function(){var t=e.reader.isPlayingMediaOverlay();t&&e.reader.pauseMediaOverlay(),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysSynchronizationGranularity:"paragraph"}),t&&e.reader.playMediaOverlay()});var f=t(".btn-mo-highlighter");f.on("click",function(){f.attr("aria-selected","false"),t(this).attr("aria-selected","true");var n=t(this).attr("data-mohighlight");e.reader.setStyles([{selector:".mo-active-default",declarations:undefined}],!0),n==="1"?e.reader.setStyles([{selector:".mo-active-default",declarations:{"background-color":"yellow !important",color:"black !important","border-color":"transparent !important","border-radius":"0.4em !important","box-shadow":"0px 0px 0.4em #333333 !important"}}],!0):n==="2"?e.reader.setStyles([{selector:".mo-active-default",declarations:{"background-color":"black !important",color:"white !important","border-color":"transparent !important","border-radius":"0.4em !important"}}],!0):n==="3"?e.reader.setStyles([{selector:".mo-active-default",declarations:{"background-color":"orange !important",color:"black !important","border-color":"transparent !important","border-radius":"0.4em !important"}}],!0):n==="4"?e.reader.setStyles([{selector:".mo-active-default",declarations:{"background-color":"blue !important",color:"white !important","border-color":"transparent !important","border-radius":"0.4em !important"}}],!0):n==="5"?e.reader.setStyles([{selector:".mo-active-default",declarations:{"background-color":"magenta !important",color:"black !important","border-color":"transparent !important","border-radius":"0.4em !important"}}],!0):n==="6"&&e.reader.setStyles([{selector:".mo-active-default",declarations:{"background-color":"#00FF00 !important",color:"black !important","border-color":"transparent !important","border-radius":"0.4em !important"}}],!0)}),a.on(a.MediaOverlaysEscape,"reader",e.reader.escapeMediaOverlay);var l=t("#btn-esc-audio");l.on("click",e.reader.escapeMediaOverlay);var c=t("#btn-previous-audio"),h=t("#btn-next-audio");a.on(a.MediaOverlaysPlayPause,"reader",e.reader.toggleMediaOverlay);var p=t("#btn-play-audio"),d=t("#btn-pause-audio");p.on("click",function(){var t=document.activeElement===p[0];e.reader.playMediaOverlay(),p.removeAttr("accesskey"),d.attr("accesskey",a.MediaOverlaysPlayPause),t&&setTimeout(function(){d[0].focus()},50)}),d.on("click",function(){var t=document.activeElement===d[0];e.reader.pauseMediaOverlay(),d.removeAttr("accesskey"),p.attr("accesskey",a.MediaOverlaysPlayPause),t&&setTimeout(function(){p[0].focus()},50)});var v=t("#btn-expand-audio"),m=t("#btn-collapse-audio"),g=function(e){e?(n.addClass("expanded-audio"),v.removeAttr("accesskey"),m.attr("accesskey",a.MediaOverlaysAdvancedPanelShowHide)):(n.removeClass("expanded-audio"),m.removeAttr("accesskey"),v.attr("accesskey",a.MediaOverlaysAdvancedPanelShowHide))};a.on(a.MediaOverlaysAdvancedPanelShowHide,"reader",function(){var e=undefined;n.hasClass("expanded-audio")?(g(!1),e=v[0]):(g(!0),e=m[0]),t(document.body).removeClass("hide-ui"),setTimeout(function(){e.focus()},50)}),v.on("click",function(){var e=document.activeElement===v[0];g(!0),e&&setTimeout(function(){m[0].focus()},50)}),m.on("click",function(){var e=document.activeElement===m[0];g(!1),e&&setTimeout(function(){v[0].focus()},50)});var y=t("#time-range-slider"),b=_.debounce(function(){inDebounce=!1;var t=y.val(),n=e.reader.package();if(!n)return;if(!n.media_overlay)return;var r={par:undefined},i={smilData:undefined},s={milliseconds:undefined};n.media_overlay.percentToPosition(t,i,r,s);if(!r.par||!r.par.text||!i.smilData)return;var o=i.smilData.href,u=s.milliseconds/1e3;e.reader.mediaOverlaysOpenContentUrl(r.par.text.src,o,u)},800),w=function(e,t,n){e.attr("aria-valuenow",t+""),e.attr("aria-value-now",t+""),e.attr("aria-valuetext",n+""),e.attr("aria-value-text",n+"")};y.on("change",function(){var t=y.val();t=Math.round(t),y.attr("data-value",t),w(y,t,t+"%"),e.reader.isPlayingMediaOverlay()&&e.reader.pauseMediaOverlay(),b()}),e.reader.on(ReadiumSDK.Events.MEDIA_OVERLAY_STATUS_CHANGED,function(t){var r=0,i="isPlaying"in t?t.isPlaying:!0,s=document.activeElement===p[0]||document.activeElement===d[0];i?(p.removeAttr("accesskey"),d.attr("accesskey",a.MediaOverlaysPlayPause)):(d.removeAttr("accesskey"),p.attr("accesskey",a.MediaOverlaysPlayPause)),n.toggleClass("isPlaying",i),s&&setTimeout(function(){(i?d[0]:p[0]).focus()},50),r=-1;if(typeof t.playPosition!="undefined"&&typeof t.smilIndex!="undefined"&&typeof t.parIndex!="undefined"){var o=e.reader.package(),u=t.playPosition*1e3;r=o.media_overlay.positionToPercent(t.smilIndex,t.parIndex,u),r<0&&(r=0)}r>=0&&(y.val(r),r=Math.round(r),y.attr("data-value",r),w(y,r,r+"%"))});var E=t("#btn-playback-scroll-disable"),S=t("#btn-playback-scroll-enable");E.on("click",function(){var t=document.activeElement===E[0];n.removeClass("playScroll"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysPreservePlaybackWhenScroll:!1}),s.get("reader",function(e){e||(e={}),e.mediaOverlaysPreservePlaybackWhenScroll=!1,s.put("reader",e)}),t&&setTimeout(function(){S[0].focus()},50)}),S.on("click",function(){var t=document.activeElement===S[0];n.addClass("playScroll"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysPreservePlaybackWhenScroll:!0}),s.get("reader",function(e){e||(e={}),e.mediaOverlaysPreservePlaybackWhenScroll=!0,s.put("reader",e)}),t&&setTimeout(function(){E[0].focus()},50)});var x=t("#btn-auto-page-turn-disable"),T=t("#btn-auto-page-turn-enable");x.on("click",function(){var t=document.activeElement===x[0];n.removeClass("autoPageTurn"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysAutomaticPageTurn:!1}),s.get("reader",function(e){e||(e={}),e.mediaOverlaysAutomaticPageTurn=!1,s.put("reader",e)}),t&&setTimeout(function(){T[0].focus()},50)}),T.on("click",function(){var t=document.activeElement===T[0];n.addClass("autoPageTurn"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysAutomaticPageTurn:!0}),s.get("reader",function(e){e||(e={}),e.mediaOverlaysAutomaticPageTurn=!0,s.put("reader",e)}),t&&setTimeout(function(){x[0].focus()},50)});var N=t("#btn-skip-audio-disable"),C=t("#btn-skip-audio-enable");N.on("click",function(){var t=document.activeElement===N[0];n.removeClass("skip"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysSkipSkippables:!1}),s.get("reader",function(e){e||(e={}),e.mediaOverlaysSkipSkippables=!1,s.put("reader",e)}),t&&setTimeout(function(){C[0].focus()},50)}),C.on("click",function(){var t=document.activeElement===C[0];n.addClass("skip"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysSkipSkippables:!0}),s.get("reader",function(e){e||(e={}),e.mediaOverlaysSkipSkippables=!0,s.put("reader",e)}),t&&setTimeout(function(){N[0].focus()},50)});var k=t("#btn-touch-audio-enable"),L=t("#btn-touch-audio-disable");k.on("click",function(){var t=document.activeElement===k[0];n.removeClass("no-touch"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysEnableClick:!0}),s.get("reader",function(e){e||(e={}),e.mediaOverlaysEnableClick=!0,s.put("reader",e)}),t&&setTimeout(function(){L[0].focus()},50)}),L.on("click",function(){var t=document.activeElement===L[0];n.addClass("no-touch"),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysEnableClick:!1}),s.get("reader",function(e){e||(e={}),e.mediaOverlaysEnableClick=!1,s.put("reader",e)}),t&&setTimeout(function(){k[0].focus()},50)});var A=t("#rate-range-slider"),O=t("#rate-range-slider-label"),M=function(t){var n=parseFloat(A.attr("min")),r=parseFloat(A.attr("max")),i=parseFloat(A.attr("step")),s=parseFloat(A.val());s+=t?-i:i,s>r&&(s=r),s<n&&(s=n);var o=(s===0?"~0":""+s)+"x";w(A,s,o),O[0].textContent=o,e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysRate:s}),A.val(""+s)};t("#buttRatePlus").on("click",function(){M(!1)}),a.on(a.MediaOverlaysRateIncrease,"reader",function(){M(!1)}),t("#buttRateMinus").on("click",function(){M(!0)}),a.on(a.MediaOverlaysRateDecrease,"reader",function(){M(!0)}),A.on("change",function(){var n=t(this).val(),r=(n==="0"?"~0":n)+"x";w(t(this),n,r),O[0].textContent=r,e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysRate:n})});var D=function(){A.val(1),w(A,"1","1x"),O[0].textContent="1x",e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysRate:1})};a.on(a.MediaOverlaysRateReset,"reader",D);var P=t("#btn-audio-rate");P.on("click",D);var H=t("#volume-range-slider"),B=function(t){var r=parseInt(H.val());r+=t?-20:20,r<0&&(r=0),r>100&&(r=100),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysVolume:r}),H.val(""+r),w(H,r,r+"%"),r===0?n.addClass("no-volume"):n.removeClass("no-volume")};t("#buttVolumePlus").on("click",function(){B(!1)}),a.on(a.MediaOverlaysVolumeIncrease,"reader",function(){B(!1)}),t("#buttVolumeMinus").on("click",function(){B(!0)}),a.on(a.MediaOverlaysVolumeDecrease,"reader",function(){B(!0)}),H.on("change",function(){var r=t(this).val();e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysVolume:r}),w(H,r,r+"%"),r==="0"?n.addClass("no-volume"):n.removeClass("no-volume")}),$volumeButtonMute=t("#btn-audio-volume-mute"),$volumeButtonUnMute=t("#btn-audio-volume-unmute");var j="0",F=function(){j=H.val(),e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysVolume:0}),H.val(0),w(H,0,"0%"),$volumeButtonMute.removeAttr("accesskey"),$volumeButtonUnMute.attr("accesskey",a.MediaOverlaysVolumeMuteToggle),n.addClass("no-volume")},I=function(){var t=j==="0"?"100":j;e.reader.updateSettings({doNotUpdateView:!0,mediaOverlaysVolume:t}),H.val(t),w(H,t,t+"%"),$volumeButtonUnMute.removeAttr("accesskey"),$volumeButtonMute.attr("accesskey",a.MediaOverlaysVolumeMuteToggle),n.removeClass("no-volume")};a.on(a.MediaOverlaysVolumeMuteToggle,"reader",function(){(n.hasClass("no-volume")?I:F)()}),$volumeButtonMute.on("click",function(){var e=document.activeElement===$volumeButtonMute[0];F(),e&&setTimeout(function(){$volumeButtonUnMute[0].focus()},50)}),$volumeButtonUnMute.on("click",function(){var e=document.activeElement===$volumeButtonUnMute[0];I(),e&&setTimeout(function(){$volumeButtonMute[0].focus()},50)}),a.on(a.MediaOverlaysPrevious,"reader",e.reader.previousMediaOverlay),c.on("click",e.reader.previousMediaOverlay),a.on(a.MediaOverlaysNext,"reader",e.reader.nextMediaOverlay),h.on("click",e.reader.nextMediaOverlay)};return{init:f}}),define("EpubReaderBackgroundAudioTrack",["module","jquery","bootstrap","Readium","Spinner","storage/Settings","i18n/Strings","Dialogs","Keyboard"],function(e,t,n,r,i,s,o,u,a){var f=function(e){if(!e.reader.backgroundAudioTrackManager)return;var n=t("#backgroundAudioTrack-div"),r=t("#backgroundAudioTrack-button-play"),i=t("#backgroundAudioTrack-button-pause");e.reader.backgroundAudioTrackManager.setCallback_PlayPause(function(e){e?(n.addClass("isPlaying"),r.removeAttr("accesskey"),i.attr("accesskey",a.BackgroundAudioPlayPause)):(n.removeClass("isPlaying"),i.removeAttr("accesskey"),r.attr("accesskey",a.BackgroundAudioPlayPause))}),e.reader.backgroundAudioTrackManager.setCallback_IsAvailable(function(e){e?n.removeClass("none"):n.addClass("none")}),a.on(a.BackgroundAudioPlayPause,"reader",function(){var t=!n.hasClass("isPlaying");e.reader.backgroundAudioTrackManager.setPlayState(t),e.reader.backgroundAudioTrackManager.playPause(t)}),r.on("click",function(){var t=document.activeElement===r[0];e.reader.backgroundAudioTrackManager.setPlayState(!0),e.reader.backgroundAudioTrackManager.playPause(!0),t&&setTimeout(function(){i[0].focus()},50)}),i.on("click",function(){var t=document.activeElement===i[0];e.reader.backgroundAudioTrackManager.setPlayState(!1),e.reader.backgroundAudioTrackManager.playPause(!1),t&&setTimeout(function(){r[0].focus()},50)})};return{init:f}}),function(e,t){function r(){if(n.READY)return;n.event.determineEventTypes(),n.utils.each(n.gestures,function(e){n.detection.register(e)}),n.event.onTouch(n.DOCUMENT,n.EVENT_MOVE,n.detection.detect),n.event.onTouch(n.DOCUMENT,n.EVENT_END,n.detection.detect),n.READY=!0}var n=function(e,t){return new n.Instance(e,t||{})};n.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},n.HAS_POINTEREVENTS=e.navigator.pointerEnabled||e.navigator.msPointerEnabled,n.HAS_TOUCHEVENTS="ontouchstart"in e,n.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,n.NO_MOUSEEVENTS=n.HAS_TOUCHEVENTS&&e.navigator.userAgent.match(n.MOBILE_REGEX),n.EVENT_TYPES={},n.DIRECTION_DOWN="down",n.DIRECTION_LEFT="left",n.DIRECTION_UP="up",n.DIRECTION_RIGHT="right",n.POINTER_MOUSE="mouse",n.POINTER_TOUCH="touch",n.POINTER_PEN="pen",n.EVENT_START="start",n.EVENT_MOVE="move",n.EVENT_END="end",n.DOCUMENT=e.document,n.plugins=n.plugins||{},n.gestures=n.gestures||{},n.READY=!1,n.utils={extend:function(n,r,i){for(var s in r){if(n[s]!==t&&i)continue;n[s]=r[s]}return n},each:function(e,n,r){var i,s;if("forEach"in e)e.forEach(n,r);else if(e.length!==t){for(i=0,s=e.length;i<s;i++)if(n.call(r,e[i],i,e)===!1)return}else for(i in e)if(e.hasOwnProperty(i)&&n.call(r,e[i],i,e)===!1)return},hasParent:function(e,t){while(e){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(t){var r=[],i=[];return n.utils.each(t,function(e){r.push(typeof e.clientX!="undefined"?e.clientX:e.pageX),i.push(typeof e.clientY!="undefined"?e.clientY:e.pageY)}),{pageX:(Math.min.apply(Math,r)+Math.max.apply(Math,r))/2,pageY:(Math.min.apply(Math,i)+Math.max.apply(Math,i))/2}},getVelocity:function(t,n,r){return{x:Math.abs(n/t)||0,y:Math.abs(r/t)||0}},getAngle:function(t,n){var r=n.pageY-t.pageY,i=n.pageX-t.pageX;return Math.atan2(r,i)*180/Math.PI},getDirection:function(t,r){var i=Math.abs(t.pageX-r.pageX),s=Math.abs(t.pageY-r.pageY);return i>=s?t.pageX-r.pageX>0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT:t.pageY-r.pageY>0?n.DIRECTION_UP:n.DIRECTION_DOWN},getDistance:function(t,n){var r=n.pageX-t.pageX,i=n.pageY-t.pageY;return Math.sqrt(r*r+i*i)},getScale:function(t,n){return t.length>=2&&n.length>=2?this.getDistance(n[0],n[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,n){return t.length>=2&&n.length>=2?this.getAngle(n[1],n[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==n.DIRECTION_UP||t==n.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(t,r){if(!r||!t||!t.style)return;n.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(e){n.utils.each(r,function(n){e&&(n=e+n.substring(0,1).toUpperCase()+n.substring(1)),n in t.style&&(t.style[n]=n)})}),r.userSelect=="none"&&(t.onselectstart=function(){return!1}),r.userDrag=="none"&&(t.ondragstart=function(){return!1})}},n.Instance=function(e,t){var i=this;return r(),this.element=e,this.enabled=!0,this.options=n.utils.extend(n.utils.extend({},n.defaults),t||{}),this.options.stop_browser_behavior&&n.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),n.event.onTouch(e,n.EVENT_START,function(e){i.enabled&&n.detection.startDetect(i,e)}),this},n.Instance.prototype={on:function(t,r){var i=t.split(" ");return n.utils.each(i,function(e){this.element.addEventListener(e,r,!1)},this),this},off:function(t,r){var i=t.split(" ");return n.utils.each(i,function(e){this.element.removeEventListener(e,r,!1)},this),this},trigger:function(t,r){r||(r={});var i=n.DOCUMENT.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=r;var s=this.element;return n.utils.hasParent(r.target,s)&&(s=r.target),s.dispatchEvent(i),this},enable:function(t){return this.enabled=t,this}};var i=null,s=!1,o=!1;n.event={bindDom:function(e,t,r){var i=t.split(" ");n.utils.each(i,function(t){e.addEventListener(t,r,!1)})},onTouch:function(t,r,u){var a=this;this.bindDom(t,n.EVENT_TYPES[r],function(f){var l=f.type.toLowerCase();if(l.match(/mouse/)&&o)return;l.match(/touch/)||l.match(/pointerdown/)||l.match(/mouse/)&&f.which===1?s=!0:l.match(/mouse/)&&!f.which&&(s=!1),l.match(/touch|pointer/)&&(o=!0);var c=0;if(s){n.HAS_POINTEREVENTS&&r!=n.EVENT_END?c=n.PointerEvent.updatePointer(r,f):l.match(/touch/)?c=f.touches.length:o||(c=l.match(/up/)?0:1),c>0&&r==n.EVENT_END?r=n.EVENT_MOVE:c||(r=n.EVENT_END);if(c||i===null)i=f;u.call(n.detection,a.collectEventData(t,r,a.getTouchList(i,r),f)),n.HAS_POINTEREVENTS&&r==n.EVENT_END&&(c=n.PointerEvent.updatePointer(r,f))}c||(i=null,s=!1,o=!1,n.PointerEvent.reset())})},determineEventTypes:function(){var t;n.HAS_POINTEREVENTS?t=n.PointerEvent.getEvents():n.NO_MOUSEEVENTS?t=["touchstart","touchmove","touchend touchcancel"]:t=["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],n.EVENT_TYPES[n.EVENT_START]=t[0],n.EVENT_TYPES[n.EVENT_MOVE]=t[1],n.EVENT_TYPES[n.EVENT_END]=t[2]},getTouchList:function(t){return n.HAS_POINTEREVENTS?n.PointerEvent.getTouchList():t.touches?t.touches:(t.identifier=1,[t])},collectEventData:function(t,r,i,s){var o=n.POINTER_TOUCH;if(s.type.match(/mouse/)||n.PointerEvent.matchType(n.POINTER_MOUSE,s))o=n.POINTER_MOUSE;return{center:n.utils.getCenter(i),timeStamp:(new Date).getTime(),target:s.target,touches:i,eventType:r,pointerType:o,srcEvent:s,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return n.detection.stopDetect()}}}},n.PointerEvent={pointers:{},getTouchList:function(){var e=this,t=[];return n.utils.each(e.pointers,function(e){t.push(e)}),t},updatePointer:function(e,t){return e==n.EVENT_END?this.pointers={}:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t),Object.keys(this.pointers).length},matchType:function(e,t){if(!t.pointerType)return!1;var r=t.pointerType,i={};return i[n.POINTER_MOUSE]=r===t.MSPOINTER_TYPE_MOUSE||r===n.POINTER_MOUSE,i[n.POINTER_TOUCH]=r===t.MSPOINTER_TYPE_TOUCH||r===n.POINTER_TOUCH,i[n.POINTER_PEN]=r===t.MSPOINTER_TYPE_PEN||r===n.POINTER_PEN,i[e]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},n.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,r){if(this.current)return;this.stopped=!1,this.current={inst:t,startEvent:n.utils.extend({},r),lastEvent:!1,name:""},this.detect(r)},detect:function(t){if(!this.current||this.stopped)return;t=this.extendEventData(t);var r=this.current.inst.options;return n.utils.each(this.gestures,function(e){if(!this.stopped&&r[e.name]!==!1&&e.handler.call(e,t,this.current.inst)===!1)return this.stopDetect(),!1},this),this.current&&(this.current.lastEvent=t),t.eventType==n.EVENT_END&&!t.touches.length-1&&this.stopDetect(),t},stopDetect:function(){this.previous=n.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(t){var r=this.current.startEvent;r&&(t.touches.length!=r.touches.length||t.touches===r.touches)&&(r.touches=[],n.utils.each(t.touches,function(e){r.touches.push(n.utils.extend({},e))}));var i=t.timeStamp-r.timeStamp,s=t.center.pageX-r.center.pageX,o=t.center.pageY-r.center.pageY,u=n.utils.getVelocity(i,s,o),a,f;return t.eventType==="end"?(a=this.current.lastEvent&&this.current.lastEvent.interimAngle,f=this.current.lastEvent&&this.current.lastEvent.interimDirection):(a=this.current.lastEvent&&n.utils.getAngle(this.current.lastEvent.center,t.center),f=this.current.lastEvent&&n.utils.getDirection(this.current.lastEvent.center,t.center)),n.utils.extend(t,{deltaTime:i,deltaX:s,deltaY:o,velocityX:u.x,velocityY:u.y,distance:n.utils.getDistance(r.center,t.center),angle:n.utils.getAngle(r.center,t.center),interimAngle:a,direction:n.utils.getDirection(r.center,t.center),interimDirection:f,scale:n.utils.getScale(r.touches,t.touches),rotation:n.utils.getRotation(r.touches,t.touches),startEvent:r}),t},register:function(r){var i=r.defaults||{};return i[r.name]===t&&(i[r.name]=!0),n.utils.extend(n.defaults,i,!0),r.index=r.index||1e3,this.gestures.push(r),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}},n.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(t,r){if(n.detection.current.name!=this.name&&this.triggered){r.trigger(this.name+"end",t),this.triggered=!1;return}if(r.options.drag_max_touches>0&&t.touches.length>r.options.drag_max_touches)return;switch(t.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:if(t.distance<r.options.drag_min_distance&&n.detection.current.name!=this.name)return;if(n.detection.current.name!=this.name){n.detection.current.name=this.name;if(r.options.correct_for_drag_min_distance&&t.distance>0){var i=Math.abs(r.options.drag_min_distance/t.distance);n.detection.current.startEvent.center.pageX+=t.deltaX*i,n.detection.current.startEvent.center.pageY+=t.deltaY*i,t=n.detection.extendEventData(t)}}if(n.detection.current.lastEvent.drag_locked_to_axis||r.options.drag_lock_to_axis&&r.options.drag_lock_min_distance<=t.distance)t.drag_locked_to_axis=!0;var s=n.detection.current.lastEvent.direction;t.drag_locked_to_axis&&s!==t.direction&&(n.utils.isVertical(s)?t.direction=t.deltaY<0?n.DIRECTION_UP:n.DIRECTION_DOWN:t.direction=t.deltaX<0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT),this.triggered||(r.trigger(this.name+"start",t),this.triggered=!0),r.trigger(this.name,t),r.trigger(this.name+t.direction,t),(r.options.drag_block_vertical&&n.utils.isVertical(t.direction)||r.options.drag_block_horizontal&&!n.utils.isVertical(t.direction))&&t.preventDefault();break;case n.EVENT_END:this.triggered&&r.trigger(this.name+"end",t),this.triggered=!1}}},n.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(t,r){switch(t.eventType){case n.EVENT_START:clearTimeout(this.timer),n.detection.current.name=this.name,this.timer=setTimeout(function(){n.detection.current.name=="hold"&&r.trigger("hold",t)},r.options.hold_timeout);break;case n.EVENT_MOVE:t.distance>r.options.hold_threshold&&clearTimeout(this.timer);break;case n.EVENT_END:clearTimeout(this.timer)}}},n.gestures.Release={name:"release",index:Infinity,handler:function(t,r){t.eventType==n.EVENT_END&&r.trigger(this.name,t)}},n.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(t,r){if(t.eventType==n.EVENT_END){if(r.options.swipe_max_touches>0&&t.touches.length<r.options.swipe_min_touches&&t.touches.length>r.options.swipe_max_touches)return;if(t.velocityX>r.options.swipe_velocity||t.velocityY>r.options.swipe_velocity)r.trigger(this.name,t),r.trigger(this.name+t.direction,t)}}},n.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(t,r){if(t.eventType==n.EVENT_END&&t.srcEvent.type!="touchcancel"){var i=n.detection.previous,s=!1;if(t.deltaTime>r.options.tap_max_touchtime||t.distance>r.options.tap_max_distance)return;i&&i.name=="tap"&&t.timeStamp-i.lastEvent.timeStamp<r.options.doubletap_interval&&t.distance<r.options.doubletap_distance&&(r.trigger("doubletap",t),s=!0);if(!s||r.options.tap_always)n.detection.current.name="tap",r.trigger(n.detection.current.name,t)}}},n.gestures.Touch={name:"touch",index:-Infinity,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(t,r){if(r.options.prevent_mouseevents&&t.pointerType==n.POINTER_MOUSE){t.stopDetect();return}r.options.prevent_default&&t.preventDefault(),t.eventType==n.EVENT_START&&r.trigger(this.name,t)}},n.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(t,r){if(n.detection.current.name!=this.name&&this.triggered){r.trigger(this.name+"end",t),this.triggered=!1;return}if(t.touches.length<2)return;r.options.transform_always_block&&t.preventDefault();switch(t.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:var i=Math.abs(1-t.scale),s=Math.abs(t.rotation);if(i<r.options.transform_min_scale&&s<r.options.transform_min_rotation)return;n.detection.current.name=this.name,this.triggered||(r.trigger(this.name+"start",t),this.triggered=!0),r.trigger(this.name,t),s>r.options.transform_min_rotation&&r.trigger("rotate",t),i>r.options.transform_min_scale&&(r.trigger("pinch",t),r.trigger("pinch"+(t.scale<1?"in":"out"),t));break;case n.EVENT_END:this.triggered&&r.trigger(this.name+"end",t),this.triggered=!1}}},typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("hammer",[],function(){return n}):typeof module=="object"&&typeof module.exports=="object"?module.exports=n:e.Hammer=n}(this),function(e,t){function n(e,n){e.event.bindDom=function(e,r,i){n(e).on(r,function(e){var n=e.originalEvent||e;n.pageX===t&&(n.pageX=e.pageX,n.pageY=e.pageY),n.target||(n.target=e.target),n.which===t&&(n.which=n.button),n.preventDefault||(n.preventDefault=e.preventDefault),n.stopPropagation||(n.stopPropagation=e.stopPropagation),i.call(this,n)})},e.Instance.prototype.on=function(e,t){return n(this.element).on(e,t)},e.Instance.prototype.off=function(e,t){return n(this.element).off(e,t)},e.Instance.prototype.trigger=function(e,t){var r=n(this.element);return r.has(t.target).length&&(r=n(t.target)),r.trigger({type:e,gesture:t})},n.fn.hammer=function(t){return this.each(function(){var r=n(this),i=r.data("hammer");i?i&&t&&e.utils.extend(i.options,t):r.data("hammer",new e(this,t||{}))})}}typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("jquery_hammer",["hammer","jquery"],n):n(e.Hammer,e.jQuery||e.Zepto)}(this),define("gestures",["jquery","jquery_hammer","hammer"],function(e,t,n){var r=function(t,r){var i=function(){t.openPageRight()},s=function(){t.openPageLeft()},o=function(){var e=t.getCurrentViewType();return e===ReadiumSDK.Views.ReaderView.VIEW_TYPE_FIXED||e==ReadiumSDK.Views.ReaderView.VIEW_TYPE_COLUMNIZED};this.initialize=function(){t.on(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,function(t,r){n.DOCUMENT=t.contents(),n.event.onTouch(n.DOCUMENT,n.EVENT_MOVE,n.detection.detect),n.event.onTouch(n.DOCUMENT,n.EVENT_END,n.detection.detect);var u={prevent_mouseevents:!0};n(n.DOCUMENT,u).on("swipeleft",function(){i()}),n(n.DOCUMENT,u).on("swiperight",function(){s()}),e(n.DOCUMENT).on("touchmove",function(e){o()&&e.preventDefault()})}),e(r).on("touchmove",function(e){o()&&e.preventDefault()}),e(r).hammer().on("swipeleft",function(){i()}),e(r).hammer().on("swiperight",function(){s()})}};return r}),define("EpubReader",["module","jquery","bootstrap","URIjs","Readium","Spinner","storage/Settings","i18n/Strings","Dialogs","ReaderSettingsDialog","hgn!templates/about-dialog.html","hgn!templates/reader-navbar.html","hgn!templates/reader-body.html","hgn!templates/reader-body-page-btns.html","analytics/Analytics","screenfull","Keyboard","EpubReaderMediaOverlays","EpubReaderBackgroundAudioTrack","gestures","versioning/Versioning"],function(e,t,n,r,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){function q(e,t){var n=e.match(/\d+/g);if(n==undefined)return"";var r=0;for(i=0;i<n.length;i++)r+=parseInt(n[i]);return Math.round(r/n.length/t*100*10)/10}var S,x,T,N=document.documentElement,C,k,L=function(e,n,r){S.openPackageDocument(e,function(e,n){C=e,C.generateTocListDOM(function(e){P(e)}),wasFixed=S.reader.isCurrentViewFixedLayout();var r=n.metadata;t('<h2 class="book-title-header"></h2>').insertAfter(".navbar").text(r.title),t("#left-page-btn").unbind("click"),t("#right-page-btn").unbind("click");var i=t("#readium-page-btns");i.empty();var s=C.getPageProgressionDirection()==="rtl";i.append(d({strings:a,dialogs:f,keyboard:g,pageProgressionDirectionIsRTL:s})),t("#left-page-btn").on("click",W),t("#right-page-btn").on("click",z)},r)},A=function(){if(o.willSpin||o.isSpinning)return;o.willSpin=!0,setTimeout(function(){if(o.stopRequested){o.willSpin=!1,o.stopRequested=!1;return}o.isSpinning=!0,o.spin(t("#reading-area")[0]),o.willSpin=!1},100)},O=function(){t(document.body).removeClass("hide-ui");var e=t("#app-container"),n=e.hasClass("toc-visible"),r;S.reader.handleViewportResize&&!x&&(r=JSON.parse(S.reader.bookmarkCurrentPage())),n?(e.removeClass("toc-visible"),setTimeout(function(){t("#tocButt")[0].focus()},100)):(e.addClass("toc-visible"),setTimeout(function(){t("#readium-toc-body button.close")[0].focus()},100)),x?F(null,!0):S.reader.handleViewportResize&&(S.reader.handleViewportResize(),setTimeout(function(){S.reader.openSpineItemElementCfi(r.idref,r.contentCFI,S.reader)},90))},M=function(){t(".zoom-wrapper").show()},_=function(){var e=S.reader.getViewScale();t(".zoom-wrapper input").val(Math.round(e)+"%")},D=function(){t(".zoom-wrapper").hide()},P=function(e){t("script",e).remove();var n,i=t("nav",e);Array.prototype.every.call(i,function(e){return e.getAttributeNS("http://www.idpf.org/2007/ops","type")=="toc"?(n=e,!1):!0});var s=!1,u=n;while(u&&u.getAttributeNS){var f=u.getAttributeNS("http://www.w3.org/1999/xhtml","dir")||u.getAttribute("dir");if(f&&f==="rtl"){s=!0;break}u=u.parentNode}var l=n&&t(n).html()||t("body",e).html()||t(e).html(),c=C.getToc();if(l&&l.length){var h=t(l);t("iframe",h).remove(),t("#readium-toc-body").append(h),s&&(h[0].setAttributeNS("http://www.w3.org/1999/xhtml","dir","rtl"),h[0].style.direction="rtl")}var p=!1,d=undefined,v;S.reader.on(ReadiumSDK.Events.FXL_VIEW_RESIZED,_),S.reader.on(ReadiumSDK.Events.CONTENT_DOCUMENT_LOADED,function(e,t){var n=S.reader.isCurrentViewFixedLayout();n?M():D(),e.attr("title","EPUB"),e.attr("aria-label","EPUB"),d=e[0]}),S.reader.on(ReadiumSDK.Events.PAGINATION_CHANGED,function(e){U(),R(e),I(e),o.isSpinning?(o.stop(),o.isSpinning=!1):o.willSpin&&(o.stopRequested=!0);if(!p)return;p=!1;try{var n=undefined,r=undefined,i=e.elementId;if(!i){var s=JSON.parse(S.reader.bookmarkCurrentPage());if(e.spineItem){r=S.reader.getElementByCfi(e.spineItem,s.contentCFI,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"]),r=r[0];if(r){n=t("#epub-reader-frame iframe")[0];var u=(n.contentWindow||n.contentDocument).document;r.ownerDocument!==u&&(n=t("#epub-reader-frame iframe")[1],n&&(u=(n.contentWindow||n.contentDocument).document,r.ownerDocument!==u&&(n=undefined)))}}}else{n=t("#epub-reader-frame iframe")[0];var u=(n.contentWindow||n.contentDocument).document;r=u.getElementById(i),r||(n=t("#epub-reader-frame iframe")[1],n&&(u=(n.contentWindow||n.contentDocument).document,r=u.getElementById(i),r||(n=undefined)))}n||(n=d);if(n){var a=n;setTimeout(function(){a.focus()},50)}}catch(f){}}),t("#readium-toc-body").on("click","a",function(e){A();var n=t(this).attr("href");return n=c?(new r(n)).absoluteTo(c).toString():n,p=!0,S.reader.openContentUrl(n),x&&(t(".toc-visible").removeClass("toc-visible"),t(document.body).removeClass("hide-ui")),!1}),t("#readium-toc-body").prepend('<button tabindex="50" type="button" class="close" data-dismiss="modal" aria-label="'+a.i18n_close+" "+a.toc+'" title="'+a.i18n_close+" "+a.toc+'"><span aria-hidden="true">&times;</span></button>'),t("#readium-toc-body button.close").on("click",function(){return O(),!1})},H=function(){if(!m.enabled)return;m.toggle()};m.onchange=function(e){var n;m.isFullscreen?(n=a.exit_fullscreen+" ["+g.FullScreenToggle+"]",t("#buttFullScreenToggle span").removeClass("glyphicon-resize-full"),t("#buttFullScreenToggle span").addClass("glyphicon-resize-small"),t("#buttFullScreenToggle").attr("aria-label",n),t("#buttFullScreenToggle").attr("title",n)):(n=a.enter_fullscreen+" ["+g.FullScreenToggle+"]",t("#buttFullScreenToggle span").removeClass("glyphicon-resize-small"),t("#buttFullScreenToggle span").addClass("glyphicon-resize-full"),t("#buttFullScreenToggle").attr("aria-label",n),t("#buttFullScreenToggle").attr("title",n))};var B=function(){j=null;if(!x&&t("#app-container").hasClass("toc-visible"))return;var e=document.getElementById("app-navbar");if(document.activeElement){var n=jQuery.contains(e,document.activeElement);if(n)return}var r=t(e),i=r.find(":hover").length>0;if(i)return;if(t("#audioplayer").hasClass("expanded-audio"))return;t(document.body).addClass("hide-ui")},j,F=function(e,n){j&&(window.clearTimeout(j),j=null),!t("#app-container").hasClass("toc-visible")&&t(document.body).hasClass("hide-ui")&&t(document.body).removeClass("hide-ui"),n?B():j=window.setTimeout(B,4e3)},I=function(e){var n=e.paginationInfo.firstOpenPage();if(n){var r=e.paginationInfo.getPageNumbers(),i=e.paginationInfo.getTotalPageCount(),s=(i?r:"?")+" von "+(i?i:"?");t("#pagination-numbering").text(s);if(i){var o;e.paginationInfo.canGoLeft()?e.paginationInfo.canGoRight()?(o=q(r,i),o=o>100?100:o):o=100:o=0,t("#pagination-in-percent").text(o+" %")}else t("#pagination-in-percent").text("?")}},R=function(e){e.paginationInfo.canGoLeft()?t("#left-page-btn").show():t("#left-page-btn").hide(),e.paginationInfo.canGoRight()?t("#right-page-btn").show():t("#right-page-btn").hide()},U=function(){u.put(T,S.reader.bookmarkCurrentPage(),t.noop)},z=function(){return S.reader.openPageRight(),!1},W=function(){return S.reader.openPageLeft(),!1},X=function(){t(".icon-annotations").on("click",function(){S.reader.addSelectionHighlight(Math.floor(Math.random()*1e6),"highlight")});var e=function(){return document.activeElement&&(document.activeElement===document.getElementById("volume-range-slider")||document.activeElement===document.getElementById("time-range-slider")||document.activeElement===document.getElementById("rate-range-slider")||jQuery.contains(document.getElementById("mo-sync-form"),document.activeElement)||jQuery.contains(document.getElementById("mo-highlighters"),document.activeElement))},n=function(){if(!x&&t("#app-container").hasClass("toc-visible"))return;t(document.body).addClass("hide-ui"),document.activeElement&&document.activeElement.blur()};t("#buttHideToolBar").on("click",n),g.on(g.ToolbarHide,"reader",n);var r=function(){t("#aboutButt1")[0].focus(),t(document.body).removeClass("hide-ui"),setTimeout(function(){t("#aboutButt1")[0].focus()},50)};t("#buttShowToolBar").on("click",r),g.on(g.ToolbarShow,"reader",r),g.on(g.PagePrevious,"reader",function(){e()||W()}),g.on(g.PagePreviousAlt,"reader",W),g.on(g.PageNextAlt,"reader",z),g.on(g.PageNext,"reader",function(){e()||z()}),g.on(g.FullScreenToggle,"reader",H),t("#buttFullScreenToggle").on("click",H);var i=function(){t("html").attr("data-theme","library"),t(window).trigger("loadlibrary")};g.on(g.SwitchToLibrary,"reader",i),t(".icon-library").on("click",function(){return i(),!1}),t(".zoom-wrapper input").on("click",function(){if(!this.disabled)return this.focus(),!1}),g.on(g.TocShowHideToggle,"reader",function(){var e=t("#app-container").hasClass("toc-visible");e?setTimeout(function(){t("#readium-toc-body button.close")[0].focus()},100):O()}),t(".icon-toc").on("click",O);var s=function(){var e=t(document.body).height()-t("#app-container")[0].offsetTop;t("#app-container").height(e),t("#readium-toc-body").height(e)};g.on(g.ShowSettingsModal,"reader",function(){t("#settings-dialog").modal("show")}),g.on(g.MetadataDialog,"reader",function(){showMetadata(T,"reader")}),t(window).on("mousemove",F),t(window).on("resize",s),s(),F(),document.addEventListener("click",F,!0)},V=function(e){return S.reader.setZoom({style:"fit-screen"}),t(".active-zoom").removeClass("active-zoom"),t("#zoom-fit-screen").addClass("active-zoom"),t(".zoom-wrapper input").prop("disabled",!0),t(".zoom-wrapper>a").dropdown("toggle"),!1},$=function(e){return S.reader.setZoom({style:"fit-width"}),t(".active-zoom").removeClass("active-zoom"),t("#zoom-fit-width").addClass("active-zoom"),t(".zoom-wrapper input").prop("disabled",!0),t(".zoom-wrapper>a").dropdown("toggle"),!1},J=function(e){return t(".zoom-wrapper input").prop("disabled",!1).focus(),t(".active-zoom").removeClass("active-zoom"),t("#zoom-custom").addClass("active-zoom"),t(".zoom-wrapper>a").dropdown("toggle"),!1},K=/^\s*(\d+)%?\s*$/,Q=function(e){var n=t(".zoom-wrapper input").val(),r=K.exec(n);if(r){var i=Number(r[1])/100;S.reader.setZoom({style:"user",scale:i})}else _()},G=function(){t(".modal-backdrop").remove();var e=t("#app-container");e.empty(),e.append(p({strings:a,dialogs:f,keyboard:g})),t("nav").empty(),t("nav").attr("aria-label",a.i18n_toolbar),t("nav").append(h({strings:a,dialogs:f,keyboard:g})),X(),document.title="Readium",t("#zoom-fit-width a").on("click",$),t("#zoom-fit-screen a").on("click",V),t("#zoom-custom a").on("click",J),t(".zoom-wrapper input").on("change",Q),A()},Y=function(e){g.scope("reader"),T=e.epub,v.trackView("/reader"),x=e.embedded,G(),S&&S.reader&&S.reader.off(),setTimeout(function(){Z()},0)},Z=function(){u.getMultiple(["reader",T],function(n){var r=self.location&&self.location.origin&&self.location.pathname?self.location.origin+self.location.pathname+"/..":"",i={el:"#epub-reader-frame",annotationCSSUrl:e.config().annotationCssUrl||r+"/css/annotations.css",mathJaxUrl:r+e.config().mathJaxUrl},o={jsLibRoot:"./lib/thirdparty/",openBookOptions:{}};e.config().useSimpleLoader&&(o.useSimpleLoader=!0);var f;if(n[T]){var h=JSON.parse(JSON.parse(n[T]));f={idref:h.idref,elementCfi:h.contentCFI}}S=new s(o,i),k=new w(S.reader,i.el),k.initialize(),E.getVersioningInfo(function(e){t("#app-container").append(c({strings:a,viewer:e.viewer,readium:e.readiumJs,sharedJs:e.readiumSharedJs})),window.navigator.epubReadingSystem.name="readium-js-viewer",window.navigator.epubReadingSystem.version=e.viewer.version,window.navigator.epubReadingSystem.readium={},window.navigator.epubReadingSystem.readium.buildInfo={},window.navigator.epubReadingSystem.readium.buildInfo.dateTime=e.viewer.dateTimeString,window.navigator.epubReadingSystem.readium.buildInfo.version=e.viewer.version,window.navigator.epubReadingSystem.readium.buildInfo.chromeVersion=e.viewer.chromeVersion,window.navigator.epubReadingSystem.readium.buildInfo.gitRepositories=[];var n={};n.name="readium-js-viewer",n.sha=e.viewer.sha,n.tag=e.viewer.tag,n.clean=e.viewer.clean,n.url="https://github.com/readium/"+n.name+"/tree/"+n.sha,window.navigator.epubReadingSystem.readium.buildInfo.gitRepositories.push(n);var r={};r.name="readium-js",r.sha=e.readiumJs.sha,r.tag=e.readiumJs.tag,r.clean=e.readiumJs.clean,r.url="https://github.com/readium/"+r.name+"/tree/"+r.sha,window.navigator.epubReadingSystem.readium.buildInfo.gitRepositories.push(r);var i={};i.name="readium-shared-js",i.sha=e.readiumSharedJs.sha,i.tag=e.readiumSharedJs.tag,i.clean=e.readiumSharedJs.clean,i.url="https://github.com/readium/"+i.name+"/tree/"+i.sha,window.navigator.epubReadingSystem.readium.buildInfo.gitRepositories.push(i)}),t(window).on("keyup",function(e){(e.keyCode===9||e.which===9)&&t(document.body).removeClass("hide-ui")}),S.reader.addIFrameEventListener("mousemove",function(){F()}),S.reader.addIFrameEventListener("keydown",function(e){g.dispatch(document.documentElement,e.originalEvent)}),S.reader.addIFrameEventListener("keyup",function(e){g.dispatch(document.documentElement,e.originalEvent)}),S.reader.addIFrameEventListener("focus",function(e){t(window).trigger("focus")}),l.initDialog(S.reader),t("#settings-dialog").on("hidden.bs.modal",function(){g.scope("reader"),t(document.body).removeClass("hide-ui"),setTimeout(function(){t("#settbutt1").focus()},50),t("#buttSave").removeAttr("accesskey"),t("#buttClose").removeAttr("accesskey")}),t("#settings-dialog").on("shown.bs.modal",function(){g.scope("settings"),t("#buttSave").attr("accesskey",g.accesskeys.SettingsModalSave),t("#buttClose").attr("accesskey",g.accesskeys.SettingsModalClose)}),t("#about-dialog").on("hidden.bs.modal",function(){g.scope("reader"),t(document.body).removeClass("hide-ui"),setTimeout(function(){t("#aboutButt1").focus()},50)}),t("#about-dialog").on("shown.bs.modal",function(){g.scope("about")});var p;n.reader&&(p=JSON.parse(n.reader)),x?S.reader.updateSettings({syntheticSpread:"auto",scroll:"auto"}):(p=p||l.defaultSettings,l.updateReader(S.reader,p));var d=function(){x||u.get("reader",function(e){e||(e={});var t=e.theme==="night-theme";e.theme=t?"author-theme":"night-theme",u.put("reader",e),l.updateReader(S.reader,e)})};t("#buttNightTheme").on("click",d),g.on(g.NightTheme,"reader",d),S.reader.on(ReadiumSDK.Events.CONTENT_DOCUMENT_LOAD_START,function(e,t){A()}),y.init(S),b.init(S),L(T,p,f),S.reader.on("annotationClicked",function(e,t,n,r){S.reader.removeHighlight(r)})})},et=function(){S&&S.closePackageDocument(),f.closeModal(),f.reset(),t("#settings-dialog").modal("hide"),t("#about-dialog").modal("hide"),t(".modal-backdrop").remove(),g.off("reader"),g.off("settings"),t("#settings-dialog").off("hidden.bs.modal"),t("#settings-dialog").off("shown.bs.modal"),t("#about-dialog").off("hidden.bs.modal"),t("#about-dialog").off("shown.bs.modal"),S&&S.reader&&S.reader.pauseMediaOverlay(),t(window).off("resize"),t(window).off("mousemove"),t(window).off("keyup"),t(window).off("message"),window.clearTimeout(j),t(document.body).removeClass("embedded"),document.removeEventListener("click",F,!0),t(".book-title-header").remove(),t(document.body).removeClass("hide-ui")},tt=function(e){u.get("reader",function(t){g.applySettings(t),Y(e)})};return{loadUI:tt,unloadUI:et}}),require(["jquery","EpubLibrary","EpubReader"],function(e,t,n){var r=function(){var e=window.location.search;e&&e.length&&(e=e.substring(1));if(e.length){var t=e.split("&");for(var n=0;n<t.length;n++){var r=t[n].split("=");if(r[0]=="epub"&&r.length==2)return r[1]}}return null},i=function(){var i=r();i?n.loadUI({epub:decodeURIComponent(i)}):t.loadUI(),e(document.body).on("click",function(){e(document.body).removeClass("keyboard")}),e(document).on("keyup",function(t){e(document.body).addClass("keyboard")})};e(i);var s=e.noop;window.history&&window.history.pushState&&(e(window).on("popstate",function(){var e=history.state;e&&e.epub?a(e.epub):u()}),s=function(e,t,n){history.pushState(e,t,n)});var o="nav *[title]",u=function(){e(o).tooltip("destroy"),n.unloadUI(),t.loadUI()},a=function(r){e(o).tooltip("destroy"),t.unloadUI(),n.loadUI({epub:r})};e(window).on("readepub",function(e,t){a(t),s({epub:t},"Readium Viewer","?epub="+encodeURIComponent(t))}),e(window).on("loadlibrary",function(e){u(),s(null,"Readium Library","index.html")}),e(document.body).tooltip({selector:o,placement:"auto",container:"body"}).on("show.bs.tooltip",function(t){e(o).not(t.target).tooltip("destroy")})}),define("ReadiumViewer",function(){});